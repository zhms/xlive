import{r as ref,X as onMounted,N as nextTick,Z as onPopupReopen,K as watch,P as windowWidth,Q as windowHeight,O as useRect,g as createVNode,A as createNamespace,E as defineComponent,U as useChildren,S as truthProp,R as withInstall,I as extend,a9 as useParent,c as computed,V as useExpose,af as getCurrentInstance,C as makeStringProp,B as numericProp,aa as unknownProp,a3 as isDef,an as Icon,aq as getRootScrollTop,a5 as setRootScrollTop,ar as isObject,as as isPromise,at as isFunction,D as makeNumericProp,G as reactive,a2 as addUnit,ab as provide,L as useEventListener,au as FORM_KEY,av as toArray,aw as formatNumber,$ as preventDefault,ax as CUSTOM_FIELD_INJECTION_KEY,ad as mergeProps,k as createTextVNode,ay as resetScroll,az as popupSharedProps,aA as popupSharedPropKeys,ae as pick,aB as Popup,aC as withKeys,aD as noop,aE as BORDER_LEFT,aF as BORDER_TOP,a7 as callInterceptor,t as inBrowser,aG as mountComponent,aH as usePopupState,z as onMountedOrActivated,w as withDirectives,ac as vShow,_ as doubleRaf,m as raf,aI as commonjsGlobal,a as useMyFetch,o as openBlock,e as createElementBlock,f as createBaseVNode,aJ as Fragment,aK as renderList,aL as normalizeClass,al as toDisplayString,i as unref,aM as checkFetchError,ah as useIntervalFn,aN as sleep,p as pushScopeId,l as popScopeId,ag as lib,b as useStorage,ak as createCommentVNode,v as vModelText,h as withCtx,am as showToast,ai as createBlock}from"./index-43cd4b4c.js";import{a as routeProps,u as useRoute,B as Button,_ as _export_sfc}from"./plugin-vueexport-helper-ee25f61a.js";const useHeight=(o,k)=>{const e=ref(),r=()=>{e.value=useRect(o).height};return onMounted(()=>{if(nextTick(r),k)for(let i=1;i<=3;i++)setTimeout(r,100*i)}),onPopupReopen(()=>nextTick(r)),watch([windowWidth,windowHeight],r),e};function usePlaceholder(o,k){const e=useHeight(o,!0);return r=>createVNode("div",{class:k("placeholder"),style:{height:e.value?`${e.value}px`:void 0}},[r()])}const[name$5,bem$5]=createNamespace("action-bar"),ACTION_BAR_KEY=Symbol(name$5),actionBarProps={placeholder:Boolean,safeAreaInsetBottom:truthProp};var stdin_default$5=defineComponent({name:name$5,props:actionBarProps,setup(o,{slots:k}){const e=ref(),r=usePlaceholder(e,bem$5),{linkChildren:i}=useChildren(ACTION_BAR_KEY);i();const s=()=>{var n;return createVNode("div",{ref:e,class:[bem$5(),{"van-safe-area-bottom":o.safeAreaInsetBottom}]},[(n=k.default)==null?void 0:n.call(k)])};return()=>o.placeholder?r(s):s()}});const ActionBar=withInstall(stdin_default$5),[name$4,bem$4]=createNamespace("action-bar-button"),actionBarButtonProps=extend({},routeProps,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var stdin_default$4=defineComponent({name:name$4,props:actionBarButtonProps,setup(o,{slots:k}){const e=useRoute(),{parent:r,index:i}=useParent(ACTION_BAR_KEY),s=computed(()=>{if(r){const u=r.children[i.value-1];return!(u&&"isButton"in u)}}),n=computed(()=>{if(r){const u=r.children[i.value+1];return!(u&&"isButton"in u)}});return useExpose({isButton:!0}),()=>{const{type:u,icon:p,text:d,color:m,loading:c,disabled:h}=o;return createVNode(Button,{class:bem$4([u,{last:n.value,first:s.value}]),size:"large",type:u,icon:p,color:m,loading:c,disabled:h,onClick:e},{default:()=>[k.default?k.default():d]})}}});const ActionBarButton=withInstall(stdin_default$4);let current=0;function useId(){const o=getCurrentInstance(),{name:k="unknown"}=(o==null?void 0:o.type)||{};return`${k}-${++current}`}const[name$3,bem$3]=createNamespace("cell"),cellSharedProps={tag:makeStringProp("div"),icon:String,size:String,title:numericProp,value:numericProp,label:numericProp,center:Boolean,isLink:Boolean,border:truthProp,required:Boolean,iconPrefix:String,valueClass:unknownProp,labelClass:unknownProp,titleClass:unknownProp,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}},cellProps=extend({},cellSharedProps,routeProps);var stdin_default$3=defineComponent({name:name$3,props:cellProps,setup(o,{slots:k}){const e=useRoute(),r=()=>{if(k.label||isDef(o.label))return createVNode("div",{class:[bem$3("label"),o.labelClass]},[k.label?k.label():o.label])},i=()=>{var p;if(k.title||isDef(o.title)){const d=(p=k.title)==null?void 0:p.call(k);return Array.isArray(d)&&d.length===0?void 0:createVNode("div",{class:[bem$3("title"),o.titleClass],style:o.titleStyle},[d||createVNode("span",null,[o.title]),r()])}},s=()=>{const p=k.value||k.default;if(p||isDef(o.value))return createVNode("div",{class:[bem$3("value"),o.valueClass]},[p?p():createVNode("span",null,[o.value])])},n=()=>{if(k.icon)return k.icon();if(o.icon)return createVNode(Icon,{name:o.icon,class:bem$3("left-icon"),classPrefix:o.iconPrefix},null)},u=()=>{if(k["right-icon"])return k["right-icon"]();if(o.isLink){const p=o.arrowDirection&&o.arrowDirection!=="right"?`arrow-${o.arrowDirection}`:"arrow";return createVNode(Icon,{name:p,class:bem$3("right-icon")},null)}};return()=>{var p;const{tag:d,size:m,center:c,border:h,isLink:a,required:y}=o,T=(p=o.clickable)!=null?p:a,v={center:c,required:y,clickable:T,borderless:!h};return m&&(v[m]=!!m),createVNode(d,{class:bem$3(v),role:T?"button":void 0,tabindex:T?0:void 0,onClick:e},{default:()=>{var g;return[n(),i(),s(),u(),(g=k.extra)==null?void 0:g.call(k)]}})}}});const Cell=withInstall(stdin_default$3);function isEmptyValue(o){return Array.isArray(o)?!o.length:o===0?!1:!o}function runSyncRule(o,k){if(isEmptyValue(o)){if(k.required)return!1;if(k.validateEmpty===!1)return!0}return!(k.pattern&&!k.pattern.test(String(o)))}function runRuleValidator(o,k){return new Promise(e=>{const r=k.validator(o,k);if(isPromise(r)){r.then(e);return}e(r)})}function getRuleMessage(o,k){const{message:e}=k;return isFunction(e)?e(o,k):e||""}function startComposing({target:o}){o.composing=!0}function endComposing({target:o}){o.composing&&(o.composing=!1,o.dispatchEvent(new Event("input")))}function resizeTextarea(o,k){const e=getRootScrollTop();o.style.height="auto";let r=o.scrollHeight;if(isObject(k)){const{maxHeight:i,minHeight:s}=k;i!==void 0&&(r=Math.min(r,i)),s!==void 0&&(r=Math.max(r,s))}r&&(o.style.height=`${r}px`,setRootScrollTop(e))}function mapInputType(o){return o==="number"?{type:"text",inputmode:"decimal"}:o==="digit"?{type:"tel",inputmode:"numeric"}:{type:o}}function getStringLength(o){return[...o].length}function cutString(o,k){return[...o].slice(0,k).join("")}const[name$2,bem$2]=createNamespace("field"),fieldSharedProps={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:numericProp,formatter:Function,clearIcon:makeStringProp("clear"),modelValue:makeNumericProp(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:makeStringProp("focus"),formatTrigger:makeStringProp("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},fieldProps=extend({},cellSharedProps,fieldSharedProps,{rows:numericProp,type:makeStringProp("text"),rules:Array,autosize:[Boolean,Object],labelWidth:numericProp,labelClass:unknownProp,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var stdin_default$2=defineComponent({name:name$2,props:fieldProps,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(o,{emit:k,slots:e}){const r=useId(),i=reactive({status:"unvalidated",focused:!1,validateMessage:""}),s=ref(),n=ref(),u=ref(),{parent:p}=useParent(FORM_KEY),d=()=>{var V;return String((V=o.modelValue)!=null?V:"")},m=V=>{if(isDef(o[V]))return o[V];if(p&&isDef(p.props[V]))return p.props[V]},c=computed(()=>{const V=m("readonly");if(o.clearable&&!V){const D=d()!=="",Q=o.clearTrigger==="always"||o.clearTrigger==="focus"&&i.focused;return D&&Q}return!1}),h=computed(()=>u.value&&e.input?u.value():o.modelValue),a=V=>V.reduce((D,Q)=>D.then(()=>{if(i.status==="failed")return;let{value:G}=h;if(Q.formatter&&(G=Q.formatter(G,Q)),!runSyncRule(G,Q)){i.status="failed",i.validateMessage=getRuleMessage(G,Q);return}if(Q.validator)return isEmptyValue(G)&&Q.validateEmpty===!1?void 0:runRuleValidator(G,Q).then(B=>{B&&typeof B=="string"?(i.status="failed",i.validateMessage=B):B===!1&&(i.status="failed",i.validateMessage=getRuleMessage(G,Q))})}),Promise.resolve()),y=()=>{i.status="unvalidated",i.validateMessage=""},T=()=>k("endValidate",{status:i.status,message:i.validateMessage}),v=(V=o.rules)=>new Promise(D=>{y(),V?(k("startValidate"),a(V).then(()=>{i.status==="failed"?(D({name:o.name,message:i.validateMessage}),T()):(i.status="passed",D(),T())})):D()}),g=V=>{if(p&&o.rules){const{validateTrigger:D}=p.props,Q=toArray(D).includes(V),G=o.rules.filter(B=>B.trigger?toArray(B.trigger).includes(V):Q);G.length&&v(G)}},b=V=>{var D;const{maxlength:Q}=o;if(isDef(Q)&&getStringLength(V)>+Q){const G=d();if(G&&getStringLength(G)===+Q)return G;const B=(D=s.value)==null?void 0:D.selectionEnd;if(i.focused&&B){const q=[...V],H=q.length-+Q;return q.splice(B-H,H),q.join("")}return cutString(V,+Q)}return V},S=(V,D="onChange")=>{const Q=V;V=b(V);const G=getStringLength(Q)-getStringLength(V);if(o.type==="number"||o.type==="digit"){const q=o.type==="number";V=formatNumber(V,q,q)}let B=0;if(o.formatter&&D===o.formatTrigger){const{formatter:q,maxlength:H}=o;if(V=q(V),isDef(H)&&getStringLength(V)>+H&&(V=cutString(V,+H)),s.value&&i.focused){const{selectionEnd:K}=s.value,Z=cutString(Q,K);B=getStringLength(q(Z))-getStringLength(Z)}}if(s.value&&s.value.value!==V)if(i.focused){let{selectionStart:q,selectionEnd:H}=s.value;if(s.value.value=V,isDef(q)&&isDef(H)){const K=getStringLength(V);G?(q-=G,H-=G):B&&(q+=B,H+=B),s.value.setSelectionRange(Math.min(q,K),Math.min(H,K))}}else s.value.value=V;V!==o.modelValue&&k("update:modelValue",V)},O=V=>{V.target.composing||S(V.target.value)},I=()=>{var V;return(V=s.value)==null?void 0:V.blur()},R=()=>{var V;return(V=s.value)==null?void 0:V.focus()},N=()=>{const V=s.value;o.type==="textarea"&&o.autosize&&V&&resizeTextarea(V,o.autosize)},F=V=>{i.focused=!0,k("focus",V),nextTick(N),m("readonly")&&I()},P=V=>{i.focused=!1,S(d(),"onBlur"),k("blur",V),!m("readonly")&&(g("onBlur"),nextTick(N),resetScroll())},x=V=>k("clickInput",V),L=V=>k("clickLeftIcon",V),_=V=>k("clickRightIcon",V),C=V=>{preventDefault(V),k("update:modelValue",""),k("clear",V)},A=computed(()=>{if(typeof o.error=="boolean")return o.error;if(p&&p.props.showError&&i.status==="failed")return!0}),M=computed(()=>{const V=m("labelWidth"),D=m("labelAlign");if(V&&D!=="top")return{width:addUnit(V)}}),U=V=>{V.keyCode===13&&(!(p&&p.props.submitOnEnter)&&o.type!=="textarea"&&preventDefault(V),o.type==="search"&&I()),k("keypress",V)},E=()=>o.id||`${r}-input`,z=()=>i.status,$=()=>{const V=bem$2("control",[m("inputAlign"),{error:A.value,custom:!!e.input,"min-height":o.type==="textarea"&&!o.autosize}]);if(e.input)return createVNode("div",{class:V,onClick:x},[e.input()]);const D={id:E(),ref:s,name:o.name,rows:o.rows!==void 0?+o.rows:void 0,class:V,disabled:m("disabled"),readonly:m("readonly"),autofocus:o.autofocus,placeholder:o.placeholder,autocomplete:o.autocomplete,enterkeyhint:o.enterkeyhint,"aria-labelledby":o.label?`${r}-label`:void 0,onBlur:P,onFocus:F,onInput:O,onClick:x,onChange:endComposing,onKeypress:U,onCompositionend:endComposing,onCompositionstart:startComposing};return o.type==="textarea"?createVNode("textarea",D,null):createVNode("input",mergeProps(mapInputType(o.type),D),null)},X=()=>{const V=e["left-icon"];if(o.leftIcon||V)return createVNode("div",{class:bem$2("left-icon"),onClick:L},[V?V():createVNode(Icon,{name:o.leftIcon,classPrefix:o.iconPrefix},null)])},Y=()=>{const V=e["right-icon"];if(o.rightIcon||V)return createVNode("div",{class:bem$2("right-icon"),onClick:_},[V?V():createVNode(Icon,{name:o.rightIcon,classPrefix:o.iconPrefix},null)])},W=()=>{if(o.showWordLimit&&o.maxlength){const V=getStringLength(d());return createVNode("div",{class:bem$2("word-limit")},[createVNode("span",{class:bem$2("word-num")},[V]),createTextVNode("/"),o.maxlength])}},ee=()=>{if(p&&p.props.showErrorMessage===!1)return;const V=o.errorMessage||i.validateMessage;if(V){const D=e["error-message"],Q=m("errorMessageAlign");return createVNode("div",{class:bem$2("error-message",Q)},[D?D({message:V}):V])}},w=()=>{const V=m("labelWidth"),D=m("labelAlign"),Q=m("colon")?":":"";if(e.label)return[e.label(),Q];if(o.label)return createVNode("label",{id:`${r}-label`,for:E(),style:D==="top"&&V?{width:addUnit(V)}:void 0},[o.label+Q])},J=()=>[createVNode("div",{class:bem$2("body")},[$(),c.value&&createVNode(Icon,{ref:n,name:o.clearIcon,class:bem$2("clear")},null),Y(),e.button&&createVNode("div",{class:bem$2("button")},[e.button()])]),W(),ee()];return useExpose({blur:I,focus:R,validate:v,formValue:h,resetValidation:y,getValidationStatus:z}),provide(CUSTOM_FIELD_INJECTION_KEY,{customValue:u,resetValidation:y,validateWithTrigger:g}),watch(()=>o.modelValue,()=>{S(d()),y(),g("onChange"),nextTick(N)}),onMounted(()=>{S(d(),o.formatTrigger),nextTick(N)}),useEventListener("touchstart",C,{target:computed(()=>{var V;return(V=n.value)==null?void 0:V.$el})}),()=>{const V=m("disabled"),D=m("labelAlign"),Q=X(),G=()=>{const B=w();return D==="top"?[Q,B].filter(Boolean):B||[]};return createVNode(Cell,{size:o.size,class:bem$2({error:A.value,disabled:V,[`label-${D}`]:D}),center:o.center,border:o.border,isLink:o.isLink,clickable:o.clickable,titleStyle:M.value,valueClass:bem$2("value"),titleClass:[bem$2("label",[D,{required:o.required}]),o.labelClass],arrowDirection:o.arrowDirection},{icon:Q&&D!=="top"?()=>Q:null,title:G,value:J,extra:e.extra})}}});const Field=withInstall(stdin_default$2),[name$1,bem$1,t]=createNamespace("dialog"),dialogProps=extend({},popupSharedProps,{title:String,theme:String,width:numericProp,message:[String,Function],callback:Function,allowHtml:Boolean,className:unknownProp,transition:makeStringProp("van-dialog-bounce"),messageAlign:String,closeOnPopstate:truthProp,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:truthProp,closeOnClickOverlay:Boolean}),popupInheritKeys=[...popupSharedPropKeys,"transition","closeOnPopstate"];var stdin_default$1=defineComponent({name:name$1,props:dialogProps,emits:["confirm","cancel","keydown","update:show"],setup(o,{emit:k,slots:e}){const r=ref(),i=reactive({confirm:!1,cancel:!1}),s=g=>k("update:show",g),n=g=>{var b;s(!1),(b=o.callback)==null||b.call(o,g)},u=g=>()=>{o.show&&(k(g),o.beforeClose?(i[g]=!0,callInterceptor(o.beforeClose,{args:[g],done(){n(g),i[g]=!1},canceled(){i[g]=!1}})):n(g))},p=u("cancel"),d=u("confirm"),m=withKeys(g=>{var b,S;if(g.target!==((S=(b=r.value)==null?void 0:b.popupRef)==null?void 0:S.value))return;({Enter:o.showConfirmButton?d:noop,Escape:o.showCancelButton?p:noop})[g.key](),k("keydown",g)},["enter","esc"]),c=()=>{const g=e.title?e.title():o.title;if(g)return createVNode("div",{class:bem$1("header",{isolated:!o.message&&!e.default})},[g])},h=g=>{const{message:b,allowHtml:S,messageAlign:O}=o,I=bem$1("message",{"has-title":g,[O]:O}),R=isFunction(b)?b():b;return S&&typeof R=="string"?createVNode("div",{class:I,innerHTML:R},null):createVNode("div",{class:I},[R])},a=()=>{if(e.default)return createVNode("div",{class:bem$1("content")},[e.default()]);const{title:g,message:b,allowHtml:S}=o;if(b){const O=!!(g||e.title);return createVNode("div",{key:S?1:0,class:bem$1("content",{isolated:!O})},[h(O)])}},y=()=>createVNode("div",{class:[BORDER_TOP,bem$1("footer")]},[o.showCancelButton&&createVNode(Button,{size:"large",text:o.cancelButtonText||t("cancel"),class:bem$1("cancel"),style:{color:o.cancelButtonColor},loading:i.cancel,disabled:o.cancelButtonDisabled,onClick:p},null),o.showConfirmButton&&createVNode(Button,{size:"large",text:o.confirmButtonText||t("confirm"),class:[bem$1("confirm"),{[BORDER_LEFT]:o.showCancelButton}],style:{color:o.confirmButtonColor},loading:i.confirm,disabled:o.confirmButtonDisabled,onClick:d},null)]),T=()=>createVNode(ActionBar,{class:bem$1("footer")},{default:()=>[o.showCancelButton&&createVNode(ActionBarButton,{type:"warning",text:o.cancelButtonText||t("cancel"),class:bem$1("cancel"),color:o.cancelButtonColor,loading:i.cancel,disabled:o.cancelButtonDisabled,onClick:p},null),o.showConfirmButton&&createVNode(ActionBarButton,{type:"danger",text:o.confirmButtonText||t("confirm"),class:bem$1("confirm"),color:o.confirmButtonColor,loading:i.confirm,disabled:o.confirmButtonDisabled,onClick:d},null)]}),v=()=>e.footer?e.footer():o.theme==="round-button"?T():y();return()=>{const{width:g,title:b,theme:S,message:O,className:I}=o;return createVNode(Popup,mergeProps({ref:r,role:"dialog",class:[bem$1([S]),I],style:{width:addUnit(g)},tabindex:0,"aria-labelledby":b||O,onKeydown:m,"onUpdate:show":s},pick(o,popupInheritKeys)),{default:()=>[c(),a(),v()]})}}});let instance;const DEFAULT_OPTIONS={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let currentOptions=extend({},DEFAULT_OPTIONS);function initInstance(){({instance}=mountComponent({setup(){const{state:k,toggle:e}=usePopupState();return()=>createVNode(stdin_default$1,mergeProps(k,{"onUpdate:show":e}),null)}}))}function showDialog(o){return inBrowser?new Promise((k,e)=>{instance||initInstance(),instance.open(extend({},currentOptions,o,{callback:r=>{(r==="confirm"?k:e)(r)}}))}):Promise.resolve()}const showConfirmDialog=o=>showDialog(extend({showCancelButton:!0},o));withInstall(stdin_default$1);const[name,bem]=createNamespace("notice-bar"),noticeBarProps={text:String,mode:String,color:String,delay:makeNumericProp(1),speed:makeNumericProp(60),leftIcon:String,wrapable:Boolean,background:String,scrollable:{type:Boolean,default:null}};var stdin_default=defineComponent({name,props:noticeBarProps,emits:["close","replay"],setup(o,{emit:k,slots:e}){let r=0,i=0,s;const n=ref(),u=ref(),p=reactive({show:!0,offset:0,duration:0}),d=()=>{if(e["left-icon"])return e["left-icon"]();if(o.leftIcon)return createVNode(Icon,{class:bem("left-icon"),name:o.leftIcon},null)},m=()=>{if(o.mode==="closeable")return"cross";if(o.mode==="link")return"arrow"},c=v=>{o.mode==="closeable"&&(p.show=!1,k("close",v))},h=()=>{if(e["right-icon"])return e["right-icon"]();const v=m();if(v)return createVNode(Icon,{name:v,class:bem("right-icon"),onClick:c},null)},a=()=>{p.offset=r,p.duration=0,raf(()=>{doubleRaf(()=>{p.offset=-i,p.duration=(i+r)/+o.speed,k("replay")})})},y=()=>{const v=o.scrollable===!1&&!o.wrapable,g={transform:p.offset?`translateX(${p.offset}px)`:"",transitionDuration:`${p.duration}s`};return createVNode("div",{ref:n,role:"marquee",class:bem("wrap")},[createVNode("div",{ref:u,style:g,class:[bem("content"),{"van-ellipsis":v}],onTransitionend:a},[e.default?e.default():o.text])])},T=()=>{const{delay:v,speed:g,scrollable:b}=o,S=isDef(v)?+v*1e3:0;r=0,i=0,p.offset=0,p.duration=0,clearTimeout(s),s=setTimeout(()=>{if(!n.value||!u.value||b===!1)return;const O=useRect(n).width,I=useRect(u).width;(b||I>O)&&doubleRaf(()=>{r=O,i=I,p.offset=-i,p.duration=i/+g})},S)};return onPopupReopen(T),onMountedOrActivated(T),useEventListener("pageshow",T),useExpose({reset:T}),watch(()=>[o.text,o.scrollable],T),()=>{const{color:v,wrapable:g,background:b}=o;return withDirectives(createVNode("div",{role:"alert",class:bem({wrapable:g}),style:{color:v,background:b}},[d(),y(),h()]),[[vShow,p.show]])}}});const NoticeBar=withInstall(stdin_default);var NIM_Web_SDKExports={},NIM_Web_SDK={get exports(){return NIM_Web_SDKExports},set exports(o){NIM_Web_SDKExports=o}};/*!
 * 
 * VERSION: 8.9.117
 * Git Hash: 34abf391f0556018489da1dd0fd37bc72560c33e
 * 
 * Create At: 2023/9/22 下午3:15:34
 * 
 * Target: NIM_Web_SDK
 */(function(module,exports){(function(o,k){module.exports=k()})(window,function(){return function(o){var k={};function e(r){if(k[r])return k[r].exports;var i=k[r]={i:r,l:!1,exports:{}};return o[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=o,e.c=k,e.d=function(r,i,s){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:s})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(1&i&&(r=e(r)),8&i||4&i&&typeof r=="object"&&r&&r.__esModule)return r;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:r}),2&i&&typeof r!="string")for(var n in r)e.d(s,n,function(u){return r[u]}.bind(null,n));return s},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="",e(e.s=908)}([function(o,k,e){var r=e(57),i=e(2),s=e(6),n=e(15),u=e(5),p=e(171),d=e(68),m=e(138),c=e(32),h=e(7),a=e(8),y=e(10),T=e(197),v=e(139),g=e(23),b=e(17),S=e(461),O=e(3),I=e(85),R=e(86),N=e(69),F=e(58),P=e(59),x=e(60),L=e(61),_=e(47),C=e(26);function A(B,q){var H=u(B);if(F){var K=F(B);q&&(K=b(K).call(K,function(Z){return P(B,Z).enumerable})),H.push.apply(H,K)}return H}function M(B,q){var H=R!==void 0&&N(B)||B["@@iterator"];if(!H){if(c(B)||(H=function(se,oe){var ae;if(se){if(typeof se=="string")return U(se,oe);var pe=n(ae=Object.prototype.toString.call(se)).call(ae,8,-1);if(pe==="Object"&&se.constructor&&(pe=se.constructor.name),pe==="Map"||pe==="Set")return I(se);if(pe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(pe))return U(se,oe)}}(B))||q&&B&&typeof B.length=="number"){H&&(B=H);var K=0,Z=function(){};return{s:Z,n:function(){return K>=B.length?{done:!0}:{done:!1,value:B[K++]}},e:function(se){throw se},f:Z}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var te,ne=!0,re=!1;return{s:function(){H=H.call(B)},n:function(){var se=H.next();return ne=se.done,se},e:function(se){re=!0,te=se},f:function(){try{ne||H.return==null||H.return()}finally{if(re)throw te}}}}function U(B,q){(q==null||q>B.length)&&(q=B.length);for(var H=0,K=new Array(q);H<q;H++)K[H]=B[H];return K}var E=e(255),z=e(198);function $(B){C(B)==="object"?(this.callFunc=B.callFunc||null,this.message=B.message||"UNKNOW ERROR"):this.message=B,this.time=new Date,this.timetag=+this.time}e(484);var X,Y,W=e(54),ee=W.getGlobal(),w=/\s+/;W.deduplicate=function(B){var q=[];return i(B).call(B,function(H){s(q).call(q,H)===-1&&q.push(H)}),q},W.capFirstLetter=function(B){return B?n(B=""+B).call(B,0,1).toUpperCase()+n(B).call(B,1):""},W.guid=(X=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return X()+X()+X()+X()+X()+X()+X()+X()}),W.extend=function(B,q,H){for(var K in q)B[K]!==void 0&&H!==!0||(B[K]=q[K])},W.filterObj=function(B,q){var H={};return W.isString(q)&&(q=q.split(w)),i(q).call(q,function(K){B.hasOwnProperty(K)&&(H[K]=B[K])}),H},W.copy=function(B,q){var H;return q=q||{},B&&i(H=u(B)).call(H,function(K){W.exist(B[K])&&(q[K]=B[K])}),q},W.copyWithNull=function(B,q){var H;return q=q||{},B&&i(H=u(B)).call(H,function(K){(W.exist(B[K])||W.isnull(B[K]))&&(q[K]=B[K])}),q},W.findObjIndexInArray=function(B,q){B=B||[];var H=q.keyPath||"id",K=-1;return p(B).call(B,function(Z,te){if(z(Z,H)===q.value)return K=te,!0}),K},W.findObjInArray=function(B,q){var H=W.findObjIndexInArray(B,q);return H===-1?null:B[H]},W.mergeObjArray=function(){var B=[],q=n([]).call(arguments,0,-1),H=arguments[arguments.length-1];W.isArray(H)&&(q.push(H),H={});var K,Z=H.keyPath=H.keyPath||"id";for(H.sortPath=H.sortPath||Z;!B.length&&q.length;)B=q.shift()||[],B=n(B).call(B,0);return i(q).call(q,function(te){te&&i(te).call(te,function(ne){(K=W.findObjIndexInArray(B,{keyPath:Z,value:z(ne,Z)}))!==-1?B[K]=W.merge({},B[K],ne):B.push(ne)})}),H.notSort||(B=W.sortObjArray(B,H)),B},W.cutObjArray=function(B){var q=n(B).call(B,0),H=arguments.length,K=n([]).call(arguments,1,H-1),Z=arguments[H-1];W.isObject(Z)||(K.push(Z),Z={});var te,ne=Z.keyPath=Z.keyPath||"id";return i(K).call(K,function(re){W.isArray(re)||(re=[re]),i(re).call(re,function(se){se&&(Z.value=z(se,ne),(te=W.findObjIndexInArray(q,Z))!==-1&&d(q).call(q,te,1))})}),q},W.sortObjArray=function(B,q){var H=(q=q||{}).sortPath||"id";E.insensitive=!!q.insensitive;var K,Z,te,ne=!!q.desc;return te=W.isFunction(q.compare)?q.compare:function(re,se){return K=z(re,H),Z=z(se,H),ne?E(Z,K):E(K,Z)},m(B).call(B,te)},W.emptyFunc=function(){},W.isEmptyFunc=function(B){return B===W.emptyFunc},W.notEmptyFunc=function(B){return B!==W.emptyFunc},W.splice=function(B,q,H){return d([]).call(B,q,H)},W.reshape2d=function(B,q){if(c(B)){W.verifyParamType("type",q,"number","util::reshape2d");var H=B.length;if(H<=q)return[B];for(var K=Math.ceil(H/q),Z=[],te=0;te<K;te++)Z.push(n(B).call(B,te*q,(te+1)*q));return Z}return B},W.flatten2d=function(B){if(c(B)){var q=[];return i(B).call(B,function(H){q=h(q).call(q,H)}),q}return B},W.dropArrayDuplicates=function(B){if(c(B)){for(var q={},H=[];B.length>0;)q[B.shift()]=!0;for(var K in q)q[K]===!0&&H.push(K);return H}return B},W.onError=function(B){throw new $(B)},W.verifyParamPresent=function(B,q,H,K){H=H||"";var Z=!1;switch(W.typeOf(q)){case"undefined":case"null":Z=!0;break;case"string":q===""&&(Z=!0);break;case"StrStrMap":case"object":u(q).length||(Z=!0);break;case"array":q.length?p(q).call(q,function(te){if(W.notexist(te))return Z=!0,!0}):Z=!0}Z&&W.onParamAbsent(H+B,K)},W.onParamAbsent=function(B,q){W.onParamError("缺少参数 ".concat(B,", 请确保参数不是 空字符串、空对象、空数组、null或undefined, 或数组的内容不是 null/undefined"),q)},W.verifyParamAbsent=function(B,q,H,K){H=H||"",q!==void 0&&W.onParamPresent(H+B,K)},W.onParamPresent=function(B,q){W.onParamError("多余的参数 ".concat(B),q)},W.verifyParamType=function(B,q,H,K){var Z=W.typeOf(q).toLowerCase();W.isArray(H)||(H=[H]),H=a(H).call(H,function(ne){return ne.toLowerCase()});var te=!0;switch(s(H).call(H,Z)===-1&&(te=!1),Z){case"number":isNaN(q)&&(te=!1);break;case"string":H.join("")==="numeric or numeric string"&&(te=!!/^[0-9]+$/.test(q))}te||W.onParamInvalidType(B,H,"",K)},W.onParamInvalidType=function(B,q,H,K){H=H||"",q=W.isArray(q)?(q=a(q).call(q,function(Z){return'"'+Z+'"'})).join(", "):'"'+q+'"',W.onParamError('参数"'+H+B+'"类型错误, 合法的类型包括: ['+q+"]",K)},W.verifyParamValid=function(B,q,H,K){W.isArray(H)||(H=[H]),s(H).call(H,q)===-1&&W.onParamInvalidValue(B,H,K)},W.onParamInvalidValue=function(B,q,H){var K;W.isArray(q)||(q=[q]),q=a(q).call(q,function(Z){return'"'+Z+'"'}),W.isArray(q)&&(q=q.join(", ")),W.onParamError(h(K="参数 ".concat(B,"值错误, 合法的值包括: [")).call(K,y(q),"]"),H)},W.verifyParamMin=function(B,q,H,K){q<H&&W.onParamError("参数"+B+"的值不能小于"+H,K)},W.verifyParamMax=function(B,q,H,K){q>H&&W.onParamError("参数"+B+"的值不能大于"+H,K)},W.verifyArrayMax=function(B,q,H,K){q.length>H&&W.onParamError("参数"+B+"的长度不能大于"+H,K)},W.verifyEmail=(Y=/^\S+@\S+$/,function(B,q,H){Y.test(q)||W.onParamError("参数"+B+"邮箱格式错误, 合法格式必须包含@符号, @符号前后至少要各有一个字符",H)}),W.verifyTel=function(){var B=/^[+\-()\d]+$/;return function(q,H,K){B.test(H)||W.onParamError("参数"+q+"电话号码格式错误, 合法字符包括+、-、英文括号和数字",K)}}(),W.verifyBirth=function(){var B=/^(\d{4})-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$/;return function(q,H,K){B.test(H)||W.onParamError("参数"+q+'生日格式错误, 合法为"yyyy-MM-dd"',K)}}(),W.onParamError=function(B,q){W.onError({message:B,callFunc:q})},W.verifyOptions=function(B,q,H,K,Z){if(B=B||{},q&&(W.isString(q)&&(q=q.split(w)),W.isArray(q))){typeof H!="boolean"&&(Z=H||null,H=!0,K="");var te=H?W.verifyParamPresent:W.verifyParamAbsent;i(q).call(q,function(ne){te.call(W,ne,B[ne],K,Z)})}return B},W.verifyParamAtLeastPresentOne=function(B,q,H){q&&(W.isString(q)&&(q=q.split(w)),W.isArray(q)&&(p(q).call(q,function(K){return W.exist(B[K])})||W.onParamError("以下参数["+q.join(", ")+"]至少需要传入一个",H)))},W.verifyParamPresentJustOne=function(B,q,H){q&&(W.isString(q)&&(q=q.split(w)),W.isArray(q)&&T(q).call(q,function(K,Z){return W.exist(B[Z])&&K++,K},0)!==1&&W.onParamError("以下参数["+q.join(", ")+"]必须且只能传入一个",H))},W.verifyBooleanWithDefault=function(B,q,H,K,Z){W.undef(H)&&(H=!0),w.test(q)&&(q=q.split(w)),W.isArray(q)?i(q).call(q,function(te){W.verifyBooleanWithDefault(B,te,H,K,Z)}):B[q]===void 0?B[q]=H:W.isBoolean(B[q])||W.onParamInvalidType(q,"boolean",K,Z)},W.verifyFileInput=function(B,q){var H;return W.verifyParamPresent("fileInput",B,"",q),W.isString(B)&&((B=typeof document>"u"?void 0:document.getElementById(B))||W.onParamError("找不到要上传的文件对应的input, 请检查fileInput id ".concat(B),q)),B.tagName&&B.tagName.toLowerCase()==="input"&&B.type.toLowerCase()==="file"||W.onParamError(h(H="请提供正确的 fileInput, 必须为 file 类型的 input 节点 tagname:".concat(B.tagName,", filetype:")).call(H,B.type),q),B},W.verifyFileType=function(B,q){W.verifyParamValid("type",B,W.validFileTypes,q)},W.verifyCallback=function(B,q,H){w.test(q)&&(q=q.split(w)),W.isArray(q)?i(q).call(q,function(K){W.verifyCallback(B,K,H)}):B[q]?W.isFunction(B[q])||W.onParamInvalidType(q,"function","",H):B[q]=W.emptyFunc},W.verifyFileUploadCallback=function(B,q){W.verifyCallback(B,"uploadprogress uploaddone uploaderror uploadcancel",q)},W.validFileTypes=["image","audio","video","file"],W.validFileExts={image:["bmp","gif","jpg","jpeg","jng","png","webp"],audio:["mp3","wav","aac","wma","wmv","amr","mp2","flac","vorbis","ac3"],video:["mp4","rm","rmvb","wmv","avi","mpg","mpeg","mov"]},W.filterFiles=function(B,q){var H,K,Z=(q=q.toLowerCase())==="file",te=[];return i([]).call(B,function(ne){var re,se;if(Z)te.push(ne);else if(H=n(re=ne.name).call(re,v(se=ne.name).call(se,".")+1),(K=ne.type.split("/"))[0]&&K[1]){var oe,ae=!1;K[0].toLowerCase()===q?ae=!0:ae=s(oe=W.validFileExts[q]).call(oe,H)!==-1,ae&&te.push(ne)}}),te};var J,V,D=W.supportFormData=W.notundef(ee.FormData);W.getFileName=function(B){return B=W.verifyFileInput(B),D?B.files[0].name:n(q=B.value).call(q,v(H=B.value).call(H,"\\")+1);var q,H},W.getFileInfo=(J={ppt:1,pptx:2,pdf:3,doc:6,docx:7},function(B){var q={};if(!(B=W.verifyFileInput(B)).files)return q;var H=B.files[0];return D&&(q.name=H.name,q.size=H.size,q.type=H.name.match(/\.(\w+)$/),q.type=q.type&&q.type[1].toLowerCase(),q.transcodeType=J[q.type]||0),q}),W.sizeText=(V=["B","KB","MB","GB","TB","PB","EB","ZB","BB"],function(B){var q,H=0;do q=(B=Math.floor(100*B)/100)+V[H],B/=1024,H++;while(B>1);return q}),W.promises2cmds=function(B){return a(B).call(B,function(q){return q.cmd})},W.objs2accounts=function(B){return a(B).call(B,function(q){return q.account})},W.teams2ids=function(B){return a(B).call(B,function(q){return q.teamId})},W.objs2ids=function(B){return a(B).call(B,function(q){return q.id})},W.getMaxUpdateTime=function(B){var q=a(B).call(B,function(H){return+H.updateTime});return Math.max.apply(Math,q)},W.genCheckUniqueFunc=function(B){return B=B||"id",function(q){this.uniqueSet=this.uniqueSet||{},this.uniqueSet[B]=this.uniqueSet[B]||{};var H=this.uniqueSet[B],K=q[B];return!H[K]&&(H[K]=!0,!0)}},W.fillPropertyWithDefault=function(B,q,H){return!!W.undef(B[q])&&(B[q]=H,!0)},W.throttle=function(B,q,H,K){var Z,te,ne=null,re=0;H||(H={});var se=function(){re=H.leading===!1?0:new Date().getTime(),ne=null,B.apply(Z,te),ne||(Z=te=null)};return function(){var oe=new Date().getTime();re||H.leading!==!1||(re=oe);var ae=q-(oe-re);return Z=this,te=arguments,ae<=0||ae>q?(clearTimeout(ne),ne=null,re=oe,B.apply(Z,te),ne||(Z=te=null)):ne||H.trailing===!1?ne&&K&&K.apply(Z,te):(ne=g(se,ae),K&&K.apply(Z,te)),ne}},W.get=function(B,q){var H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(C(B)!=="object")return H;var K,Z=q.replace(/\[(\d+)\]/g,".$1").split("."),te=B,ne=M(Z);try{for(ne.s();!(K=ne.n()).done;){var re=K.value;if((te=Object(te)[re])===void 0)return H}}catch(se){ne.e(se)}finally{ne.f()}return te},W.pickAsString=function(B,q){var H;return B?a(H=b(q).call(q,function(K){return B[K]!==void 0})).call(H,function(K){var Z;return h(Z="".concat(K,"=")).call(Z,B[K])}).join(","):""},W.omitAsString=function(B,q){var H,K;if(!B)return"";var Z={};return i(q).call(q,function(te){Z[te]=!0}),a(H=b(K=u(B)).call(K,function(te){return!Z[te]})).call(H,function(te){var ne;return h(ne="".concat(te,"=")).call(ne,B[te])}).join(",")};var Q={session:function(B){var q=function(K){for(var Z=1;Z<arguments.length;Z++){var te,ne,re=arguments[Z]!=null?arguments[Z]:{};Z%2?i(te=A(Object(re),!0)).call(te,function(se){r(K,se,re[se])}):x?L(K,x(re)):i(ne=A(Object(re))).call(ne,function(se){_(K,se,P(re,se))})}return K}({},B),H=["topCustom","localCustom","extra"];return i(H).call(H,function(K){q[K]&&(q[K]="***")}),q.lastMsg&&(q.lastMsg={idServer:q.lastMsg.idServer,idClient:q.lastMsg.idClient}),q}};W.secureOutput=function(B,q){c(q)||(q=[q]);var H=Q[B];return(q=a(q).call(q,function(K){return H(K)})).length===1?q[0]:q};var G={string:function(B,q,H){var K=H.required,Z=H.allowEmpty,te=B[q];return K===!1&&te===void 0||typeof te=="string"&&!(!Z&&te==="")},number:function(B,q,H){var K=H.required,Z=H.min,te=B[q];return K===!1&&te===void 0||typeof te=="number"&&!(te<Z)},enum:function(B,q,H){var K=H.required,Z=S(H),te=B[q];return K===!1&&te===void 0||s(Z).call(Z,te)>-1},array:function(B,q,H){var K=H.required,Z=B[q];return K===!1&&Z===void 0||!!c(Z)}};W.validate=function(B,q,H){var K,Z={};return i(K=u(B)).call(K,function(te){var ne,re=B[te].type,se=G[re];se&&!se(q,te,B[te])?W.onError({message:h(ne="Error in parameter verification, ".concat(te," expected value is ")).call(ne,y(B[te])),callFunc:H}):Z[te]=q[te]}),Z},W.asyncPool=function(B,q,H){if(typeof B!="number"||typeof H!="function"||!q||!q.length)return O.resolve();var K=0,Z=[],te=[];return function ne(){if(K===q.length)return O.resolve();var re=q[K++],se=O.resolve().then(function(){return H(re,q)});Z.push(se);var oe=O.resolve();if(B<=q.length){var ae=se.then(function(){return d(te).call(te,s(te).call(te,ae),1)});te.push(ae),te.length>=B&&(oe=O.race(te))}return oe.then(function(){return ne()})}().then(function(){return O.all(Z)})},W.getIdArray=function(B){if(!B||typeof B!="string")throw new Error("id type error");var q=s(B).call(B,"-");if(q<0||q===B.length-1)throw new Error("id format error");return[n(B).call(B,0,q),n(B).call(B,q+1)]},o.exports=W},function(o,k,e){var r=e(14),i=e(76),s=e(156),n=e(16),u=e(90).f,p=e(210),d=e(12),m=e(34),c=e(53),h=e(29),a=function(y){var T=function(v,g,b){if(this instanceof T){switch(arguments.length){case 0:return new y;case 1:return new y(v);case 2:return new y(v,g)}return new y(v,g,b)}return i(y,this,arguments)};return T.prototype=y.prototype,T};o.exports=function(y,T){var v,g,b,S,O,I,R,N,F,P=y.target,x=y.global,L=y.stat,_=y.proto,C=x?r:L?r[P]:(r[P]||{}).prototype,A=x?d:d[P]||c(d,P,{})[P],M=A.prototype;for(S in T)g=!(v=p(x?S:P+(L?".":"#")+S,y.forced))&&C&&h(C,S),I=A[S],g&&(R=y.dontCallGetSet?(F=u(C,S))&&F.value:C[S]),O=g&&R?R:T[S],g&&typeof I==typeof O||(N=y.bind&&g?m(O,r):y.wrap&&g?a(O):_&&n(O)?s(O):O,(y.sham||O&&O.sham||I&&I.sham)&&c(N,"sham",!0),c(A,S,N),_&&(h(d,b=P+"Prototype")||c(d,b,{}),c(d[b],S,O),y.real&&M&&(v||!M[S])&&c(M,S,O)))}},function(o,k,e){o.exports=e(229)},function(o,k,e){o.exports=e(231)},function(o,k){o.exports=function(e){try{return!!e()}catch{return!0}}},function(o,k,e){o.exports=e(230)},function(o,k,e){o.exports=e(206)},function(o,k,e){o.exports=e(322)},function(o,k,e){o.exports=e(439)},function(o,k,e){o.exports=e(275)},function(o,k,e){o.exports=e(383)},function(o,k,e){var r=e(107),i=Function.prototype,s=i.call,n=r&&i.bind.bind(s,s);o.exports=r?n:function(u){return function(){return s.apply(u,arguments)}}},function(o,k){o.exports={}},function(o,k,e){var r=e(6),i=e(7),s=!1;try{typeof localStorage.setItem=="function"&&typeof localStorage.getItem=="function"&&(localStorage.setItem("nim_localstorage_exist_test","1"),s=localStorage.getItem("nim_localstorage_exist_test")==="1",localStorage.removeItem("nim_localstorage_exist_test"))}catch{s=!1}var n={nodeEnv:"production",info:{hash:"34abf391f0556018489da1dd0fd37bc72560c33e",shortHash:"34abf391",version:"8.9.117",sdkVersion:"2317",sdkHumanVersion:"8.9.117",protocolVersion:1},lbsUrl:"https://lbs.netease.im/lbs/webconf.jsp",needToXHR:!0,connectTimeout:1e4,xhrTimeout:8e3,reconnectionDelay:1600,reconnectionDelayMax:8e3,reconnectionJitter:.01,reconnectiontimer:null,heartbeatInterval:3e4,cmdTimeout:8e3,hbCmdTimeout:5e3,isWeixinApp:!1,isNodejs:!1,isRN:!1,ipVersion:0,PUSHTOKEN:"",PUSHCONFIG:{},CLIENTTYPE:16,PushPermissionAsked:!1,iosPushConfig:null,androidPushConfig:null,optionDefaultLinkUrl:"",defaultLinkUrl:"weblink.netease.im",ipv6DefaultLinkUrl:"weblink.netease.im",optionIpv6DefaultLinkUrl:"",wxDefaultLinkUrl:"wlnimsc0.netease.im",serverNosConfig:s?{cdnDomain:localStorage.getItem("nim_cdn_domain")||"",objectPrefix:localStorage.getItem("nim_object_prefix")||""}:{},hasLocalStorage:s,privateConf:{isABTestEnable:!1,isDataReportEnable:!0,isMixStoreEnable:!1,reportConfigUrl:"https://statistic.live.126.net/dispatcher/req",reportUrl:"https://statistic.live.126.net/statics/report/common/form"},getDefaultLinkUrl:function(u){var p,d;n.ipVersion===1?(p=n.optionIpv6DefaultLinkUrl,d=n.ipv6DefaultLinkUrl):(p=n.optionDefaultLinkUrl,d=n.defaultLinkUrl);var m=p||(n.isWeixinApp?n.wxDefaultLinkUrl:d);if(!m)return!1;var c=u?"https":"http",h=u?"443":"80",a=m;return r(m).call(m,"http")===-1&&(a=c+"://"+a),r(m).call(m,":")===-1&&(a=a+":"+h),a},ipProbeAddr:{ipv4:"https://check-ipv4.netease.im/test/",ipv6:"https://check-ipv6.netease.im/test/"},formatSocketUrl:function(u){var p=u.url,d=u.secure?"https":"http";return r(p).call(p,"http")===-1?d+"://"+p:p},uploadUrl:"https://nos.netease.com",chunkUploadUrl:"https://wanproxy-web.127.net",commonMaxSize:104857600,chunkSize:4194304,chunkMaxSize:4194304e4,replaceUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHost:"nos.netease.com",downloadHostList:["nos.netease.com"],downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",nosCdnEnable:!0,httpsEnabled:!1,threshold:0,nosLbsUrls:[],edgeList:["https://wanproxy-web.127.net","https://nosup-hz1.127.net"],genUploadUrl:function(u){return n.uploadUrl+"/"+u},genChunkUploadUrl:function(u){return n.chunkUploadUrl?n.chunkUploadUrl+"/"+u.bucket+"/"+u.objectName:""},genDownloadUrl:function(u,p,d){var m,c,h,a,y,T=u.bucket,v=u.expireSec,g=+new Date,b=v?"&survivalTime=".concat(v):"";if(d)return i(h=i(a=i(y="https://".concat(d,"/")).call(y,p,"?createTime=")).call(a,g)).call(h,b);var S=i(m=i(c="".concat(n.replaceUrl,"?createTime=")).call(c,g)).call(m,b);return(S=n.genNosProtocolUrl(S)).replace("{bucket}",T).replace("{object}",p)},genFileUrl:function(u){var p=u.bucket,d=u.objectName;return n.genNosProtocolUrl(n.replaceUrl).replace("{bucket}",p).replace("{object}",d)},genNosProtocolUrl:function(u){return/^http/.test(u)?n.httpsEnabled&&r(u).call(u,"https://")!==0&&(u=u.replace("http","https")):u=n.httpsEnabled?"https://".concat(u):"http://".concat(u),u}};n.hostEnv="BROWSER",o.exports=n},function(o,k,e){(function(r){var i=function(s){return s&&s.Math==Math&&s};o.exports=i(typeof globalThis=="object"&&globalThis)||i(typeof window=="object"&&window)||i(typeof self=="object"&&self)||i(typeof r=="object"&&r)||function(){return this}()||Function("return this")()}).call(this,e(70))},function(o,k,e){o.exports=e(250)},function(o,k,e){var r=e(207),i=r.all;o.exports=r.IS_HTMLDDA?function(s){return typeof s=="function"||s===i}:function(s){return typeof s=="function"}},function(o,k,e){o.exports=e(457)},function(o,k,e){o.exports=e(215)},function(o,k,e){var r=e(107),i=Function.prototype.call;o.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},function(o,k,e){var r=e(14),i=e(109),s=e(29),n=e(127),u=e(92),p=e(208),d=i("wks"),m=r.Symbol,c=m&&m.for,h=p?m:m&&m.withoutSetter||n;o.exports=function(a){if(!s(d,a)||!u&&typeof d[a]!="string"){var y="Symbol."+a;u&&s(m,a)?d[a]=m[a]:d[a]=p&&c?c(y):h(y)}return d[a]}},function(o,k,e){var r=e(11);o.exports=r({}.isPrototypeOf)},function(o,k,e){var r=e(12),i=e(29),s=e(133),n=e(38).f;o.exports=function(u){var p=r.Symbol||(r.Symbol={});i(p,u)||n(p,u,{value:s.f(u)})}},function(o,k,e){o.exports=e(453)},function(o,k,e){var r=e(57),i=e(56),s=e(7),n=e(23),u=e(10),p=e(32),d=e(5),m=e(58),c=e(17),h=e(59),a=e(2),y=e(60),T=e(61),v=e(47),g=e(15),b=e(85),S=e(86),O=e(69);function I(C,A){var M=S!==void 0&&O(C)||C["@@iterator"];if(!M){if(p(C)||(M=function(Y,W){var ee;if(Y){if(typeof Y=="string")return R(Y,W);var w=g(ee=Object.prototype.toString.call(Y)).call(ee,8,-1);if(w==="Object"&&Y.constructor&&(w=Y.constructor.name),w==="Map"||w==="Set")return b(Y);if(w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w))return R(Y,W)}}(C))||A&&C&&typeof C.length=="number"){M&&(C=M);var U=0,E=function(){};return{s:E,n:function(){return U>=C.length?{done:!0}:{done:!1,value:C[U++]}},e:function(Y){throw Y},f:E}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var z,$=!0,X=!1;return{s:function(){M=M.call(C)},n:function(){var Y=M.next();return $=Y.done,Y},e:function(Y){X=!0,z=Y},f:function(){try{$||M.return==null||M.return()}finally{if(X)throw z}}}}function R(C,A){(A==null||A>C.length)&&(A=C.length);for(var M=0,U=new Array(A);M<A;M++)U[M]=C[M];return U}function N(C,A){var M=d(C);if(m){var U=m(C);A&&(U=c(U).call(U,function(E){return h(C,E).enumerable})),M.push.apply(M,U)}return M}function F(C){for(var A=1;A<arguments.length;A++){var M,U,E=arguments[A]!=null?arguments[A]:{};A%2?a(M=N(Object(E),!0)).call(M,function(z){r(C,z,E[z])}):y?T(C,y(E)):a(U=N(Object(E))).call(U,function(z){v(C,z,h(E,z))})}return C}var P=e(44),x=e(0);function L(C){return x.get(C,"code")||x.get(C,"msg.code")||x.get(C,"statusCode")||x.get(C,"event.code")||0}function _(C){var A,M,U=typeof C=="string"?C:x.get(C,"msg")||x.get(C,"message")||x.get(C,"error")||x.get(C,"event.msg")||x.get(C,"event.message")||x.get(C,"event")||"unknown",E="",z="";C&&typeof C.toString=="function"&&(E=C.toString());try{z=u(C)}catch{}return s(A=s(M=`
errMsg: `.concat(U,`
errStr: `)).call(M,E,`
errJsonStr: `)).call(A,z,`
  `)}o.exports={reportAPI:function(C){var A=C.instance,M=C.className,U=C.funcName,E=C.hasCallback,z=E===void 0||E,$=C.done;if(!function(W){if(!W||!p(W.experiments))return!1;var ee,w=I(W.experiments);try{for(w.s();!(ee=w.n()).done;){var J=ee.value;if(J.experimentKey==="api_trace_collection"&&J.schemeKey==="open_flow"&&p(J.variates)){var V,D=I(J.variates);try{for(D.s();!(V=D.n()).done;){var Q=V.value;if(Q.key==="open"&&Q.value===!0)return!0}}catch(G){D.e(G)}finally{D.f()}}}}catch(G){w.e(G)}finally{w.f()}return!1}(A.abtInfo)||!A.reporter||!A.reporter.isUploadEnable)return $;var X,Y={user_id:x.get(A,"options.account")||"",trace_id:x.get(A,"socket.socket.sessionid"),class_name:M,api_name:U,action:z?1:0,active_id:P.deviceId,start_time:i()};return z?(X=n(function(){A&&A.logger&&A.logger.warn("API 数据上报回调函数未调用",Y),A&&A.reporter&&A.reporter.report("nim_api_trace",F(F({},Y),{},{state:1,error_code:408,error_msg:"API回调函数未被调用",duration:i()-Y.start_time}))},1e4),function(W){if(clearTimeout(X),typeof $=="function"){for(var ee,w=arguments.length,J=new Array(w>1?w-1:0),V=1;V<w;V++)J[V-1]=arguments[V];$.apply(void 0,s(ee=[W]).call(ee,J))}try{if(!A||!A.reporter)return;W?A.reporter.report("nim_api_trace",F(F({},Y),{},{state:1,error_code:L(W),error_msg:_(W),duration:i()-Y.start_time})):A.reporter.report("nim_api_trace",F(F({},Y),{},{state:0,duration:i()-Y.start_time}))}catch(D){A&&A.logger&&A.logger.error("api report error",D)}}):(A.reporter.report("nim_api_trace",F(F({},Y),{},{state:0,duration:1})),$)}}},function(o,k,e){o.exports=e(272)},function(o,k,e){var r=e(153),i=e(364);function s(n){return o.exports=s=typeof r=="function"&&typeof i=="symbol"?function(u){return typeof u}:function(u){return u&&typeof r=="function"&&u.constructor===r&&u!==r.prototype?"symbol":typeof u},o.exports.__esModule=!0,o.exports.default=o.exports,s(n)}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(4);o.exports=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},function(o,k,e){var r=e(16),i=e(207),s=i.all;o.exports=i.IS_HTMLDDA?function(n){return typeof n=="object"?n!==null:r(n)||n===s}:function(n){return typeof n=="object"?n!==null:r(n)}},function(o,k,e){var r=e(11),i=e(42),s=r({}.hasOwnProperty);o.exports=Object.hasOwn||function(n,u){return s(i(n),u)}},function(o,k,e){var r=e(12);o.exports=function(i){return r[i+"Prototype"]}},function(o,k,e){var r=e(16),i=e(78),s=TypeError;o.exports=function(n){if(r(n))return n;throw s(i(n)+" is not a function")}},function(o,k,e){o.exports=e(299)},function(o,k,e){var r=e(12),i=e(14),s=e(16),n=function(u){return s(u)?u:void 0};o.exports=function(u,p){return arguments.length<2?n(r[u])||n(i[u]):r[u]&&r[u][p]||i[u]&&i[u][p]}},function(o,k,e){var r=e(156),i=e(31),s=e(107),n=r(r.bind);o.exports=function(u,p){return i(u),p===void 0?u:s?n(u,p):function(){return u.apply(p,arguments)}}},function(o,k,e){var r=e(18),i=e(25),s=e(3),n=e(71),u=e(75),p=e(13),d=e(0),m=e(290),c=d.undef,h=e(309),a=e(147),y=e(151),T=e(777);function v(S){var O,I,R,N=this;d.verifyOptions(S,"appKey account token","protocol::IMProtocol"),d.verifyCallback(S,["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onSessionsWithMoreRoaming","onStickTopSessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onSyncUpdateServerSession","onUpdateSuperTeamMember","onMySuperTeamMembers","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamMembersMute","onupdateteammember","onMyTeamMembers","onMsgReceipts","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onQuickComment","onDeleteQuickComment","onPinMsgChange","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldIgnoreMsg","onDeleteMsgSelf","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],"protocol::IMProtocol"),O=typeof d.get(S,"privateConf.isDataReportEnable")=="boolean"?S.privateConf.isDataReportEnable:p.privateConf.isDataReportEnable,I=typeof d.get(S,"privateConf.reportConfigUrl")=="string"?S.privateConf.reportConfigUrl:p.privateConf.reportConfigUrl,R=typeof d.get(S,"privateConf.reportUrl")=="string"?S.privateConf.reportUrl:p.privateConf.reportUrl,N.reporter=m.initReporter({isDataReportEnable:O,reportConfigUrl:I,reportUrl:R,appKey:S.appKey,logger:N.logger}),N.db=S.api.db=new n({logger:S.logger,reporter:N.reporter,account:S.account,core:N,notifyError:function(F){N.notifyError&&N.notifyError("DB error",F)}}),u.call(N,S)}var g=u.fn,b=v.fn=v.prototype=r(g);b.init=function(){var S,O;g.init.call(this),a.IM.setProtocol(this),this.parser=a.IM,i(S=this.sendCmd).call(S,this),this.socketUrls=[],this.syncing=!0,this.canHandleDeletedMsgInSyncing=!1,this.hasSynced=!1,this.hasSyncedTeamMembers=!1,this.syncPromiseArray=[],this.syncResult={},this.syncTeamMembersPromiseArray=[],this.syncSuperTeamMembersPromiseArray=[],this.syncTeamMembersResult={},this.timetags={},this.superTeamMembersData={},this.saveAck={},this.sysMsgUnread=y.completeUnread({}),this.resetUnsettledMsgs(),this.resetUnsettledSysMsgs(),this.msgPromise=s.resolve(),this.sysMsgPromise=s.resolve(),this.msgDelayArr=[],this.msgDelayTimer=null,this.msgStatEnable=!1,this.nosCdnHostTimer=null,this.relativeServerTime=0,this.sessionSet={},this.msgReceiptTasks={},this.userSet={},this.pushNotificationMultiportConfig=h.getDefaultConfig(),this.msgAckBufferManager=new T({processFn:i(O=this.handleMsgsAck).call(O,this),throttleTime:500})},b.reset=function(){g.reset.call(this);var S=this.options;this.db.reset(S.db),c(S.lbsUrl)&&(S.lbsUrl=p.lbsUrl),this.autoconnect=!!S.autoconnect,this.resetAutoMarkRead()},b.resetAutoMarkRead=function(){var S=this.options;d.verifyBooleanWithDefault(S,"autoMarkRead",!0,"","protocol::resetAutoMarkRead")},b.resetUnsettledMsgs=function(){this.unhandledMsgs=[],this.unupdatedMsgs=[]},b.resetUnsettledSysMsgs=function(){this.unhandledSysMsgs=[],this.unhandledSysMsgsForDeletedMsgs=[],this.unupdatedSysMsgs=[]},b.packetFromSync=function(S){return!S.obj||!!S.obj.sync},o.exports=v,e(778),e(779),e(780),e(800),e(802),e(803),e(804),e(805),e(806),e(807),e(808),e(813),e(814),e(815),e(816),e(820),e(821),e(822),e(823),e(824),e(825)},function(o,k,e){var r=e(28),i=String,s=TypeError;o.exports=function(n){if(r(n))return n;throw s(i(n)+" is not an object")}},function(o,k,e){var r=e(78);o.exports=function(i){if(typeof i=="object"&&"size"in i&&"has"in i&&"get"in i&&"set"in i&&"delete"in i&&"entries"in i)return i;throw TypeError(r(i)+" is not a map")}},function(o,k,e){var r=e(27),i=e(209),s=e(211),n=e(36),u=e(125),p=TypeError,d=Object.defineProperty,m=Object.getOwnPropertyDescriptor;k.f=r?s?function(c,h,a){if(n(c),h=u(h),n(a),typeof c=="function"&&h==="prototype"&&"value"in a&&"writable"in a&&!a.writable){var y=m(c,h);y&&y.writable&&(c[h]=a.value,a={configurable:"configurable"in a?a.configurable:y.configurable,enumerable:"enumerable"in a?a.enumerable:y.enumerable,writable:!1})}return d(c,h,a)}:d:function(c,h,a){if(n(c),h=u(h),n(a),i)try{return d(c,h,a)}catch{}if("get"in a||"set"in a)throw p("Accessors not supported");return"value"in a&&(c[h]=a.value),c}},function(o,k,e){var r=e(18),i=e(73),s=e(35),n=e(13),u=e(826),p=e(147).IM,d=e(154);function m(h){var a=d(h);return this.subType="im",this.nosScene=a.nosScene||"im",this.nosSurvivalTime=a.nosSurvivalTime,a.Protocol=s,a.Message=u,a.constructor=m,this.init(a)}m.Protocol=s,m.parser=p,m.use=i.use,m.getInstance=i.getInstance,m.rmAllInstances=i.rmAllInstances,m.genInstanceName=function(h){return"NIM-account-"+h.account};var c=m.fn=m.prototype=r(i.prototype);m.info=c.info=n.info,o.exports=m,e(837),e(838),e(839),e(840),e(841),e(842),e(843),e(844),e(845),e(855),e(866),e(867),e(868),e(869),e(870),e(871),e(872),e(873),e(874),e(877),e(878)},function(o,k,e){var r=e(18),i=e(2),s=e(26);function n(d,m){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},h=this;h.message=d||c.message||"",s(m)==="object"?(h.event=m,h.code="Other_Error"):m!==void 0&&(h.code=m),h.timetag=+new Date,c!==void 0&&(h.event=c),h.event&&(h.callFunc=h.event.callFunc||null,delete h.event.callFunc)}n.prototype=r(Error.prototype),n.prototype.name="NIMError";var u={201:"客户端版本不对, 需升级sdk",302:"用户名或密码错误, 请检查appKey和token是否有效, account和token是否匹配",403:"非法操作或没有权限",404:"对象(用户/群/聊天室)不存在",405:"参数长度过长",408:"客户端请求超时",414:"参数错误",415:"服务不可用/没有聊天室服务器可分配",416:"频率控制",417:"重复操作",422:"帐号被禁用",500:"服务器内部错误",501:"数据库操作失败",503:"服务器繁忙",508:"删除有效期过了",509:"已失效",7101:"被拉黑",700:"批量操作部分失败",801:"群人数达到上限",802:"没有权限",803:"群不存在或未发生变化",804:"用户不在群里面",805:"群类型不匹配",806:"创建群数量达到限制",807:"群成员状态不对",809:"已经在群里",811:"强推列表中帐号数量超限",812:"群被禁言",813:"因群数量限制，部分拉人成功",814:"禁止使用群组消息已读服务",815:"群管理员人数上限",816:"批量操作部分失败",997:"协议已失效",998:"解包错误",999:"打包错误",9102:"通道失效",9103:"已经在其他端接听/拒绝过这通电话",11001:"对方离线, 通话不可送达",13002:"聊天室状态异常",13003:"在黑名单中",13004:"在禁言名单中",13006:"聊天室处于整体禁言状态,只有管理员能发言",Connect_Failed:"无法建立连接, 请确保能 ping/telnet 到云信服务器; 如果是IE8/9, 请确保项目部署在 HTTPS 环境下",Error_Internet_Disconnected:"网断了",Error_Connection_is_not_Established:"连接未建立",Error_Connection_Socket_State_not_Match:"socket状态不对",Error_Timeout:"超时",Param_Error:"参数错误",No_File_Selected:"请选择文件",Wrong_File_Type:"文件类型错误",File_Too_Large:"文件过大",Cross_Origin_Iframe:"不能获取跨域Iframe的内容",Not_Support:"不支持",NO_DB:"无数据库",DB:"数据库错误",Still_In_Team:"还在群里",Session_Exist:"会话已存在",Session_Not_Exist:"会话不存在",Error_Unknown:"未知错误",Operation_Canceled:"操作取消",Sync_Error:"同步数据失败"},p=[200,406,808,810];i(p).call(p,function(d){u[d]=null}),n.genError=function(d){var m=u[d];return m===void 0&&(m="操作失败"),m===null?null:new n(m,d)},n.multiInstance=function(d){return new n("不允许初始化多个实例","Not_Allow_Multi_Instance",d)},n.newNetworkError=function(d){var m="Error_Internet_Disconnected";return new n(u[m],m,d)},n.newConnectError=function(d){var m="Connect_Failed";return new n(u[m]||null,m,d)},n.newConnectionError=function(d){var m="Error_Connection_is_not_Established";return new n(u[m],m,d)},n.newSocketStateError=function(d){var m="Error_Connection_Socket_State_not_Match";return new n(u[m],m,d)},n.newTimeoutError=function(d){var m="Error_Timeout";return new n(u[m],m,d)},n.newFrequencyControlError=function(d){var m=new n(u[416],416,d);return m.from="local",m},n.newParamError=function(d,m){return new n(d||u.Param_Error,"Param_Error",m)},n.newNoFileError=function(d,m){var c="No_File_Selected";return new n(d||u[c],c,m)},n.newWrongFileTypeError=function(d,m){var c="Wrong_File_Type";return new n(d||u[c],c,m)},n.newFileTooLargeError=function(d,m){var c="File_Too_Large";return new n(d||u[c],c,m)},n.newCORSIframeError=function(d){var m="Cross_Origin_Iframe";return new n(u[m],m,d)},n.newSupportError=function(d,m,c){return new n("不支持"+d,"Not_Support_"+m,c)},n.newSupportDBError=function(d){return n.newSupportError("数据库","DB",d)},n.noDBError=function(d){return new n(u.NO_DB,"NO_DB",d)},n.newDBError=function(d){return new n(u.DB,"DB",d)},n.newUnknownError=function(d){var m="Error_Unknown";return new n(u[m],m,d)},n.stillInTeamError=function(d){var m="Still_In_Team";return new n(u[m],m,d)},n.sessionExist=function(d){var m="Session_Exist";return new n(u[m],m,d)},n.sessionNotExist=function(d){var m="Session_Not_Exist";return new n(u[m],m,d)},n.cancel=function(d){var m="Operation_Canceled";return new n(u[m],m,d)},n.syncError=function(d){return new n(u.Sync_Error,"Sync_Error",d)},n.customError=function(d,m){d=d||"Other_Error";var c="";return(m=m||{}).message||(c=u[d]||d),s(d)!=="object"?new n(c,d,m):new n(c,"Other_Error",m===void 0?d:m)},o.exports=n},function(o,k,e){o.exports=e(304)},function(o,k,e){var r=e(108),i=Object;o.exports=function(s){return i(r(s))}},function(o,k,e){var r=e(124),i=e(108);o.exports=function(s){return r(i(s))}},function(o,k,e){var r=e(0),i={init:function(){i.deviceId=r.guid()}};i.init(),i.clientTypeMap={1:"Android",2:"iOS",4:"PC",8:"WindowsPhone",16:"Web",32:"Server",64:"Mac"},i.db={open:function(){}},i.rnfs=null,o.exports=i},function(o,k,e){var r=e(321);o.exports=function(i){return r(i.length)}},function(o,k,e){var r=e(34),i=e(19),s=e(36),n=e(78),u=e(234),p=e(45),d=e(21),m=e(235),c=e(136),h=e(236),a=TypeError,y=function(v,g){this.stopped=v,this.result=g},T=y.prototype;o.exports=function(v,g,b){var S,O,I,R,N,F,P,x=b&&b.that,L=!(!b||!b.AS_ENTRIES),_=!(!b||!b.IS_RECORD),C=!(!b||!b.IS_ITERATOR),A=!(!b||!b.INTERRUPTED),M=r(g,x),U=function(z){return S&&h(S,"normal",z),new y(!0,z)},E=function(z){return L?(s(z),A?M(z[0],z[1],U):M(z[0],z[1])):A?M(z,U):M(z)};if(_)S=v.iterator;else if(C)S=v;else{if(!(O=c(v)))throw a(n(v)+" is not iterable");if(u(O)){for(I=0,R=p(v);R>I;I++)if((N=E(v[I]))&&d(T,N))return N;return new y(!1)}S=m(v,O)}for(F=_?v.next:S.next;!(P=i(F,S)).done;){try{N=E(P.value)}catch(z){h(S,"throw",z)}if(typeof N=="object"&&N&&d(T,N))return N}return new y(!1)}},function(o,k,e){o.exports=e(248)},function(o,k){o.exports=!0},function(o,k,e){var r=e(64),i=String;o.exports=function(s){if(r(s)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return i(s)}},function(o,k,e){var r=e(257),i=typeof self=="object"&&self&&self.Object===Object&&self,s=r||i||Function("return this")();o.exports=s},function(o,k,e){var r=e(714);o.exports=function(i,s,n){return n?r(i.entries(),function(u){return s(u[1],u[0])}):i.forEach(s)}},function(o,k,e){o.exports=e(557)},function(o,k,e){var r=e(27),i=e(38),s=e(77);o.exports=r?function(n,u,p){return i.f(n,u,s(1,p))}:function(n,u,p){return n[u]=p,n}},function(o,k,e){(function(r){var i=e(15),s=e(23),n=e(6),u=e(139),p=e(2),d=e(10),m=e(5),c=e(138),h=e(3),a=e(85),y=e(86),T=e(69),v=e(32);function g(H,K){var Z=y!==void 0&&T(H)||H["@@iterator"];if(!Z){if(v(H)||(Z=function(ae,pe){var ge;if(ae){if(typeof ae=="string")return b(ae,pe);var fe=i(ge=Object.prototype.toString.call(ae)).call(ge,8,-1);if(fe==="Object"&&ae.constructor&&(fe=ae.constructor.name),fe==="Map"||fe==="Set")return a(ae);if(fe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(fe))return b(ae,pe)}}(H))||K&&H&&typeof H.length=="number"){Z&&(H=Z);var te=0,ne=function(){};return{s:ne,n:function(){return te>=H.length?{done:!0}:{done:!1,value:H[te++]}},e:function(ae){throw ae},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var re,se=!0,oe=!1;return{s:function(){Z=Z.call(H)},n:function(){var ae=Z.next();return se=ae.done,ae},e:function(ae){oe=!0,re=ae},f:function(){try{se||Z.return==null||Z.return()}finally{if(oe)throw re}}}}function b(H,K){(K==null||K>H.length)&&(K=H.length);for(var Z=0,te=new Array(K);Z<K;Z++)te[Z]=H[Z];return te}var S=e(154);function O(){return typeof window<"u"?window:r!==void 0?r:typeof self<"u"?self:{}}function I(H){var K;return i(K=Object.prototype.toString.call(H)).call(K,8,-1)}function R(H){return I(H).toLowerCase()}function N(H){return R(H)==="string"}function F(H){return R(H)==="number"}function P(H){return R(H)==="array"}function x(H){return typeof H=="function"}function L(H){return R(H)==="date"}function _(H){return H===null}function C(H){return H!==null}function A(H){return H===void 0}function M(H){return H!==void 0}function U(H){return M(H)&&C(H)}function E(H){return A(H)||_(H)}function z(H){return U(H)&&R(H)==="object"}var $=function(H,K,Z){H.addEventListener?H.addEventListener(K,Z,!1):H.attachEvent&&H.attachEvent("on"+K,Z)},X=$,Y=function(H,K,Z){H.removeEventListener?H.removeEventListener(K,Z,!1):H.detachEvent&&H.detachEvent("on"+K,Z)},W=Y;function ee(){var H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},Z=arguments.length>2?arguments[2]:void 0;for(var te in H)H.hasOwnProperty(te)&&K.call(Z,te,H[te])}function w(H,K){ee(K,function(Z,te){H[Z]=te})}var J,V=(J=0,function(){return""+J++});function D(H){return N(H)&&n(H).call(H,"{")===0&&u(H).call(H,"}")===H.length-1}function Q(H,K,Z){if(!H)return"";var te=[];return ee(H,function(ne,re){x(re)||(L(re)?re=re.getTime():P(re)?re=re.join(","):z(re)&&(re=d(re)),Z&&(re=encodeURIComponent(re)),te.push(encodeURIComponent(ne)+"="+re))}),te.join(K||",")}var G,B=(G=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(H){return G.test(H||"")?RegExp.$1.toLowerCase():""});function q(H){var K=O();return H.tagName&&H.tagName.toUpperCase()==="INPUT"||K.Blob&&H instanceof K.Blob}o.exports={o:{},emptyObj:{},f:function(){},emptyFunc:function(){},regBlank:/\s+/gi,regWhiteSpace:/\s+/gi,getGlobal:O,getClass:I,typeOf:R,isString:N,isNumber:F,isInt:function(H){return F(H)&&H%1==0},isBoolean:function(H){return R(H)==="boolean"},isArray:P,isFunction:x,isDate:L,isRegExp:function(H){return R(H)==="regexp"},isError:function(H){return R(H)==="error"},isnull:_,notnull:C,undef:A,notundef:M,exist:U,notexist:E,isObject:z,isEmpty:function(H){return E(H)||(N(H)||P(H))&&H.length===0},remove:function(H){H.parentNode&&H.parentNode.removeChild(H)},dataset:function(H,K,Z){if(!U(Z))return H.getAttribute("data-"+K);H.setAttribute("data-"+K,Z)},addEventListener:$,on:X,removeEventListener:Y,off:W,target:function(H){return H.target||H.srcElement},createIframe:function(H){if(typeof document<"u"){var K;if((H=H||{}).name)try{(K=document.createElement('<iframe name="'+H.name+'"></iframe>')).frameBorder=0}catch{(K=document.createElement("iframe")).name=H.name}else K=document.createElement("iframe");H.visible||(K.style.display="none"),x(H.onload)&&X(K,"load",function te(ne){K.src&&(H.multi||W(K,"load",te),H.onload(ne))}),(H.parent||document.body).appendChild(K);var Z=H.src||"about:blank";return s(function(){K.src=Z},0),K}},html2node:function(H){if(typeof document<"u"){var K=document.createElement("div");K.innerHTML=H;var Z,te,ne=[];if(K.children)for(Z=0,te=K.children.length;Z<te;Z++)ne.push(K.children[Z]);else for(Z=0,te=K.childNodes.length;Z<te;Z++){var re=K.childNodes[Z];re.nodeType===1&&ne.push(re)}return ne.length>1?K:ne[0]}},forOwn:ee,mixin:w,uniqueID:V,isJSON:D,parseJSON:function H(K){try{D(K)&&(K=JSON.parse(K)),z(K)&&ee(K,function(Z,te){switch(R(te)){case"string":case"object":K[Z]=H(te)}})}catch{}return K},simpleClone:function(H){return S(H)},merge:function(){for(var H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},K=arguments.length,Z=new Array(K>1?K-1:0),te=1;te<K;te++)Z[te-1]=arguments[te];return p(Z).call(Z,function(ne){w(H,ne)}),H},fillUndef:function(H,K){return ee(K,function(Z,te){A(H[Z])&&(H[Z]=te)}),H},checkWithDefault:function(H,K,Z){var te=H[K]||H[K.toLowerCase()];return E(te)&&(te=Z,H[K]=te),te},fetch:function(H,K){return ee(H,function(Z){U(K[Z])&&(H[Z]=K[Z])}),H},string2object:function(){var H,K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",Z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:",",te={};return p(H=K.split(Z)).call(H,function(ne){var re=ne.split("="),se=re.shift();se&&(te[decodeURIComponent(se)]=decodeURIComponent(re.join("=")))}),te},object2string:Q,genUrlSep:function(H){return n(H).call(H,"?")<0?"?":"&"},object2query:function(H){return Q(H,"&",!0)},url2origin:B,isFileInput:q,getKeys:function(H,K){var Z=m(H);return K&&c(Z).call(Z,function(te,ne){var re=q(H[te]);return re===q(H[ne])?0:re?1:-1}),Z},_get:function(H,K){var Z,te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,ne=K.replace(/\[(\d+)\]/g,".$1").split("."),re=H,se=g(ne);try{for(se.s();!(Z=se.n()).done;){var oe=Z.value;if((re=Object(re)[oe])===void 0)return te}}catch(ae){se.e(ae)}finally{se.f()}return re},getPromiseWithAbort:function(H){var K={},Z=new h(function(te,ne){K.abort=ne});return K.promise=h.race([H,Z]),K}}}).call(this,e(70))},function(o,k,e){var r=e(33),i=e(711),s=r("Map");o.exports={Map:s,set:i("set",2),get:i("get",1),has:i("has",1),remove:i("delete",1),proto:s.prototype}},function(o,k,e){o.exports=e(579)},function(o,k,e){var r=e(137),i=e(249);o.exports=function(s,n,u){return(n=i(n))in s?r(s,n,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[n]=u,s},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(254)},function(o,k,e){o.exports=e(475)},function(o,k,e){o.exports=e(478)},function(o,k,e){o.exports=e(481)},function(o,k,e){var r=e(11),i=r({}.toString),s=r("".slice);o.exports=function(n){return s(i(n),8,-1)}},function(o,k,e){var r=e(33);o.exports=r("navigator","userAgent")||""},function(o,k,e){var r=e(162),i=e(16),s=e(62),n=e(20)("toStringTag"),u=Object,p=s(function(){return arguments}())=="Arguments";o.exports=r?s:function(d){var m,c,h;return d===void 0?"Undefined":d===null?"Null":typeof(c=function(a,y){try{return a[y]}catch{}}(m=u(d),n))=="string"?c:p?s(m):(h=s(m))=="Object"&&i(m.callee)?"Arguments":h}},function(o,k,e){var r=e(53);o.exports=function(i,s,n,u){return u&&u.enumerable?i[s]=n:r(i,s,n),i}},function(o,k,e){e(82);var r=e(355),i=e(14),s=e(64),n=e(53),u=e(99),p=e(20)("toStringTag");for(var d in r){var m=i[d],c=m&&m.prototype;c&&s(c)!==p&&n(c,p,d),u[d]=u.Array}},function(o,k,e){var r=e(31),i=TypeError,s=function(n){var u,p;this.promise=new n(function(d,m){if(u!==void 0||p!==void 0)throw i("Bad Promise constructor");u=d,p=m}),this.resolve=r(u),this.reject=r(p)};o.exports.f=function(n){return new s(n)}},function(o,k,e){o.exports=e(426)},function(o,k,e){o.exports=e(469)},function(o,k){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch{typeof window=="object"&&(e=window)}o.exports=e},function(o,k,e){var r=e(764);r.fn=r.prototype,o.exports=r,e(766),e(767),e(768),e(769),e(770),e(771),e(772),e(773),e(774),e(775),e(776)},function(o,k,e){var r=e(26),i=e(5),s=e(10),n=e(17),u=e(2),p=e(8),d=e(15),m=e(85),c=e(86),h=e(69),a=e(32);function y(_,C){var A=c!==void 0&&h(_)||_["@@iterator"];if(!A){if(a(_)||(A=function(X,Y){var W;if(X){if(typeof X=="string")return T(X,Y);var ee=d(W=Object.prototype.toString.call(X)).call(W,8,-1);if(ee==="Object"&&X.constructor&&(ee=X.constructor.name),ee==="Map"||ee==="Set")return m(X);if(ee==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ee))return T(X,Y)}}(_))||C&&_&&typeof _.length=="number"){A&&(_=A);var M=0,U=function(){};return{s:U,n:function(){return M>=_.length?{done:!0}:{done:!1,value:_[M++]}},e:function(X){throw X},f:U}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E,z=!0,$=!1;return{s:function(){A=A.call(_)},n:function(){var X=A.next();return z=X.done,X},e:function(X){$=!0,E=X},f:function(){try{z||A.return==null||A.return()}finally{if($)throw E}}}}function T(_,C){(C==null||C>_.length)&&(C=_.length);for(var A=0,M=new Array(C);A<C;A++)M[A]=_[A];return M}var v=e(0),g=v.undef,b=v.notundef,S=v.exist,O=e(193),I=e(296),R={p2p:0,team:1,superTeam:5},N={0:"p2p",1:"team",5:"superTeam"},F=i(R),P=I.typeMap,x=I.validTypes;function L(_){v.verifyOptions(_,"scene to type","msg::Message"),v.verifyParamValid("scene",_.scene,F,"msg::Message"),this.scene=R[_.scene],this.to=""+_.to,this.type=P[_.type],this.resend=_.resend?1:0,_.resend?(v.verifyOptions(_,"idClient","msg::Message"),this.idClient=_.idClient):this.idClient=v.guid(),b(_.subType)&&(v.isInt(+_.subType)&&+_.subType>0?this.subType=+_.subType:v.onParamError("subType只能是大于0的整数","msg::Message"));var C=_.replyMsg;C&&C.idServer&&C.from&&C.to&&C.time&&(this.replyMsgFromAccount=C.from,this.replyMsgToAccount=C.to,this.replyMsgTime=C.time,this.replyMsgIdServer=C.idServer,this.replyMsgIdClient=C.idClient,C.threadMsgFromAccount&&C.threadMsgIdServer&&C.threadMsgTime&&C.threadMsgToAccount?(this.threadMsgFromAccount=C.threadMsgFromAccount,this.threadMsgToAccount=C.threadMsgToAccount,this.threadMsgTime=C.threadMsgTime,this.threadMsgIdServer=C.threadMsgIdServer,this.threadMsgIdClient=C.threadMsgIdClient):(this.threadMsgFromAccount=C.from,this.threadMsgToAccount=C.to,this.threadMsgTime=C.time,this.threadMsgIdServer=C.idServer,this.threadMsgIdClient=C.idClient)),b(_.text)&&(this.body=""+_.text),b(_.custom)&&(r(_.custom)==="object"?this.custom=s(_.custom):this.custom=""+_.custom),b(_.body)&&(this.body=""+_.body),b(_.pushContent)&&(this.pushContent=""+_.pushContent),b(_.pushPayload)&&(this.pushPayload=""+_.pushPayload);var A=_.apns;if(b(A)&&_.scene==="team"){var M=A.accounts;b(M)&&v.verifyParamType("apns.accounts",M,"array","msg::Message"),this.apnsAccounts=M?s(M):"#%@all@%#",this.apnsContent=A.content||_.pushContent||"",v.verifyBooleanWithDefault(A,"forcePush",!0,"options.apns","msg::Message"),this.apnsForcePush=A.forcePush?1:0}var U=_.robotInfo;b(U)&&(_.scene==="team"&&v.verifyOptions(_.robotInfo,"account","msg::Message::robotInfo scene === team"),U.function&&(this.robotInfoFunction=U.function),U.topic&&(this.robotInfoTopic=U.topic),U.customContent&&(this.robotInfoCustomContent=U.customContent),U.account&&(this.robotInfoAccount=U.account)),b(_.isHistoryable)&&(this.isHistoryable=_.isHistoryable?1:0),b(_.isRoamingable)&&(this.isRoamingable=_.isRoamingable?1:0),b(_.isSyncable)&&(this.isSyncable=_.isSyncable?1:0),b(_.cc)&&(this.cc=_.cc?1:0),b(_.env)&&(this.env=_.env),b(_.isPushable)&&(this.isPushable=_.isPushable?1:0),b(_.isOfflinable)&&(this.isOfflinable=_.isOfflinable?1:0),b(_.isUnreadable)&&(this.isUnreadable=_.isUnreadable?1:0),b(_.needPushNick)&&(this.needPushNick=_.needPushNick?1:0),b(_.needMsgReceipt)&&(this.needMsgReceipt=_.needMsgReceipt?1:0),b(_.yidunEnable)&&(this.yidunEnable=_.yidunEnable?1:0),this.needUpdateSession=_.needUpdateSession===!1?0:1,b(_.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=_.antiSpamUsingYidun?1:0),b(_.clientAntiSpam)&&(this.clientAntiSpam=_.clientAntiSpam?1:0),b(_.antiSpamContent)&&(r(_.antiSpamContent)==="object"?this.antiSpamContent=s(_.antiSpamContent):this.antiSpamContent=""+_.antiSpamContent),b(_.antiSpamBusinessId)&&(r(_.antiSpamBusinessId)==="object"?this.antiSpamBusinessId=s(_.antiSpamBusinessId):this.antiSpamBusinessId=""+_.antiSpamBusinessId),b(_.yidunAntiCheating)&&(this.yidunAntiCheating=_.yidunAntiCheating),b(_.yidunAntiSpamExt)&&(this.yidunAntiSpamExt=_.yidunAntiSpamExt)}v.merge(L.prototype,I.prototype),L.prototype.getScene=function(){return N[this.scene]},L.getType=I.getType,L.setFlow=I.setFlow,L.reverse=function(_){var C,A=N[_.scene];if(C=_.delete==="1"?{delete:!0,scene:A||_.scene,from:_.from,time:+_.time,to:""+_.to}:{scene:A||_.scene,from:_.from,fromNick:_.fromNick,fromClientType:O.reverseType(_.fromClientType),fromDeviceId:_.fromDeviceId,to:""+_.to,time:+_.time,type:L.getType(_),text:S(_.body)?_.body:_.text||"",isHistoryable:g(_.isHistoryable)||+_.isHistoryable==1,isRoamingable:g(_.isRoamingable)||+_.isRoamingable==1,isSyncable:g(_.isSyncable)||+_.isSyncable==1,cc:g(_.cc)||+_.cc==1,isPushable:g(_.isPushable)||+_.isPushable==1,isOfflinable:g(_.isOfflinable)||+_.isOfflinable==1,isUnreadable:g(_.isUnreadable)||+_.isUnreadable==1,isReplyMsg:g(_.isReplyMsg)||+_.isReplyMsg==1,needPushNick:g(_.needPushNick)||+_.needPushNick==1,needMsgReceipt:+_.needMsgReceipt==1,isLocal:!1},_.isInBlackList&&(C.isInBlackList=+_.isInBlackList==1,C.isInBlackList&&(_.status="fail")),b(_.isMuted)&&(C.isMuted=+_.isMuted==1),b(_.resend)&&(C.resend=+_.resend==1),b(_.idClient)&&(C.idClient=_.idClient),b(_.idServer)&&(C.idServer=""+_.idServer),b(_.userUpdateTime)&&(C.userUpdateTime=+_.userUpdateTime),b(_.custom)&&(C.custom=_.custom),b(_.callbackExt)&&(C.callbackExt=_.callbackExt),b(_.subType)&&(C.subType=+_.subType),b(_.pushContent)&&(C.pushContent=_.pushContent),b(_.pushPayload)&&(C.pushPayload=_.pushPayload),b(_.tempTeamMemberCount)&&(C.tempTeamMemberCount=+_.tempTeamMemberCount),b(_.yidunAntiSpamRes)&&(C.yidunAntiSpamRes=_.yidunAntiSpamRes),b(_.apnsAccounts)){if(C.apns={},_.apnsAccounts!=="#%@all@%#"){var M=_.apnsAccounts;try{C.apns.accounts=JSON.parse(M)}catch{C.apns.accounts=[]}}C.apns.content=_.apnsContent||"",C.apns.forcePush=+_.apnsForcePush==1}if(b(_.robotInfoFunction)&&(C.robotInfo=C.robotInfo||{},_.robotInfoFunction&&(C.robotInfo.function=_.robotInfoFunction)),b(_.robotInfoCustomContent)&&(C.robotInfo=C.robotInfo||{},_.robotInfoCustomContent&&(C.robotInfo.customContent=_.robotInfoCustomContent)),b(_.robotInfoTopic)&&(C.robotInfo=C.robotInfo||{},_.robotInfoTopic&&(C.robotInfo.topic=_.robotInfoTopic)),b(_.robotInfoAccount)&&(C.robotInfo=C.robotInfo||{},_.robotInfoAccount&&(C.robotInfo.account=_.robotInfoAccount)),b(_.needUpdateSession)&&(C.needUpdateSession=+_.needUpdateSession==1),C.status=_.status||"success",b(n(_))&&(C.filter=n(_)),_.replyMsgIdServer&&_.threadMsgIdServer){var U=["replyMsgFromAccount","replyMsgToAccount","replyMsgTime","replyMsgIdServer","replyMsgIdClient","threadMsgFromAccount","threadMsgToAccount","threadMsgTime","threadMsgIdServer","threadMsgIdClient"];u(U).call(U,function(E){C[E]=_[E]}),C.replyMsgTime=+C.replyMsgTime,C.threadMsgTime=+C.threadMsgTime}return C},L.setExtra=function(_,C){_.target=L.getMsgTarget(_,C),_.sessionId=_.scene+"-"+_.target,I.setFlow(_,C)},L.getMsgTarget=function(_,C){return _.scene==="p2p"?_.to===C?_.from:_.to:_.scene==="team"||_.scene==="superTeam"?_.to:void 0},L.deduplication=function(_){var C,A,M={},U=y(_);try{for(U.s();!(A=U.n()).done;){var E=A.value,z=M[E.idClient];z&&z.time>E.time||(M[E.idClient]=E)}}catch($){U.e($)}finally{U.f()}return p(C=i(M)).call(C,function($){return M[$]})},L.sortMsgs=function(_){return _=d(_).call(_,0),v.sortObjArray(_,{sortPath:"time"}),_},L.getLastMsg=function(_){return(_=L.sortMsgs(_))[_.length-1]},L.getLastNotIgnoredMsg=function(_){for(var C=null,A=(_=L.sortMsgs(_)).length-1;A>=0;A--)if(!(C=_[A]).ignore)return C;return null},L.getMaxTimetag=function(_){return L.getLastMsg(_).time},L.validScenes=F,L.validTypes=x,L.sceneMap=R,L.sceneReverseMap=N,o.exports=L},function(o,k,e){var r=e(26),i=e(18),s=e(32),n=e(2),u=e(377),p=e(6),d=e(5),m=e(10),c=e(3),h=e(170),a=e(0),y=a.notundef,T=e(552),v=e(13),g=(e(184),e(44)),b=e(578).wrapSafeCallback,S=e(24).reportAPI,O=e(154);function I(){}var R={};I.getInstance=function(x){x=F(x),a.verifyOptions(x,"account","api::Base.getInstance");var L=this.genInstanceName(x),_=R[L];return _?I.updateInstance(_,x):_=R[L]=new this(x),_},I.updateInstance=function(x,L){x.setOptions(L),x.connect()};var N=I.fn=I.prototype=i(new h),F=function(x){return x.nosSurvivalTime?(a.verifyParamType("nosSurvivalTime",x.nosSurvivalTime,"number","api::Base.getInstance"),a.verifyParamMin("nosSurvivalTime",x.nosSurvivalTime,86400,"api::Base.getInstance")):x.nosSurvivalTime=1/0,x};N.updatePrivateConf=function(x){if(S({instance:this,className:"ApiBaseFn",funcName:"updatePrivateConf",hasCallback:!1}),x&&r(x.privateConf)==="object"){var L=x.privateConf;typeof L.lbs_web=="string"&&(x.lbsUrl=L.lbs_web),typeof L.link_ssl_web=="boolean"&&(x.secure=L.link_ssl_web),typeof L.https_enabled=="boolean"&&(x.httpsEnabled=L.https_enabled),x.uploadUrl=L.nos_uploader_web?L.nos_uploader_web:null,x.chunkUploadUrl=L.nos_uploader_web?L.nos_uploader_web:null,x.replaceUrl=L.nos_downloader?L.nos_downloader:null,x.downloadUrl=L.nos_accelerate?L.nos_accelerate:null,x.downloadHost=L.nos_accelerate_host?L.nos_accelerate_host:null,x.downloadHostList=L.nos_accelerate_host_list||[],x.downloadHost&&x.downloadHostList.push(x.downloadHost),x.nosCdnEnable=L.nos_cdn_enable!==!1,x.ntServerAddress=L.nt_server||null,x.kibanaServer=L.kibana_server,x.statisticServer=L.statistic_server,x.reportGlobalServer=L.report_global_server,x.ipVersion=L.ip_protocol_version||x.ipVersion,x.defaultLink=L.link_web||x.defaultLink,x.ipv6DefaultLink=L.link_ipv6_web||x.ipv6DefaultLink,typeof L.nos_lbs=="string"?x.nosLbsUrls=[L.nos_lbs]:x.nosLbsUrls=[],s(L.nos_edge_list)&&(x.edgeList=L.nos_edge_list)}return x.ntServerAddress===null||x.ntServerAddress===""?v.ntServerAddress=null:v.ntServerAddress=x.ntServerAddress,v.uploadUrl=x.uploadUrl||v.uploadUrl,v.chunkUploadUrl=x.chunkUploadUrl||v.chunkUploadUrl,v.downloadUrl=x.downloadUrl||v.downloadUrl,v.downloadHost=x.downloadHost||v.downloadHost,v.downloadHostList=x.downloadHostList&&x.downloadHostList.length>0?x.downloadHostList:v.downloadHostList,v.nosCdnEnable=x.nosCdnEnable!==!1,v.replaceUrl=x.replaceUrl||v.replaceUrl,v.httpsEnabled=x.httpsEnabled||v.httpsEnabled,x.probe_ipv4_url&&(v.ipProbeAddr.ipv4=x.probe_ipv4_url),x.probe_ipv6_url&&(v.ipProbeAddr.ipv6=x.probe_ipv6_url),x},N.init=function(x){a.verifyOptions(x,"account","api::Base.init"),x=this.updatePrivateConf(x),a.verifyBooleanWithDefault(x,"exifOrientation",!0,"","api::Base.init"),x.lbsBackup=x.lbsBackup===void 0||x.lbsBackup;var L=this.account=x.account=x.account+"",_=x.constructor.genInstanceName(x),C=R[_];if(x._disableSingleton&&(C=null),C)return I.updateInstance(C,x),C;this.logger=x.logger=new T({debug:x.debug,logFunc:x.logFunc,prefix:this.subType,dbLog:x.dbLog!==!1,account:x.account,expire:x.expire,logLevel:x.logLevel}),this.options=b(x,this),x.api=this;var A=this.protocol=new x.Protocol(x);return A.name="Protocol-"+_,A.account=L,A.api=this,A.message=this.message=new x.Message({account:L}),this.reporter=A.reporter,this.statusProtector=A.statusProtector,this.reporterHook=A.reporterHook,this.abtInfo={},(typeof a.get(x,"privateConf.isABTestEnable")=="boolean"?x.privateConf.isABTestEnable:v.privateConf.isABTestEnable)&&this.abTestConfigRequset(),this.name=_,R[_]=this,this},N.destroy=function(x){var L=this;(x=x||{}).done=S({instance:this,className:"ApiBaseFn",funcName:"destroy",done:x.done});var _=this;if(!_.__beginDestroy){var C;_.__beginDestroy=!0,x=x||{};var A,M=this.name;if(this.logger.warn("destroy::start"),!M)return this.logger&&this.logger.warn&&this.logger.warn("destroy::no instanceName"),void(_.__beginDestroy=void 0);this.protocol&&(C=this.protocol.connectTimer),this.protocol&&this.protocol.resetPush&&this.protocol.resetPush(),this.eventNames&&typeof this.eventNames=="function"&&n(A=this.eventNames()).call(A,function(U){delete L._events[U]}),this.disconnect({done:function(U){var E,z,$;_.logger.warn(`ApiBase::destroy: instance destroyed ...

`),_.__beginDestroy=void 0,_.reporter.destroy(),_.statusProtector.destroy(),_.reporterHook.destroy(),n(E=u(_.options)).call(E,function(Y){p(Y).call(Y,"on")===0&&(_.options[Y]=function(){},_.protocol.options[Y]=function(){},_.protocol.api.options[Y]=function(){})}),_.logger.destroy(),r(_.protocol.sessionSet)==="object"&&n(z=d(_.protocol.sessionSet)).call(z,function(Y){_.protocol.sessionSet[Y].unreadMsgs=[],_.protocol.sessionSet[Y]=void 0}),_.protocol.syncResult={},_.db&&_.db.close();var X=_.protocol;n($=u(_)).call($,function(Y){_[Y]=void 0}),R&&(R[M]=null,clearTimeout(C)),X&&(X.__destroyed=!0),x.done instanceof Function&&x.done(U)}})}},N.setOptions=function(x){var L=O(x);L=b(L,this),this.protocol.setOptions(L)},N.abTestConfigRequset=function(){var x=this,L=x.options.abTestUrl||"https://abt-online.netease.im/v1/api/abt/client/getExperimentInfo",_={projectKey:"im1_sdk_abtest_web",appKey:x.options.appKey,osType:"Web",sdkVersion:x.info.version,deviceId:g.deviceId},C=m({clientInfo:_});this.protocol.adaptersRequest(L,{method:"POST",timeout:5e3,headers:{"Content-Type":"application/json"},data:C,onload:function(A){var M=JSON.parse(A);x.abtInfo=M.data.abtInfo||{},x.logger&&x.logger.info("abTestConfigRequset::success",x.abtInfo)},onerror:function(){x.logger&&x.logger.info("abTestConfigRequset::fail")}},{exception_service:7})},N.processCallback=function(x,L){P(x,L)},N.processCallbackPromise=function(x,L){return new c(function(_,C){P(x,L,!0,_,C)})};var P=function(x,L,_,C,A){var M="api::processCallback";_&&(M="api::processCallbackPromise"),a.verifyCallback(x,"done",M),x.callback=function(U,E,z){var $=x.callback.options;if(E=E||$,L&&(E=$),a.isFunction(x.cbaop)){var X=x.cbaop(U,E);y(X)&&(E=X)}var Y=x.done;a.isObject(E)&&(delete E.done,delete E.cb,delete E.callback),_?U?A({message:"生成接口回调错误",callFunc:M,event:U}):C(E):Y(U,E,z)},x.callback.options=a.copy(x)};N.processPs=function(x){a.notexist(x.ps)&&(x.ps=""),a.verifyArrayMax("ps",x.ps,5e3)},N.processCustom=function(x){a.notexist(x.custom)&&(x.custom="")},N.sendCmd=function(){this.protocol.sendCmd.apply(this.protocol,arguments)},N.sendCmdWithResp=function(x,L,_){this.sendCmd(x,L,function(C,A,M){a.isFunction(_)&&(C?_(C,A):_(null,M))})},N.cbAndSendCmd=function(x,L){var _=this.processCallbackPromise(L);return this.sendCmd(x,L),_},N.sendCmdUsePromise=function(x,L){var _=this,C=S({instance:this,className:"ApiBaseFn",funcName:x,hasCallback:!0});return new c(function(A,M){_.sendCmd(x,L,function(U,E,z){if(U)typeof C=="function"&&C(U),M(U);else{var $=a.merge({},E,z);typeof C=="function"&&C(void 0),A($)}})})},I.use=function(x,L){x&&x.install&&a.isFunction(x.install)&&x.install(this,L)},I.rmAllInstances=function(){for(var x in R)R[x].destroy();R={}},N.logout=function(){var x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};x.callback=S({instance:this,className:"ApiBaseFn",funcName:"logout",done:x.callback}),x=x||{},this.protocol.shouldReconnect=!1,this.protocol.doLogout=!0,this.processCallback(x),this.sendCmd("logout",x,x.callback),this.protocol.statusProtector.emit("auth/loginLifeCycleLogout")},o.exports=I,e(582),e(583),e(625),e(626),e(636),e(640)},function(o,k,e){(function(r){var i=e(15),s=e(6),n=e(302),u=e(52),p=e(26),d=function(){var m=(r===void 0?"undefined":p(r))==="object"?r:window,c=Math.pow(2,53)-1,h=/\bOpera/,a=Object.prototype,y=a.hasOwnProperty,T=a.toString;function v(N){return(N=String(N)).charAt(0).toUpperCase()+i(N).call(N,1)}function g(N){return N=R(N),/^(?:webOS|i(?:OS|P))/.test(N)?N:v(N)}function b(N,F){for(var P in N)y.call(N,P)&&F(N[P],P,N)}function S(N){var F;return N==null?v(N):i(F=T.call(N)).call(F,8,-1)}function O(N){return String(N).replace(/([ -])(?!$)/g,"$1?")}function I(N,F){var P=null;return function(x,L){var _=-1,C=x?x.length:0;if(typeof C=="number"&&C>-1&&C<=c)for(;++_<C;)L(x[_],_,x);else b(x,L)}(N,function(x,L){P=F(P,x,L,N)}),P}function R(N){return String(N).replace(/^ +| +$/g,"")}return function N(F){var P=m,x=F&&p(F)==="object"&&S(F)!="String";x&&(P=F,F=null);var L=P.navigator||{},_=L.userAgent||"";F||(F=_);var C,A,M,U,E,z=x?!!L.likeChrome:/\bChrome\b/.test(F)&&!/internal|\n/i.test(T.toString()),$=x?"Object":"ScriptBridgingProxyObject",X=x?"Object":"Environment",Y=x&&P.java?"JavaPackage":S(P.java),W=x?"Object":"RuntimeObject",ee=/\bJava/.test(Y)&&P.java,w=ee&&S(P.environment)==X,J=ee?"a":"α",V=ee?"b":"β",D=P.document||{},Q=P.operamini||P.opera,G=h.test(G=x&&Q?Q["[[Class]]"]:S(Q))?G:Q=null,B=F,q=[],H=null,K=F==_,Z=K&&Q&&typeof Q.version=="function"&&Q.version(),te=I([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(ie,me){return ie||RegExp("\\b"+(me.pattern||O(me))+"\\b","i").exec(F)&&(me.label||me)}),ne=function(ie){return I(ie,function(me,ye){return me||RegExp("\\b"+(ye.pattern||O(ye))+"\\b","i").exec(F)&&(ye.label||ye)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),re=ae([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),se=function(ie){return I(ie,function(me,ye,de){return me||(ye[re]||ye[/^[a-z]+(?: +[a-z]+\b)*/i.exec(re)]||RegExp("\\b"+O(de)+"(?:\\b|\\w*\\d)","i").exec(F))&&de})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),oe=function(ie){return I(ie,function(me,ye){var de=ye.pattern||O(ye);return!me&&(me=RegExp("\\b"+de+"(?:/[\\d.]+|[ \\w.]*)","i").exec(F))&&(me=function(ue,ce,ve){var be={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return ce&&ve&&/^Win/i.test(ue)&&!/^Windows Phone /i.test(ue)&&(be=be[/[\d.]+$/.exec(ue)])&&(ue="Windows "+be),ue=String(ue),ce&&ve&&(ue=ue.replace(RegExp(ce,"i"),ve)),ue=g(ue.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(me,de,ye.label||ye)),me})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function ae(ie){return I(ie,function(me,ye){var de=ye.pattern||O(ye);return!me&&(me=RegExp("\\b"+de+" *\\d+[.\\w_]*","i").exec(F)||RegExp("\\b"+de+" *\\w+-[\\w]*","i").exec(F)||RegExp("\\b"+de+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(F))&&((me=String(ye.label&&!RegExp(de,"i").test(ye.label)?ye.label:me).split("/"))[1]&&!/[\d.]+/.test(me[0])&&(me[0]+=" "+me[1]),ye=ye.label||ye,me=g(me[0].replace(RegExp(de,"i"),ye).replace(RegExp("; *(?:"+ye+"[_-])?","i")," ").replace(RegExp("("+ye+")[-_.]?(\\w)","i"),"$1 $2"))),me})}if(te&&(te=[te]),se&&!re&&(re=ae([se])),(C=/\bGoogle TV\b/.exec(re))&&(re=C[0]),/\bSimulator\b/i.test(F)&&(re=(re?re+" ":"")+"Simulator"),ne=="Opera Mini"&&/\bOPiOS\b/.test(F)&&q.push("running in Turbo/Uncompressed mode"),ne=="IE"&&/\blike iPhone OS\b/.test(F)?(se=(C=N(F.replace(/like iPhone OS/,""))).manufacturer,re=C.product):/^iP/.test(re)?(ne||(ne="Safari"),oe="iOS"+((C=/ OS ([\d_]+)/i.exec(F))?" "+C[1].replace(/_/g,"."):"")):ne!="Konqueror"||/buntu/i.test(oe)?se&&se!="Google"&&(/Chrome/.test(ne)&&!/\bMobile Safari\b/i.test(F)||/\bVita\b/.test(re))||/\bAndroid\b/.test(oe)&&/^Chrome/.test(ne)&&/\bVersion\//i.test(F)?(ne="Android Browser",oe=/\bAndroid\b/.test(oe)?oe:"Android"):ne=="Silk"?(/\bMobi/i.test(F)||(oe="Android",q.unshift("desktop mode")),/Accelerated *= *true/i.test(F)&&q.unshift("accelerated")):ne=="PaleMoon"&&(C=/\bFirefox\/([\d.]+)\b/.exec(F))?q.push("identifying as Firefox "+C[1]):ne=="Firefox"&&(C=/\b(Mobile|Tablet|TV)\b/i.exec(F))?(oe||(oe="Firefox OS"),re||(re=C[1])):!ne||(C=!/\bMinefield\b/i.test(F)&&/\b(?:Firefox|Safari)\b/.exec(ne))?(ne&&!re&&/[\/,]|^[^(]+?\)/.test(i(F).call(F,s(F).call(F,C+"/")+8))&&(ne=null),(C=re||se||oe)&&(re||se||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(oe))&&(ne=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(oe)?oe:C)+" Browser")):ne=="Electron"&&(C=(/\bChrome\/([\d.]+)\b/.exec(F)||0)[1])&&q.push("Chromium "+C):oe="Kubuntu",Z||(Z=I(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version","HeadlessChrome",O(ne),"(?:Firefox|Minefield|NetFront)"],function(ie,me){return ie||(RegExp(me+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(F)||0)[1]||null})),(C=(te=="iCab"&&n(Z)>3?"WebKit":/\bOpera\b/.test(ne)&&(/\bOPR\b/.test(F)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(F)&&!/^(?:Trident|EdgeHTML)$/.test(te)&&"WebKit"||!te&&/\bMSIE\b/i.test(F)&&(oe=="Mac OS"?"Tasman":"Trident")||te=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(ne)&&"NetFront")&&(te=[C]),ne=="IE"&&(C=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(F)||0)[1])?(ne+=" Mobile",oe="Windows Phone "+(/\+$/.test(C)?C:C+".x"),q.unshift("desktop mode")):/\bWPDesktop\b/i.test(F)?(ne="IE Mobile",oe="Windows Phone 8.x",q.unshift("desktop mode"),Z||(Z=(/\brv:([\d.]+)/.exec(F)||0)[1])):ne!="IE"&&te=="Trident"&&(C=/\brv:([\d.]+)/.exec(F))&&(ne&&q.push("identifying as "+ne+(Z?" "+Z:"")),ne="IE",Z=C[1]),K){if(U="global",E=(M=P)!=null?p(M[U]):"number",/^(?:boolean|number|string|undefined)$/.test(E)||E=="object"&&!M[U])S(C=P.runtime)==$?(ne="Adobe AIR",oe=C.flash.system.Capabilities.os):S(C=P.phantom)==W?(ne="PhantomJS",Z=(C=C.version||null)&&C.major+"."+C.minor+"."+C.patch):typeof D.documentMode=="number"&&(C=/\bTrident\/(\d+)/i.exec(F))?(Z=[Z,D.documentMode],(C=+C[1]+4)!=Z[1]&&(q.push("IE "+Z[1]+" mode"),te&&(te[1]=""),Z[1]=C),Z=ne=="IE"?String(Z[1].toFixed(1)):Z[0]):typeof D.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(ne)&&(q.push("masking as "+ne+" "+Z),ne="IE",Z="11.0",te=["Trident"],oe="Windows");else if(ee&&(B=(C=ee.lang.System).getProperty("os.arch"),oe=oe||C.getProperty("os.name")+" "+C.getProperty("os.version")),w){try{Z=P.require("ringo/engine").version.join("."),ne="RingoJS"}catch{(C=P.system)&&C.global.system==P.system&&(ne="Narwhal",oe||(oe=C[0].os||null))}ne||(ne="Rhino")}else p(P.process)==="object"&&!P.process.browser&&(C=P.process)&&(p(C.versions)==="object"&&(typeof C.versions.electron=="string"?(q.push("Node "+C.versions.node),ne="Electron",Z=C.versions.electron):typeof C.versions.nw=="string"&&(q.push("Chromium "+Z,"Node "+C.versions.node),ne="NW.js",Z=C.versions.nw)),ne||(ne="Node.js",B=C.arch,oe=C.platform,Z=(Z=/[\d.]+/.exec(C.version))?Z[0]:null));oe=oe&&g(oe)}if(Z&&(C=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(Z)||/(?:alpha|beta)(?: ?\d)?/i.exec(F+";"+(K&&L.appMinorVersion))||/\bMinefield\b/i.test(F)&&"a")&&(H=/b/i.test(C)?"beta":"alpha",Z=Z.replace(RegExp(C+"\\+?$"),"")+(H=="beta"?V:J)+(/\d+\+?/.exec(C)||"")),ne=="Fennec"||ne=="Firefox"&&/\b(?:Android|Firefox OS)\b/.test(oe))ne="Firefox Mobile";else if(ne=="Maxthon"&&Z)Z=Z.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(re))re=="Xbox 360"&&(oe=null),re=="Xbox 360"&&/\bIEMobile\b/.test(F)&&q.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(ne)&&(!ne||re||/Browser|Mobi/.test(ne))||oe!="Windows CE"&&!/Mobi/i.test(F))if(ne=="IE"&&K)try{P.external===null&&q.unshift("platform preview")}catch{q.unshift("embedded")}else(/\bBlackBerry\b/.test(re)||/\bBB10\b/.test(F))&&(C=(RegExp(re.replace(/ +/g," *")+"/([.\\d]+)","i").exec(F)||0)[1]||Z)?(oe=((C=[C,/BB10/.test(F)])[1]?(re=null,se="BlackBerry"):"Device Software")+" "+C[0],Z=null):this!=b&&re!="Wii"&&(K&&Q||/Opera/.test(ne)&&/\b(?:MSIE|Firefox)\b/i.test(F)||ne=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(oe)||ne=="IE"&&(oe&&!/^Win/.test(oe)&&Z>5.5||/\bWindows XP\b/.test(oe)&&Z>8||Z==8&&!/\bTrident\b/.test(F)))&&!h.test(C=N.call(b,F.replace(h,"")+";"))&&C.name&&(C="ing as "+C.name+((C=C.version)?" "+C:""),h.test(ne)?(/\bIE\b/.test(C)&&oe=="Mac OS"&&(oe=null),C="identify"+C):(C="mask"+C,ne=G?g(G.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(C)&&(oe=null),K||(Z=null)),te=["Presto"],q.push(C));else ne+=" Mobile";if(C=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(F)||0)[1]){var pe,ge;C=[n(C.replace(/\.(\d)$/,".0$1")),C],ne=="Safari"&&i(pe=C[1]).call(pe,-1)=="+"?(ne="WebKit Nightly",H="alpha",Z=i(ge=C[1]).call(ge,0,-1)):Z!=C[1]&&Z!=(C[2]=(/\bSafari\/([\d.]+\+?)/i.exec(F)||0)[1])||(Z=null),C[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(F)||0)[1],C[0]==537.36&&C[2]==537.36&&n(C[1])>=28&&te=="WebKit"&&(te=["Blink"]),K&&(z||C[1])?(te&&(te[1]="like Chrome"),C=C[1]||((C=C[0])<530?1:C<532?2:C<532.05?3:C<533?4:C<534.03?5:C<534.07?6:C<534.1?7:C<534.13?8:C<534.16?9:C<534.24?10:C<534.3?11:C<535.01?12:C<535.02?"13+":C<535.07?15:C<535.11?16:C<535.19?17:C<536.05?18:C<536.1?19:C<537.01?20:C<537.11?"21+":C<537.13?23:C<537.18?24:C<537.24?25:C<537.36?26:te!="Blink"?"27":"28")):(te&&(te[1]="like Safari"),C=(C=C[0])<400?1:C<500?2:C<526?3:C<533?4:C<534?"4+":C<535?5:C<537?6:C<538?7:C<601?8:"8"),te&&(te[1]+=" "+(C+=typeof C=="number"?".x":/[.+]/.test(C)?"":"+")),ne=="Safari"&&(!Z||u(Z)>45)&&(Z=C)}ne=="Opera"&&(C=/\bzbov|zvav$/.exec(oe))?(ne+=" ",q.unshift("desktop mode"),C=="zvav"?(ne+="Mini",Z=null):ne+="Mobile",oe=oe.replace(RegExp(" *"+C+"$"),"")):ne=="Safari"&&/\bChrome\b/.exec(te&&te[1])&&(q.unshift("desktop mode"),ne="Chrome Mobile",Z=null,/\bOS X\b/.test(oe)?(se="Apple",oe="iOS 4.3+"):oe=null),Z&&s(Z).call(Z,C=/[\d.]+$/.exec(oe))==0&&s(F).call(F,"/"+C+"-")>-1&&(oe=R(oe.replace(C,""))),te&&!/\b(?:Avant|Nook)\b/.test(ne)&&(/Browser|Lunascape|Maxthon/.test(ne)||ne!="Safari"&&/^iOS/.test(oe)&&/\bSafari\b/.test(te[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(ne)&&te[1])&&(C=te[te.length-1])&&q.push(C),q.length&&(q=["("+q.join("; ")+")"]),se&&re&&s(re).call(re,se)<0&&q.push("on "+se),re&&q.push((/^on /.test(q[q.length-1])?"":"on ")+re),oe&&(C=/ ([\d.+]+)$/.exec(oe),A=C&&oe.charAt(oe.length-C[0].length-1)=="/",oe={architecture:32,family:C&&!A?oe.replace(C[0],""):oe,version:C?C[1]:null,toString:function(){var ie=this.version;return this.family+(ie&&!A?" "+ie:"")+(this.architecture==64?" 64-bit":"")}}),(C=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(B))&&!/\bi686\b/i.test(B)?(oe&&(oe.architecture=64,oe.family=oe.family.replace(RegExp(" *"+C),"")),ne&&(/\bWOW64\b/i.test(F)||K&&/\w(?:86|32)$/.test(L.cpuClass||L.platform)&&!/\bWin64; x64\b/i.test(F))&&q.unshift("32-bit")):oe&&/^OS X/.test(oe.family)&&ne=="Chrome"&&n(Z)>=39&&(oe.architecture=64),F||(F=null);var fe={};return fe.description=F,fe.layout=te&&te[0],fe.manufacturer=se,fe.name=ne,fe.prerelease=H,fe.product=re,fe.ua=F,fe.version=ne&&Z,fe.os=oe||{architecture:null,family:null,version:null,toString:function(){return"null"}},fe.parse=N,fe.toString=function(){return this.description||""},fe.version&&q.unshift(Z),fe.name&&q.unshift(ne),oe&&ne&&(oe!=String(oe).split(" ")[0]||oe!=ne.split(" ")[0]&&!re)&&q.push(re?"("+oe+")":"on "+oe),q.length&&(fe.description=q.join(" ")),fe}()}();o.exports=d}).call(this,e(70))},function(o,k,e){var r=e(87),i=e(32),s=e(5),n=e(17),u=e(201),p=e(6),d=e(68),m=e(7),c=e(2),h=e(10),a=e(56),y=e(23),T=e(25),v=e(0),g=v.undef,b=e(13),S=e(40),O=e(155),I=O.StatusProtector,R=(O.V2NIMLoginStatus,e(105)),N=R.ReporterHook,F=R.EMSyncType,P=e(641),x=e(642);function L(C){v.undef(C.secure)&&(C.secure=!0),this.options=C,this.keepNosSafeUrl=this.options.keepNosSafeUrl||!1;var A=C.defaultLink||C.defaultLinkUrl;v.notundef(A)&&v.isString(A)&&(b.optionDefaultLinkUrl=r(A).call(A)),v.notundef(C.ipv6DefaultLink)&&v.isString(C.ipv6DefaultLink)&&(b.optionIpv6DefaultLinkUrl=C.ipv6DefaultLink),typeof C.heartbeatInterval=="number"&&(b.heartbeatInterval=C.heartbeatInterval),i(C.nosLbsUrls)&&(b.nosLbsUrls=C.nosLbsUrls);var M=this.options.socketConcurrent;M=typeof M=="number"&&M>=1&&M<=3?M:1,this.options.socketConcurrent=M,this.options.rollbackDelMsgUnread!==void 0&&typeof this.options.rollbackDelMsgUnread=="boolean"||(this.options.rollbackDelMsgUnread=!0),this.init(),this.connect()}var _=L.fn=L.prototype;_.init=function(){var C=this;this.logger=this.options.logger,this.getNosOriginUrlReqNum=0,this.checkNosReqNum=0,this.timerMap={},this.cmdCallbackMap={},this.cmdContentMap={},this.initConnect(),this.reset(),this.statusProtector=new I(this),this.reporterHook=new N(this,this.options.reporterHookConfig),this.promiseAbortManager=new P,this.imsocket=new x(this,{socketConcurrent:this.options.socketConcurrent}),this.statusProtector.on("auth/loginLifeCycleLogout",function(){C.promiseAbortManager.clear()}),this.statusProtector.on("auth/loginLifeCycleLoginSucc",function(){C.reporterHook.reset(),C.reporterHook.setOriginTimetick()})},_.reset=function(){g(this.options.thumbnailToStatic)&&(this.options.thumbnailToStatic=!0),this.resetConnect()},_.setOptions=function(C){var A=this.options,M=s(A),U=s(C),E=["onconnect","onerror","onwillreconnect","ondisconnect","onloginportschange","onmyinfo","onblacklist","onmutelist","onfriends","onusers","onrobots","onteams","onSuperTeams","onsessions","onSessionsWithMoreRoaming","onStickTopSessions","onroamingmsgs","onofflinemsgs","onofflinefiltermsgs","onroamingsysmsgs","onofflinesysmsgs","onofflinefiltersysmsgs","onofflinecustomsysmsgs","onofflinefiltercustomsysmsgs","onbroadcastmsg","onbroadcastmsgs","onsysmsgunread","onsyncdone","onteammembers","onsyncteammembersdone","onmsg","onsysmsg","oncustomsysmsg","onupdatemyinfo","onupdateuser","onSyncUpdateServerSession","onUpdateSuperTeamMember","onMySuperTeamMembers","onCreateSuperTeam","onUpdateSuperTeam","onAddSuperTeamMembers","onRemoveSuperTeamMembers","onUpdateSuperTeamManagers","onDismissSuperTeam","onTransferSuperTeam","onUpdateSuperTeamMembersMute","onupdateteammember","onMyTeamMembers","onMsgReceipts","onCreateTeam","onUpdateTeam","onAddTeamMembers","onRemoveTeamMembers","onUpdateTeamManagers","onDismissTeam","onTransferTeam","onUpdateTeamMembersMute","onTeamMsgReceipt","onupdatesession","onQuickComment","onDeleteQuickComment","onPinMsgChange","onupdatesysmsgunread","onupdatesysmsg","onsynccreateteam","onsyncsupercreateteam","onsyncmarkinblacklist","onsyncmarkinmutelist","onsyncfriendaction","shouldIgnoreNotification","shouldIgnoreMsg","onDeleteMsgSelf","shouldCountNotifyUnread","onPushNotificationMultiportConfig","onPushNotificationMultiportConfigUpdate","onpushevents"],z=n(U).call(U,function(X){return u(E).call(E,X)}),$=p(M).call(M,"account");v.verifyCallback(C,z,"protocol::IMProtocol"),this.logger.info("setOptions::",v.omitAsString(C,["appKey","token","loginExt","customTag"])),$!==-1&&d(M).call(M,$,1),C=v.filterObj(C,M),this.options=v.merge(A,C),this.reset()},_.sendCmd=function(C){var A,M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",U=arguments.length>2?arguments[2]:void 0,E=this;E.heartbeat();var z,$=C,X=(C=E.parser.createCmd(C,M)).SER;M=M||{},E.cmdContentMap[X]=M,M.single&&(delete M.single,(z=s(M)).length===1&&(E.cmdContentMap[X]=M[z[0]])),M.__exceptionInfo={target:m(A="".concat(C.SID,"-")).call(A,C.CID),context:X,startTime:E.reporterHook.getSafeClock()},M.NOTSTORE&&(z=M.NOTSTORE.split(" "),c(z).call(z,function(Y){delete M[Y]}),delete M.NOTSTORE),(U=U||M.callback)&&(E.cmdCallbackMap[X]=U),E.executeCmdTask({cmdName:$,cmd:h(C)})},_.executeCmdTask=function(C){var A=C.cmdName,M=C.cmd,U=(M=JSON.parse(M)).SER;this.isFrequencyControlled(A)?(this.logger.warn("protocol::executeCmdTask: ".concat(A," hit freq control")),this.markCallbackInvalid(U,S.newFrequencyControlError({callFunc:"protocol::executeCmdTask",message:"".concat(A," hit freq control")}))):this.hasLogin?(A!=="heartbeat"&&(this.logger.debugEnable?this.logger.debug("protocol::sendCmd: ".concat(C.cmd)):this.logger.info("protocol::sendCmd: ".concat(A))),this.doSendCmd(M)):A==="login"&&this.isConnected()?(this.logger.debugEnable?this.logger.debug("protocol::sendCmd: ".concat(C.cmd)):this.logger.info("protocol::sendCmd: ".concat(A)),this.doSendCmd(M)):(this.logger.warn("protocol::executeCmdTask: ".concat(A," not connected or login")),this.markCallbackInvalid(U,S.newSocketStateError({callFunc:"protocol::executeCmdTask",message:"".concat(A," not connected or not login")})))},_.isFrequencyControlled=function(C){var A=this.frequencyControlMap&&this.frequencyControlMap[C];if(A){if(a()<A.from+A.duration)return!0;delete this.frequencyControlMap[C]}},_.doSendCmd=function(C){var A=this,M=C.SER,U=M===0?b.hbCmdTimeout:b.cmdTimeout,E=new Date().getTime(),z=A.cmdContentMap[M];function $(){A.markCallbackInvalid(M,S.newSocketStateError({callFunc:"protocol::doSendCmd",message:"ser ".concat(M," socketSendJson Error")})),A.onDisconnect("protocol::doSendCmd:socketSendJson","broken")}z&&z.__exceptionInfo&&(z.__exceptionInfo.startTime=a()),C.isAwaitable&&(A.timerMap[M]=y(function(){var X;A.markCallbackInvalid(M,S.newTimeoutError({callFunc:"protocol::doSendCmd",message:"ser ".concat(M," Timeout Error")})),A.reporter.reportTraceStart("exceptions",{user_id:v.get(A,"options.account")||"",trace_id:v.get(A,"socket.socket.sessionid"),start_time:E,action:2,exception_service:6}),A.reporter.reportTraceUpdateV2("exceptions",{code:408,description:"Packet timeout",operation_type:1,target:m(X="".concat(C.SID,"-")).call(X,C.CID),context:"".concat(C.SER),net_connect:A.checkNetworkAvailable()}),A.reporter.reportTraceEnd("exceptions",1)},U));try{A.socket&&A.socket.send?A.socket.send(h(C)):$()}catch{$()}},_.getObjWithSer=function(C){var A=this.cmdContentMap[C];return A&&!A.isImSyncDataObj&&delete this.cmdContentMap[C],A&&v.copy(A)},_.getCallbackWithSer=function(C){var A=this.cmdCallbackMap[C];return A&&!A.isImSyncDataCb&&delete this.cmdCallbackMap[C],A},_.getTimerWithSer=function(C){var A=this.timerMap[C];return delete this.timerMap[C],A},_.clearTimerWithSer=function(C){var A=this.getTimerWithSer(C);A&&clearTimeout(A)},_.markCallbackInvalid=function(C,A){this.getObjWithSer(C),this.clearTimerWithSer(C);var M=this.getCallbackWithSer(C);if(M){var U=M.options;y(function(){M(A||S.newUnknownError({ser:C}),U)},0)}},_.markAllCallbackInvalid=function(C){var A,M,U=this;c(A=s(this.cmdCallbackMap)).call(A,function(E){var z=U.getObjWithSer(E);if(z.__exceptionInfo){var $=z.__exceptionInfo.target,X=z.__exceptionInfo.context,Y=v.get(C,"event.uploadCode")||C&&C.code;Y=typeof Y!="number"?415:Y;var W=v.get(C,"event.disconnectReason"),ee=W?h({disconnect_reason:W}):C&&C.message||"send cmd failed";U.reporter.reportTraceStart("exceptions",{user_id:v.get(U,"options.account")||"",trace_id:v.get(U,"socket.socket.sessionid"),start_time:U.reporterHook.getNTPTime(z.__exceptionInfo.startTime),action:2,exception_service:6}),U.reporter.reportTraceUpdateV2("exceptions",{code:Y,description:ee,operation_type:1,target:$,context:X,net_connect:U.checkNetworkAvailable()}),U.reporter.reportTraceEnd("exceptions",1),delete z.__exceptionInfo}}),c(M=s(this.cmdCallbackMap)).call(M,function(E){U.markCallbackInvalid(E,C)})},_.getPacketObj=function(C){var A=null;if(C&&C.raw){var M=C.raw.ser;v.notundef(M)&&(A=this.getObjWithSer(M))}return A},_.callPacketAckCallback=function(C){var A=this;if(C&&C.raw){var M=C.raw.ser;if(v.notundef(M)){A.clearTimerWithSer(M);var U=A.getCallbackWithSer(M);if(U){var E;U.originUrl&&C.obj&&C.obj.file&&(C.obj.file._url_safe=C.obj.file.url,C.obj.file.url=U.originUrl,C.obj.type==="audio"&&(C.obj.file.mp3Url=U.originUrl+(~p(E=U.originUrl).call(E,"?")?"&":"?")+"audioTrans&type=mp3")),C.promise?C.promise.then(function(){U(C.error,C.obj)},function(z){var $,X;z.callFunc="protocol::callPacketAckCallback",z.message=m($=m(X="Resp Promoise Error: cmd: ".concat(C.cmd,", ser: ")).call(X,M,", reason: ")).call($,z.message);var Y=S.customError("CALLBACK_ACK_ERR",z);A.logger.error(`protocol::callPacketAckCallback error stack: 
`.concat(z.stack||z.event&&z.event.stack)),U(Y,C.obj,C.content)}):U(C.error,C.obj,C.content)}}}},_.onMessage=function(C){var A=this;A.heartbeat(),A.parser.parseResponse(C).then(function(M){var U;if(M.notFound&&A.logger.warn("protocol::onMessage: packet not found ".concat(h(M))),M.error){var E,z;M.error.message=m(E="".concat(M.cmd," error: ")).call(E,M.error.message),A.logger.error(m(z="protocol::onMessage: packet error ".concat(h(M.error),"，raw cmd ")).call(z,M.rawStr));var $=M.raw||{};$.code!==408&&$.code!==415&&$.code!==500||A.reporter.report("nimErrEvent",{code:$.code,module:M.cmd,accid:A.account})}M.__receiveTime=A.reporterHook.getSafeClock();var X=F[m(U="kSyncType".concat(M.raw.sid,"_")).call(U,M.raw.cid)];if(X){var Y=v.get(M,"raw.r"),W=1;if(Y&&Y.length>0){var ee=n(Y).call(Y,function(B){return i(B)}),w=v.get(ee,"0.length");W=typeof w=="number"?w:1}A.reporterHook.emit("reporter/syncItem",X,W)}M.frequencyControlDuration&&(A.logger.error("protocol::onMessage: server freq control ".concat(h(M.cmd))),A.frequencyControlMap=A.frequencyControlMap||{},A.frequencyControlMap[M.cmd]={from:+new Date,duration:M.frequencyControlDuration}),M.obj=A.getPacketObj(M),M.obj&&M.obj.__exceptionInfo&&delete M.obj.__exceptionInfo,M.cmd!=="heartbeat"&&(A.logger.debugEnable?A.logger.debug("protocol::recvCmd: ".concat(M.rawStr)):A.logger.log("protocol::recvCmd: ".concat(M.cmd)));var J="process"+v.capFirstLetter(M.service);if(A[J])if(M.cmd==="syncDone"){if(A.cmdCallbackMap[M.raw.ser]&&A.cmdCallbackMap[M.raw.ser].isImSyncDataCb){var V;A.cmdCallbackMap[M.raw.ser].isImSyncDataCb=!1;var D=T(V=function(B,q){this.checkNosReqNum++,this.getNosOriginUrlReqNum<=0||this.checkNosReqNum>=20?this[B](q):y(D,300)}).call(V,A,J,M);y(function(){D.call(A,J,M)},10)}}else try{A[J](M)}catch(B){var Q,G;A.logger.warn(m(Q=m(G="protocol::onMessage: ".concat(J,".")).call(G,M.cmd," excute failed ")).call(Q,M.obj?"":", maybe the packet timed out",": "),B.message)}else A.logger.warn("protocol::onMessage: ".concat(J," not found"));A.callPacketAckCallback(M)})},_.onMiscError=function(C,A,M){A&&this.notifyError(C,A,M)},_.onCustomError=function(C,A){var M=S.customError(C,A),U=A.message||"未知错误";this.onMiscError(U,M)},_.notifyError=function(C,A,M){var U;this.isConnected()&&(this.logger.error(m(U="".concat(C||""," ")).call(U,this.name),A,M),this.options.onerror(A,M))},_.emitAPI=function(C){var A=C.type,M=C.obj;this.api.emit(A,M)},o.exports=L,e(662),e(678),e(679),e(680),e(681),e(682)},function(o,k,e){var r=e(107),i=Function.prototype,s=i.apply,n=i.call;o.exports=typeof Reflect=="object"&&Reflect.apply||(r?n.bind(s):function(){return n.apply(s,arguments)})},function(o,k){o.exports=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}}},function(o,k){var e=String;o.exports=function(r){try{return e(r)}catch{return"Object"}}},function(o,k,e){var r=e(62);o.exports=Array.isArray||function(i){return r(i)=="Array"}},function(o,k,e){var r,i=e(36),s=e(163),n=e(164),u=e(112),p=e(217),d=e(159),m=e(130),c=m("IE_PROTO"),h=function(){},a=function(v){return"<script>"+v+"<\/script>"},y=function(v){v.write(a("")),v.close();var g=v.parentWindow.Object;return v=null,g},T=function(){try{r=new ActiveXObject("htmlfile")}catch{}var v,g;T=typeof document<"u"?document.domain&&r?y(r):((g=d("iframe")).style.display="none",p.appendChild(g),g.src=String("javascript:"),(v=g.contentWindow.document).open(),v.write(a("document.F=Object")),v.close(),v.F):y(r);for(var b=n.length;b--;)delete T.prototype[n[b]];return T()};u[c]=!0,o.exports=Object.create||function(v,g){var b;return v!==null?(h.prototype=i(v),b=new h,h.prototype=null,b[c]=v):b=T(),g===void 0?b:s.f(b,g)}},function(o,k,e){var r=e(162),i=e(38).f,s=e(53),n=e(29),u=e(333),p=e(20)("toStringTag");o.exports=function(d,m,c,h){if(d){var a=c?d:d.prototype;n(a,p)||i(a,p,{configurable:!0,value:m}),h&&!r&&s(a,"toString",u)}}},function(o,k,e){var r=e(43),i=e(196),s=e(99),n=e(97),u=e(38).f,p=e(166),d=e(167),m=e(48),c=e(27),h=n.set,a=n.getterFor("Array Iterator");o.exports=p(Array,"Array",function(T,v){h(this,{type:"Array Iterator",target:r(T),index:0,kind:v})},function(){var T=a(this),v=T.target,g=T.kind,b=T.index++;return!v||b>=v.length?(T.target=void 0,d(void 0,!0)):d(g=="keys"?b:g=="values"?v[b]:[b,v[b]],!1)},"values");var y=s.Arguments=s.Array;if(i("keys"),i("values"),i("entries"),!m&&c&&y.name!=="values")try{u(y,"name",{value:"values"})}catch{}},function(o,k,e){var r=e(497),i=e(502);o.exports=function(s,n){var u=i(s,n);return r(u)?u:void 0}},function(o,k,e){var r=e(34),i=e(11),s=e(124),n=e(42),u=e(45),p=e(161),d=i([].push),m=function(c){var h=c==1,a=c==2,y=c==3,T=c==4,v=c==6,g=c==7,b=c==5||v;return function(S,O,I,R){for(var N,F,P=n(S),x=s(P),L=r(O,I),_=u(x),C=0,A=R||p,M=h?A(S,_):a||g?A(S,0):void 0;_>C;C++)if((b||C in x)&&(F=L(N=x[C],C,P),c))if(h)M[C]=F;else if(F)switch(c){case 3:return!0;case 5:return N;case 6:return C;case 2:d(M,N)}else switch(c){case 4:return!1;case 7:d(M,N)}return v?-1:y||T?T:M}};o.exports={forEach:m(0),map:m(1),filter:m(2),some:m(3),every:m(4),find:m(5),findIndex:m(6),filterReject:m(7)}},function(o,k,e){o.exports=e(300)},function(o,k,e){o.exports=e(218)},function(o,k,e){o.exports=e(571)},function(o,k){o.exports=function(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}},function(o,k,e){(function(r){var i;o.exports=(i=i||function(s,n){var u;if(typeof window<"u"&&window.crypto&&(u=window.crypto),typeof self<"u"&&self.crypto&&(u=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(u=globalThis.crypto),!u&&typeof window<"u"&&window.msCrypto&&(u=window.msCrypto),!u&&r!==void 0&&r.crypto&&(u=r.crypto),!u)try{u=e(884)}catch{}var p=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},d=Object.create||function(){function O(){}return function(I){var R;return O.prototype=I,R=new O,O.prototype=null,R}}(),m={},c=m.lib={},h=c.Base={extend:function(O){var I=d(this);return O&&I.mixIn(O),I.hasOwnProperty("init")&&this.init!==I.init||(I.init=function(){I.$super.init.apply(this,arguments)}),I.init.prototype=I,I.$super=this,I},create:function(){var O=this.extend();return O.init.apply(O,arguments),O},init:function(){},mixIn:function(O){for(var I in O)O.hasOwnProperty(I)&&(this[I]=O[I]);O.hasOwnProperty("toString")&&(this.toString=O.toString)},clone:function(){return this.init.prototype.extend(this)}},a=c.WordArray=h.extend({init:function(O,I){O=this.words=O||[],this.sigBytes=I??4*O.length},toString:function(O){return(O||T).stringify(this)},concat:function(O){var I=this.words,R=O.words,N=this.sigBytes,F=O.sigBytes;if(this.clamp(),N%4)for(var P=0;P<F;P++){var x=R[P>>>2]>>>24-P%4*8&255;I[N+P>>>2]|=x<<24-(N+P)%4*8}else for(var L=0;L<F;L+=4)I[N+L>>>2]=R[L>>>2];return this.sigBytes+=F,this},clamp:function(){var O=this.words,I=this.sigBytes;O[I>>>2]&=4294967295<<32-I%4*8,O.length=s.ceil(I/4)},clone:function(){var O=h.clone.call(this);return O.words=this.words.slice(0),O},random:function(O){for(var I=[],R=0;R<O;R+=4)I.push(p());return new a.init(I,O)}}),y=m.enc={},T=y.Hex={stringify:function(O){for(var I=O.words,R=O.sigBytes,N=[],F=0;F<R;F++){var P=I[F>>>2]>>>24-F%4*8&255;N.push((P>>>4).toString(16)),N.push((15&P).toString(16))}return N.join("")},parse:function(O){for(var I=O.length,R=[],N=0;N<I;N+=2)R[N>>>3]|=parseInt(O.substr(N,2),16)<<24-N%8*4;return new a.init(R,I/2)}},v=y.Latin1={stringify:function(O){for(var I=O.words,R=O.sigBytes,N=[],F=0;F<R;F++){var P=I[F>>>2]>>>24-F%4*8&255;N.push(String.fromCharCode(P))}return N.join("")},parse:function(O){for(var I=O.length,R=[],N=0;N<I;N++)R[N>>>2]|=(255&O.charCodeAt(N))<<24-N%4*8;return new a.init(R,I)}},g=y.Utf8={stringify:function(O){try{return decodeURIComponent(escape(v.stringify(O)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(O){return v.parse(unescape(encodeURIComponent(O)))}},b=c.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(O){typeof O=="string"&&(O=g.parse(O)),this._data.concat(O),this._nDataBytes+=O.sigBytes},_process:function(O){var I,R=this._data,N=R.words,F=R.sigBytes,P=this.blockSize,x=F/(4*P),L=(x=O?s.ceil(x):s.max((0|x)-this._minBufferSize,0))*P,_=s.min(4*L,F);if(L){for(var C=0;C<L;C+=P)this._doProcessBlock(N,C);I=N.splice(0,L),R.sigBytes-=_}return new a.init(I,_)},clone:function(){var O=h.clone.call(this);return O._data=this._data.clone(),O},_minBufferSize:0}),S=(c.Hasher=b.extend({cfg:h.extend(),init:function(O){this.cfg=this.cfg.extend(O),this.reset()},reset:function(){b.reset.call(this),this._doReset()},update:function(O){return this._append(O),this._process(),this},finalize:function(O){return O&&this._append(O),this._doFinalize()},blockSize:16,_createHelper:function(O){return function(I,R){return new O.init(R).finalize(I)}},_createHmacHelper:function(O){return function(I,R){return new S.HMAC.init(O,R).finalize(I)}}}),m.algo={});return m}(Math),i)}).call(this,e(70))},function(o,k,e){var r=e(27),i=e(19),s=e(148),n=e(77),u=e(43),p=e(125),d=e(29),m=e(209),c=Object.getOwnPropertyDescriptor;k.f=r?c:function(h,a){if(h=u(h),a=p(a),m)try{return c(h,a)}catch{}if(d(h,a))return n(!i(s.f,h,a),h[a])}},function(o,k){o.exports=function(e){return e==null}},function(o,k,e){var r=e(93),i=e(4);o.exports=!!Object.getOwnPropertySymbols&&!i(function(){var s=Symbol();return!String(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&r&&r<41})},function(o,k,e){var r,i,s=e(14),n=e(63),u=s.process,p=s.Deno,d=u&&u.versions||p&&p.version,m=d&&d.v8;m&&(i=(r=m.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&n&&(!(r=n.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=n.match(/Chrome\/(\d+)/))&&(i=+r[1]),o.exports=i},function(o,k,e){var r=e(4);o.exports=function(i,s){var n=[][i];return!!n&&r(function(){n.call(null,s||function(){return 1},1)})}},function(o,k,e){var r=e(125),i=e(38),s=e(77);o.exports=function(n,u,p){var d=r(u);d in n?i.f(n,d,s(0,p)):n[d]=p}},function(o,k){},function(o,k,e){var r,i,s,n=e(334),u=e(14),p=e(28),d=e(53),m=e(29),c=e(158),h=e(130),a=e(112),y=u.TypeError,T=u.WeakMap;if(n||c.state){var v=c.state||(c.state=new T);v.get=v.get,v.has=v.has,v.set=v.set,r=function(b,S){if(v.has(b))throw y("Object already initialized");return S.facade=b,v.set(b,S),S},i=function(b){return v.get(b)||{}},s=function(b){return v.has(b)}}else{var g=h("state");a[g]=!0,r=function(b,S){if(m(b,g))throw y("Object already initialized");return S.facade=b,d(b,g,S),S},i=function(b){return m(b,g)?b[g]:{}},s=function(b){return m(b,g)}}o.exports={set:r,get:i,has:s,enforce:function(b){return s(b)?i(b):r(b,{})},getterFor:function(b){return function(S){var O;if(!p(S)||(O=i(S)).type!==b)throw y("Incompatible receiver, "+b+" required");return O}}}},function(o,k,e){var r=e(11);o.exports=r([].slice)},function(o,k){o.exports={}},function(o,k){o.exports=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}}},function(o,k,e){var r=e(14);o.exports=r.Promise},function(o,k,e){var r=e(643)();o.exports=r;try{regeneratorRuntime=r}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(o,k,e){var r=e(287);function i(s,n,u,p,d,m,c){try{var h=s[m](c),a=h.value}catch(y){return void u(y)}h.done?n(a):r.resolve(a).then(p,d)}o.exports=function(s){return function(){var n=this,u=arguments;return new r(function(p,d){var m=s.apply(n,u);function c(a){i(m,p,d,c,h,"next",a)}function h(a){i(m,p,d,c,h,"throw",a)}c(void 0)})}},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k){o.exports=function(e){return e!=null&&typeof e=="object"}},function(o,k,e){var r=e(278),i=e(56),s=e(3),n=e(23),u=e(25),p=e(7),d=e(52),m=e(17),c=e(2),h=e(5),a=e(8),y=e(197),T=e(41),v=e(121),g=e(122),b=e(280),S=e(281),O=e(190);function I(A){var M=function(){if(typeof Reflect>"u"||!r||r.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(r(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var U,E=O(A);if(M){var z=O(this).constructor;U=r(E,arguments,z)}else U=E.apply(this,arguments);return S(this,U)}}var R=e(170),N=e(0),F=e(13).heartbeatInterval,P=e(155).V2NIMLoginStatus,x=e(13),L={kSyncAction5_1:0,kSyncAction5_2:1,kSyncAction5_3:2},_={kKnown:-1,kSucceed:0,kFailed:1,kAborted:2,kCanceled:3},C=function(A){b(U,A);var M=I(U);function U(E){var z,$=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return v(this,U),(z=M.call(this)).clientProto=E,z.logger=E.logger,z.reporter=E.reporter,z.timer=null,z.setClientOrigin(),z.serverOrigin={timeStamp:null,rtt:null,baseTimeStamp:null},z.tolerantRTT=$.tolerantRTT||3e3,z.bestRTT=$.bestRTT||100,z.maxChances=$.maxChances||10,z.isSettingNTP=!1,z.currentChance=0,z.syncTraceData={},z.syncTraceMap={},z.syncTraceLastItem={},z.uploadTraceData={},z.setMonitorForSync(),z.setMonitorForResources(),z}return g(U,[{key:"hasOriginTimetick",value:function(){return!!this.serverOrigin.timeStamp}},{key:"setOriginTimetick",value:function(){var E=this,z=this.clientProto.options;if((typeof N.get(z,"privateConf.isDataReportEnable")=="boolean"?z.privateConf.isDataReportEnable:x.privateConf.isDataReportEnable)&&x.isBrowser&&performance&&performance.now&&!(this.isSettingNTP||this.currentChance>=this.maxChances)){this.isSettingNTP=!0,this.currentChance++,clearTimeout(this.timer),this.timer=null;var $="ReporterHook::setOriginTimetick:",X=i();return this.logger.info("".concat($," getServerTime start, times ").concat(this.currentChance)),new s(function(Y){E.clientProto.sendCmd("getServerTime",{},function(W,ee){if(E.isSettingNTP=!1,W){var w;E.logger.warn("".concat($," Calculate Delay time, getServerTime error"),W),E.clientProto.statusProtector.getLoginStatus()===P.V2NIM_LOGIN_STATUS_LOGINED&&(E.timer=n(u(w=E.setOriginTimetick).call(w,E),F)),Y()}else{if(!ee)return E.logger.warn("".concat($," Calculate Delay time, getServerTime not correct")),void Y();var J,V=i()-X;if(V>E.tolerantRTT)E.logger.warn("".concat($," Denied, cause of exceeding the maximum tolerance range of RTT: ").concat(V)),E.timer=n(u(J=E.setOriginTimetick).call(J,E),F);else if(V>E.bestRTT){var D,Q,G;E.serverOrigin.rtt&&V>=E.serverOrigin.rtt?E.logger.info("".concat($," Denied, cause of current.RTT >= serverOrigin.RTT: ").concat(V)):(E.setServerOrigin(V,ee),E.logger.info(p(Q=p(G="".concat($," Accept within maximum tolerance range of RTT: ").concat(V,", ntpTimestamp: ")).call(G,E.serverOrigin.timeStamp,", localClock: ")).call(Q,E.serverOrigin.baseTimeStamp))),E.timer=n(u(D=E.setOriginTimetick).call(D,E),F)}else{var B,q;E.setServerOrigin(V,ee),E.logger.info(p(B=p(q="".concat($," Accept within best RTT: ").concat(V,", ntpTimestamp: ")).call(q,E.serverOrigin.timeStamp,", localClock: ")).call(B,E.serverOrigin.baseTimeStamp))}Y()}})})}}},{key:"getNTPTime",value:function(E){if(typeof E!="number"&&(E=this.getSafeClock()),this.serverOrigin.timeStamp){var z=d(E-this.serverOrigin.baseTimeStamp);return this.serverOrigin.timeStamp+z}var $=d(E-this.clientOrigin.baseTimeStamp);return this.clientOrigin.timeStamp+$}},{key:"getSafeClock",value:function(){return x.isBrowser&&performance&&performance.now?performance.now():i()}},{key:"setMonitorForSync",value:function(){var E=this,z="ReporterHook::setMonitorForSync:";this.on("reporter/syncStart",function(){E.logger.info("".concat(z," sync start")),E.syncTraceData={user_id:E.clientProto.account,trace_id:N.get(E.clientProto,"socket.socket.sessionid"),action:L.kSyncAction5_1,sync_begin_time:E.getSafeClock(),sync_end_time:0,sync_duration:0,overall_duration:0,extension:[]}}),this.on("reporter/syncRecv",function(){E.syncTraceData.user_id&&(E.logger.info("".concat(z," sync receive packet")),E.syncTraceData.sync_end_time=E.getSafeClock(),E.syncTraceData.sync_duration=d(E.syncTraceData.sync_end_time-E.syncTraceData.sync_begin_time))}),this.on("reporter/syncItem",function($,X){var Y;if(typeof $=="number"&&E.syncTraceData.user_id){E.logger.info(p(Y="".concat(z," receive sync item: ").concat($,", total: ")).call(Y,X));var W=E.getSafeClock();E.syncTraceMap[$]=E.syncTraceMap[$]?E.syncTraceMap[$]:{sync_type:$,times:0,total:0,sync_duration:0,proc_duration:0,description:"",items:[]};var ee={total:X,pre_item_recv_time:E.syncTraceLastItem.cur_item_recv_time?E.syncTraceLastItem.cur_item_recv_time:E.syncTraceData.sync_begin_time,cur_item_recv_time:W};E.syncTraceMap[$].items.push(ee),E.syncTraceLastItem=ee}}),this.on("reporter/syncItemComplete",function($){var X;if(typeof $=="number"&&E.syncTraceData.user_id){var Y=E.syncTraceMap[$];if(Y){E.logger.info("".concat(z," sync item ").concat($," callback done"));var W=m(X=Y.items).call(X,function(ee){return!ee.callback_time});W.length!==0&&(W[0].callback_time=E.getSafeClock())}}}),this.on("reporter/syncComplete",function(){var $;E.syncTraceData.user_id&&(E.logger.info("".concat(z," sync complete")),c($=h(E.syncTraceMap)).call($,function(X){var Y,W=a(Y=E.syncTraceMap[X].items).call(Y,function(w){return{total:w.total,pre_item_recv_time:E.getNTPTime(w.pre_item_recv_time),cur_item_recv_time:E.getNTPTime(w.cur_item_recv_time),callback_time:E.getNTPTime(w.callback_time)}}),ee=y(W).call(W,function(w,J){return w.times+=1,w.total+=J.total,w.sync_duration+=J.cur_item_recv_time-J.pre_item_recv_time,w.proc_duration+=J.callback_time-J.cur_item_recv_time,w},{times:0,total:0,sync_duration:0,proc_duration:0});E.syncTraceMap[X].items=W,T(E.syncTraceMap[X],ee),E.syncTraceData.extension.push(E.syncTraceMap[X])}),E.syncTraceData.sync_begin_time=E.getNTPTime(E.syncTraceData.sync_begin_time),E.syncTraceData.sync_end_time=E.getNTPTime(E.syncTraceData.sync_end_time),E.syncTraceData.overall_duration=E.getNTPTime()-E.syncTraceData.sync_begin_time,E.reporter.report("nim_sdk_sync",E.syncTraceData),E.syncTraceData={},E.syncTraceMap={})})}},{key:"setMonitorForResources",value:function(){var E=this,z="ReporterHook::setMonitorForResources:";this.on("reporter/uploadStart",function(){E.logger.info("".concat(z," upload start")),E.uploadTraceData={user_id:E.clientProto.account,trace_id:N.get(E.clientProto,"socket.socket.sessionid"),action:0,duration:0,start_time:E.getSafeClock(),offset:0,full_size:0,transferred_size:0}}),this.on("reporter/uploadUpdate",function(){var $,X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};E.uploadTraceData.user_id&&(E.logger.info("".concat(z," upload update"),X),c($=h(X)).call($,function(Y){E.uploadTraceData[Y]=X[Y]}))}),this.on("reporter/uploadEnd",function(){var $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_.kKnown;E.uploadTraceData.user_id&&(E.logger.info("".concat(z," upload end cause of ").concat($)),E.uploadTraceData.state=$,E.uploadTraceData.start_time=E.getNTPTime(E.uploadTraceData.start_time),E.uploadTraceData.duration=E.getNTPTime(E.getSafeClock())-E.uploadTraceData.start_time,E.reporter.report("nim_sdk_resources",E.uploadTraceData),E.uploadTraceData={})})}},{key:"destroy",value:function(){this.reset(),this.removeAllListeners(),this.logger.info("ReporterHook::destroy: complete")}},{key:"reset",value:function(){this.logger.info("ReporterHook::reset"),this.serverOrigin={},this.setClientOrigin(),this.currentChance=0,this.timer&&clearTimeout(this.timer),this.syncTraceData={},this.syncTraceMap={},this.syncTraceLastItem={},this.uploadTraceData={}}},{key:"setClientOrigin",value:function(){this.clientOrigin={timeStamp:i(),baseTimeStamp:this.getSafeClock()}}},{key:"setServerOrigin",value:function(E,z){this.serverOrigin={timeStamp:z+d(E/2),rtt:E,baseTimeStamp:this.getSafeClock()}}}]),U}(R);o.exports={EMSyncAction:L,EMSyncType:{kSyncType3_8:30008,kSyncType3_109:30109,kSyncType4_4:40004,kSyncType4_6:40006,kSyncType4_9:40009,kSyncType4_12:40012,kSyncType4_13:40013,kSyncType4_14:40014,kSyncType4_16:40016,kSyncType4_17:40017,kSyncType4_18:40018,kSyncType4_19:40019,kSyncType4_20:40020,kSyncType4_21:40021,kSyncType4_23:40023,kSyncType4_24:40024,kSyncType4_100:40100,kSyncType4_101:40101,kSyncType7_15:70015,kSyncType8_109:80109,kSyncType8_126:80126,kSyncType12_5:12005,kSyncType12_6:12006,kSyncType15_13:15013,kSyncType21_109:21109,kSyncType21_111:21111},ReporterHook:C,EMExceptionState:_,EMResourceUploadWay:{kResourceUploadWayNOS:0,kResourceUploadWayAWSPlugin:1,kResourceUploadWayNOSPlugin:2}}},function(o,k,e){var r=e(6),i=e(15),s=e(2),n=e(7),u=e(201),p=e(17),d=e(85),m=e(86),c=e(69),h=e(32);function a(g,b){var S=m!==void 0&&c(g)||g["@@iterator"];if(!S){if(h(g)||(S=function(P,x){var L;if(P){if(typeof P=="string")return y(P,x);var _=i(L=Object.prototype.toString.call(P)).call(L,8,-1);if(_==="Object"&&P.constructor&&(_=P.constructor.name),_==="Map"||_==="Set")return d(P);if(_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_))return y(P,x)}}(g))||b&&g&&typeof g.length=="number"){S&&(g=S);var O=0,I=function(){};return{s:I,n:function(){return O>=g.length?{done:!0}:{done:!1,value:g[O++]}},e:function(P){throw P},f:I}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R,N=!0,F=!1;return{s:function(){S=S.call(g)},n:function(){var P=S.next();return N=P.done,P},e:function(P){F=!0,R=P},f:function(){try{N||S.return==null||S.return()}finally{if(F)throw R}}}}function y(g,b){(b==null||b>g.length)&&(b=g.length);for(var S=0,O=new Array(b);S<b;S++)O[S]=g[S];return O}var T=e(13),v={genUrlSep:function(g){return r(g=""+g).call(g,"?")===-1?"?imageView&":"&"},urlQuery2Object:function(g){if(Object.prototype.toString.call(g)!=="[object String]"||g==="")return{};var b=r(g).call(g,"?");if(b!==-1){var S=i(g).call(g,b+1).split("&"),O={};return s(S).call(S,function(I){if(~r(I).call(I,"=")){var R=I.split("=");O[R[0]]=decodeURIComponent(R[1])}else O[I]=""}),O}},url2object:function(g){Object.prototype.toString.call(g)!=="[object String]"&&(g="");var b=r(g=g||"").call(g,"https")>=0?"https://":"http://",S=g.replace(b,"");r(S).call(S,"?")>=0&&(S=S.substring(0,r(S).call(S,"?")));var O=S.split("/");S=O[0];var I="";if(O.length>0&&(I=i(O).call(O,1).join("/")),r(g).call(g,"?")===-1)return{protocol:b,hostname:S,path:I,query:{}};var R=g.substr(r(g).call(g,"?")+1).split("&"),N={};return s(R).call(R,function(F){if(r(F).call(F,"=")>0){var P=F.split("=");N[P[0]]=decodeURIComponent(P[1])}else N[F]=""}),{protocol:b,hostname:S,path:I,query:N}},object2url:function(g){var b,S=g.protocol,O=g.hostname,I=g.path,R=g.query;S=S||"http://",O=O||"",I&&(O=n(b="".concat(O,"/")).call(b,I)),R=R||{};var N,F,P,x=[];for(var L in R){var _;L!=="imageView"&&x.push(n(_="".concat(L,"=")).call(_,encodeURIComponent(R[L])))}return x.length>0?n(N=n(F="".concat(S)).call(F,O,"?imageView&")).call(N,x.join("&")):n(P="".concat(S)).call(P,O)},genPrivateUrl:function(g,b,S){if(b&&b.length){var O,I=a(b);try{for(I.s();!(O=I.n()).done;){var R=O.value;if(r(g).call(g,R)>=0)return R!==S&&(g=g.replace(R,S)),g;if(r(g).call(g,R)>=0&&R===S)return g}}catch(w){I.e(w)}finally{I.f()}}var N,F,P=v.url2object(g),x=P.hostname,L=P.path,_=T.downloadUrl,C=T.downloadHostList,A=T.nosCdnEnable,M=T.serverNosConfig.cdnDomain,U=decodeURIComponent(T.serverNosConfig.objectPrefix),E=decodeURIComponent(L),z=r(E).call(E,U);if(M&&z>-1&&A)return n(N=n(F="".concat(P.protocol)).call(F,M,"/")).call(N,i(E).call(E,z));if(u(C).call(C,x)&&u(L).call(L,"/")){var $=r(L).call(L,"/"),X=L.substring(0,$),Y=L.substring($+1);return _.replace("{bucket}",X).replace("{object}",Y)}var W=p(C).call(C,function(w){return typeof x=="string"&&u(x).call(x,w)})[0],ee=W?x.replace(W,"").replace(/\W/g,""):null;return ee?_.replace("{bucket}",ee).replace("{object}",L):g}};o.exports=v},function(o,k,e){var r=e(4);o.exports=!r(function(){var i=function(){}.bind();return typeof i!="function"||i.hasOwnProperty("prototype")})},function(o,k,e){var r=e(91),i=TypeError;o.exports=function(s){if(r(s))throw i("Can't call method on "+s);return s}},function(o,k,e){var r=e(48),i=e(158);(o.exports=function(s,n){return i[s]||(i[s]=n!==void 0?n:{})})("versions",[]).push({version:"3.27.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(o,k,e){var r=e(320);o.exports=function(i){var s=+i;return s!=s||s===0?0:r(s)}},function(o,k,e){var r=e(4),i=e(20),s=e(93),n=i("species");o.exports=function(u){return s>=51||!r(function(){var p=[];return(p.constructor={})[n]=function(){return{foo:1}},p[u](Boolean).foo!==1})}},function(o,k){o.exports={}},function(o,k,e){var r=e(370).charAt,i=e(49),s=e(97),n=e(166),u=e(167),p=s.set,d=s.getterFor("String Iterator");n(String,"String",function(m){p(this,{type:"String Iterator",string:i(m),index:0})},function(){var m,c=d(this),h=c.string,a=c.index;return a>=h.length?u(void 0,!0):(m=r(h,a),c.index+=m.length,u(m,!1))})},function(o,k,e){var r=e(62),i=e(14);o.exports=r(i.process)=="process"},function(o,k,e){var r=e(14),i=e(101),s=e(16),n=e(210),u=e(214),p=e(20),d=e(399),m=e(242),c=e(48),h=e(93),a=i&&i.prototype,y=p("species"),T=!1,v=s(r.PromiseRejectionEvent),g=n("Promise",function(){var b=u(i),S=b!==String(i);if(!S&&h===66||c&&(!a.catch||!a.finally))return!0;if(!h||h<51||!/native code/.test(b)){var O=new i(function(R){R(1)}),I=function(R){R(function(){},function(){})};if((O.constructor={})[y]=I,!(T=O.then(function(){})instanceof I))return!0}return!S&&(d||m)&&!v});o.exports={CONSTRUCTOR:g,REJECTION_EVENT:v,SUBCLASSING:T}},function(o,k,e){var r=e(25),i=e(54),s=e(568),n=e(570),u=e(576),p={},d=i.f;function m(v){var g=v.upload=(v.headers||i.o)["Content-Type"]==="multipart/form-data",b=!1;try{b=(location.protocol+"//"+location.host).toLowerCase()!==i.url2origin(v.url)}catch{}return v.cors=b,g||b||v.mode?function(S){var O=S.mode,I=s,R=i.getGlobal();return!R.FormData&&R.document&&(O="iframe"),O==="iframe"&&(I=S.upload?n:u),new I(S)}(v):new s(v)}function c(v,g,b){var S=p[v];if(S){g==="onload"&&S.result&&(b=function(I,R){R={data:R};var N=I.result.headers;return N&&(R.headers=I.req.header(N)),R}(S,b)),function(I){var R=p[I];R&&(R.req.destroy(),delete p[I])}(v);var O={type:g,result:b};d(O),O.stopped||S[g](O.result)}}function h(v,g){c(v,"onload",g)}function a(v,g){c(v,"onerror",g)}function y(v,g){var b=i.genUrlSep(v);return g=g||"",i.isObject(g)&&(g=i.object2query(g)),g&&(v+=b+g),v}function T(v,g){g=g||{};var b=i.uniqueID(),S={result:g.result,onload:g.onload||i.f,onerror:g.onerror||i.f};p[b]=S,g.onload=r(h).call(h,null,b),g.onerror=r(a).call(a,null,b),g.query&&(v=y(v,g.query));var O=g.method||"";return O&&!/get/i.test(O)||!g.data||(v=y(v,g.data),g.data=null),g.url=v,S.req=m(g),b}T.filter=function(v){i.isFunction(v)&&(d=v)},T.abort=function(v){var g=p[v];g&&g.req&&g.req.abort()},o.exports=T},function(o,k,e){var r=e(10),i=e(302),s=e(26),n=e(106).genPrivateUrl,u=e(0),p=u.notundef,d=u.exist,m=e(193),c=e(296),h=c.typeMap;function a(y){y.resend?(u.verifyOptions(y,"idClient","msg::Message"),this.idClient=y.idClient):this.idClient=u.guid(),this.type=h[y.type],this.resend=y.resend?1:0,p(y.subType)&&(u.isInt(+y.subType)&&+y.subType>0?this.subType=+y.subType:u.onParamError("subType只能是大于0的整数","msg::Message")),p(y.custom)&&(s(y.custom)==="object"?this.custom=r(y.custom):this.custom=""+y.custom),p(y.text)&&(this.body=""+y.text),p(y.body)&&(this.body=""+y.body),p(y.yidunEnable)&&(this.yidunEnable=y.yidunEnable?1:0),p(y.antiSpamUsingYidun)&&(this.antiSpamUsingYidun=y.antiSpamUsingYidun?1:0),p(y.antiSpamContent)&&(s(y.antiSpamContent)==="object"?this.antiSpamContent=r(y.antiSpamContent):this.antiSpamContent=""+y.antiSpamContent),p(y.antiSpamBusinessId)&&(s(y.antiSpamBusinessId)==="object"?this.antiSpamBusinessId=r(y.antiSpamBusinessId):this.antiSpamBusinessId=""+y.antiSpamBusinessId),p(y.yidunAntiCheating)&&(this.yidunAntiCheating=y.yidunAntiCheating+""),p(y.skipHistory)&&(this.skipHistory=y.skipHistory?1:0),p(y.highPriority)&&(this.highPriority=y.highPriority?1:0),p(y.clientAntiSpam)&&(this.clientAntiSpam=y.clientAntiSpam?1:0),p(y.env)&&(this.env=y.env),p(y.notifyTargetTags)&&(this.notifyTargetTags=y.notifyTargetTags),p(y.yidunAntiSpamExt)&&(this.yidunAntiSpamExt=y.yidunAntiSpamExt),(p(y.loc_x)||p(y.loc_y)||p(y.loc_z))&&(this.loc_x=y.loc_x,this.loc_y=y.loc_y,this.loc_z=y.loc_z)}a.validTypes=c.validTypes,u.merge(a.prototype,c.prototype),a.getType=c.getType,a.setFlow=c.setFlow,a.reverse=function(y){var T=u.filterObj(y,"chatroomId idClient from fromNick fromAvatar _fromAvatar_safe fromCustom userUpdateTime custom status notifyTargetTags");return p(T.fromAvatar)&&(T.fromAvatar=n(T.fromAvatar)),T=u.merge(T,{fromClientType:m.reverseType(y.fromClientType),time:+y.time,type:a.getType(y),text:d(y.body)?y.body:y.text||"",resend:+y.resend==1}),p(T.userUpdateTime)&&(T.userUpdateTime=+T.userUpdateTime),p(y.callbackExt)&&(T.callbackExt=y.callbackExt),p(y.subType)&&(T.subType=+y.subType),p(y.yidunAntiSpamRes)&&(T.yidunAntiSpamRes=y.yidunAntiSpamRes),p(y.loc_x)&&(T.x=i(y.loc_x),T.y=i(y.loc_y),T.z=i(y.loc_z)),p(y.toAccids)&&(T.toAccids=y.toAccids),T.status=T.status||"success",T},a.setExtra=function(y,T){c.setFlow(y,T)},o.exports=a},function(o,k,e){var r=e(216),i=e(164);o.exports=Object.keys||function(s){return r(s,i)}},function(o,k,e){var r=e(173),i=e(498),s=e(499),n=r?r.toStringTag:void 0;o.exports=function(u){return u==null?u===void 0?"[object Undefined]":"[object Null]":n&&n in Object(u)?i(u):s(u)}},function(o,k,e){var r=e(590),i=e(186),s=e(597);o.exports=function(n,u){if(n==null)return{};var p,d,m=s(n,u);if(r){var c=r(n);for(d=0;d<c.length;d++)p=c[d],i(u).call(u,p)>=0||Object.prototype.propertyIsEnumerable.call(n,p)&&(m[p]=n[p])}return m},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k){o.exports=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(137),i=e(249);function s(n,u){for(var p=0;p<u.length;p++){var d=u[p];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),r(n,i(d.key),d)}}o.exports=function(n,u,p){return u&&s(n.prototype,u),p&&s(n,p),r(n,"prototype",{writable:!1}),n},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(564)},function(o,k,e){var r=e(11),i=e(4),s=e(62),n=Object,u=r("".split);o.exports=i(function(){return!n("z").propertyIsEnumerable(0)})?function(p){return s(p)=="String"?u(p,""):n(p)}:n},function(o,k,e){var r=e(317),i=e(126);o.exports=function(s){var n=r(s,"string");return i(n)?n:n+""}},function(o,k,e){var r=e(33),i=e(16),s=e(21),n=e(208),u=Object;o.exports=n?function(p){return typeof p=="symbol"}:function(p){var d=r("Symbol");return i(d)&&s(d.prototype,u(p))}},function(o,k,e){var r=e(11),i=0,s=Math.random(),n=r(1 .toString);o.exports=function(u){return"Symbol("+(u===void 0?"":u)+")_"+n(++i+s,36)}},function(o,k,e){var r=e(110),i=Math.max,s=Math.min;o.exports=function(n,u){var p=r(n);return p<0?i(p+u,0):s(p,u)}},function(o,k,e){var r=e(11),i=e(4),s=e(16),n=e(64),u=e(33),p=e(214),d=function(){},m=[],c=u("Reflect","construct"),h=/^\s*(?:class|function)\b/,a=r(h.exec),y=!h.exec(d),T=function(g){if(!s(g))return!1;try{return c(d,m,g),!0}catch{return!1}},v=function(g){if(!s(g))return!1;switch(n(g)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return y||!!a(h,p(g))}catch{return!0}};v.sham=!0,o.exports=!c||i(function(){var g;return T(T.call)||!T(Object)||!T(function(){g=!0})||g})?v:T},function(o,k,e){var r=e(109),i=e(127),s=r("keys");o.exports=function(n){return s[n]||(s[n]=i(n))}},function(o,k,e){var r=e(216),i=e(164).concat("length","prototype");k.f=Object.getOwnPropertyNames||function(s){return r(s,i)}},function(o,k){k.f=Object.getOwnPropertySymbols},function(o,k,e){var r=e(20);k.f=r},function(o,k,e){var r=e(29),i=e(16),s=e(42),n=e(130),u=e(228),p=n("IE_PROTO"),d=Object,m=d.prototype;o.exports=u?d.getPrototypeOf:function(c){var h=s(c);if(r(h,p))return h[p];var a=h.constructor;return i(a)&&h instanceof a?a.prototype:h instanceof d?m:null}},function(o,k,e){var r=e(11),i=e(36),s=e(354);o.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,u=!1,p={};try{(n=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(p,[]),u=p instanceof Array}catch{}return function(d,m){return i(d),s(m),u?n(d,m):d.__proto__=m,d}}():void 0)},function(o,k,e){var r=e(64),i=e(157),s=e(91),n=e(99),u=e(20)("iterator");o.exports=function(p){if(!s(p))return i(p,u)||i(p,"@@iterator")||n[r(p)]}},function(o,k,e){o.exports=e(406)},function(o,k,e){o.exports=e(431)},function(o,k,e){o.exports=e(448)},function(o,k,e){var r=e(487),i=e(488),s=e(489),n=e(490),u=e(491);function p(d){var m=-1,c=d==null?0:d.length;for(this.clear();++m<c;){var h=d[m];this.set(h[0],h[1])}}p.prototype.clear=r,p.prototype.delete=i,p.prototype.get=s,p.prototype.has=n,p.prototype.set=u,o.exports=p},function(o,k,e){var r=e(199);o.exports=function(i,s){for(var n=i.length;n--;)if(r(i[n][0],s))return n;return-1}},function(o,k,e){var r=e(83)(Object,"create");o.exports=r},function(o,k,e){var r=e(511);o.exports=function(i,s){var n=i.__data__;return r(s)?n[typeof s=="string"?"string":"hash"]:n.map}},function(o,k,e){var r=e(260),i=e(261);o.exports=function(s,n,u,p){var d=!u;u||(u={});for(var m=-1,c=n.length;++m<c;){var h=n[m],a=p?p(u[h],s[h],h,u,s):void 0;a===void 0&&(a=s[h]),d?i(u,h,a):r(u,h,a)}return u}},function(o,k){o.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(o,k){o.exports=`	
\v\f\r                　\u2028\u2029\uFEFF`},function(o,k,e){var r,i=e(18),s=e(2),n=e(8),u=e(3),p=e(7),d=e(6),m=e(25),c=e(10),h=e(106).urlQuery2Object,a=e(0),y=e(40),T=e(737),v=e(738),g=e(739),b=e(740),S=e(741),O=e(742);function I(P){this.mixin(P)}I.prototype=i(function(){}.prototype,{protocol:{value:null,writable:!0,enumerable:!0,configurable:!0}}),I.prototype.setProtocol=function(P){this.protocol=P},I.prototype.mixin=function(P){var x,L,_=this;this.configMap=this.configMap||{},s(x=["idMap","cmdConfig","packetConfig"]).call(x,function(C){_.configMap[C]=a.merge({},_.configMap[C],P.configMap&&P.configMap[C])}),s(L=["serializeMap","unserializeMap"]).call(L,function(C){_[C]=a.merge({},_[C],P[C])})},I.prototype.createCmd=(r=1,function(P,x){var L,_=this,C=this.configMap.cmdConfig[P],A=this.configMap.packetConfig[C.sid+"_"+C.cid],M=P==="heartbeat"?0:r++;return M>32767&&(M=1,r=2),P={SID:C.sid,CID:C.cid,SER:M,isAwaitable:typeof C.isAwaitable=="boolean"?C.isAwaitable:!(!A||!A.response)},C.params&&(P.Q=[],s(L=C.params).call(L,function(U){var E=U.type,z=U.name,$=U.entity,X=x[z];if(!a.undef(X)){switch(E){case"PropertyArray":E="ArrayMable",X=n(X).call(X,function(Y){return{t:"Property",v:_.serialize(Y,$)}});break;case"Property":X=_.serialize(X,z);break;case"bool":X=X?"true":"false"}P.Q.push({t:E,v:X})}})),P}),I.prototype.parseResponse=function(P){var x=this;return new u(function(L){var _=JSON.parse(P),C={raw:_,rawStr:P,error:y.genError(_.code)},A=x.configMap.packetConfig[_.sid+"_"+_.cid];if(!A)return C.notFound={sid:_.sid,cid:_.cid},void L(C);var M=_.r,U=A.service==="notify"&&!A.cmd;if(C.isNotify=U,U){var E=_.r[1].headerPacket;if(A=x.configMap.packetConfig[E.sid+"_"+E.cid],M=_.r[1].body,!A)return C.notFound={sid:E.sid,cid:E.cid},void L(C)}if(C.service=A.service,C.cmd=A.cmd,C.error){var z,$,X=p(z="".concat(_.sid,"_")).call(z,_.cid);if(U&&(X=p($="".concat(E.sid,"_")).call($,E.cid)),C.error.cmd=C.cmd,C.error.callFunc="protocol::parseResponse: ".concat(X),C.error.code===416){var Y=M[0];Y&&(C.frequencyControlDuration=1e3*Y)}}var W,ee=!1;C.error&&A.trivialErrorCodes&&(ee=d(W=A.trivialErrorCodes).call(W,C.error.code)!==-1);var w=[];if((!C.error||ee)&&A.response){var J;C.content={};var V=function(D,Q,G,B){if(D&&B==="msg"||B==="sysMsg"){var q=G.content[B];a.isObject(q)&&!q.idServer&&(q.idServer=""+Q.r[0])}};s(J=A.response).call(J,function(D,Q){var G,B=M[Q];if(!a.undef(B)){var q=D.type,H=D.name,K=D.entity||H;switch(q){case"Property":w.push(x.unserialize(B,K).then(m(G=function(Z,te,ne,re,se){ne.content[re]=se,V(Z,te,ne,re)}).call(G,this,U,_,C,H)));break;case"PropertyArray":C.content[H]=[],s(B).call(B,function(Z,te){var ne;w.push(x.unserialize(Z,K).then(m(ne=function(re,se,oe){re.content[se][te]=oe}).call(ne,this,C,H)))});break;case"KVArray":C.content[H]=B,V(U,_,C,H);break;case"long":case"Long":case"byte":case"Byte":case"Number":C.content[H]=+B;break;default:C.content[H]=B,V(U,_,C,H)}}})}u.all(w).then(function(){L(C)})})},I.prototype.serialize=function(P,x){var L=this.serializeMap[x],_={};for(var C in L)P.hasOwnProperty(C)&&(_[L[C]]=P[C]);return _},I.prototype.matchNosSafeUrl=function(P){if(!a.isString(P)||!~d(P).call(P,"_im_url=1"))return!1;var x=h(P);return!(!x||!x._im_url||x._im_url!=1)},I.prototype.getOneNosOriginUrl=function(P,x,L){var _=this;return new u(function(C){_.protocol.getNosOriginUrlReqNum++,_.protocol.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:P}},function(A,M,U){_.protocol.getNosOriginUrlReqNum--,A?_.protocol.logger.warn("error: get nos originUrl failed",A):(x["_"+L+"_safe"]=x[L],x[L]=U.nosFileUrlTag&&U.nosFileUrlTag.originUrl),C()})})},I.prototype.checkObjSafeUrl=function(P,x,L){var _=this;for(var C in P)if(P.hasOwnProperty(C)){var A=P[C];if(a.isString(A)){if(this.matchNosSafeUrl(A)){var M=this.getOneNosOriginUrl(A,P,C);x.push(M),L.push(M)}}else a.isObject(A)?this.checkObjSafeUrl(A,x,L):a.isArray(A)&&s(A).call(A,function(U){a.isObject(U)&&_.checkObjSafeUrl(U,x,L)})}};var R=["url","avatar","fromAvatar","chatroomAvatar"];I.prototype.unserialize=function(P,x){var L=this;return new u(function(_){var C=L.unserializeMap[x],A={},M=[];if(P)for(var U in C){var E,z=[];if(P.hasOwnProperty(U)&&(A[C[U]]=P[U],L.protocol.hasLogin&&!L.protocol.keepNosSafeUrl))if(C[U]==="attach"&&P[U]&&d(P[U])&&~d(E=P[U]).call(E,"_im_url=1"))try{var $,X=JSON.parse(P[U]);X.isS3||L.checkObjSafeUrl(X,z,M),u.all(z).then(m($=function(Y,W){Y.attach=c(W)}).call($,L,A,X))}catch(Y){L.logger.warn("unserialize",Y&&Y.message)}else~d(R).call(R,C[U])&&P[U]&&L.matchNosSafeUrl(P[U])&&M.push(L.getOneNosOriginUrl(P[U],A,C[U]))}u.all(M).then(function(){_(A)})})},I.prototype.syncUnserialize=function(P,x){var L=this.unserializeMap[x],_={};if(P)for(var C in L)P.hasOwnProperty(C)&&(_[L[C]]=P[C]);return _};var N=new I({configMap:T,serializeMap:v,unserializeMap:g}),F=new I({configMap:b,serializeMap:S,unserializeMap:O});o.exports={IM:N,Chatroom:F}},function(o,k,e){var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,s=i&&!r.call({1:2},1);k.f=s?function(n){var u=i(this,n);return!!u&&u.enumerable}:r},function(o,k,e){o.exports=e(616)},function(o,k,e){var r=e(8),i=e(9),s=e(0),n=s.notundef,u=s.fillPropertyWithDefault,p={0:"normal",1:"owner",2:"manager"};function d(m){s.verifyOptions(m,"teamId","team::TeamMember"),s.verifyParamAtLeastPresentOne(m,"nickInTeam muteTeam muteNotiType custom","team::TeamMember"),this.teamId=m.teamId,n(m.account)&&(this.account=m.account),n(m.nickInTeam)&&(this.nickInTeam=m.nickInTeam),n(m.muteNotiType)?this.bits=m.muteNotiType:n(m.muteTeam)&&(this.bits=0,m.muteTeam&&(this.bits+=1)),n(m.mute)&&(this.mute=m.mute?1:0),n(m.custom)&&(this.custom=""+m.custom)}d.reverse=function(m){var c=s.copy(m);if(n(c.teamId)&&(c.teamId=""+c.teamId),n(c.type)&&(c.type=p[c.type]),n(c.active)&&(c.active=+c.active==1),n(c.valid)&&(c.valid=+c.valid==1),n(c.mute)&&(c.mute=+c.mute==1),n(c.joinTime)&&(c.joinTime=+c.joinTime),n(c.updateTime)&&(c.updateTime=+c.updateTime),n(c.bits)){var h=c.bits;delete c.bits,c.muteTeam=!!(1&h),c.muteNotiType=h}return n(c.teamId)&&n(c.account)&&(c.id=d.genId(c.teamId,c.account)),c},d.reverseMembers=function(m){return r(m).call(m,function(c){return i(d).call(d,c)})},d.fillProperties=function(m){var c=u(m,"mute",!1),h=u(m,"custom","");return c||h},d.genId=function(m,c){return m+"-"+c},d.accounts2ids=function(m,c){return r(c).call(c,function(h){return d.genId(m,h)})},d.assembleMembers=function(m,c){return s.isArray(c)||(c=[c]),r(c).call(c,function(h){return d.assembleMember(m,h)})},d.assembleMember=function(m,c){return{id:d.genId(m.teamId,c),account:c,teamId:m.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:m.memberUpdateTime,updateTime:m.memberUpdateTime,active:!0,valid:!0,invitorAccid:""}},d.assembleOwner=function(m){var c=d.assembleMember(m,m.owner);return c.type="owner",c},o.exports=d},function(o,k,e){var r,i=e(26),s=e(6),n=e(10),u=e(7),p=e(5),d=e(15),m=e(9),c=e(17),h=e(8),a=e(2),y=e(0),T=y.undef,v=y.notundef,g=e(147).IM,b=e(192),S=e(150),O={customP2p:100,customTeam:101,customSuperTeam:103,deleteMsgP2p:7,deleteMsgTeam:8,deleteMsgSuperTeam:12,deleteOnewayMsgP2p:13,deleteOnewayMsgTeam:14},I={0:"applyTeam",1:"rejectTeamApply",2:"teamInvite",3:"rejectTeamInvite",5:"friendRequest",6:"deleteFriend",7:"deleteMsgP2p",8:"deleteMsgTeam",12:"deleteMsgSuperTeam",13:"deleteMsgP2pOneWay",14:"deleteMsgTeamOneWay",15:"applySuperTeam",16:"rejectSuperTeamApply",17:"superTeamInvite",18:"rejectSuperTeamInvite",100:"customP2p",101:"customTeam",103:"customSuperTeam",102:"customP2p"},R={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"},N=["team","superTeam","friend","msg"],F={applyTeam:"team",rejectTeamApply:"team",teamInvite:"team",rejectTeamInvite:"team",applySuperTeam:"superTeam",rejectSuperTeamApply:"superTeam",superTeamInvite:"superTeam",rejectSuperTeamInvite:"superTeam",addFriend:"friend",applyFriend:"friend",passFriendApply:"friend",rejectFriendApply:"friend",deleteFriend:"friend",deleteMsg:"msg"};function P(x){var L,_;y.verifyOptions(x,"type to","sysmsg::SystemMessage"),y.verifyParamValid("type",x.type,P.validTypes,"sysmsg::SystemMessage"),s(L=x.type).call(L,"custom")!==-1&&(y.verifyOptions(x,"content","sysmsg::SystemMessage"),this.attach=x.content,v(x.apnsText)&&(this.apnsText=""+x.apnsText),v(x.pushPayload)&&(i(x.pushPayload)==="object"?this.pushPayload=n(x.pushPayload):this.pushPayload=""+x.pushPayload),v(x.sendToOnlineUsersOnly)&&(this.sendToOnlineUsersOnly=x.sendToOnlineUsersOnly?0:1),v(x.cc)&&(this.cc=x.cc?1:0),v(x.isPushable)&&(this.isPushable=x.isPushable?1:0),v(x.isUnreadable)&&(this.isUnreadable=x.isUnreadable?1:0),v(x.needPushNick)&&(this.needPushNick=x.needPushNick?1:0)),s(_=x.type).call(_,"deleteMsg")===0&&(x.apnsText&&(this.apnsText=x.apnsText),x.pushPayload&&(this.pushPayload=x.pushPayload),x.attach&&(this.attach=x.attach)),this.time=x.time||+new Date,this.type=O[x.type],this.to=x.to,v(x.from)&&(this.from=x.from),v(x.ps)&&(this.ps=x.ps),v(x.deletedIdClient)&&(this.deletedIdClient=x.deletedIdClient),v(x.deletedIdServer)&&(this.deletedIdServer=x.deletedIdServer),v(x.opeAccount)&&(this.opeAccount=x.opeAccount),v(x.yidunEnable)&&(this.yidunEnable=x.yidunEnable?1:0),v(x.antiSpamContent)&&(i(x.antiSpamContent)==="object"?this.antiSpamContent=n(x.antiSpamContent):this.antiSpamContent=""+x.antiSpamContent),v(x.antiSpamBusinessId)&&(i(x.antiSpamBusinessId)==="object"?this.antiSpamBusinessId=n(x.antiSpamBusinessId):this.antiSpamBusinessId=""+x.antiSpamBusinessId),v(x.env)&&(this.env=x.env),this.idClient=x.idClient||y.guid()}P.validTypes=u(r=p(O)).call(r,p(F)),P.validCategories=["team","friend"],P.isCustom=function(x){return x.type==="custom"},P.reverse=function(x){var L,_,C={time:+x.time,to:x.to,type:I[x.type]};if(v(x.from)&&(C.from=x.from),v(x.idClient)&&(C.idClient=x.idClient),v(x.idServer)&&(C.idServer=""+x.idServer),v(x.deletedIdClient)&&(C.deletedIdClient=x.deletedIdClient),v(x.deletedIdServer)&&(C.deletedIdServer=""+x.deletedIdServer),v(x.deletedMsgTime)&&(C.deletedMsgTime=+x.deletedMsgTime),v(x.deletedMsgFromNick)&&(C.deletedMsgFromNick=""+x.deletedMsgFromNick),v(x.opeAccount)&&(C.opeAccount=x.opeAccount),v(x.ps)&&(C.ps=x.ps),v(x.callbackExt)&&(C.callbackExt=x.callbackExt),x.attach=x.attach?""+x.attach:"",C.type==="customP2p"||C.type==="customTeam"||C.type==="customSuperTeam")C.content=x.attach,v(x.apnsText)&&(C.apnsText=x.apnsText),v(x.pushPayload)&&(C.pushPayload=x.pushPayload),y.merge(C,{sendToOnlineUsersOnly:T(x.sendToOnlineUsersOnly)||+x.sendToOnlineUsersOnly==0,cc:T(x.cc)||+x.cc==1,isPushable:T(x.isPushable)||+x.isPushable==1,isUnreadable:T(x.isUnreadable)||+x.isUnreadable==1,needPushNick:v(x.needPushNick)&&+x.needPushNick==1}),C.scene=d(_=C.type).call(_,6).toLowerCase(),C.type="custom";else if(s(L=C.type).call(L,"deleteMsg")===0){x.apnsText&&(C.apnsText=x.apnsText),x.pushPayload&&(C.pushPayload=x.pushPayload),x.attach&&(C.attach=x.attach);var A=C.type.toLowerCase();s(A).call(A,"p2p")>-1?C.scene="p2p":s(A).call(A,"superteam")>-1?C.scene="superTeam":s(A).call(A,"team")>-1&&(C.scene="team"),C.type="deleteMsg"}else{if(x.attach){C.attach={};var M=JSON.parse(x.attach);v(M.vt)?(C.type=R[M.vt],M.serverex&&M.serverex[0]===1&&(C.serverex=M.serverex[1]),delete C.attach):(v(M.tinfo)&&(C.attach.team=m(b).call(b,g.syncUnserialize(M.tinfo,"team"))),v(M.tlist)&&(C.attach.member=m(S).call(S,g.syncUnserialize(M.tlist,"teamMember"))),v(M.attach)&&(C.attach.custom=M.attach))}C.category=F[C.type],C.read=!1,C.state="init"}return v(x.cc)&&(C.cc=+x.cc==1),C.status=x.status||"success",v(c(x))&&(C.filter=c(x)),C},P.reverseSysMsgs=function(x,L){var _=(L=L||{}).mapper,C=y.isFunction(_);return h(x).call(x,function(A){return A=m(P).call(P,A),C&&(A=_(A)),A})},P.completeUnread=function(x){var L,_;return x=x||{},a(N).call(N,function(C){delete x[C]}),a(L=p(F)).call(L,function(C){x[C]=x[C]||0,x[C]<0&&(x[C]=0),x[_=F[C]]=x[_]||0,x[_]=x[_]+x[C]}),x.total=0,a(N).call(N,function(C){x.total+=x[C]}),x},o.exports=P},function(o,k,e){var r=e(120),i=["unreadMsgs"],s=e(0);function n(){}n.parse=function(u){var p=u.split("|");return{scene:p[0],to:p[1]}},n.genSessionByMsg=function(u){return{id:u.sessionId,scene:u.scene,to:u.target,updateTime:u.time,lastMsg:u}},n.appendLastMsg=function(u){var p=u.lastMsg;u["last"+s.capFirstLetter(p.type)+"Msg"]=p,u["last"+s.capFirstLetter(p.flow)+"Msg"]=p},n.genSessionByMsgs=function(u,p){var d=u.getLastNotIgnoredMsg(p);return d?n.genSessionByMsg(d):null},n.trim=function(u){var p=u=s.simpleClone(u);return p.unreadMsgs,r(p,i)},n.isComplete=function(u){return u.id&&u.scene&&u.to},o.exports=n},function(o,k,e){o.exports=e(328)},function(o,k,e){var r=e(485);o.exports=function(i){return r(i,5)}},function(o,k,e){var r=e(18),i=e(170),s={V2NIM_LOGIN_STATUS_LOGOUT:0,V2NIM_LOGIN_STATUS_LOGINED:1,V2NIM_LOGIN_STATUS_LOGINING:2},n={V2NIM_CONNECT_STATUS_DISCONNECTED:0,V2NIM_CONNECT_STATUS_CONNECTED:1,V2NIM_CONNECT_STATUS_CONNECTING:2,V2NIM_CONNECT_STATUS_WAITING:3};function u(p){this.loginStatus=s.V2NIM_LOGIN_STATUS_LOGOUT,this.connectStatus=n.V2NIM_CONNECT_STATUS_DISCONNECTED,this.logger=p.logger,this.setMonitor()}u.prototype=r(new i),u.prototype.setMonitor=function(){var p=this;this.on("auth/loginLifeCycleAddressing",function(){p.logger.log("auth::life cycle addressing"),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGINING),p.setConnectStatus(n.V2NIM_CONNECT_STATUS_CONNECTING)}),this.on("auth/loginLifeCycleConnect",function(){p.logger.log("auth::life cycle connecting"),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGINING),p.setConnectStatus(n.V2NIM_CONNECT_STATUS_CONNECTING)}),this.on("auth/loginLifeCycleConnectSucc",function(){p.logger.log("auth::life cycle connect success"),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGINING),p.setConnectStatus(n.V2NIM_CONNECT_STATUS_CONNECTED)}),this.on("auth/loginLifeCycleConnectFail",function(d){p.logger.log("auth::life cycle connect fail"),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGOUT),p.setConnectStatus(n.V2NIM_CONNECT_STATUS_DISCONNECTED,d)}),this.on("auth/loginLifeCycleDisconnected",function(d){p.logger.log("auth::life cycle disconnected:",d&&d.message),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGOUT),p.setConnectStatus(n.V2NIM_CONNECT_STATUS_DISCONNECTED,d)}),this.on("auth/loginLifeCycleLoginSucc",function(){p.logger.log("auth::life cycle login success, verify authentication success"),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGINED)}),this.on("auth/loginLifeCycleLoginFail",function(d){p.logger.log("auth::life cycle login fail due to verify authentication failed:",d),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGOUT,d)}),this.on("auth/loginLifeCycleLogout",function(){p.logger.log("auth::life cycle logout"),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGOUT)}),this.on("auth/loginLifeCycleKicked",function(d){p.logger.log("auth::life cycle kicked",d),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGOUT)}),this.on("auth/loginLifeCycleWaiting",function(){p.logger.log("auth::life cycle waiting to reconnect"),p.getConnectStatus(),p.setLoginStatus(s.V2NIM_LOGIN_STATUS_LOGOUT),p.setConnectStatus(n.V2NIM_CONNECT_STATUS_WAITING)})},u.prototype.getConnectStatus=function(){return this.connectStatus},u.prototype.getLoginStatus=function(){return this.loginStatus},u.prototype.setLoginStatus=function(p,d){if(p!==this.loginStatus){var m=this.loginStatus;this.loginStatus=p,this.emit("loginStatus",p),this.delegateLoginEvent(m,p,d)}},u.prototype.delegateLoginEvent=function(p,d,m){p===s.V2NIM_LOGIN_STATUS_LOGINING&&d===s.V2NIM_LOGIN_STATUS_LOGOUT&&this.emit("loginFailed",m)},u.prototype.setConnectStatus=function(p,d){if(p!==this.connectStatus){var m=this.connectStatus;this.connectStatus=p,this.emit("connectStatus",p),this.delegateConnectEvent(m,p,d)}},u.prototype.delegateConnectEvent=function(p,d,m){p===n.V2NIM_CONNECT_STATUS_CONNECTED&&d===n.V2NIM_CONNECT_STATUS_DISCONNECTED&&this.emit("disconnected",m),p===n.V2NIM_CONNECT_STATUS_CONNECTING&&d===n.V2NIM_CONNECT_STATUS_CONNECTED&&this.emit("connectSuccess"),p===n.V2NIM_CONNECT_STATUS_CONNECTING&&d===n.V2NIM_CONNECT_STATUS_DISCONNECTED&&this.emit("connectFailed",m),p!==n.V2NIM_CONNECT_STATUS_DISCONNECTED&&this.connectStatus!==n.V2NIM_CONNECT_STATUS_WAITING||d!==n.V2NIM_CONNECT_STATUS_CONNECTING||this.emit("connecting")},u.prototype.destroy=function(){this.removeAllListeners()},o.exports={V2NIMLoginStatus:s,V2NIMConnectStatus:n,StatusProtector:u}},function(o,k,e){var r=e(62),i=e(11);o.exports=function(s){if(r(s)==="Function")return i(s)}},function(o,k,e){var r=e(31),i=e(91);o.exports=function(s,n){var u=s[n];return i(u)?void 0:r(u)}},function(o,k,e){var r=e(14),i=e(319),s=r["__core-js_shared__"]||i("__core-js_shared__",{});o.exports=s},function(o,k,e){var r=e(14),i=e(28),s=r.document,n=i(s)&&i(s.createElement);o.exports=function(u){return n?s.createElement(u):{}}},function(o,k,e){var r=e(43),i=e(128),s=e(45),n=function(u){return function(p,d,m){var c,h=r(p),a=s(h),y=i(m,a);if(u&&d!=d){for(;a>y;)if((c=h[y++])!=c)return!0}else for(;a>y;y++)if((u||y in h)&&h[y]===d)return u||y||0;return!u&&-1}};o.exports={includes:n(!0),indexOf:n(!1)}},function(o,k,e){var r=e(325);o.exports=function(i,s){return new(r(i))(s===0?0:s)}},function(o,k,e){var r={};r[e(20)("toStringTag")]="z",o.exports=String(r)==="[object z]"},function(o,k,e){var r=e(27),i=e(211),s=e(38),n=e(36),u=e(43),p=e(118);k.f=r&&!i?Object.defineProperties:function(d,m){n(d);for(var c,h=u(m),a=p(m),y=a.length,T=0;y>T;)s.f(d,c=a[T++],h[c]);return d}},function(o,k){o.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(o,k,e){var r=e(62),i=e(43),s=e(131).f,n=e(220),u=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];o.exports.f=function(p){return u&&r(p)=="Window"?function(d){try{return s(d)}catch{return n(u)}}(p):s(i(p))}},function(o,k,e){var r=e(1),i=e(19),s=e(48),n=e(226),u=e(16),p=e(353),d=e(134),m=e(135),c=e(81),h=e(53),a=e(65),y=e(20),T=e(99),v=e(227),g=n.PROPER,b=n.CONFIGURABLE,S=v.IteratorPrototype,O=v.BUGGY_SAFARI_ITERATORS,I=y("iterator"),R=function(){return this};o.exports=function(N,F,P,x,L,_,C){p(P,F,x);var A,M,U,E=function(w){if(w===L&&W)return W;if(!O&&w in X)return X[w];switch(w){case"keys":case"values":case"entries":return function(){return new P(this,w)}}return function(){return new P(this)}},z=F+" Iterator",$=!1,X=N.prototype,Y=X[I]||X["@@iterator"]||L&&X[L],W=!O&&Y||E(L),ee=F=="Array"&&X.entries||Y;if(ee&&(A=d(ee.call(new N)))!==Object.prototype&&A.next&&(s||d(A)===S||(m?m(A,S):u(A[I])||a(A,I,R)),c(A,z,!0,!0),s&&(T[z]=R)),g&&L=="values"&&Y&&Y.name!=="values"&&(!s&&b?h(X,"name","values"):($=!0,W=function(){return i(Y,this)})),L)if(M={values:E("values"),keys:_?W:E("keys"),entries:E("entries")},C)for(U in M)(O||$||!(U in X))&&a(X,U,M[U]);else r({target:F,proto:!0,forced:O||$},M);return s&&!C||X[I]===W||a(X,I,W,{name:L}),T[F]=W,M}},function(o,k){o.exports=function(e,r){return{value:e,done:r}}},function(o,k,e){var r=e(21),i=TypeError;o.exports=function(s,n){if(r(n,s))return s;throw i("Incorrect invocation")}},function(o,k,e){var r=e(129),i=e(78),s=TypeError;o.exports=function(n){if(r(n))return n;throw s(i(n)+" is not a constructor")}},function(o,k,e){var r=Object.prototype.hasOwnProperty,i="~";function s(){}function n(m,c,h){this.fn=m,this.context=c,this.once=h||!1}function u(m,c,h,a,y){if(typeof h!="function")throw new TypeError("The listener must be a function");var T=new n(h,a||m,y),v=i?i+c:c;return m._events[v]?m._events[v].fn?m._events[v]=[m._events[v],T]:m._events[v].push(T):(m._events[v]=T,m._eventsCount++),m}function p(m,c){--m._eventsCount==0?m._events=new s:delete m._events[c]}function d(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(i=!1)),d.prototype.eventNames=function(){var m,c,h=[];if(this._eventsCount===0)return h;for(c in m=this._events)r.call(m,c)&&h.push(i?c.slice(1):c);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(m)):h},d.prototype.listeners=function(m){var c=i?i+m:m,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var a=0,y=h.length,T=new Array(y);a<y;a++)T[a]=h[a].fn;return T},d.prototype.listenerCount=function(m){var c=i?i+m:m,h=this._events[c];return h?h.fn?1:h.length:0},d.prototype.emit=function(m,c,h,a,y,T){var v=i?i+m:m;if(!this._events[v])return!1;var g,b,S=this._events[v],O=arguments.length;if(S.fn){switch(S.once&&this.removeListener(m,S.fn,void 0,!0),O){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,c),!0;case 3:return S.fn.call(S.context,c,h),!0;case 4:return S.fn.call(S.context,c,h,a),!0;case 5:return S.fn.call(S.context,c,h,a,y),!0;case 6:return S.fn.call(S.context,c,h,a,y,T),!0}for(b=1,g=new Array(O-1);b<O;b++)g[b-1]=arguments[b];S.fn.apply(S.context,g)}else{var I,R=S.length;for(b=0;b<R;b++)switch(S[b].once&&this.removeListener(m,S[b].fn,void 0,!0),O){case 1:S[b].fn.call(S[b].context);break;case 2:S[b].fn.call(S[b].context,c);break;case 3:S[b].fn.call(S[b].context,c,h);break;case 4:S[b].fn.call(S[b].context,c,h,a);break;default:if(!g)for(I=1,g=new Array(O-1);I<O;I++)g[I-1]=arguments[I];S[b].fn.apply(S[b].context,g)}}return!0},d.prototype.on=function(m,c,h){return u(this,m,c,h,!1)},d.prototype.once=function(m,c,h){return u(this,m,c,h,!0)},d.prototype.removeListener=function(m,c,h,a){var y=i?i+m:m;if(!this._events[y])return this;if(!c)return p(this,y),this;var T=this._events[y];if(T.fn)T.fn!==c||a&&!T.once||h&&T.context!==h||p(this,y);else{for(var v=0,g=[],b=T.length;v<b;v++)(T[v].fn!==c||a&&!T[v].once||h&&T[v].context!==h)&&g.push(T[v]);g.length?this._events[y]=g.length===1?g[0]:g:p(this,y)}return this},d.prototype.removeAllListeners=function(m){var c;return m?(c=i?i+m:m,this._events[c]&&p(this,c)):(this._events=new s,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=i,d.EventEmitter=d,o.exports=d},function(o,k,e){o.exports=e(422)},function(o,k,e){var r=e(83)(e(50),"Map");o.exports=r},function(o,k,e){var r=e(50).Symbol;o.exports=r},function(o,k,e){var r=e(262),i=e(524),s=e(200);o.exports=function(n){return s(n)?r(n):i(n)}},function(o,k){var e=Array.isArray;o.exports=e},function(o,k){o.exports=function(e){return function(r){return e(r)}}},function(o,k,e){(function(r){var i=e(257),s=k&&!k.nodeType&&k,n=s&&typeof r=="object"&&r&&!r.nodeType&&r,u=n&&n.exports===s&&i.process,p=function(){try{var d=n&&n.require&&n.require("util").types;return d||u&&u.binding&&u.binding("util")}catch{}}();r.exports=p}).call(this,e(145)(o))},function(o,k){var e=Object.prototype;o.exports=function(r){var i=r&&r.constructor;return r===(typeof i=="function"&&i.prototype||e)}},function(o,k,e){var r=e(262),i=e(527),s=e(200);o.exports=function(n){return s(n)?r(n,!0):i(n)}},function(o,k,e){var r=e(532),i=e(266),s=Object.prototype.propertyIsEnumerable,n=Object.getOwnPropertySymbols,u=n?function(p){return p==null?[]:(p=Object(p),r(n(p),function(d){return s.call(p,d)}))}:i;o.exports=u},function(o,k,e){var r=e(536),i=e(172),s=e(537),n=e(271),u=e(538),p=e(119),d=e(258),m=d(r),c=d(i),h=d(s),a=d(n),y=d(u),T=p;(r&&T(new r(new ArrayBuffer(1)))!="[object DataView]"||i&&T(new i)!="[object Map]"||s&&T(s.resolve())!="[object Promise]"||n&&T(new n)!="[object Set]"||u&&T(new u)!="[object WeakMap]")&&(T=function(v){var g=p(v),b=g=="[object Object]"?v.constructor:void 0,S=b?d(b):"";if(S)switch(S){case m:return"[object DataView]";case c:return"[object Map]";case h:return"[object Promise]";case a:return"[object Set]";case y:return"[object WeakMap]"}return g}),o.exports=T},function(o,k,e){var r=e(541);o.exports=function(i){var s=new i.constructor(i.byteLength);return new r(s).set(new r(i)),s}},function(o,k,e){var r=e(11),i=e(108),s=e(49),n=e(146),u=r("".replace),p="["+n+"]",d=RegExp("^"+p+p+"*"),m=RegExp(p+p+"*$"),c=function(h){return function(a){var y=s(i(a));return 1&h&&(y=u(y,d,"")),2&h&&(y=u(y,m,"")),y}};o.exports={start:c(1),end:c(2),trim:c(3)}},function(o,k,e){var r=e(116),i=e(577);r.json=i,o.exports=r},function(o,k,e){var r=e(18),i=e(23),s=e(6),n=e(2),u=e(54),p=u.f,d=e(569);function m(h){h.onload&&this.once("load",h.onload),h.onerror&&this.once("error",h.onerror),h.onbeforesend&&this.once("beforesend",h.onbeforesend),h.onaftersend&&this.once("aftersend",h.onaftersend);var a=(h=this.options=u.fetch({method:"GET",url:"",sync:!1,data:null,headers:{},cookie:!1,timeout:6e4,type:"text",form:null,input:null,putFileAtEnd:!1,proxyUrl:""},h)).headers;u.notexist(a["Content-Type"])&&(a["Content-Type"]="application/x-www-form-urlencoded"),this.send()}var c=m.prototype=r(d.prototype);c.send=function(){var h=this,a=h.options;i(function(){try{try{h.emit("beforesend",a)}catch{}h.doSend()}catch(y){h.onError("serverError","请求失败:"+y.message)}},0)},c.doSend=p,c.afterSend=function(){var h=this;i(function(){h.emit("aftersend",h.options)},0)},c.onLoad=function(h){var a,y=this.options,T=h.status,v=h.result;if(typeof T!="number"||T!==0)if(s(a=""+T).call(a,"2")===0){if(y.type==="json")try{v=JSON.parse(v)}catch{return void this.onError("parseError",v)}this.emit("load",v)}else this.onError("serverError","服务器返回异常状态",{status:T,result:v,date:h.date});else this.onError("netError","网络错误",{status:408})},c.onError=function(h,a,y){var T=u.isObject(y)?y:{};T.code=h||"error",T.message=a||"发生错误",this.emit("error",T)},c.onTimeout=function(){this.onError("timeout","请求超时")},c.abort=function(){this.onError("abort","客户端中止")},c.header=function(h){var a=this;if(!u.isArray(h))return a.getResponseHeader(h||"");var y={};return n(h).call(h,function(T){y[T]=a.header(T)}),y},c.getResponseHeader=p,c.destroy=p,o.exports=m},function(o,k,e){o.exports=e(594)},function(o,k,e){o.exports=e(607)},function(o,k,e){var r=e(189),i=e(149);function s(n,u){var p;return o.exports=s=r?i(p=r).call(p):function(d,m){return d.__proto__=m,d},o.exports.__esModule=!0,o.exports.default=o.exports,s(n,u)}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(610)},function(o,k,e){var r=e(189),i=e(149),s=e(282);function n(u){var p;return o.exports=n=r?i(p=s).call(p):function(d){return d.__proto__||s(d)},o.exports.__esModule=!0,o.exports.default=o.exports,n(u)}o.exports=n,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k){var e={link:{id:1,heartbeat:2,negotiateTransport:5,initTransport:6},sync:{id:5,sync:1,syncTeamMembers:2},misc:{id:6,getSimpleNosToken:1,getNosToken:2,notifyUploadLog:3,uploadSdkLogUrl:4,audioToText:5,processImage:6,getNosTokenTrans:7,notifyTransLog:8,fetchFile:9,fetchFileList:10,removeFile:11,getClientAntispam:17,fileQuickTransfer:18,getNosOriginUrl:22,getServerTime:23,getNosAccessToken:24,deleteNosAccessToken:25,getNosCdnHost:26,getGrayscaleConfig:27,getMixStorePolicy:28,getMixStoreToken:29,getBackSourceToken:30,uploadDetect:32},avSignal:{id:15,signalingCreate:1,signalingDelay:2,signalingClose:3,signalingJoin:4,signalingLeave:5,signalingInvite:6,signalingCancel:7,signalingReject:8,signalingAccept:9,signalingControl:10,signalingNotify:11,signalingMutilClientSyncNotify:12,signalingUnreadMessageSyncNotify:13,signalingChannelsSyncNotify:14,signalingGetChannelInfo:15,signalingCallEx:16,signalingJoinAndAccept:17}},r={heartbeat:{sid:e.link.id,cid:e.link.heartbeat},negotiateTransport:{sid:e.link.id,cid:e.link.negotiateTransport,params:[{type:"int",name:"sdkVersion"},{type:"Property",name:"negotiateTransportTag"}]},initTransport:{sid:e.link.id,cid:e.link.initTransport,params:[{type:"Property",name:"initTransportTag"}]},getGrayscaleConfig:{sid:e.misc.id,cid:e.misc.getGrayscaleConfig,params:[{type:"Property",name:"providers"}]},getMixStorePolicy:{sid:e.misc.id,cid:e.misc.getMixStorePolicy,params:[{type:"LongArray",name:"providers"}]},getMixStoreToken:{sid:e.misc.id,cid:e.misc.getMixStoreToken,params:[{type:"Property",name:"mixTokenReq"}]},getBackSourceToken:{sid:e.misc.id,cid:e.misc.getBackSourceToken,params:[{type:"Property",name:"mixAuthTokenReq"}]},uploadDetect:{sid:e.misc.id,cid:e.misc.uploadDetect,isAwaitable:!1,params:[{type:"Property",name:"notifyDetectTag"}]},getSimpleNosToken:{sid:e.misc.id,cid:e.misc.getSimpleNosToken,params:[{type:"int",name:"num"}]},getNosToken:{sid:e.misc.id,cid:e.misc.getNosToken,params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken"}]},uploadSdkLogUrl:{sid:e.misc.id,cid:e.misc.uploadSdkLogUrl,params:[{type:"string",name:"url"}]},audioToText:{sid:e.misc.id,cid:e.misc.audioToText,params:[{type:"Property",name:"audioToText"}]},processImage:{sid:e.misc.id,cid:e.misc.processImage,params:[{type:"String",name:"url"},{type:"PropertyArray",name:"imageOps",entity:"imageOp"}]},getClientAntispam:{sid:e.misc.id,cid:e.misc.getClientAntispam,params:[{type:"Property",name:"clientAntispam"}]},fileQuickTransfer:{sid:e.misc.id,cid:e.misc.fileQuickTransfer,params:[{type:"Property",name:"fileQuickTransfer"}]},getNosOriginUrl:{sid:e.misc.id,cid:e.misc.getNosOriginUrl,params:[{type:"Property",name:"nosFileUrlTag"}]},getServerTime:{sid:e.misc.id,cid:e.misc.getServerTime,params:[]},getNosAccessToken:{sid:e.misc.id,cid:e.misc.getNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},deleteNosAccessToken:{sid:e.misc.id,cid:e.misc.deleteNosAccessToken,params:[{type:"Property",name:"nosAccessTokenTag"}]},getNosTokenTrans:{sid:e.misc.id,cid:e.misc.getNosTokenTrans,params:[{type:"Property",name:"transToken"}]},fetchFile:{sid:e.misc.id,cid:e.misc.fetchFile,params:[{type:"String",name:"docId"}]},fetchFileList:{sid:e.misc.id,cid:e.misc.fetchFileList,params:[{type:"Property",name:"fileListParam"}]},removeFile:{sid:e.misc.id,cid:e.misc.removeFile,params:[{type:"String",name:"docId"}]},getNosCdnHost:{sid:e.misc.id,cid:e.misc.getNosCdnHost,params:[]},signalingCreate:{sid:e.avSignal.id,cid:e.avSignal.signalingCreate,params:[{type:"Property",name:"avSignalTag"}]},signalingDelay:{sid:e.avSignal.id,cid:e.avSignal.signalingDelay,params:[{type:"Property",name:"avSignalTag"}]},signalingClose:{sid:e.avSignal.id,cid:e.avSignal.signalingClose,params:[{type:"Property",name:"avSignalTag"}]},signalingJoin:{sid:e.avSignal.id,cid:e.avSignal.signalingJoin,params:[{type:"Property",name:"avSignalTag"}]},signalingLeave:{sid:e.avSignal.id,cid:e.avSignal.signalingLeave,params:[{type:"Property",name:"avSignalTag"}]},signalingInvite:{sid:e.avSignal.id,cid:e.avSignal.signalingInvite,params:[{type:"Property",name:"avSignalTag"}]},signalingCancel:{sid:e.avSignal.id,cid:e.avSignal.signalingCancel,params:[{type:"Property",name:"avSignalTag"}]},signalingReject:{sid:e.avSignal.id,cid:e.avSignal.signalingReject,params:[{type:"Property",name:"avSignalTag"}]},signalingAccept:{sid:e.avSignal.id,cid:e.avSignal.signalingAccept,params:[{type:"Property",name:"avSignalTag"}]},signalingControl:{sid:e.avSignal.id,cid:e.avSignal.signalingControl,params:[{type:"Property",name:"avSignalTag"}]},signalingGetChannelInfo:{sid:e.avSignal.id,cid:e.avSignal.signalingGetChannelInfo,params:[{type:"Property",name:"avSignalTag"}]},signalingCallEx:{sid:e.avSignal.id,cid:e.avSignal.signalingCallEx,params:[{type:"Property",name:"avSignalTag"}]},signalingJoinAndAccept:{sid:e.avSignal.id,cid:e.avSignal.signalingJoinAndAccept,params:[{type:"Property",name:"avSignalTag"}]}};o.exports={idMap:e,cmdConfig:r,packetConfig:{"1_2":{service:"link",cmd:"heartbeat"},"1_5":{service:"link",cmd:"negotiateTransport",response:[{type:"Property",name:"negotiateTransportTag"}]},"1_6":{service:"link",cmd:"initTransport",response:[{type:"Property",name:"initTransportTag"}]},"6_1":{service:"misc",cmd:"getSimpleNosToken",response:[{type:"PropertyArray",name:"nosTokens",entity:"nosToken"}]},"6_2":{service:"misc",cmd:"getNosToken",response:[{type:"Property",name:"nosToken"}]},"6_3":{service:"misc",cmd:"notifyUploadLog"},"6_4":{service:"misc",cmd:"uploadSdkLogUrl"},"6_5":{service:"misc",cmd:"audioToText",response:[{type:"String",name:"text"}]},"6_6":{service:"misc",cmd:"processImage",response:[{type:"String",name:"url"}]},"6_7":{service:"misc",cmd:"getNosTokenTrans",response:[{type:"Property",name:"nosToken"},{type:"String",name:"docId"}]},"6_8":{service:"misc",cmd:"notifyTransLog",response:[{type:"Property",name:"transInfo"}]},"6_9":{service:"misc",cmd:"fetchFile",response:[{type:"Property",name:"info",entity:"transInfo"}]},"6_10":{service:"misc",cmd:"fetchFileList",response:[{type:"PropertyArray",name:"list",entity:"transInfo"},{type:"Number",name:"totalCount"}]},"6_11":{service:"misc",cmd:"removeFile",response:[{type:"String",name:"res"}]},"6_17":{service:"misc",cmd:"getClientAntispam",response:[{type:"Property",name:"clientAntispam"}]},"6_18":{service:"misc",cmd:"fileQuickTransfer",response:[{type:"Property",name:"fileQuickTransfer"}]},"6_22":{service:"misc",cmd:"getNosOriginUrl",response:[{type:"Property",name:"nosFileUrlTag"}]},"6_23":{service:"misc",cmd:"getServerTime",response:[{type:"Number",name:"time"}]},"6_24":{service:"misc",cmd:"getNosAccessToken",response:[{type:"Property",name:"nosAccessTokenTag"}]},"6_25":{service:"misc",cmd:"deleteNosAccessToken"},"6_26":{service:"misc",cmd:"getNosCdnHost",response:[{type:"Property",name:"nosConfigTag"}]},"6_27":{service:"misc",cmd:"getGrayscaleConfig",response:[{type:"Property",name:"appGrayConfigTag"}]},"6_28":{service:"misc",cmd:"getMixStorePolicy",response:[{type:"Property",name:"mixStorePolicyTag"}]},"6_29":{service:"misc",cmd:"getMixStoreToken",response:[{type:"Property",name:"mixStoreTokenTag"}]},"6_30":{service:"misc",cmd:"getBackSourceToken",response:[{type:"Property",name:"backSourceTokenTag"}]},"6_31":{service:"link",cmd:"notifyDetect",response:[{type:"Property",name:"notifyDetectTag"}]},"6_32":{service:"link",cmd:"uploadDetect",response:[]},"15_1":{service:"avSignal",cmd:"signalingCreate",response:[{type:"Property",name:"avSignalTag"}]},"15_2":{service:"avSignal",cmd:"signalingDelay",response:[{type:"Property",name:"avSignalTag"}]},"15_3":{service:"avSignal",cmd:"signalingClose",response:[{type:"Property",name:"avSignalTag"}]},"15_4":{service:"avSignal",cmd:"signalingJoin",response:[{type:"Property",name:"avSignalTag"}]},"15_5":{service:"avSignal",cmd:"signalingLeave",response:[]},"15_6":{service:"avSignal",cmd:"signalingInvite",response:[]},"15_7":{service:"avSignal",cmd:"signalingCancel",response:[]},"15_8":{service:"avSignal",cmd:"signalingReject",response:[]},"15_9":{service:"avSignal",cmd:"signalingAccept",response:[]},"15_10":{service:"avSignal",cmd:"signalingControl",response:[]},"15_11":{service:"avSignal",cmd:"signalingNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_12":{service:"avSignal",cmd:"signalingMutilClientSyncNotify",response:[{type:"Property",name:"avSignalTag"}]},"15_13":{service:"avSignal",cmd:"signalingUnreadMessageSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_14":{service:"avSignal",cmd:"signalingChannelsSyncNotify",response:[{type:"PropertyArray",name:"avSignalTag"}]},"15_15":{service:"avSignal",cmd:"signalingGetChannelInfo",response:[{type:"Property",name:"avSignalTag"}]},"15_16":{service:"avSignal",cmd:"signalingCallEx",response:[{type:"Property",name:"avSignalTag"}]},"15_17":{service:"avSignal",cmd:"signalingJoinAndAccept",response:[{type:"Property",name:"avSignalTag"}]}}}},function(o,k,e){var r=e(5),i=e(2),s=e(25),n=e(0),u=n.notundef,p=n.fillPropertyWithDefault,d=r,m={},c={},h=[],a={},y={normal:0,advanced:1},T={0:"normal",1:"advanced"},v=d(y),g=m.joinMode={noVerify:0,needVerify:1,rejectAll:2};c.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},h.push("join"),a.joinMode=d(g);var b=m.beInviteMode={needVerify:0,noVerify:1};c.beInviteMode={0:"needVerify",1:"noVerify"},h.push("beInvite"),a.beInviteMode=d(b);var S=m.inviteMode={manager:0,all:1};c.inviteMode={0:"manager",1:"all"},h.push("invite"),a.inviteMode=d(S);var O=m.updateTeamMode={manager:0,all:1};c.updateTeamMode={0:"manager",1:"all"},h.push("updateTeam"),a.updateTeamMode=d(O);var I=m.updateCustomMode={manager:0,all:1};function R(F){var P;switch(n.verifyOptions(F,"action","team::Team"),F.action){case"create":n.verifyOptions(F,"teamId",!1,"team::Team"),n.verifyOptions(F,"type name","team::Team"),n.verifyParamValid("type",F.type,v,"team::Team"),u(F.level)&&(n.verifyParamType("level",F.level,"number","team::Team"),this.level=F.level);break;case"update":n.verifyOptions(F,"teamId","team::Team"),n.verifyOptions(F,"type",!1,"team::Team")}u(F.teamId)&&(this.teamId=F.teamId),u(F.type)&&(this.type=y[F.type]),u(F.avatar)&&(this.avatar=""+F.avatar),u(F.name)&&(this.name=""+F.name),u(F.intro)&&(this.intro=""+F.intro),u(F.announcement)&&(this.announcement=""+F.announcement),i(h).call(h,s(P=this.setMode).call(P,this,F)),u(F.custom)&&(this.custom=""+F.custom)}function N(F,P){u(F[P+="Mode"])&&(F[P]=c[P][F[P]])}c.updateCustomMode={0:"manager",1:"all"},h.push("updateCustom"),a.updateCustomMode=d(I),R.prototype.setMode=function(F,P){u(F[P+="Mode"])&&(n.verifyParamValid(P,F[P],a[P],"team::Team"),this[P]=m[P][F[P]])},R.reverse=function(F,P){var x=n.copy(F);if(u(x.teamId)&&(x.teamId=""+x.teamId),u(x.type)&&(x.type=T[x.type]),u(x.level)&&(x.level=+x.level),u(x.valid)&&(x.valid=+x.valid==1),u(x.memberNum)&&(x.memberNum=+x.memberNum),u(x.memberUpdateTime)&&(x.memberUpdateTime=+x.memberUpdateTime),u(x.createTime)&&(x.createTime=+x.createTime),u(x.updateTime)&&(x.updateTime=+x.updateTime),u(x.validToCurrentUser)&&(x.validToCurrentUser=x.validToCurrentUser==="1"),u(x.mute)&&(x.mute=x.mute==="1"),u(x.muteType))switch(x.muteType){case"0":x.mute=!1,x.muteType="none";break;case"1":x.mute=!0,x.muteType="normal";break;case"3":x.mute=!0,x.muteType="all"}else u(x.mute)&&(x.mute===1?(x.mute=!0,x.muteType="normal"):(x.mute=!1,x.muteType="none"));return i(h).call(h,s(N).call(N,null,x)),delete x.bits,P||R.fillProperties(x),x},R.fillProperties=function(F){var P=p(F,"beInviteMode","needVerify"),x=p(F,"inviteMode","manager"),L=p(F,"updateTeamMode","manager"),_=p(F,"updateCustomMode","manager"),C=p(F,"avatar","");return P||x||L||_||C},o.exports=R},function(o,k,e){var r=e(44).clientTypeMap;function i(){}i.reverse=function(s){var n=s;return n.type=r[n.type],n},i.reverseType=function(s){return r[s]||s},o.exports=i},function(o,k,e){var r=e(18),i=e(41),s=e(10),n=e(73),u=e(195),p=e(13),d=e(760),m=e(892),c=e(0),h=c.verifyOptions,a=c.verifyParamType,y=e(24).reportAPI,T=e(147).Chatroom,v=e(154);function g(S){var O=v(S);return this.subType="chatroom",this.nosScene=O.nosScene||"chatroom",this.nosSurvivalTime=O.nosSurvivalTime,O.Protocol=u,O.Message=m,O.constructor=g,O.isAnonymous&&(O.account=O.account||"nimanon_".concat(c.guid()),O.isAnonymous=1,c.verifyOptions(O,"chatroomNick","api::Chatroom"),O.chatroomAvatar=O.chatroomAvatar||" "),this.init(O)}g.Protocol=u,g.parser=T,g.use=n.use,g.getInstance=function(S){return S.isAnonymous&&(S.account=S.account||"nimanon_".concat(c.guid()),S.isAnonymous=1,c.verifyOptions(S,"chatroomNick","api::Chatroom.getInstance"),S.chatroomAvatar=S.chatroomAvatar||" "),n.getInstance.call(this,S)},g.genInstanceName=function(S){return c.verifyOptions(S,"chatroomId","api::Chatroom.genInstanceName"),"Chatroom-account-"+S.account+"-chatroomId-"+S.chatroomId};var b=g.fn=g.prototype=r(n.prototype);g.info=b.info=p.info,b.getChatroom=function(S){(S=S||{}).done=y({instance:this,className:"ChatroomFn",funcName:"getChatroom",done:S.done}),this.processCallback(S),this.sendCmd("getChatroom",S)},b.updateChatroom=function(S){(S=S||{}).done=y({instance:this,className:"ChatroomFn",funcName:"updateChatroom",done:S.done}),h(S,"chatroom needNotify","api::updateChatroom"),a("needNotify",S.needNotify,"boolean"),this.processCustom(S),this.processCallback(S),S.chatroom=new d(S.chatroom),S.antispamTag={antiSpamBusinessId:S.antiSpamBusinessId},this.sendCmd("updateChatroom",S)},b.closeChatroom=function(S){(S=S||{}).done=y({instance:this,className:"ChatroomFn",funcName:"closeChatroom",done:S.done}),this.processCustom(S),this.processCallback(S),this.sendCmd("closeChatroom",S)},b.updateTags=function(S){(S=S||{}).done=y({instance:this,className:"ChatroomFn",funcName:"updateTags",done:S.done}),c.validate({tags:{type:"array",required:!1},notifyTargetTags:{type:"string",allowEmpty:!0,required:!1},needNotify:{type:"boolean",required:!1}},S,"chatroom::updateTags");var O=i({},S);this.processCallback(O),O.tags&&(O.tags=s(O.tags)),O.needNotify&&(O.needNotify=O.needNotify?1:0),this.sendCmd("updateChatroomTags",{chatRoomTagsUpdateTag:O},O.done)},o.exports=g,e(902),e(903),e(904),e(905)},function(o,k,e){var r=e(18),i=e(25),s=e(8),n=e(9),u=e(75),p=e(0),d=p.undef,m=p.notundef,c=e(290),h=e(13),a=e(147),y=e(760),T=e(311);function v(S){var O,I,R;p.verifyOptions(S,"appKey account chatroomId chatroomAddresses","protocol::ChatroomProtocol"),S.isAnonymous||p.verifyOptions(S,"token","protocol::ChatroomProtocol"),p.verifyParamType("chatroomAddresses",S.chatroomAddresses,"array","protocol::ChatroomProtocol"),p.verifyCallback(S,"onconnect onerror onwillreconnect ondisconnect onmsg onmsgs onrobots","protocol::ChatroomProtocol"),O=typeof p.get(S,"privateConf.isDataReportEnable")=="boolean"?S.privateConf.isDataReportEnable:h.privateConf.isDataReportEnable,I=typeof p.get(S,"privateConf.reportConfigUrl")=="string"?S.privateConf.reportConfigUrl:h.privateConf.reportConfigUrl,R=typeof p.get(S,"privateConf.reportUrl")=="string"?S.privateConf.reportUrl:h.privateConf.reportUrl,this.reporter=c.initReporter({isDataReportEnable:O,reportConfigUrl:I,reportUrl:R,appKey:S.appKey,logger:this.logger}),u.call(this,S)}var g=u.fn,b=v.fn=v.prototype=r(g);b.init=function(){var S;g.init.call(this),a.Chatroom.setProtocol(this),this.parser=a.Chatroom,i(S=this.sendCmd).call(S,this),this.syncResult={},this.timetags={},this.msgBuffer=[]},b.reset=function(){var S=this;g.reset.call(S);var O,I=S.options;S.autoconnect=!!I.autoconnect,d(I.msgBufferInterval)&&(I.msgBufferInterval=300),p.verifyParamType("msgBufferInterval",I.msgBufferInterval,"number","protocol::ChatroomProtocol.reset"),d(I.msgBufferSize)&&(I.msgBufferSize=500),p.verifyParamType("msgBufferSize",I.msgBufferSize,"number","protocol::ChatroomProtocol.reset"),m(I.chatroomAddresses)&&(S.socketUrlsBackup=s(O=I.chatroomAddresses).call(O,function(R){return h.formatSocketUrl({url:R,secure:S.options.secure})}))},b.processChatroom=function(S){switch(S.cmd){case"login":S.error||(S.obj={chatroom:n(y).call(y,S.content.chatroom),member:n(T).call(T,S.content.chatroomMember)},this.cdnInfo={},this.initCdnData(),clearTimeout(this.queryCdnTimer),this.onCdnMsgInfo(S.content.chatroomCdnInfo));break;case"kicked":this.onKicked(S);break;case"logout":break;case"sendMsg":this.onSendMsg(S);break;case"msg":this.onMsg(S),this.cdnInfo&&this.cdnInfo.enable&&this.correctCdnTime(+S.content.msg.time);break;case"getChatroomMembers":case"getChatroomMembersByTag":this.onChatroomMembers(S);break;case"getChatroomMemberCountByTag":this.onGetChatroomMemberCountByTag(S);break;case"getHistoryMsgs":case"getHistoryMsgsByTags":this.onHistoryMsgs(S);break;case"markChatroomMember":this.onMarkChatroomMember(S);break;case"closeChatroom":break;case"getChatroom":this.onChatroom(S);break;case"updateChatroom":break;case"updateMyChatroomMemberInfo":delete S.obj.chatroomMember;break;case"getChatroomMembersInfo":this.onChatroomMembersInfo(S);break;case"kickChatroomMember":case"updateChatroomMemberTempMute":break;case"queueList":S.error||(S.obj=S.content);break;case"syncRobot":this.onSyncRobot(S);break;case"notifyCdnInfo":this.onCdnMsgInfo(S.content&&S.content.chatroomCdnInfo);break;case"updateChatroomTag":this.onTagsUpdate(S.content)}},b.onChatroom=function(S){S.error||(S.obj.chatroom=n(y).call(y,S.content.chatroom))},b.onTagsUpdate=function(S){if(this.logger.info("onTagsUpdate:: ",S),this.options.onTagsUpdate&&typeof this.options.onTagsUpdate=="function"){var O=S.updateTags&&S.updateTags.currentTags;try{O=JSON.parse(O)}catch(I){this.logger.error("onTagsUpdate:: parse tags failed",I)}this.options.onTagsUpdate(O)}},o.exports=v,e(880),e(881),e(882),e(891)},function(o,k){o.exports=function(){}},function(o,k,e){o.exports=e(443)},function(o,k){o.exports=function(e,r){for(var i=r.split(".");i.length;){var s=i.shift(),n=!1;if(s[s.length-1]=="?"&&(s=s.slice(0,-1),n=!0),!(e=e[s])&&n)return e}return e}},function(o,k){o.exports=function(e,r){return e===r||e!=e&&r!=r}},function(o,k,e){var r=e(256),i=e(264);o.exports=function(s){return s!=null&&i(s.length)&&!r(s)}},function(o,k,e){o.exports=e(627)},function(o,k,e){var r=e(8),i=e(9),s=e(0),n=s.notundef,u=s.fillPropertyWithDefault,p={0:"normal",1:"owner",2:"manager"};function d(m){s.verifyOptions(m,"teamId","superTeam::TeamMember"),s.verifyParamAtLeastPresentOne(m,"nickInTeam muteTeam custom muteNotiType","superTeam::SuperTeamMember"),this.teamId=m.teamId,n(m.account)&&(this.account=m.account),n(m.nickInTeam)&&(this.nickInTeam=m.nickInTeam),n(m.muteNotiType)?this.bits=m.muteNotiType:n(m.muteTeam)&&(this.bits=0,m.muteTeam&&(this.bits+=1)),n(m.mute)&&(this.mute=m.mute?1:0),n(m.custom)&&(this.custom=""+m.custom)}d.reverse=function(m){var c=s.copy(m);if(n(c.teamId)&&(c.teamId=""+c.teamId),n(c.type)&&(c.type=p[c.type]),n(c.active)&&(c.active=+c.active==1),n(c.valid)&&(c.valid=+c.valid==1),n(c.mute)&&(c.mute=+c.mute==1),n(c.joinTime)&&(c.joinTime=+c.joinTime),n(c.updateTime)&&(c.updateTime=+c.updateTime),n(c.bits)){var h=c.bits;delete c.bits,c.muteTeam=!!(1&h),c.muteNotiType=h}return n(c.teamId)&&n(c.account)&&(c.id=d.genId(c.teamId,c.account)),c},d.reverseMembers=function(m){return r(m).call(m,function(c){return i(d).call(d,c)})},d.fillProperties=function(m){var c=u(m,"mute",!1),h=u(m,"custom","");return c||h},d.genId=function(m,c){return m+"-"+c},d.accounts2ids=function(m,c){return r(c).call(c,function(h){return d.genId(m,h)})},d.assembleMembers=function(m,c){return s.isArray(c)||(c=[c]),r(c).call(c,function(h){return d.assembleMember(m,h)})},d.assembleMember=function(m,c){return{id:d.genId(m.teamId,c),account:c,teamId:m.teamId,type:"normal",nickInTeam:"",muteTeam:!1,mute:!1,joinTime:m.memberUpdateTime,updateTime:m.memberUpdateTime,active:!0,valid:!0}},d.assembleOwner=function(m){var c=d.assembleMember(m,m.owner);return c.type="owner",c},o.exports=d},function(o,k,e){var r=e(8),i=e(9),s=e(5),n=e(106).genPrivateUrl,u=e(0),p={unknown:0,male:1,female:2},d={0:"unknown",1:"male",2:"female"};function m(c){u.merge(this,c),u.notundef(this.gender)&&(u.verifyParamValid("gender",this.gender,m.validGenders,"user::User"),this.gender=p[this.gender]),u.notundef(this.email)&&this.email!==""&&u.verifyEmail("email",this.email,"user::User"),u.notundef(this.birth)&&this.birth!==""&&u.verifyBirth("birth",this.birth,"user::User"),u.notundef(this.tel)&&this.tel!==""&&u.verifyTel("tel",this.tel,"user::User")}m.reverse=function(c,h,a){var y=u.filterObj(c,"account nick avatar _avatar_safe sign gender email birth tel custom createTime updateTime");return u.notundef(y.avatar)&&(y.avatar=n(y.avatar,h,a)),u.notundef(y.gender)&&(y.gender=d[y.gender]),u.notundef(y.createTime)&&(y.createTime=+y.createTime),u.notundef(y.updateTime)&&(y.updateTime=+y.updateTime),y},m.reverseUsers=function(c){return r(c).call(c,function(h){return i(m).call(m,h)})},m.validGenders=s(p),o.exports=m},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(6),u=e(106).genPrivateUrl,p=e(72),d=e(0),m=e(13);function c(T,v){switch(d.notundef(T.type)?d.verifyFileType(T.type,"msg::FileMessage"):T.type="file",d.verifyOptions(T,"file","msg::FileMessage"),d.verifyOptions(T.file,"url ext size",!0,"file.","msg::FileMessage"),T.type){case"image":h.verifyFile(T.file,"msg::FileMessage");break;case"audio":a.verifyFile(T.file,"msg::FileMessage");break;case"video":y.verifyFile(T.file,"msg::FileMessage")}p.call(this,T),v&&(this.idClient=v),this.attach=r(T.file)}c.prototype=i(p.prototype),c.reverse=function(T){var v=s(p).call(p,T);if(T.attach=T.attach?""+T.attach:"",T.attach&&(v.file=JSON.parse(T.attach),!v.file.isS3)){var g,b;v.file.url=u(v.file.url)||"",v.type==="audio"&&v.file.url&&!v.file.mp3Url&&(v.file.mp3Url=v.file.url+(~n(b=v.file.url).call(b,"?")?"&":"?")+"audioTrans&type=mp3"),m.httpsEnabled&&n(g=v.file.url).call(g,"https://")!==0&&(v.file.url=v.file.url.replace("http","https"))}return v},o.exports=c;var h=e(828),a=e(829),y=e(830)},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(6),u=e(106).genPrivateUrl,p=e(117),d=e(0),m=e(13);function c(T,v){switch(d.notundef(T.type)?d.verifyFileType(T.type,"msg::FileMessage"):T.type="file",d.verifyOptions(T,"file","msg::FileMessage"),d.verifyOptions(T.file,"url ext size",!0,"file.","msg::FileMessage"),T.type){case"image":h.verifyFile(T.file,"msg::FileMessage");break;case"audio":a.verifyFile(T.file,"msg::FileMessage");break;case"video":y.verifyFile(T.file,"msg::FileMessage")}p.call(this,T),v&&(this.idClient=v),this.attach=r(T.file)}c.prototype=i(p.prototype),c.reverse=function(T){var v=s(p).call(p,T);if(T.attach=T.attach?""+T.attach:"",T.attach&&(v.file=JSON.parse(T.attach),!v.file.isS3)){var g,b;v.file.url=u(v.file.url)||"",v.type==="audio"&&v.file.url&&!v.file.mp3Url&&(v.file.mp3Url=v.file.url+(~n(b=v.file.url).call(b,"?")?"&":"?")+"audioTrans&type=mp3"),m.httpsEnabled&&n(g=v.file.url).call(g,"https://")!==0&&(v.file.url=v.file.url.replace("http","https"))}return v},o.exports=c;var h=e(894),a=e(895),y=e(896)},function(o,k,e){var r=e(314);o.exports=r},function(o,k){var e=typeof document=="object"&&document.all,r=e===void 0&&e!==void 0;o.exports={all:e,IS_HTMLDDA:r}},function(o,k,e){var r=e(92);o.exports=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},function(o,k,e){var r=e(27),i=e(4),s=e(159);o.exports=!r&&!i(function(){return Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a!=7})},function(o,k,e){var r=e(4),i=e(16),s=/#|\.prototype\./,n=function(c,h){var a=p[u(c)];return a==m||a!=d&&(i(h)?r(h):!!h)},u=n.normalize=function(c){return String(c).replace(s,".").toLowerCase()},p=n.data={},d=n.NATIVE="N",m=n.POLYFILL="P";o.exports=n},function(o,k,e){var r=e(27),i=e(4);o.exports=r&&i(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},function(o,k,e){var r=e(1),i=e(4),s=e(79),n=e(28),u=e(42),p=e(45),d=e(213),m=e(95),c=e(161),h=e(111),a=e(20),y=e(93),T=a("isConcatSpreadable"),v=y>=51||!i(function(){var S=[];return S[T]=!1,S.concat()[0]!==S}),g=h("concat"),b=function(S){if(!n(S))return!1;var O=S[T];return O!==void 0?!!O:s(S)};r({target:"Array",proto:!0,arity:1,forced:!v||!g},{concat:function(S){var O,I,R,N,F,P=u(this),x=c(P,0),L=0;for(O=-1,R=arguments.length;O<R;O++)if(b(F=O===-1?P:arguments[O]))for(N=p(F),d(L+N),I=0;I<N;I++,L++)I in F&&m(x,L,F[I]);else d(L+1),m(x,L++,F);return x.length=L,x}})},function(o,k){var e=TypeError;o.exports=function(r){if(r>9007199254740991)throw e("Maximum allowed index exceeded");return r}},function(o,k,e){var r=e(11),i=e(16),s=e(158),n=r(Function.toString);i(s.inspectSource)||(s.inspectSource=function(u){return n(u)}),o.exports=s.inspectSource},function(o,k,e){var r=e(326);o.exports=r},function(o,k,e){var r=e(11),i=e(29),s=e(43),n=e(160).indexOf,u=e(112),p=r([].push);o.exports=function(d,m){var c,h=s(d),a=0,y=[];for(c in h)!i(u,c)&&i(h,c)&&p(y,c);for(;m.length>a;)i(h,c=m[a++])&&(~n(y,c)||p(y,c));return y}},function(o,k,e){var r=e(33);o.exports=r("document","documentElement")},function(o,k,e){var r=e(331);e(66),o.exports=r},function(o,k,e){e(332),e(335),e(336),e(223),e(337)},function(o,k,e){var r=e(128),i=e(45),s=e(95),n=Array,u=Math.max;o.exports=function(p,d,m){for(var c=i(p),h=r(d,c),a=r(m===void 0?c:m,c),y=n(u(a-h,0)),T=0;h<a;h++,T++)s(y,T,p[h]);return y.length=T,y}},function(o,k,e){var r=e(19),i=e(33),s=e(20),n=e(65);o.exports=function(){var u=i("Symbol"),p=u&&u.prototype,d=p&&p.valueOf,m=s("toPrimitive");p&&!p[m]&&n(p,m,function(c){return r(d,this)},{arity:1})}},function(o,k,e){var r=e(92);o.exports=r&&!!Symbol.for&&!!Symbol.keyFor},function(o,k,e){var r=e(1),i=e(33),s=e(76),n=e(19),u=e(11),p=e(4),d=e(79),m=e(16),c=e(28),h=e(126),a=e(98),y=e(92),T=i("JSON","stringify"),v=u(/./.exec),g=u("".charAt),b=u("".charCodeAt),S=u("".replace),O=u(1 .toString),I=/[\uD800-\uDFFF]/g,R=/^[\uD800-\uDBFF]$/,N=/^[\uDC00-\uDFFF]$/,F=!y||p(function(){var _=i("Symbol")();return T([_])!="[null]"||T({a:_})!="{}"||T(Object(_))!="{}"}),P=p(function(){return T("\uDF06\uD834")!=='"\\udf06\\ud834"'||T("\uDEAD")!=='"\\udead"'}),x=function(_,C){var A=a(arguments),M=C;if((c(C)||_!==void 0)&&!h(_))return d(C)||(C=function(U,E){if(m(M)&&(E=n(M,this,U,E)),!h(E))return E}),A[1]=C,s(T,null,A)},L=function(_,C,A){var M=g(A,C-1),U=g(A,C+1);return v(R,_)&&!v(N,U)||v(N,_)&&!v(R,M)?"\\u"+O(b(_,0),16):_};T&&r({target:"JSON",stat:!0,arity:3,forced:F||P},{stringify:function(_,C,A){var M=a(arguments),U=s(F?x:T,null,M);return P&&typeof U=="string"?S(U,I,L):U}})},function(o,k,e){e(22)("iterator")},function(o,k,e){var r=e(22),i=e(221);r("toPrimitive"),i()},function(o,k,e){var r=e(27),i=e(29),s=Function.prototype,n=r&&Object.getOwnPropertyDescriptor,u=i(s,"name"),p=u&&function(){}.name==="something",d=u&&(!r||r&&n(s,"name").configurable);o.exports={EXISTS:u,PROPER:p,CONFIGURABLE:d}},function(o,k,e){var r,i,s,n=e(4),u=e(16),p=e(28),d=e(80),m=e(134),c=e(65),h=e(20),a=e(48),y=h("iterator"),T=!1;[].keys&&("next"in(s=[].keys())?(i=m(m(s)))!==Object.prototype&&(r=i):T=!0),!p(r)||n(function(){var v={};return r[y].call(v)!==v})?r={}:a&&(r=d(r)),u(r[y])||c(r,y,function(){return this}),o.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:T}},function(o,k,e){var r=e(4);o.exports=!r(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype})},function(o,k,e){e(66);var r=e(64),i=e(29),s=e(21),n=e(373),u=Array.prototype,p={DOMTokenList:!0,NodeList:!0};o.exports=function(d){var m=d.forEach;return d===u||s(u,d)&&m===u.forEach||i(p,r(d))?n:m}},function(o,k,e){var r=e(381);o.exports=r},function(o,k,e){var r=e(385);e(66),o.exports=r},function(o,k,e){e(386)},function(o,k,e){var r=e(33),i=e(11),s=e(131),n=e(132),u=e(36),p=i([].concat);o.exports=r("Reflect","ownKeys")||function(d){var m=s.f(u(d)),c=n.f;return c?p(m,c(d)):m}},function(o,k,e){var r=e(20),i=e(99),s=r("iterator"),n=Array.prototype;o.exports=function(u){return u!==void 0&&(i.Array===u||n[s]===u)}},function(o,k,e){var r=e(19),i=e(31),s=e(36),n=e(78),u=e(136),p=TypeError;o.exports=function(d,m){var c=arguments.length<2?u(d):m;if(i(c))return s(r(c,d));throw p(n(d)+" is not iterable")}},function(o,k,e){var r=e(19),i=e(36),s=e(157);o.exports=function(n,u,p){var d,m;i(n);try{if(!(d=s(n,"return"))){if(u==="throw")throw p;return p}d=r(d,n)}catch(c){m=!0,d=c}if(u==="throw")throw p;if(m)throw d;return i(d),p}},function(o,k,e){var r=e(33),i=e(38),s=e(20),n=e(27),u=s("species");o.exports=function(p){var d=r(p),m=i.f;n&&d&&!d[u]&&m(d,u,{configurable:!0,get:function(){return this}})}},function(o,k,e){var r=e(36),i=e(169),s=e(91),n=e(20)("species");o.exports=function(u,p){var d,m=r(u).constructor;return m===void 0||s(d=r(m)[n])?p:i(d)}},function(o,k,e){var r,i,s,n,u=e(14),p=e(76),d=e(34),m=e(16),c=e(29),h=e(4),a=e(217),y=e(98),T=e(159),v=e(240),g=e(241),b=e(114),S=u.setImmediate,O=u.clearImmediate,I=u.process,R=u.Dispatch,N=u.Function,F=u.MessageChannel,P=u.String,x=0,L={};try{r=u.location}catch{}var _=function(U){if(c(L,U)){var E=L[U];delete L[U],E()}},C=function(U){return function(){_(U)}},A=function(U){_(U.data)},M=function(U){u.postMessage(P(U),r.protocol+"//"+r.host)};S&&O||(S=function(U){v(arguments.length,1);var E=m(U)?U:N(U),z=y(arguments,1);return L[++x]=function(){p(E,void 0,z)},i(x),x},O=function(U){delete L[U]},b?i=function(U){I.nextTick(C(U))}:R&&R.now?i=function(U){R.now(C(U))}:F&&!g?(n=(s=new F).port2,s.port1.onmessage=A,i=d(n.postMessage,n)):u.addEventListener&&m(u.postMessage)&&!u.importScripts&&r&&r.protocol!=="file:"&&!h(M)?(i=M,u.addEventListener("message",A,!1)):i="onreadystatechange"in T("script")?function(U){a.appendChild(T("script")).onreadystatechange=function(){a.removeChild(this),_(U)}}:function(U){setTimeout(C(U),0)}),o.exports={set:S,clear:O}},function(o,k){var e=TypeError;o.exports=function(r,i){if(r<i)throw e("Not enough arguments");return r}},function(o,k,e){var r=e(63);o.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(o,k){o.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},function(o,k,e){var r=e(101),i=e(244),s=e(115).CONSTRUCTOR;o.exports=s||!i(function(n){r.all(n).then(void 0,function(){})})},function(o,k,e){var r=e(20)("iterator"),i=!1;try{var s=0,n={next:function(){return{done:!!s++}},return:function(){i=!0}};n[r]=function(){return this},Array.from(n,function(){throw 2})}catch{}o.exports=function(u,p){if(!p&&!i)return!1;var d=!1;try{var m={};m[r]=function(){return{next:function(){return{done:d=!0}}}},u(m)}catch{}return d}},function(o,k,e){var r=e(36),i=e(28),s=e(67);o.exports=function(n,u){if(r(n),i(u)&&u.constructor===n)return u;var p=s.f(n);return(0,p.resolve)(u),p.promise}},function(o,k,e){var r=e(1),i=e(19),s=e(31),n=e(67),u=e(100),p=e(46);r({target:"Promise",stat:!0},{allSettled:function(d){var m=this,c=n.f(m),h=c.resolve,a=c.reject,y=u(function(){var T=s(m.resolve),v=[],g=0,b=1;p(d,function(S){var O=g++,I=!1;b++,i(T,m,S).then(function(R){I||(I=!0,v[O]={status:"fulfilled",value:R},--b||h(v))},function(R){I||(I=!0,v[O]={status:"rejected",reason:R},--b||h(v))})}),--b||h(v)});return y.error&&a(y.value),c.promise}})},function(o,k,e){var r=e(1),i=e(19),s=e(31),n=e(33),u=e(67),p=e(100),d=e(46);r({target:"Promise",stat:!0},{any:function(m){var c=this,h=n("AggregateError"),a=u.f(c),y=a.resolve,T=a.reject,v=p(function(){var g=s(c.resolve),b=[],S=0,O=1,I=!1;d(m,function(R){var N=S++,F=!1;O++,i(g,c,R).then(function(P){F||I||(I=!0,y(P))},function(P){F||I||(F=!0,b[N]=P,--O||T(new h(b,"No one promise resolved")))})}),--O||T(new h(b,"No one promise resolved"))});return v.error&&T(v.value),a.promise}})},function(o,k,e){var r=e(409);o.exports=r},function(o,k,e){var r=e(26).default,i=e(411);o.exports=function(s){var n=i(s,"string");return r(n)==="symbol"?n:String(n)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(419);o.exports=r},function(o,k,e){var r=e(78),i=TypeError;o.exports=function(s,n){if(!delete s[n])throw i("Cannot delete property "+r(n)+" of "+r(s))}},function(o,k,e){e(454),e(456)},function(o,k,e){var r,i=e(14),s=e(76),n=e(16),u=e(455),p=e(63),d=e(98),m=e(240),c=i.Function,h=/MSIE .\./.test(p)||u&&((r=i.Bun.version.split(".")).length<3||r[0]==0&&(r[1]<3||r[1]==3&&r[2]==0));o.exports=function(a,y){var T=y?2:1;return h?function(v,g){var b=m(arguments.length,1)>T,S=n(v)?v:c(v),O=b?d(arguments,T):[],I=b?function(){s(S,this,O)}:S;return y?a(I,g):a(I)}:a}},function(o,k,e){var r=e(474);o.exports=r},function(o,k){o.exports=function e(r,i){var s,n,u=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,p=/(^[ ]*|[ ]*$)/g,d=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,m=/^0x[0-9a-f]+$/i,c=/^0/,h=function(I){return e.insensitive&&(""+I).toLowerCase()||""+I},a=h(r).replace(p,"")||"",y=h(i).replace(p,"")||"",T=a.replace(u,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),v=y.replace(u,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(a.match(m),16)||T.length!==1&&a.match(d)&&Date.parse(a),b=parseInt(y.match(m),16)||g&&y.match(d)&&Date.parse(y)||null;if(b){if(g<b)return-1;if(g>b)return 1}for(var S=0,O=Math.max(T.length,v.length);S<O;S++){if(s=!(T[S]||"").match(c)&&parseFloat(T[S])||T[S]||0,n=!(v[S]||"").match(c)&&parseFloat(v[S])||v[S]||0,isNaN(s)!==isNaN(n))return isNaN(s)?1:-1;if(typeof s!=typeof n&&(s+="",n+=""),s<n)return-1;if(s>n)return 1}return 0}},function(o,k,e){var r=e(119),i=e(88);o.exports=function(s){if(!i(s))return!1;var n=r(s);return n=="[object Function]"||n=="[object GeneratorFunction]"||n=="[object AsyncFunction]"||n=="[object Proxy]"}},function(o,k,e){(function(r){var i=typeof r=="object"&&r&&r.Object===Object&&r;o.exports=i}).call(this,e(70))},function(o,k){var e=Function.prototype.toString;o.exports=function(r){if(r!=null){try{return e.call(r)}catch{}try{return r+""}catch{}}return""}},function(o,k,e){var r=e(503),i=e(510),s=e(512),n=e(513),u=e(514);function p(d){var m=-1,c=d==null?0:d.length;for(this.clear();++m<c;){var h=d[m];this.set(h[0],h[1])}}p.prototype.clear=r,p.prototype.delete=i,p.prototype.get=s,p.prototype.has=n,p.prototype.set=u,o.exports=p},function(o,k,e){var r=e(261),i=e(199),s=Object.prototype.hasOwnProperty;o.exports=function(n,u,p){var d=n[u];s.call(n,u)&&i(d,p)&&(p!==void 0||u in n)||r(n,u,p)}},function(o,k,e){var r=e(516);o.exports=function(i,s,n){s=="__proto__"&&r?r(i,s,{configurable:!0,enumerable:!0,value:n,writable:!0}):i[s]=n}},function(o,k,e){var r=e(518),i=e(519),s=e(175),n=e(263),u=e(301),p=e(522),d=Object.prototype.hasOwnProperty;o.exports=function(m,c){var h=s(m),a=!h&&i(m),y=!h&&!a&&n(m),T=!h&&!a&&!y&&p(m),v=h||a||y||T,g=v?r(m.length,String):[],b=g.length;for(var S in m)!c&&!d.call(m,S)||v&&(S=="length"||y&&(S=="offset"||S=="parent")||T&&(S=="buffer"||S=="byteLength"||S=="byteOffset")||u(S,b))||g.push(S);return g}},function(o,k,e){(function(r){var i=e(50),s=e(521),n=k&&!k.nodeType&&k,u=n&&typeof r=="object"&&r&&!r.nodeType&&r,p=u&&u.exports===n?i.Buffer:void 0,d=(p?p.isBuffer:void 0)||s;r.exports=d}).call(this,e(145)(o))},function(o,k){o.exports=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991}},function(o,k){o.exports=function(e,r){return function(i){return e(r(i))}}},function(o,k){o.exports=function(){return[]}},function(o,k,e){var r=e(268),i=e(269),s=e(180),n=e(266),u=Object.getOwnPropertySymbols?function(p){for(var d=[];p;)r(d,s(p)),p=i(p);return d}:n;o.exports=u},function(o,k){o.exports=function(e,r){for(var i=-1,s=r.length,n=e.length;++i<s;)e[n+i]=r[i];return e}},function(o,k,e){var r=e(265)(Object.getPrototypeOf,Object);o.exports=r},function(o,k,e){var r=e(268),i=e(175);o.exports=function(s,n,u){var p=n(s);return i(s)?p:r(p,u(s))}},function(o,k,e){var r=e(83)(e(50),"Set");o.exports=r},function(o,k,e){var r=e(565);o.exports=r},function(o,k,e){var r=e(11),i=e(31),s=e(28),n=e(29),u=e(98),p=e(107),d=Function,m=r([].concat),c=r([].join),h={},a=function(y,T,v){if(!n(h,T)){for(var g=[],b=0;b<T;b++)g[b]="a["+b+"]";h[T]=d("C,a","return new C("+c(g,",")+")")}return h[T](y,v)};o.exports=p?d.bind:function(y){var T=i(this),v=T.prototype,g=u(arguments,1),b=function(){var S=m(g,u(arguments));return this instanceof b?a(T,S.length,S):T.apply(y,S)};return s(v)&&(b.prototype=v),b}},function(o,k,e){var r=e(87),i=e(6),s=e(68),n=e(123),u=e(10),p=e(54),d=p.getGlobal(),m={},c=d.name||"_parent",h=[],a=[];m.addMsgListener=function(R){h.push(R)};var y,T,v,g,b=(y=/^([\w]+?:\/\/.*?(?=\/|$))/i,function(R){return R=R||"",y.test(R)?RegExp.$1:"*"}),S=function(){var R,N,F=r(R=unescape(d.name||"")).call(R);if(F&&i(F).call(F,"MSG|")===0){d.name="";var P=p.string2object(F.replace("MSG|",""),"|"),x=(P.origin||"").toLowerCase();x&&x!=="*"&&i(N=location.href.toLowerCase()).call(N,x)!==0||function(L){for(var _=0,C=h.length;_<C;_++)try{h[_].call(null,L)}catch{}}({data:JSON.parse(P.data||"null"),source:d.frames[P.self]||P.self,origin:b(P.ref||(typeof document>"u"?"":document.referrer))})}},O=(v=function(R,N){for(var F=0,P=R.length;F<P;F++)if(R[F]===N)return!0;return!1},function(){if(a.length){T=[];for(var R,N=a.length-1;N>=0;N--)R=a[N],v(T,R.w)||(T.push(R.w),s(a).call(a,N,1),R.w.name=R.d);T=null}}),I=m.startTimer=(g=!1,function(){g||(g=!0,d.postMessage||(n(O,100),n(S,20)))});m.postMessage=function(R){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(p.fillUndef(N,{origin:"*",source:c}),d.postMessage){var F=N.data;d.FormData||(F=u(F)),R.postMessage(F,N.origin)}else{if(I(),p.isObject(N)){var P={};P.origin=N.origin||"",P.ref=location.href,P.self=N.source,P.data=u(N.data),N="MSG|"+p.object2string(P,"|",!0)}a.unshift({w:R,d:escape(N)})}},o.exports=m},function(o,k,e){var r=e(587);o.exports=r},function(o,k,e){var r=e(0),i={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}},s={genResponseBody:function(n){return i[n=n||"file"]},parseResponse:function(n,u){r.notundef(n.size)&&(n.size=+n.size),r.notundef(n.w)&&(n.w=+n.w),r.notundef(n.h)&&(n.h=+n.h),r.notundef(n.dur)&&(n.dur=+n.dur);var p=n.orientation;if(r.notundef(p)&&(delete n.orientation,u&&(p==="right, top"||p==="left, bottom"))){var d=n.w;n.w=n.h,n.h=d}return n}};o.exports=s},function(o,k,e){var r=e(120),i=e(15),s=e(6),n=e(56),u=e(23),p=["Code","code","Message","message"],d=e(13),m=e(0),c=e(40),h=e(603),a=e(604),y=e(105),T=y.EMResourceUploadWay,v=y.EMExceptionState,g=e(184).abort,b=m.supportFormData;function S(I,R){var N=this,F=I.uploadprogress,P=I.uploaddone,x=I.beginupload;return{beginupload:typeof x=="function"?function(L){try{x(L,R)}catch(_){N.logger.error("Upload::options.beginupload execute error",_)}}:function(){},uploadprogress:typeof F=="function"?function(L){N.reporterHook.emit("reporter/uploadUpdate",{transferred_size:L.loaded});try{F(L,R)}catch(_){N.logger.error("Upload::options.uploadprogress execute error",_)}}:function(L){N.reporterHook.emit("reporter/uploadUpdate",{transferred_size:L.loaded})},uploaddone:function(L,_){L?N.reporterHook.emit("reporter/uploadEnd",L.code==="RequestAbortedError"||L.code==="abort"?v.kCanceled:v.kFailed):N.reporterHook.emit("reporter/uploadEnd",v.kSucceed);try{P(L,_,null,R)}catch(C){N.logger.error("Upload::options.uploaddone execute error",C)}}}}function O(I,R,N){var F=this;F.options=m.copy(I),I=F.options,m.verifyOptions(I,"url fileName"),m.verifyParamPresentJustOne(I,"blob fileInput"),m.verifyCallback(I,"beginupload uploadprogress uploaddone"),F.reporterHook=R.reporterHook,F.logger=R.logger,F.message=N;var P=S.call(this,I,N),x=P.beginupload,L=P.uploadprogress,_=P.uploaddone;F.options.beginupload=x,F.options.uploadprogress=L,F.options.uploaddone=_,I.fileInput&&(I.fileInput=m.verifyFileInput(I.fileInput)),I.type&&m.verifyFileType(I.type),I.timeout?m.verifyParamType("timeout",I.timeout,"number"):I.timeout=6e5,m.verifyFileUploadCallback(I),I.data={},I.params&&m.merge(I.data,I.params);var C,A,M=I.fileName,U=I.fileInput;if(b){if(U){if(!(A=I.type?m.filterFiles(U.files,I.type):i([]).call(U.files,0))||!A.length)return void I.uploaddone(c.newWrongFileTypeError("未读取到"+I.type+"类型的文件, 请确保文件选择节点的文件不为空, 并且请确保选择了"+I.type+"类型的文件"));I.data[M]=A[0],C=U.files[0].size}else if(I.blob){var E;if(I.data[M]=I.blob,I.type!=="file"&&I.blob.type&&s(E=I.blob.type).call(E,I.type)===-1)return void I.uploaddone(c.newWrongFileTypeError("未读取到"+I.type+"类型的文件, 请确保选择了"+I.type+"类型的文件"));C=I.blob.size}if(F.reporterHook.emit("reporter/uploadUpdate",{full_size:C}),I.maxSize&&C>I.maxSize)return void I.uploaddone(c.newFileTooLargeError("上传文件大小超过".concat(I.maxSize,"限制")))}function z(){if(F.logger.info("Upload:enter aws upload"),C){if(C>d.chunkMaxSize)I.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(d.commonMaxSize,"限制")));else if(I.s3Policy&&I.s3Policy.uploadConfig&&I.s3Policy.uploadConfig.retryPolicy){var Y=I.s3Policy.uploadConfig.retryPolicy,W={accessKeyId:I.mixStoreToken.accessKeyId,secretAccessKey:I.mixStoreToken.secretAccessKey,sessionToken:I.mixStoreToken.sessionToken,region:I.mixStoreToken.region,maxRetries:Y.retry},ee=new I.s3;ee.config.update(W);var w=F.reporterHook.getNTPTime();ee.config.systemClockOffset=w-n();var J=decodeURIComponent(I.mixStoreToken.bucket),V=decodeURIComponent(I.mixStoreToken.objectName),D=I.data[M],Q=ee.upload({Bucket:J,Key:V,Body:D,Metadata:{token:I.mixStoreToken.token},ContentType:D.type||"application/octet-stream"});Q.on("httpUploadProgress",function(G){var B=Math.floor(1e4*G.loaded/G.total)/100,q={docId:I.docId,total:G.total,loaded:G.loaded,percentage:B,percentageText:B+"%"};I.fileInput&&(q.fileInput=I.fileInput),I.blob&&(q.blob=I.blob),I.uploadprogress(q)}),Q.send(function(G,B){if(I.errorHook({bucket:J,object:V},{provider:"s3"}),I.docId&&(B.docId=I.docId),G&&G.code==="RequestAbortedError")F.logger.error("uploadFile:","api::s3:upload file abort",G),F.onError(G);else if(G){var q;I.logger.error("error:","api::s3:upload file failed",G);var H=I.providers[(s(q=I.providers).call(q,I.curProvider)+1)%I.providers.length];Y.retryNext&&H?(F.addCircuitTimer(I,H),H===1&&I.getMixStoreToken(1,function(Z){I.mixStoreToken=Z,$()})):F.onError(B),I.errorHook(G,{provider:"s3"})}else{var K=F.options.s3Policy.cdnSchema;K=(K=K.replace("{cdnDomain}",F.options.s3Policy.dlcdn)).replace("{objectName}",B.Key),I.uploaddone(null,{size:D.size,name:D.name,url:K,ext:D.name.split(".")[1]||"unknown",_url_safe:I.mixStoreToken.shortUrl,isS3:!0}),I.logger.info("s3 Upload done: fileObj is",{size:D.size,name:D.name,url:K,ext:D.name.split(".")[1]||"unknown",_url_safe:I.mixStoreToken.shortUrl,isS3:!0})}}),typeof I.beginupload=="function"&&I.beginupload(Q)}}else I.uploaddone(c.newFileTooLargeError("Browser version is too low"))}function $(){if(F.logger.info("Upload:enter nos upload"),C&&!I.commonUpload)return F.logger.info("Upload:use chunk upload, url ".concat(I.url)),C>d.chunkMaxSize?void I.uploaddone(c.newFileTooLargeError("直传文件大小超过".concat(d.chunkMaxSize,"限制"))):void(F.sn=a(I,M,F,-1));if(F.logger.info("Upload:use common upload, url ".concat(I.url)),C&&C>d.commonMaxSize)I.uploaddone(c.newFileTooLargeError("普通上传文件大小超过".concat(d.commonMaxSize,"限制")));else{C||(m.dataset(U,"name",M),I.data.input=U);var Y={data:I.data,onaftersend:function(){I.beginupload(F,F.message)},onuploading:function(W){var ee=Math.floor(1e4*W.loaded/W.total)/100,w={docId:I.docId,total:W.total,loaded:W.loaded,percentage:ee,percentageText:ee+"%"};I.fileInput&&(w.fileInput=I.fileInput),I.blob&&(w.blob=I.blob),I.uploadprogress(w)},onload:function(W){var ee;if(I.docId&&(W.docId=I.docId),!W.Error)return I.uploaddone(null,W),void I.logger.info("nos Upload done: fileObj is",W);if(I.mixEnable&&I.curProvider===1){var w=I.nosPolicy.uploadConfig.retryPolicy,J=I.providers[(s(ee=I.providers).call(ee,I.curProvider)+1)%I.providers.length];w.retryNext&&J?(F.addCircuitTimer(I,J),J===2&&I.getMixStoreToken(2,function(V){I.mixStoreToken=V,z()})):F.onError(W)}else F.onError(W)},onerror:function(W){var ee;if(I.mixEnable&&I.curProvider===1){var w,J=I.nosPolicy.uploadConfig.retryPolicy,V=I.providers[(s(w=I.providers).call(w,I.curProvider)+1)%I.providers.length];if(J.retryNext&&V)F.addCircuitTimer(I,V),V===2&&I.getMixStoreToken(2,function(D){I.mixStoreToken=D,z()});else try{ee=W.result?JSON.parse(W.result):W,F.onError(ee)}catch{I.uploaddone(new c(W.message,W.code),F.options)}}else try{ee=W.result?JSON.parse(W.result):W,F.onError(ee)}catch{I.uploaddone(new c(W.message,W.code),F.options)}I.errorHook(W,{provider:"nos"})}};b||(Y.mode="iframe"),Y.putFileAtEnd=!0,F.sn=h(I.url,Y)}}if(I.mixEnable&&I.curProvider===2){var X=F.options.s3Policy.cdnSchema;X=X.replace("{cdnDomain}",F.options.s3Policy.dlcdn),F.reporterHook.emit("reporter/uploadUpdate",{remote_addr:X,operation_type:T.kResourceUploadWayAWSPlugin}),z()}else I.mixEnable&&I.curProvider===1?(F.reporterHook.emit("reporter/uploadUpdate",{remote_addr:I.url,operation_type:T.kResourceUploadWayNOSPlugin}),$()):(F.reporterHook.emit("reporter/uploadUpdate",{remote_addr:I.url,operation_type:T.kResourceUploadWayNOS}),$())}O.prototype.addCircuitTimer=function(I,R){var N=this;if(I.curProvider=R,I.s3Policy&&I.nosPolicy){var F=I[I.curProvider===1?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!F||F===0)return;N.circuitTimer&&clearTimeout(N.circuitTimer),N.circuitTimer=u(function(){I.curProvider=I.providers[0],N.circuitTimer=void 0},1e3*F)}},O.prototype.onError=function(){var I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},R=this,N=R.options,F=I.Error||I||{},P=F.Code,x=F.code,L=F.Message,_=F.message,C=r(F,p),A=P||x||"unknown",M=L||_||"未知错误";N.uploaddone(new c(A+"("+M+")",A,C))},O.prototype.abort=function(){g(this.sn)},o.exports=O},function(o,k,e){o.exports=e(279)},function(o,k,e){var r=e(605);o.exports=r},function(o,k,e){var r=e(187),i=e(137),s=e(188);o.exports=function(n,u){if(typeof u!="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=r(u&&u.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),i(n,"prototype",{writable:!1}),u&&s(n,u)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(26).default,i=e(619);o.exports=function(s,n){if(n&&(r(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return i(s)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(620)},function(o,k,e){var r=e(623);o.exports=r},function(o,k,e){var r=e(6),i=e(0),s={fromDataURL:function(n){var u,p,d=i.getGlobal();p=r(u=n.split(",")[0]).call(u,"base64")>=0?d.atob(n.split(",")[1]):d.decodeURIComponent(n.split(",")[1]);for(var m=n.split(",")[0].split(":")[1].split(";")[0],c=new Uint8Array(p.length),h=0;h<p.length;h++)c[h]=p.charCodeAt(h);return new d.Blob([c],{type:m})}};o.exports=s},function(o,k,e){var r=e(5),i=e(8),s=e(9),n=e(0),u={stripmeta:0,blur:2,quality:3,crop:4,rotate:5,thumbnail:7,interlace:9},p={0:"stripmeta",1:"type",2:"blur",3:"quality",4:"crop",5:"rotate",6:"pixel",7:"thumbnail",8:"watermark",9:"interlace",10:"tmp"};function d(m){n.verifyOptions(m,"type","image::ImageOp"),n.verifyParamValid("type",m.type,d.validTypes,"image::ImageOp"),n.merge(this,m),this.type=u[m.type]}d.validTypes=r(u),d.reverse=function(m){var c=n.copy(m);return c.type=p[c.type],c},d.reverseImageOps=function(m){return i(m).call(m,function(c){return s(d).call(d,c)})},o.exports=d},function(o,k,e){var r=e(2),i=e(5),s={1:"ROOM_CLOSE",2:"ROOM_JOIN",3:"INVITE",4:"CANCEL_INVITE",5:"REJECT",6:"ACCEPT",7:"LEAVE",8:"CONTROL"},n={1:"accid",2:"uid",3:"createTime",4:"expireTime",5:"web_uid"},u={10404:"ROOM_NOT_EXISTS",10405:"ROOM_HAS_EXISTS",10406:"ROOM_MEMBER_NOT_EXISTS",10407:"ROOM_MEMBER_HAS_EXISTS",10408:"INVITE_NOT_EXISTS",10409:"INVITE_HAS_REJECT",10410:"INVITE_HAS_ACCEPT",10201:"PEER_NIM_OFFLINE",10202:"PEER_PUSH_OFFLINE",10419:"ROOM_MEMBER_EXCEED",10420:"ROOM_MEMBER_HAS_EXISTS_OTHER_CLIENT",10417:"UID_CONFLICT"};o.exports={parseAvSignalType:function(p){return s[p]||p},parseAvSignalMember:function(p){var d,m={};return r(d=i(p)).call(d,function(c){m[n[c]]=p[c]}),m},parseAvSignalError:function(p){return p.message=u[p.code]||p.message||p,p}}},function(o,k,e){o.exports=e(648)},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;/*! Socket.IO.js build:0.9.11, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */function getGlobal(){return typeof window<"u"?window:typeof self<"u"?self:global!==void 0?global:{}}var root=getGlobal(),io=module.exports;root.location===void 0&&(root.location=null),root.io?module&&(module.exports=io=root.io):root.io=io,function(){(function(o,k){var e=o;e.version="0.9.11",e.protocol=1,e.transports=[],e.j=[],e.sockets={},e.connect=function(r,i){var s,n,u=e.util.parseUri(r);k&&k.location&&(u.protocol=u.protocol||k.location.protocol.slice(0,-1),u.host=u.host||(k.document?k.document.domain:k.location.hostname),u.port=u.port||k.location.port),s=e.util.uniqueUri(u);var p={host:u.ipv6uri?"["+u.host+"]":u.host,secure:u.protocol==="https",port:u.port||(u.protocol==="https"?443:80),query:u.query||""};return e.util.merge(p,i),!p["force new connection"]&&e.sockets[s]||(n=new e.Socket(p)),!p["force new connection"]&&n&&(e.sockets[s]=n),(n=n||e.sockets[s]).of(u.path.length>1?u.path:"")}})(module.exports,root),function(o,k){var e=o.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.parseUri=function(n){var u=n,p=n.indexOf("["),d=n.indexOf("]");p!=-1&&d!=-1&&(n=n.substring(0,p)+n.substring(p,d).replace(/:/g,";")+n.substring(d,n.length));for(var m=r.exec(n||""),c={},h=14;h--;)c[i[h]]=m[h]||"";return p!=-1&&d!=-1&&(c.source=u,c.host=c.host.substring(1,c.host.length-1).replace(/;/g,":"),c.authority=c.authority.replace("[","").replace("]","").replace(/;/g,":"),c.ipv6uri=!0),c},e.uniqueUri=function(n){var u=n.protocol,p=n.host,d=n.port;return"document"in k&&k.document?(p=p||document.domain,d=d||(u=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(p=p||"localhost",d||u!="https"||(d=443)),(u||"http")+"://"+p+":"+(d||80)},e.query=function(n,u){var p=e.chunkQuery(n||""),d=[];for(var m in e.merge(p,e.chunkQuery(u||"")),p)p.hasOwnProperty(m)&&d.push(m+"="+p[m]);return d.length?"?"+d.join("&"):""},e.chunkQuery=function(n){for(var u,p={},d=n.split("&"),m=0,c=d.length;m<c;++m)(u=d[m].split("="))[0]&&(p[u[0]]=u[1]);return p};var s=!1;e.load=function(n){if(typeof document<"u"&&document&&document.readyState==="complete"||s)return n();e.on(k,"load",n,!1)},e.on=function(n,u,p,d){n.attachEvent?n.attachEvent("on"+u,p):n.addEventListener&&n.addEventListener(u,p,d)},e.request=function(n){if(n&&typeof XDomainRequest<"u"&&!e.ua.hasCORS)return new XDomainRequest;if(typeof XMLHttpRequest<"u"&&(!n||e.ua.hasCORS))return new XMLHttpRequest;if(!n)try{return new root[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}return null},root!==void 0&&e.load(function(){s=!0}),e.defer=function(n){if(!e.ua.webkit||typeof importScripts<"u")return n();e.load(function(){setTimeout(n,100)})},e.merge=function(n,u,p,d){var m,c=d||[],h=p===void 0?2:p;for(m in u)u.hasOwnProperty(m)&&e.indexOf(c,m)<0&&(typeof n[m]=="object"&&h?e.merge(n[m],u[m],h-1,c):(n[m]=u[m],c.push(u[m])));return n},e.mixin=function(n,u){e.merge(n.prototype,u.prototype)},e.inherit=function(n,u){function p(){}p.prototype=u.prototype,n.prototype=new p},e.isArray=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"},e.intersect=function(n,u){for(var p=[],d=n.length>u.length?n:u,m=n.length>u.length?u:n,c=0,h=m.length;c<h;c++)~e.indexOf(d,m[c])&&p.push(m[c]);return p},e.indexOf=function(n,u,p){var d=n.length;for(p=p<0?p+d<0?0:p+d:p||0;p<d&&n[p]!==u;p++);return d<=p?-1:p},e.toArray=function(n){for(var u=[],p=0,d=n.length;p<d;p++)u.push(n[p]);return u},e.ua={},e.ua.hasCORS=typeof XMLHttpRequest<"u"&&function(){try{var n=new XMLHttpRequest}catch{return!1}return n.withCredentials!=null}(),e.ua.webkit=typeof navigator<"u"&&/webkit/i.test(navigator.userAgent),e.ua.iDevice=typeof navigator<"u"&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(io!==void 0?io:module.exports,root),function(o,k){function e(){}o.EventEmitter=e,e.prototype.on=function(r,i){return this.$events||(this.$events={}),this.$events[r]?k.util.isArray(this.$events[r])?this.$events[r].push(i):this.$events[r]=[this.$events[r],i]:this.$events[r]=i,this},e.prototype.addListener=e.prototype.on,e.prototype.once=function(r,i){var s=this;function n(){s.removeListener(r,n),i.apply(this,arguments)}return n.listener=i,this.on(r,n),this},e.prototype.removeListener=function(r,i){if(this.$events&&this.$events[r]){var s=this.$events[r];if(k.util.isArray(s)){for(var n=-1,u=0,p=s.length;u<p;u++)if(s[u]===i||s[u].listener&&s[u].listener===i){n=u;break}if(n<0)return this;s.splice(n,1),s.length||delete this.$events[r]}else(s===i||s.listener&&s.listener===i)&&delete this.$events[r]}return this},e.prototype.removeAllListeners=function(r){return r===void 0?(this.$events={},this):(this.$events&&this.$events[r]&&(this.$events[r]=null),this)},e.prototype.removeAllListenersX=function(r){if(r===void 0)return this.$events={},this;for(let i in this.$events)i!==r&&(this.$events[i]=null);return this},e.prototype.listeners=function(r){return this.$events||(this.$events={}),this.$events[r]||(this.$events[r]=[]),k.util.isArray(this.$events[r])||(this.$events[r]=[this.$events[r]]),this.$events[r]},e.prototype.emit=function(r){if(!this.$events)return!1;var i=this.$events[r];if(!i)return!1;var s=Array.prototype.slice.call(arguments,1);if(typeof i=="function")i.apply(this,s);else{if(!k.util.isArray(i))return!1;for(var n=i.slice(),u=0,p=n.length;u<p;u++)n[u].apply(this,s)}return!0}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(exports,nativeJSON){if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(o){return o<10?"0"+o:o}function date(o,k){return isFinite(o.valueOf())?o.getUTCFullYear()+"-"+f(o.getUTCMonth()+1)+"-"+f(o.getUTCDate())+"T"+f(o.getUTCHours())+":"+f(o.getUTCMinutes())+":"+f(o.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(o){return escapable.lastIndex=0,escapable.test(o)?'"'+o.replace(escapable,function(k){var e=meta[k];return typeof e=="string"?e:"\\u"+("0000"+k.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+o+'"'}function str(o,k){var e,r,i,s,n,u=gap,p=k[o];switch(p instanceof Date&&(p=date(o)),typeof rep=="function"&&(p=rep.call(k,o,p)),typeof p){case"string":return quote(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(gap+=indent,n=[],Object.prototype.toString.apply(p)==="[object Array]"){for(s=p.length,e=0;e<s;e+=1)n[e]=str(e,p)||"null";return i=n.length===0?"[]":gap?`[
`+gap+n.join(`,
`+gap)+`
`+u+"]":"["+n.join(",")+"]",gap=u,i}if(rep&&typeof rep=="object")for(s=rep.length,e=0;e<s;e+=1)typeof rep[e]=="string"&&(i=str(r=rep[e],p))&&n.push(quote(r)+(gap?": ":":")+i);else for(r in p)Object.prototype.hasOwnProperty.call(p,r)&&(i=str(r,p))&&n.push(quote(r)+(gap?": ":":")+i);return i=n.length===0?"{}":gap?`{
`+gap+n.join(`,
`+gap)+`
`+u+"}":"{"+n.join(",")+"}",gap=u,i}}JSON.stringify=function(o,k,e){var r;if(gap="",indent="",typeof e=="number")for(r=0;r<e;r+=1)indent+=" ";else typeof e=="string"&&(indent=e);if(rep=k,k&&typeof k!="function"&&(typeof k!="object"||typeof k.length!="number"))throw new Error("socket.io:: replacer cannot JSON.stringify");return str("",{"":o})},JSON.parse=function(text,reviver){var j;function walk(o,k){var e,r,i=o[k];if(i&&typeof i=="object")for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&((r=walk(i,e))!==void 0?i[e]=r:delete i[e]);return reviver.call(o,k,i)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(o){return"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("socket.io:: reviver cannot JSON.parse")}}(io!==void 0?io:module.exports,typeof JSON<"u"?JSON:void 0),function(o,k){var e=o.parser={},r=e.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=e.reasons=["transport not supported","client not handshaken","unauthorized"],s=e.advice=["reconnect"],n=k.JSON,u=k.util.indexOf;e.encodePacket=function(d){var m=u(r,d.type),c=d.id||"",h=d.endpoint||"",a=d.ack,y=null;switch(d.type){case"error":var T=d.reason?u(i,d.reason):"",v=d.advice?u(s,d.advice):"";T===""&&v===""||(y=T+(v!==""?"+"+v:""));break;case"message":d.data!==""&&(y=d.data);break;case"event":var g={name:d.name};d.args&&d.args.length&&(g.args=d.args),y=n.stringify(g);break;case"json":y=n.stringify(d.data);break;case"connect":d.qs&&(y=d.qs);break;case"ack":y=d.ackId+(d.args&&d.args.length?"+"+n.stringify(d.args):"")}var b=[m,c+(a=="data"?"+":""),h];return y!=null&&b.push(y),b.join(":")},e.encodePayload=function(d){var m="";if(d.length==1)return d[0];for(var c=0,h=d.length;c<h;c++)m+="�"+d[c].length+"�"+d[c];return m};var p=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;e.decodePacket=function(d){if(!(h=d.match(p)))return{};var m=h[2]||"",c=(d=h[5]||"",{type:r[h[1]],endpoint:h[4]||""});switch(m&&(c.id=m,h[3]?c.ack="data":c.ack=!0),c.type){case"error":var h=d.split("+");c.reason=i[h[0]]||"",c.advice=s[h[1]]||"";break;case"message":c.data=d||"";break;case"event":try{var a=n.parse(d);c.name=a.name,c.args=a.args}catch{}c.args=c.args||[];break;case"json":try{c.data=n.parse(d)}catch{}break;case"connect":c.qs=d||"";break;case"ack":if((h=d.match(/^([0-9]+)(\+)?(.*)/))&&(c.ackId=h[1],c.args=[],h[3]))try{c.args=h[3]?n.parse(h[3]):[]}catch{}}return c},e.decodePayload=function(d){var m=function(v,g){for(var b=0,S=v;S<g.length;S++){if(g.charAt(S)=="�")return b;b++}return b};if(d.charAt(0)=="�"){for(var c=[],h=1,a="";h<d.length;h++)if(d.charAt(h)=="�"){var y=d.substr(h+1).substr(0,a);if(d.charAt(h+1+Number(a))!="�"&&h+1+Number(a)!=d.length){var T=Number(a);l=m(h+T+1,d),y=d.substr(h+1).substr(0,T+l),h+=l}c.push(e.decodePacket(y)),h+=Number(a)+1,a=""}else a+=d.charAt(h);return c}return[e.decodePacket(d)]}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(o,k){function e(r,i){this.socket=r,this.sessid=i}o.Transport=e,k.util.mixin(e,k.EventEmitter),e.prototype.heartbeats=function(){return!0},e.prototype.onData=function(r){if(this!==this.socket.transport)return this;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),r!==""){var i=k.parser.decodePayload(r);if(i&&i.length)for(var s=0,n=i.length;s<n;s++)this.onPacket(i[s])}return this},e.prototype.onPacket=function(r){return this.socket.setHeartbeatTimeout(),r.type=="heartbeat"?this.onHeartbeat():(r.type=="connect"&&r.endpoint==""&&this.onConnect(),r.type=="error"&&r.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(r),this)},e.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var r=this;this.closeTimeout=setTimeout(function(){r.socket&&r.socket.publish("info","socket disconnected by setCloseTimeout"),r.onDisconnect()},this.socket.closeTimeout)}},e.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket?(this.socket.transport===this?this.socket.onDisconnect():this.socket.setBuffer(!1),this):this},e.prototype.onConnect=function(){return this.socket.onConnect(),this},e.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},e.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},e.prototype.packet=function(r){this.send(k.parser.encodePacket(r))},e.prototype.onHeartbeat=function(r){this.packet({type:"heartbeat"})},e.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},e.prototype.onClose=function(){this.socket.publish("info","transport onClose"),this.isOpen=!1,this.socket.transport===this?this.socket.onClose():this.socket.setBuffer(!1),this.onDisconnect(),this.onDisconnectDone instanceof Function&&this.onDisconnectDone(null),this.onConnectionOver instanceof Function&&this.onConnectionOver(null)},e.prototype.onDisconnectDone=function(){},e.prototype.onConnectionOver=function(){},e.prototype.prepareUrl=function(){var r=this.socket.options;return this.scheme()+"://"+r.host+":"+r.port+"/"+r.resource+"/"+k.protocol+"/"+this.name+"/"+this.sessid},e.prototype.ready=function(r,i){i.call(this)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(o,k,e){function r(s){if(this.options={port:80,secure:!1,document:"document"in e&&document,resource:"socket.io",transports:s.transports||k.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,needToXHR:!0,manualFlush:!1},k.util.merge(this.options,s),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||k.util.ua.hasCORS)){var n=this;k.util.on(e,"beforeunload",function(){n.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}o.Socket=r,k.util.mixin(r,k.EventEmitter),r.prototype.of=function(s){return this.namespaces[s]||(this.namespaces[s]=new k.SocketNamespace(this,s),s!==""&&this.namespaces[s].packet({type:"connect"})),this.namespaces[s]},r.prototype.publish=function(){var s;for(var n in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(n)&&(s=this.of(n)).$emit.apply(s,arguments)},r.prototype.guid=function(){var s=root.crypto||root.msCrypto;if(s){var n=new Uint8Array(16);s.getRandomValues(n),n[6]&=15,n[6]|=64,n[8]&=63,n[8]|=128;for(var u="",p=0;p<n.length;p++){var d=n[p].toString(16);d.length===1&&(d="0"+d),u+=d}return u.substring(0,8)+"-"+u.substring(8,12)+"-"+u.substring(12,16)+"-"+u.substring(16,20)+"-"+u.substring(20)}},r.prototype.handshake=function(s){var n=this,u=this.options;if(!this.options.needToXHR&&this.options.transports.length===1&&this.options.transports[0]==="websocket"){var p=this.guid();if(p)return void setTimeout(function(){n.publish("info","xhr, skip and get:"+p),s.apply(null,[p,"90","60","websocket"])},0)}function d(y){y instanceof Error?(n.connecting=!1,n.publish("info","xhr, status:200, but got error:",y),n.onError("xhr, status:200, but got error:"+y.message,y)):s.apply(null,y.split(":"))}var m=["http"+(u.secure?"s":"")+":/",u.host+":"+u.port,u.resource,k.protocol,k.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!k.util.ua.hasCORS&&typeof document<"u"&&document){var c=document.getElementsByTagName("script")[0],h=document.createElement("script");h.src=m+"&jsonp="+k.j.length,h.onreadystatechange=function(){this.readyState=="loaded"&&h.parentNode&&(h.parentNode.removeChild(h),n.connecting=!1,n.publish("info","xhr, jsonp:Server down or port not open"),!n.reconnecting&&n.onError("Server down or port not open",new Error("xhr, jsonp:server down or port not open")),n.publish("handshake_failed"))},c.parentNode.insertBefore(h,c),k.j.push(function(y){d(y),h.parentNode.removeChild(h)})}else{var a=k.util.request();a.open("GET",m,!0),a.timeout=8e3,this.isXDomain()&&(a.withCredentials=!0),a.onreadystatechange=function(){n.publish("info","xhr, readyState:"+a.readyState+" status:"+a.status),a.readyState==4&&(n.publish("info","xhr, responseText:"+a.responseText),a.onreadystatechange=i,a.status==200?d(a.responseText):a.status==403?(n.connecting=!1,n.onError(a.responseText,new Error("xhr, status:403"+a.responseText)),n.publish("handshake_failed")):(n.connecting=!1,!n.reconnecting&&n.onError(a.responseText,new Error("xhr, status:"+a.status+" "+a.responseText)),n.publish("handshake_failed")))},a.ontimeout=function(y){n.publish("info","xhr, timeout"),n.connecting=!1,!n.reconnecting&&n.onError(a.responseText,new Error("xhr, timeout")),n.publish("handshake_failed")},a.send(null)}},r.prototype.connect=function(s){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(u,p,d,m){n.publish("info","SocketIO handshake parameter: sid: "+u+", transports: "+m+", close: "+d+", heartbeat: "+p),n.sessionid=u,n.closeTimeout=1e3*d,n.heartbeatTimeout=1e3*p,n.transports||(n.transports=n.origTransports=m?k.util.intersect(m.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),n.once("connect",function(){n.publish("info","tcp, clear connect timeout due to recv connect event"),clearTimeout(n.connectTimeoutTimer),n.connectTimeoutTimer=null,s&&typeof s=="function"&&s()}),n.doConnect()}),this},r.prototype.doConnect=function(){var s=this;if(s.transport&&s.transport.clearTimeouts(),s.transport=s.getTransport(s.transports),!s.transport)return s.publish("connect_failed");s.transport.ready(s,function(){s.connecting=!0,s.publish("info","tcp, connecting, transport ready in "+s.transport.name),s.publish("connecting",s.transport.name),s.transport.open(),s.options["connect timeout"]&&(s.connectTimeoutTimer&&clearTimeout(s.connectTimeoutTimer),s.publish("info","set new connect timeout"),s.connectTimeoutTimer=setTimeout(function(){s.publish("info","trigger connect timeout due to setTimeout"),s.transport.close(),s.tryNextTransport()},s.options["connect timeout"]))})},r.prototype.getTransport=function(s){const n=this;for(var u,p=s||this.transports,d=0;u=p[d];d++)if(n.publish("info","check transport: "+u),k.Transport[u]&&k.Transport[u].check(this)&&(!this.isXDomain()||k.Transport[u].xdomainCheck(this)))return n.publish("info","use transport: "+u),new k.Transport[u](this,this.sessionid);return null},r.prototype.tryNextTransport=function(){if(!this.connected&&(this.connecting=!1,this.options["try multiple transports"])){for(var s=this.transports;s.length>0&&s.splice(0,1)[0]!=this.transport.name;);s.length?this.doConnect():this.publish("connect_failed")}},r.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var s=this;this.heartbeatTimeoutTimer=setTimeout(function(){s.transport&&(s.publish("info","transport closed by setHeartbeatTimeout"),s.transport.onClose())},this.heartbeatTimeout)}},r.prototype.packet=function(s){return this.connected&&!this.doBuffer?this.transport.packet(s):this.buffer.push(s),this},r.prototype.setBuffer=function(s){this.doBuffer=s,!s&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},r.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.publish("info","socket disconnected by IM SDK"),this.onDisconnect("booted")),this},r.prototype.disconnectSync=function(){var s=k.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,k.protocol,"",this.sessionid].join("/")+"/?disconnect=1";s.open("GET",n,!1),s.send(null),this.publish("info","socket disconnected by disconnectSync before page unload"),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var s=e&&e.location||{},n=s.port||(s.protocol=="https:"?443:80);return this.options.host!==s.hostname||this.options.port!=n},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.publish("info","tcp, websocket onOpen"),this.open=!0},r.prototype.onClose=function(){this.publish("info","tcp, websocket onClose"),this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(s){this.of(s.endpoint).onPacket(s)},r.prototype.onError=function(s,n){s&&s.advice&&s.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",s&&s.reason?s.reason:s,n)},r.prototype.onDisconnect=function(s){var n=this.connected,u=this.connecting;this.publish("info",s?"tcp, onDisconnect reason:"+s:"tcp, onDisconnect"),this.connected=!1,this.connecting=!1,this.open=!1,(n||u)&&this.transport&&(this.transport.close(),this.transport.clearTimeouts(),n&&(this.publish("disconnect",s),s!="booted"&&this.options.reconnect&&!this.reconnecting&&this.reconnect()),u&&(this.connectTimeoutTimer&&(this.publish("info","clear connect timeout due to onDisconnect"),clearTimeout(this.connectTimeoutTimer)),this.tryNextTransport()))},r.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var s=this,n=this.options["max reconnection attempts"],u=this.options["try multiple transports"],p=this.options["reconnection limit"];function d(){if(s.connected){for(var c in s.namespaces)s.namespaces.hasOwnProperty(c)&&c!==""&&s.namespaces[c].packet({type:"connect"});s.publish("reconnect",s.transport.name,s.reconnectionAttempts)}clearTimeout(s.reconnectionTimer),s.removeListener("connect_failed",m),s.removeListener("connect",m),s.reconnecting=!1,delete s.reconnectionAttempts,delete s.reconnectionDelay,delete s.reconnectionTimer,delete s.redoTransports,s.options["try multiple transports"]=u}function m(){if(s.reconnecting)return s.connected?d():s.connecting&&s.reconnecting?s.reconnectionTimer=setTimeout(m,1e3):void(s.reconnectionAttempts++>=n?s.redoTransports?(s.publish("reconnect_failed"),d()):(s.on("connect_failed",m),s.options["try multiple transports"]=!0,s.transports=s.origTransports,s.transport=s.getTransport(),s.redoTransports=!0,s.connect()):(s.reconnectionDelay<p&&(s.reconnectionDelay*=2),s.connect(),s.publish("reconnecting",s.reconnectionDelay,s.reconnectionAttempts),s.reconnectionTimer=setTimeout(m,s.reconnectionDelay)))}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(m,this.reconnectionDelay),this.on("connect",m)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports,root),function(o,k){function e(i,s){this.socket=i,this.name=s||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(i,s){this.namespace=i,this.name=s}o.SocketNamespace=e,k.util.mixin(e,k.EventEmitter),e.prototype.$emit=k.EventEmitter.prototype.emit,e.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},e.prototype.packet=function(i){return i.endpoint=this.name,this.socket.packet(i),this.flags={},this},e.prototype.send=function(i,s){var n={type:this.flags.json?"json":"message",data:i};return typeof s=="function"&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=s),this.packet(n)},e.prototype.emit=function(i){var s=Array.prototype.slice.call(arguments,1),n=s[s.length-1],u={type:"event",name:i};return typeof n=="function"&&(u.id=++this.ackPackets,u.ack="data",this.acks[u.id]=n,s=s.slice(0,s.length-1)),u.args=s,this.packet(u)},e.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},e.prototype.onPacket=function(i){var s=this;function n(){s.packet({type:"ack",args:k.util.toArray(arguments),ackId:i.id})}switch(i.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?(this.socket.publish("info","socket disconnected by SocketNameSpace.onPacket"),this.socket.onDisconnect(i.reason||"booted")):this.$emit("disconnect",i.reason);break;case"message":case"json":var u=["message",i.data];i.ack=="data"?u.push(n):i.ack&&this.packet({type:"ack",ackId:i.id}),this.$emit.apply(this,u);break;case"event":u=[i.name].concat(i.args),i.ack=="data"&&u.push(n),this.$emit.apply(this,u);break;case"ack":this.acks[i.ackId]&&(this.acks[i.ackId].apply(this,i.args),delete this.acks[i.ackId]);break;case"error":this.socket.publish("info","packet, type:error",i),i.advice?this.socket.onError(i,new Error("packet, type:error and advice is "+i.advice)):i.reason==="unauthorized"?this.$emit("connect_failed",i.reason):this.$emit("error",i.reason,new Error("packet, type:error and reason is "+i.reason))}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(io!==void 0?io:module.exports,io!==void 0?io:module.parent.exports),function(o,k,e){function r(i){k.Transport.apply(this,arguments)}o.websocket=r,k.util.inherit(r,k.Transport),r.prototype.name="websocket",r.prototype.open=function(){var i,s=k.util.query(this.socket.options.query),n=this;return i||(i=e.MozWebSocket||e.WebSocket),this.websocket=new i(this.prepareUrl()+s),this.websocket.onopen=function(){n.onOpen(),n.socket.setBuffer(!1)},this.websocket.onmessage=function(u){n.onData(u.data)},this.websocket.onclose=function(){n.socket.setBuffer(!0),n.onClose()},this.websocket.onerror=function(u){var p="";u&&u.message?p=u.message:u.target&&(p=u.target.readyState?"websocket, readyState:"+u.target.readyState:"websocket event"),n.onError(p,u)},this},k.util.ua.iDevice?r.prototype.send=function(i){var s=this;return setTimeout(function(){s.websocket.send(i)},0),this}:r.prototype.send=function(i){return this.websocket.send(i),this},r.prototype.payload=function(i){for(var s=0,n=i.length;s<n;s++)this.packet(i[s]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(i,s){this.socket.publish("info","tcp, onError",i,s),this.socket.onError(i,s)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in e&&!("__addTask"in WebSocket)||"MozWebSocket"in e},r.xdomainCheck=function(){return!0},k.transports.push("websocket")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,root),function(o,k,e){function r(s){s&&(k.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}o.XHR=r,k.util.inherit(r,k.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(s){for(var n=[],u=0,p=s.length;u<p;u++)n.push(k.parser.encodePacket(s[u]));this.send(k.parser.encodePayload(n))},r.prototype.send=function(s){return this.post(s),this},r.prototype.post=function(s){var n=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),e.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,n.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){this.readyState==4&&(this.onreadystatechange=i,n.posting=!1,this.status==200?n.socket.setBuffer(!1):n.onClose())},this.sendXHR.send(s)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(s){var n=k.util.request(this.socket.isXDomain()),u=k.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(s||"GET",this.prepareUrl()+u,!0),s=="POST")try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch{}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(s,n){try{var u=k.util.request(n),p=e.XDomainRequest&&u instanceof XDomainRequest,d=s&&s.options&&s.options.secure?"https:":"http:",m=e.location&&d!=e.location.protocol;if(u&&(!p||!m))return!0}catch{}return!1},r.xdomainCheck=function(s){return r.check(s,!0)}}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,root),function(o,k,e){function r(){k.Transport.XHR.apply(this,arguments)}function i(){}o["xhr-polling"]=r,k.util.inherit(r,k.Transport.XHR),k.util.merge(r,k.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.heartbeats=function(){return!1},r.prototype.open=function(){return k.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpen){var s=this;this.xhr=this.request(),e.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){this.onload=i,this.onerror=i,s.retryCounter=1,s.onData(this.responseText),s.get()},this.xhr.onerror=function(){s.retryCounter++,!s.retryCounter||s.retryCounter>3?s.onClose():s.get()}):this.xhr.onreadystatechange=function(){this.readyState==4&&(this.onreadystatechange=i,this.status==200?(s.onData(this.responseText),s.get()):s.onClose())},this.xhr.send(null)}},r.prototype.onClose=function(){if(k.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch{}this.xhr=null}},r.prototype.ready=function(s,n){var u=this;k.util.defer(function(){n.call(u)})},k.transports.push("xhr-polling")}(io!==void 0?io.Transport:module.exports,io!==void 0?io:module.parent.exports,root),__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return io}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__===void 0||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(70),__webpack_require__(145)(module))},function(o,k){o.exports=function(e){var r=-1,i=Array(e.size);return e.forEach(function(s){i[++r]=s}),i}},function(o,k,e){var r,i=e(25),s=e(44),n=e(13),u=e(74),p=e(683),d=e(690),m={initReporter:function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h={app_key:c.appKey,platform:"Web",dev_id:s.deviceId,sdk_ver:n.info.version,env:"online",os_name:u.os?u.os.family:"",os_ver:u.os?u.os.version:"",model:u.version,manufactor:n.hostEnv,host_env:n.hostEnv,host_info:u.ua,host_env_ver:u.version};n.isBrowser||(c.isDataReportEnable=!1);var a=new p({isDataReportEnable:c.isDataReportEnable,reportConfigUrl:c.reportConfigUrl,reportUrl:c.reportUrl,common:h,request:d,logger:c.logger,autoStart:n.isBrowser});return a}};m.sendBeacon=navigator&&navigator.sendBeacon&&i(r=navigator.sendBeacon).call(r,navigator)||function(c,h){var a=new XMLHttpRequest;a.open("POST",c,!0),a.send(h)},o.exports=m},function(o,k,e){o.exports=e(684)},function(o,k,e){var r=e(1),i=e(14);r({global:!0,forced:i.globalThis!==i},{globalThis:i})},function(o,k,e){var r=e(1),i=e(11),s=e(112),n=e(28),u=e(29),p=e(38).f,d=e(131),m=e(165),c=e(701),h=e(127),a=e(703),y=!1,T=h("meta"),v=0,g=function(S){p(S,T,{value:{objectID:"O"+v++,weakData:{}}})},b=o.exports={enable:function(){b.enable=function(){},y=!0;var S=d.f,O=i([].splice),I={};I[T]=1,S(I).length&&(d.f=function(R){for(var N=S(R),F=0,P=N.length;F<P;F++)if(N[F]===T){O(N,F,1);break}return N},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:m.f}))},fastKey:function(S,O){if(!n(S))return typeof S=="symbol"?S:(typeof S=="string"?"S":"P")+S;if(!u(S,T)){if(!c(S))return"F";if(!O)return"E";g(S)}return S[T].objectID},getWeakData:function(S,O){if(!u(S,T)){if(!c(S))return!0;if(!O)return!1;g(S)}return S[T].weakData},onFreeze:function(S){return a&&y&&c(S)&&!u(S,T)&&g(S),S}};s[T]=!0},function(o,k,e){var r=e(19),i=e(31),s=e(16),n=e(36),u=TypeError;o.exports=function(p,d){var m,c=n(this),h=i(c.get),a=i(c.has),y=i(c.set),T=arguments.length>2?arguments[2]:void 0;if(!s(d)&&!s(T))throw u("At least one callback required");return r(a,c,p)?(m=r(h,c,p),s(d)&&(m=d(m),r(y,c,p,m))):s(T)&&(m=T(),r(y,c,p,m)),m}},function(o,k,e){o.exports=e(733)},function(o,k,e){var r=e(5);e(44);function i(){}i.typeMap={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,g2:12,custom:100};var s=i.typeReverseMap={0:"text",1:"image",2:"audio",3:"video",4:"geo",5:"notification",6:"file",10:"tip",11:"robot",12:"g2",100:"custom"};i.validTypes=r(i.typeMap),i.setFlow=function(n,u){n.flow=n.from===u?n.to===u?"in":"out":"in",n.type==="robot"&&n.content&&n.content.msgOut&&(n.flow="in")},i.getType=function(n){var u=n.type;return s[u]||u},o.exports=i},function(o,k,e){o.exports=function(r,i,s,n){var u=self||window;try{try{var p;try{p=new u.Blob([r])}catch{(p=new(u.BlobBuilder||u.WebKitBlobBuilder||u.MozBlobBuilder||u.MSBlobBuilder)).append(r),p=p.getBlob()}var d=u.URL||u.webkitURL,m=d.createObjectURL(p),c=new u[i](m,s);return d.revokeObjectURL(m),c}catch{return new u[i]("data:application/javascript,".concat(encodeURIComponent(r)),s)}}catch{if(!n)throw Error("Inline worker is not supported");return new u[i](n,s)}}},function(o,k,e){e(13).isBrowser=!0},function(o,k,e){var r=e(371);o.exports=r},function(o,k,e){var r=e(465);o.exports=r},function(o,k){var e=/^(?:0|[1-9]\d*)$/;o.exports=function(r,i){var s=typeof r;return!!(i=i??9007199254740991)&&(s=="number"||s!="symbol"&&e.test(r))&&r>-1&&r%1==0&&r<i}},function(o,k,e){o.exports=e(553)},function(o,k,e){(function(r){var i,s=e(26),n=e(3),u=e(123),p=e(15),d=e(32),m=e(2),c=e(47),h=e(7),a=e(5),y=e(17);(function(T,v){var g,b=(T=T!==void 0?T:typeof self<"u"?self:r!==void 0?r:{}).IDBKeyRange||T.webkitIDBKeyRange,S="readonly",O="readwrite",I=Object.prototype.hasOwnProperty,R=function(){if(!g&&!(g=T.indexedDB||T.webkitIndexedDB||T.mozIndexedDB||T.oIndexedDB||T.msIndexedDB||(T.indexedDB===null&&T.shimIndexedDB?T.shimIndexedDB:void 0)))throw"IndexedDB required";return g},N=!1,F=navigator&&!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent),P=function(X){return X},x=function(X){var Y;return p(Y=Object.prototype.toString.call(X)).call(Y,8,-1).toLowerCase()},L=function(X){return typeof X=="function"},_=function(X){return x(X)==="number"},C=function(X){return x(X)==="array"},A=function(X){return X===void 0},M=function(X,Y){var W=this,ee=!1;this.name=Y,this.getIndexedDB=function(){return X},this.add=function(V){if(ee)throw"Database has been closed";for(var D=[],Q=0,G=0;G<arguments.length-1;G++)if(d(arguments[G+1]))for(var B=0;B<arguments[G+1].length;B++)D[Q]=arguments[G+1][B],Q++;else D[Q]=arguments[G+1],Q++;var q=X.transaction(V,O),H=q.objectStore(V);return new n(function(K,Z){m(D).call(D,function(te){var ne;if(te.item&&te.key){var re=te.key;te=te.item,ne=H.add(te,re)}else ne=H.add(te);ne.onsuccess=function(se){var oe=se.target,ae=oe.source.keyPath;ae===null&&(ae="__id__"),c(te,ae,{value:oe.result,enumerable:!0})}}),q.oncomplete=function(){K(D,W)},q.onerror=function(te){te.preventDefault(),Z(te)},q.onabort=function(te){Z(te)}})},this.updateAndDelete=function(V,D,Q){if(ee)throw"Database has been closed";var G=X.transaction(V,O),B=G.objectStore(V),q=B.keyPath;return new n(function(H,K){m(D).call(D,function(Z){if(Z.item&&Z.key){var te=Z.key;Z=Z.item,B.put(Z,te)}else B.put(Z)}),m(Q).call(Q,function(Z){B.delete(Z[q])}),G.oncomplete=function(){H([D,Q])},G.onerror=function(Z){K(Z)}})},this.update=function(V){if(ee)throw"Database has been closed";for(var D,Q=[],G=1;G<arguments.length;G++)d(D=arguments[G])?Q=h(Q).call(Q,D):Q.push(D);var B=X.transaction(V,O),q=B.objectStore(V);return q.keyPath,new n(function(H,K){m(Q).call(Q,function(Z){var te;if(Z.item&&Z.key){var ne=Z.key;Z=Z.item,te=q.put(Z,ne)}else te=q.put(Z);te.onsuccess=function(re){},te.onerror=function(re){}}),B.oncomplete=function(){H(Q,W)},B.onerror=function(Z){K(Z)},B.onabort=function(Z){K(Z)}})},this.remove=function(V,D,Q,G,B,q,H){if(ee)throw"Database has been closed";var K=X.transaction(V,O),Z=K.objectStore(V);return new n(function(te,ne){function re(oe){return oe==null}var se;re(G)&&(G=-1/0),re(B)&&(B=1/0),D===null||d(D)||(D=[D]),re(Q)?D!==null?m(D).call(D,function(oe){Z.delete(oe)}):Z.delete(range=b.bound(G,B,q,H)):(se=D!==null?b.only(D[0]):b.bound(G,B,q,H),Z.index(Q).openCursor(se).onsuccess=function(oe){var ae=oe.target.result;ae&&(ae.delete(),ae.continue())}),K.oncomplete=function(){te()},K.onerror=function(oe){ne(oe)},K.onabort=function(oe){ne(oe)}})},this.clear=function(V){if(ee)throw"Database has been closed";var D=X.transaction(V,O);return D.objectStore(V).clear(),new n(function(Q,G){D.oncomplete=function(){Q()},D.onerror=function(B){G(B)}})},this.close=function(){ee||(X.close(),ee=!0,delete z[Y])},this.get=function(V,D){if(ee)throw"Database has been closed";var Q=X.transaction(V),G=Q.objectStore(V).get(D);return new n(function(B,q){G.onsuccess=function(H){B(H.target.result)},Q.onerror=function(H){q(H)}})},this.query=function(V,D){if(ee)throw"Database has been closed";return new U(V,X,D)},this.count=function(V,D){if(ee)throw"Database has been closed";X.transaction(V).objectStore(V)};for(var w=0,J=X.objectStoreNames.length;w<J;w++)(function(V){for(var D in W[V]={},W)I.call(W,D)&&D!=="close"&&(W[V][D]=function(Q){return function(){var G,B=h(G=[V]).call(G,p([]).call(arguments,0));return W[Q].apply(W,B)}}(D))})(X.objectStoreNames[w])},U=function(X,Y,W){var ee,w=this,J=!1,V=!1,D=function(G,B,q,H,K,Z,te){return new n(function(ne,re){var se=J||V?O:S,oe=Y.transaction(X,se),ae=oe.objectStore(X),pe=W?ae.index(W):ae,ge=G?b[G].apply(null,B):null,fe=[],ie=[ge],me=0;K=K||null,Z=Z||[],q!=="count"&&ie.push(H||"next");var ye=!!J&&a(J);pe[q].apply(pe,ie).onsuccess=function(de){var ue=de.target.result;if(s(ue)===s(0))fe=ue;else if(ue){if(K!==null&&K[0]>me)me=K[0],ue.advance(K[0]);else if(!(K!==null&&me>=K[0]+K[1])){var ce=!0,ve="value"in ue?ue.value:ue.key;m(Z).call(Z,function(be){be&&be.length&&(be.length===2?ce=ce&&ve[be[0]]===be[1]:L(be[0])&&(ce=ce&&be[0].apply(void 0,[ve])))}),ce&&(me++,fe.push(te(ve)),V?ue.delete():J&&(ve=function(be){for(var xe=0;xe<ye.length;xe++){var Le=ye[xe],De=J[Le];De instanceof Function&&(De=De(be)),be[Le]=De}return be}(ve),ue.update(ve))),ue.continue()}}},oe.oncomplete=function(){ne(fe)},oe.onerror=function(de){re(de)},oe.onabort=function(de){re(de)}})},Q=function(G,B){var q="next",H="openCursor",K=[],Z=null,te=P,ne=!1,re=function(){return D(G,B,H,ne?q+"unique":q,Z,K,te)},se=function(){return q=null,H="count",{execute:re}},oe=function ue(){return(Z=C(arguments[0])?arguments[0]:p(Array.prototype).call(arguments,0,2)).length==1&&Z.unshift(0),_(Z[1])||(Z=null),{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:fe,distinct:ie,modify:me,limit:ue,map:ye,remove:de}},ae=function ue(ce){return(ce=!!A(ce)||!!ce)&&(H="openKeyCursor"),{execute:re,keys:ue,filter:pe,asc:ge,desc:fe,distinct:ie,modify:me,limit:oe,map:ye,remove:de}},pe=function ue(){return K.push(p(Array.prototype).call(arguments,0,2)),{execute:re,count:se,keys:ae,filter:ue,asc:ge,desc:fe,distinct:ie,modify:me,limit:oe,map:ye,remove:de}},ge=function ue(ce){return ce=!!A(ce)||!!ce,q=ce?"next":"prev",{execute:re,count:se,keys:ae,filter:pe,asc:ue,desc:fe,distinct:ie,modify:me,limit:oe,map:ye,remove:de}},fe=function ue(ce){return ce=!!A(ce)||!!ce,q=ce?"prev":"next",{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:ue,distinct:ie,modify:me,limit:oe,map:ye,remove:de}},ie=function ue(ce){return ce=!!A(ce)||!!ce,ne=ce,{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:fe,distinct:ue,modify:me,limit:oe,map:ye,remove:de}},me=function ue(ce){return J=ce,{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:fe,distinct:ie,modify:ue,limit:oe,map:ye,remove:de}},ye=function ue(ce){return L(ce)&&(te=ce),{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:fe,distinct:ie,modify:me,limit:oe,map:ue,remove:de}},de=function ue(ce){return ce=!!A(ce)||!!ce,V=ce,{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:fe,distinct:ie,modify:me,limit:oe,map:ye,remove:ue}};return{execute:re,count:se,keys:ae,filter:pe,asc:ge,desc:fe,distinct:ie,modify:me,limit:oe,map:ye,remove:de}};m(ee="only bound upperBound lowerBound".split(" ")).call(ee,function(G){w[G]=function(){return new Q(G,arguments)}}),this.filter=function(){var G=new Q(null,null);return y(G).apply(G,arguments)},this.all=function(){var G;return y(G=this).call(G)}},E=function(X,Y,W,ee){var w=X.target.result,J=new M(w,Y);return z[Y]=w,n.resolve(J)},z={},$={version:"0.10.2",open:function(X){var Y;return new n(function(W,ee){var w;z[X.server]?E({target:{result:z[X.server]}},X.server,X.version,X.schema).then(W,ee):(N?n.resolve():F&&R().databases?new n(function(J){var V=function(){return R().databases().finally(J)};w=u(V,100),V()}).finally(function(){N=!0,clearInterval(w)}):(N=!0,n.resolve())).then(function(){try{Y=R().open(X.server,X.version)}catch(J){ee(J)}Y.onsuccess=function(J){E(J,X.server,X.version,X.schema).then(W,ee)},Y.onupgradeneeded=function(J){(function(V,D,Q){for(var G in typeof D=="function"&&(D=D()),D){var B,q=D[G];for(var H in B=!I.call(D,G)||Q.objectStoreNames.contains(G)?V.currentTarget.transaction.objectStore(G):Q.createObjectStore(G,q.key),q.indexes){var K=q.indexes[H];try{B.index(H)}catch{B.createIndex(H,K.key||H,a(K).length?K:{unique:!1})}}}})(J,X.schema,J.target.result)},Y.onerror=function(J){ee(J)}})})},remove:function(X){return new n(function(Y,W){if(!X)return Y();var ee,w;s(X)===M&&(X=X.name),typeof X=="string"&&(ee=z[X]),ee&&typeof ee.close=="function"&&ee.close();try{w=R().deleteDatabase(X)}catch(J){W(J)}w.onsuccess=function(J){delete z[X],Y(X)},w.onerror=function(J){W(J)},w.onblocked=function(J){W(J)}})}};o.exports!==void 0?o.exports=$:(i=function(){return $}.call(k,e,k,o))===void 0||(o.exports=i)})(void 0)}).call(this,e(70))},function(o,k,e){var r=e(584);o.exports=r},function(o,k,e){o.exports=e(637)},function(o,k){var e={set:function(r,i,s){e[r]=i,s&&(s.support=i)}};o.exports=e},function(o,k,e){var r=e(5),i=e(2),s=e(25),n=e(0),u=n.notundef,p=n.fillPropertyWithDefault,d=r,m={},c={},h={},a=[],y={normal:0,advanced:1},T={manager:0,all:1};m.inviteMode=m.updateCustomMode=m.updateTeamMode=T;var v={0:"normal",1:"advanced"},g=m.joinMode={noVerify:0,needVerify:1,rejectAll:2};c.joinMode={0:"noVerify",1:"needVerify",2:"rejectAll"},h.joinMode=d(g),a.push("join");var b=m.beInviteMode={needVerify:0,noVerify:1};function S(I){var R;n.verifyOptions(I,"action","superTeam::SuperTeam"),n.verifyOptions(I,"teamId","superTeam::SuperTeam"),u(I.teamId)&&(this.teamId=I.teamId),u(I.type)&&(this.type=y[I.type]),u(I.avatar)&&(this.avatar=""+I.avatar),u(I.name)&&(this.name=""+I.name),u(I.intro)&&(this.intro=""+I.intro),u(I.announcement)&&(this.announcement=""+I.announcement),u(I.custom)&&(this.custom=""+I.custom),u(I.inviteMode)&&(this.inviteMode=T[I.inviteMode]),u(I.updateCustomMode)&&(this.updateCustomMode=T[I.updateCustomMode]),u(I.updateTeamMode)&&(this.updateTeamMode=T[I.updateTeamMode]),i(a).call(a,s(R=this.setMode).call(R,this,I))}function O(I,R){u(I[R+="Mode"])&&(I[R]=c[R][I[R]])}c.beInviteMode={0:"needVerify",1:"noVerify"},a.push("beInvite"),c.inviteMode=c.updateCustomMode=c.updateTeamMode={0:"manager",1:"all"},a.push("invite"),a.push("updateCustom"),a.push("updateTeam"),h.inviteMode=h.updateCustomMode=h.updateTeamMode=d(T),h.beInviteMode=d(b),S.prototype.setMode=function(I,R){u(I[R+="Mode"])&&(n.verifyParamValid(R,I[R],h[R],"Superteam::Team"),this[R]=m[R][I[R]])},S.reverse=function(I,R){var N=n.copy(I);if(u(N.teamId)&&(N.teamId=""+N.teamId),u(N.type)&&(N.type=v[N.type]),u(N.level)&&(N.level=+N.level),u(N.valid)&&(N.valid=+N.valid==1),u(N.memberNum)&&(N.memberNum=+N.memberNum),u(N.memberUpdateTime)&&(N.memberUpdateTime=+N.memberUpdateTime),u(N.createTime)&&(N.createTime=+N.createTime),u(N.updateTime)&&(N.updateTime=+N.updateTime),u(N.validToCurrentUser)&&(N.validToCurrentUser=N.validToCurrentUser==="1"),u(N.mute)&&(N.mute=N.mute==="1"),u(N.muteType))switch(N.muteType){case"0":N.mute=!1,N.muteType="none";break;case"1":N.mute=!0,N.muteType="normal";break;case"3":N.mute=!0,N.muteType="all"}else u(N.mute)&&(N.mute===1?(N.mute=!0,N.muteType="normal"):(N.mute=!1,N.muteType="none"));return i(a).call(a,s(O).call(O,null,N)),delete N.bits,R||S.fillProperties(N),N},S.fillProperties=function(I){return p(I,"avatar","")},o.exports=S},function(o,k,e){o.exports=e(659)},function(o,k,e){var r=e(0).notundef;function i(s){r(s.shouldPushNotificationWhenPCOnline)&&(this.open=s.shouldPushNotificationWhenPCOnline?2:1)}i.getDefaultConfig=function(){return{shouldPushNotificationWhenPCOnline:!0}},i.reverse=function(s){return{shouldPushNotificationWhenPCOnline:+s.open!=1}},o.exports=i},function(o,k,e){var r=e(74),i=e(753),s=e(288),n=e(255),u=e(198),p=e(0),d=e(306),m=e(284),c=e(184),h=e(758),a=e(759);o.exports=function(y){p.merge(y,{platform:r,xhr:i,io:s,naturalSort:n,deepAccess:u,util:p,support:d,blob:m,ajax:c,LoggerPlugin:h,usePlugin:a})}},function(o,k,e){var r=e(8),i=e(9),s=e(5),n=e(106).genPrivateUrl,u=e(0),p=u.notundef,d={"-2":"unset","-1":"restricted",0:"common",1:"owner",2:"manager",3:"guest",4:"anonymous"};function m(c){p(c.nick)&&(this.nick=""+c.nick),p(c.avatar)&&(this.avatar=""+c.avatar),p(c.custom)&&(this.custom=""+c.custom)}m.reverse=function(c){var h=u.copy(c);return p(h.chatroomId)&&(h.chatroomId=""+h.chatroomId),p(h.avatar)&&(h.avatar=n(h.avatar)),p(h.type)&&(h.type=d[h.type]),p(h.level)&&(h.level=+h.level),p(h.online)&&(h.online=+h.online==1),p(h.enterTime)&&(h.enterTime=+h.enterTime),p(h.guest)&&(h.guest=+h.guest==1),p(h.blacked)&&(h.blacked=+h.blacked==1),p(h.gaged)&&(h.gaged=+h.gaged==1),p(h.valid)&&(h.valid=+h.valid==1),p(h.updateTime)&&(h.updateTime=+h.updateTime),p(h.tempMuted)?h.tempMuted=+h.tempMuted==1:h.tempMuted=!1,p(h.tempMuteDuration)?h.tempMuteDuration=+h.tempMuteDuration:h.tempMuteDuration=0,h.online||delete h.enterTime,h.guest&&(h.type="guest",delete h.valid),h.type!=="common"&&delete h.level,delete h.guest,h},m.reverseMembers=function(c){return r(c).call(c,function(h){return i(m).call(m,h)})},m.validTypes=s(d),m.typeReverseMap=d,o.exports=m},function(o,k,e){var r,i,s,n,u,p,d,m,c,h,a,y,T,v,g,b,S,O,I;o.exports=(r=e(89),e(762),void(r.lib.Cipher||(i=r,s=i.lib,n=s.Base,u=s.WordArray,p=s.BufferedBlockAlgorithm,d=i.enc,d.Utf8,m=d.Base64,c=i.algo.EvpKDF,h=s.Cipher=p.extend({cfg:n.extend(),createEncryptor:function(R,N){return this.create(this._ENC_XFORM_MODE,R,N)},createDecryptor:function(R,N){return this.create(this._DEC_XFORM_MODE,R,N)},init:function(R,N,F){this.cfg=this.cfg.extend(F),this._xformMode=R,this._key=N,this.reset()},reset:function(){p.reset.call(this),this._doReset()},process:function(R){return this._append(R),this._process()},finalize:function(R){return R&&this._append(R),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function R(N){return typeof N=="string"?I:S}return function(N){return{encrypt:function(F,P,x){return R(P).encrypt(N,F,P,x)},decrypt:function(F,P,x){return R(P).decrypt(N,F,P,x)}}}}()}),s.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),a=i.mode={},y=s.BlockCipherMode=n.extend({createEncryptor:function(R,N){return this.Encryptor.create(R,N)},createDecryptor:function(R,N){return this.Decryptor.create(R,N)},init:function(R,N){this._cipher=R,this._iv=N}}),T=a.CBC=function(){var R=y.extend();function N(F,P,x){var L,_=this._iv;_?(L=_,this._iv=void 0):L=this._prevBlock;for(var C=0;C<x;C++)F[P+C]^=L[C]}return R.Encryptor=R.extend({processBlock:function(F,P){var x=this._cipher,L=x.blockSize;N.call(this,F,P,L),x.encryptBlock(F,P),this._prevBlock=F.slice(P,P+L)}}),R.Decryptor=R.extend({processBlock:function(F,P){var x=this._cipher,L=x.blockSize,_=F.slice(P,P+L);x.decryptBlock(F,P),N.call(this,F,P,L),this._prevBlock=_}}),R}(),v=(i.pad={}).Pkcs7={pad:function(R,N){for(var F=4*N,P=F-R.sigBytes%F,x=P<<24|P<<16|P<<8|P,L=[],_=0;_<P;_+=4)L.push(x);var C=u.create(L,P);R.concat(C)},unpad:function(R){var N=255&R.words[R.sigBytes-1>>>2];R.sigBytes-=N}},s.BlockCipher=h.extend({cfg:h.cfg.extend({mode:T,padding:v}),reset:function(){var R;h.reset.call(this);var N=this.cfg,F=N.iv,P=N.mode;this._xformMode==this._ENC_XFORM_MODE?R=P.createEncryptor:(R=P.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==R?this._mode.init(this,F&&F.words):(this._mode=R.call(P,this,F&&F.words),this._mode.__creator=R)},_doProcessBlock:function(R,N){this._mode.processBlock(R,N)},_doFinalize:function(){var R,N=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(N.pad(this._data,this.blockSize),R=this._process(!0)):(R=this._process(!0),N.unpad(R)),R},blockSize:4}),g=s.CipherParams=n.extend({init:function(R){this.mixIn(R)},toString:function(R){return(R||this.formatter).stringify(this)}}),b=(i.format={}).OpenSSL={stringify:function(R){var N=R.ciphertext,F=R.salt;return(F?u.create([1398893684,1701076831]).concat(F).concat(N):N).toString(m)},parse:function(R){var N,F=m.parse(R),P=F.words;return P[0]==1398893684&&P[1]==1701076831&&(N=u.create(P.slice(2,4)),P.splice(0,4),F.sigBytes-=16),g.create({ciphertext:F,salt:N})}},S=s.SerializableCipher=n.extend({cfg:n.extend({format:b}),encrypt:function(R,N,F,P){P=this.cfg.extend(P);var x=R.createEncryptor(F,P),L=x.finalize(N),_=x.cfg;return g.create({ciphertext:L,key:F,iv:_.iv,algorithm:R,mode:_.mode,padding:_.padding,blockSize:R.blockSize,formatter:P.format})},decrypt:function(R,N,F,P){return P=this.cfg.extend(P),N=this._parse(N,P.format),R.createDecryptor(F,P).finalize(N.ciphertext)},_parse:function(R,N){return typeof R=="string"?N.parse(R,this):R}}),O=(i.kdf={}).OpenSSL={execute:function(R,N,F,P){P||(P=u.random(8));var x=c.create({keySize:N+F}).compute(R,P),L=u.create(x.words.slice(N),4*F);return x.sigBytes=4*N,g.create({key:x,iv:L,salt:P})}},I=s.PasswordBasedCipher=S.extend({cfg:S.cfg.extend({kdf:O}),encrypt:function(R,N,F,P){var x=(P=this.cfg.extend(P)).kdf.execute(F,R.keySize,R.ivSize);P.iv=x.iv;var L=S.encrypt.call(this,R,N,x.key,P);return L.mixIn(x),L},decrypt:function(R,N,F,P){P=this.cfg.extend(P),N=this._parse(N,P.format);var x=P.kdf.execute(F,R.keySize,R.ivSize,N.salt);return P.iv=x.iv,S.decrypt.call(this,R,N,x.key,P)}}))))},function(o,k,e){o.exports=e(283)},function(o,k,e){var r=e(21),i=e(315),s=Array.prototype;o.exports=function(n){var u=n.indexOf;return n===s||r(s,n)&&u===s.indexOf?i:u}},function(o,k,e){e(316);var r=e(30);o.exports=r("Array").indexOf},function(o,k,e){var r=e(1),i=e(156),s=e(160).indexOf,n=e(94),u=i([].indexOf),p=!!u&&1/u([1],1,-0)<0,d=n("indexOf");r({target:"Array",proto:!0,forced:p||!d},{indexOf:function(m){var c=arguments.length>1?arguments[1]:void 0;return p?u(this,m,c)||0:s(this,m,c)}})},function(o,k,e){var r=e(19),i=e(28),s=e(126),n=e(157),u=e(318),p=e(20),d=TypeError,m=p("toPrimitive");o.exports=function(c,h){if(!i(c)||s(c))return c;var a,y=n(c,m);if(y){if(h===void 0&&(h="default"),a=r(y,c,h),!i(a)||s(a))return a;throw d("Can't convert object to primitive value")}return h===void 0&&(h="number"),u(c,h)}},function(o,k,e){var r=e(19),i=e(16),s=e(28),n=TypeError;o.exports=function(u,p){var d,m;if(p==="string"&&i(d=u.toString)&&!s(m=r(d,u))||i(d=u.valueOf)&&!s(m=r(d,u))||p!=="string"&&i(d=u.toString)&&!s(m=r(d,u)))return m;throw n("Can't convert object to primitive value")}},function(o,k,e){var r=e(14),i=Object.defineProperty;o.exports=function(s,n){try{i(r,s,{value:n,configurable:!0,writable:!0})}catch{r[s]=n}return n}},function(o,k){var e=Math.ceil,r=Math.floor;o.exports=Math.trunc||function(i){var s=+i;return(s>0?r:e)(s)}},function(o,k,e){var r=e(110),i=Math.min;o.exports=function(s){return s>0?i(r(s),9007199254740991):0}},function(o,k,e){var r=e(323);o.exports=r},function(o,k,e){var r=e(21),i=e(324),s=Array.prototype;o.exports=function(n){var u=n.concat;return n===s||r(s,n)&&u===s.concat?i:u}},function(o,k,e){e(212);var r=e(30);o.exports=r("Array").concat},function(o,k,e){var r=e(79),i=e(129),s=e(28),n=e(20)("species"),u=Array;o.exports=function(p){var d;return r(p)&&(d=p.constructor,(i(d)&&(d===u||r(d.prototype))||s(d)&&(d=d[n])===null)&&(d=void 0)),d===void 0?u:d}},function(o,k,e){e(327);var r=e(12).Object;o.exports=function(i,s){return r.create(i,s)}},function(o,k,e){e(1)({target:"Object",stat:!0,sham:!e(27)},{create:e(80)})},function(o,k,e){o.exports=e(329)},function(o,k,e){var r=e(330);e(357),e(358),e(359),e(360),e(361),e(362),e(363),o.exports=r},function(o,k,e){var r=e(218);e(356),o.exports=r},function(o,k,e){e(212),e(96),e(219),e(338),e(339),e(340),e(341),e(224),e(342),e(343),e(344),e(345),e(346),e(347),e(225),e(348),e(349),e(350),e(351),e(352);var r=e(12);o.exports=r.Symbol},function(o,k,e){var r=e(1),i=e(14),s=e(19),n=e(11),u=e(48),p=e(27),d=e(92),m=e(4),c=e(29),h=e(21),a=e(36),y=e(43),T=e(125),v=e(49),g=e(77),b=e(80),S=e(118),O=e(131),I=e(165),R=e(132),N=e(90),F=e(38),P=e(163),x=e(148),L=e(65),_=e(109),C=e(130),A=e(112),M=e(127),U=e(20),E=e(133),z=e(22),$=e(221),X=e(81),Y=e(97),W=e(84).forEach,ee=C("hidden"),w=Y.set,J=Y.getterFor("Symbol"),V=Object.prototype,D=i.Symbol,Q=D&&D.prototype,G=i.TypeError,B=i.QObject,q=N.f,H=F.f,K=I.f,Z=x.f,te=n([].push),ne=_("symbols"),re=_("op-symbols"),se=_("wks"),oe=!B||!B.prototype||!B.prototype.findChild,ae=p&&m(function(){return b(H({},"a",{get:function(){return H(this,"a",{value:7}).a}})).a!=7})?function(ue,ce,ve){var be=q(V,ce);be&&delete V[ce],H(ue,ce,ve),be&&ue!==V&&H(V,ce,be)}:H,pe=function(ue,ce){var ve=ne[ue]=b(Q);return w(ve,{type:"Symbol",tag:ue,description:ce}),p||(ve.description=ce),ve},ge=function(ue,ce,ve){ue===V&&ge(re,ce,ve),a(ue);var be=T(ce);return a(ve),c(ne,be)?(ve.enumerable?(c(ue,ee)&&ue[ee][be]&&(ue[ee][be]=!1),ve=b(ve,{enumerable:g(0,!1)})):(c(ue,ee)||H(ue,ee,g(1,{})),ue[ee][be]=!0),ae(ue,be,ve)):H(ue,be,ve)},fe=function(ue,ce){a(ue);var ve=y(ce),be=S(ve).concat(de(ve));return W(be,function(xe){p&&!s(ie,ve,xe)||ge(ue,xe,ve[xe])}),ue},ie=function(ue){var ce=T(ue),ve=s(Z,this,ce);return!(this===V&&c(ne,ce)&&!c(re,ce))&&(!(ve||!c(this,ce)||!c(ne,ce)||c(this,ee)&&this[ee][ce])||ve)},me=function(ue,ce){var ve=y(ue),be=T(ce);if(ve!==V||!c(ne,be)||c(re,be)){var xe=q(ve,be);return!xe||!c(ne,be)||c(ve,ee)&&ve[ee][be]||(xe.enumerable=!0),xe}},ye=function(ue){var ce=K(y(ue)),ve=[];return W(ce,function(be){c(ne,be)||c(A,be)||te(ve,be)}),ve},de=function(ue){var ce=ue===V,ve=K(ce?re:y(ue)),be=[];return W(ve,function(xe){!c(ne,xe)||ce&&!c(V,xe)||te(be,ne[xe])}),be};d||(L(Q=(D=function(){if(h(Q,this))throw G("Symbol is not a constructor");var ue=arguments.length&&arguments[0]!==void 0?v(arguments[0]):void 0,ce=M(ue),ve=function(be){this===V&&s(ve,re,be),c(this,ee)&&c(this[ee],ce)&&(this[ee][ce]=!1),ae(this,ce,g(1,be))};return p&&oe&&ae(V,ce,{configurable:!0,set:ve}),pe(ce,ue)}).prototype,"toString",function(){return J(this).tag}),L(D,"withoutSetter",function(ue){return pe(M(ue),ue)}),x.f=ie,F.f=ge,P.f=fe,N.f=me,O.f=I.f=ye,R.f=de,E.f=function(ue){return pe(U(ue),ue)},p&&(H(Q,"description",{configurable:!0,get:function(){return J(this).description}}),u||L(V,"propertyIsEnumerable",ie,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!d,sham:!d},{Symbol:D}),W(S(se),function(ue){z(ue)}),r({target:"Symbol",stat:!0,forced:!d},{useSetter:function(){oe=!0},useSimple:function(){oe=!1}}),r({target:"Object",stat:!0,forced:!d,sham:!p},{create:function(ue,ce){return ce===void 0?b(ue):fe(b(ue),ce)},defineProperty:ge,defineProperties:fe,getOwnPropertyDescriptor:me}),r({target:"Object",stat:!0,forced:!d},{getOwnPropertyNames:ye}),$(),X(D,"Symbol"),A[ee]=!0},function(o,k,e){var r=e(162),i=e(64);o.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},function(o,k,e){var r=e(14),i=e(16),s=r.WeakMap;o.exports=i(s)&&/native code/.test(String(s))},function(o,k,e){var r=e(1),i=e(33),s=e(29),n=e(49),u=e(109),p=e(222),d=u("string-to-symbol-registry"),m=u("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!p},{for:function(c){var h=n(c);if(s(d,h))return d[h];var a=i("Symbol")(h);return d[h]=a,m[a]=h,a}})},function(o,k,e){var r=e(1),i=e(29),s=e(126),n=e(78),u=e(109),p=e(222),d=u("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!p},{keyFor:function(m){if(!s(m))throw TypeError(n(m)+" is not a symbol");if(i(d,m))return d[m]}})},function(o,k,e){var r=e(1),i=e(92),s=e(4),n=e(132),u=e(42);r({target:"Object",stat:!0,forced:!i||s(function(){n.f(1)})},{getOwnPropertySymbols:function(p){var d=n.f;return d?d(u(p)):[]}})},function(o,k,e){e(22)("asyncIterator")},function(o,k){},function(o,k,e){e(22)("hasInstance")},function(o,k,e){e(22)("isConcatSpreadable")},function(o,k,e){e(22)("match")},function(o,k,e){e(22)("matchAll")},function(o,k,e){e(22)("replace")},function(o,k,e){e(22)("search")},function(o,k,e){e(22)("species")},function(o,k,e){e(22)("split")},function(o,k,e){var r=e(33),i=e(22),s=e(81);i("toStringTag"),s(r("Symbol"),"Symbol")},function(o,k,e){e(22)("unscopables")},function(o,k,e){var r=e(14);e(81)(r.JSON,"JSON",!0)},function(o,k){},function(o,k){},function(o,k,e){var r=e(227).IteratorPrototype,i=e(80),s=e(77),n=e(81),u=e(99),p=function(){return this};o.exports=function(d,m,c,h){var a=m+" Iterator";return d.prototype=i(r,{next:s(+!h,c)}),n(d,a,!1,!0),u[a]=p,d}},function(o,k,e){var r=e(16),i=String,s=TypeError;o.exports=function(n){if(typeof n=="object"||r(n))return n;throw s("Can't set "+i(n)+" as a prototype")}},function(o,k){o.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(o,k,e){e(22)("dispose")},function(o,k,e){e(22)("asyncDispose")},function(o,k,e){e(22)("matcher")},function(o,k,e){e(22)("metadataKey")},function(o,k,e){e(22)("observable")},function(o,k,e){e(22)("metadata")},function(o,k,e){e(22)("patternMatch")},function(o,k,e){e(22)("replaceAll")},function(o,k,e){o.exports=e(365)},function(o,k,e){o.exports=e(366)},function(o,k,e){var r=e(367);o.exports=r},function(o,k,e){var r=e(368);o.exports=r},function(o,k,e){var r=e(369);e(66),o.exports=r},function(o,k,e){e(82),e(96),e(113),e(224);var r=e(133);o.exports=r.f("iterator")},function(o,k,e){var r=e(11),i=e(110),s=e(49),n=e(108),u=r("".charAt),p=r("".charCodeAt),d=r("".slice),m=function(c){return function(h,a){var y,T,v=s(n(h)),g=i(a),b=v.length;return g<0||g>=b?c?"":void 0:(y=p(v,g))<55296||y>56319||g+1===b||(T=p(v,g+1))<56320||T>57343?c?u(v,g):y:c?d(v,g,g+2):T-56320+(y-55296<<10)+65536}};o.exports={codeAt:m(!1),charAt:m(!0)}},function(o,k,e){e(372);var r=e(12);o.exports=r.Array.isArray},function(o,k,e){e(1)({target:"Array",stat:!0},{isArray:e(79)})},function(o,k,e){var r=e(374);o.exports=r},function(o,k,e){e(375);var r=e(30);o.exports=r("Array").forEach},function(o,k,e){var r=e(1),i=e(376);r({target:"Array",proto:!0,forced:[].forEach!=i},{forEach:i})},function(o,k,e){var r=e(84).forEach,i=e(94)("forEach");o.exports=i?[].forEach:function(s){return r(this,s,arguments.length>1?arguments[1]:void 0)}},function(o,k,e){o.exports=e(378)},function(o,k,e){var r=e(379);o.exports=r},function(o,k,e){e(380);var r=e(12).Object;o.exports=function(i){return r.getOwnPropertyNames(i)}},function(o,k,e){var r=e(1),i=e(4),s=e(165).f;r({target:"Object",stat:!0,forced:i(function(){return!Object.getOwnPropertyNames(1)})},{getOwnPropertyNames:s})},function(o,k,e){e(382);var r=e(12);o.exports=r.Object.keys},function(o,k,e){var r=e(1),i=e(42),s=e(118);r({target:"Object",stat:!0,forced:e(4)(function(){s(1)})},{keys:function(n){return s(i(n))}})},function(o,k,e){var r=e(384);o.exports=r},function(o,k,e){e(223);var r=e(12),i=e(76);r.JSON||(r.JSON={stringify:JSON.stringify}),o.exports=function(s,n,u){return i(r.JSON.stringify,null,arguments)}},function(o,k,e){e(232),e(82),e(96),e(392),e(246),e(247),e(405),e(113);var r=e(12);o.exports=r.Promise},function(o,k,e){var r=e(1),i=e(21),s=e(134),n=e(135),u=e(387),p=e(80),d=e(53),m=e(77),c=e(388),h=e(389),a=e(46),y=e(390),T=e(20),v=e(391),g=T("toStringTag"),b=Error,S=[].push,O=function(R,N){var F,P=arguments.length>2?arguments[2]:void 0,x=i(I,this);n?F=n(b(),x?s(this):I):(F=x?this:p(I),d(F,g,"Error")),N!==void 0&&d(F,"message",y(N)),v&&d(F,"stack",c(F.stack,1)),h(F,P);var L=[];return a(R,S,{that:L}),d(F,"errors",L),F};n?n(O,b):u(O,b,{name:!0});var I=O.prototype=p(b.prototype,{constructor:m(1,O),message:m(1,""),name:m(1,"AggregateError")});r({global:!0,constructor:!0,arity:2},{AggregateError:O})},function(o,k,e){var r=e(29),i=e(233),s=e(90),n=e(38);o.exports=function(u,p,d){for(var m=i(p),c=n.f,h=s.f,a=0;a<m.length;a++){var y=m[a];r(u,y)||d&&r(d,y)||c(u,y,h(p,y))}}},function(o,k,e){var r=e(11),i=Error,s=r("".replace),n=String(i("zxcasd").stack),u=/\n\s*at [^:]*:[^\n]*/,p=u.test(n);o.exports=function(d,m){if(p&&typeof d=="string"&&!i.prepareStackTrace)for(;m--;)d=s(d,u,"");return d}},function(o,k,e){var r=e(28),i=e(53);o.exports=function(s,n){r(n)&&"cause"in n&&i(s,"cause",n.cause)}},function(o,k,e){var r=e(49);o.exports=function(i,s){return i===void 0?arguments.length<2?"":s:r(i)}},function(o,k,e){var r=e(4),i=e(77);o.exports=!r(function(){var s=Error("a");return!("stack"in s)||(Object.defineProperty(s,"stack",i(1,7)),s.stack!==7)})},function(o,k,e){e(393),e(400),e(401),e(402),e(403),e(404)},function(o,k,e){var r,i,s,n=e(1),u=e(48),p=e(114),d=e(14),m=e(19),c=e(65),h=e(135),a=e(81),y=e(237),T=e(31),v=e(16),g=e(28),b=e(168),S=e(238),O=e(239).set,I=e(394),R=e(397),N=e(100),F=e(398),P=e(97),x=e(101),L=e(115),_=e(67),C=L.CONSTRUCTOR,A=L.REJECTION_EVENT,M=L.SUBCLASSING,U=P.getterFor("Promise"),E=P.set,z=x&&x.prototype,$=x,X=z,Y=d.TypeError,W=d.document,ee=d.process,w=_.f,J=w,V=!!(W&&W.createEvent&&d.dispatchEvent),D=function(re){var se;return!(!g(re)||!v(se=re.then))&&se},Q=function(re,se){var oe,ae,pe,ge=se.value,fe=se.state==1,ie=fe?re.ok:re.fail,me=re.resolve,ye=re.reject,de=re.domain;try{ie?(fe||(se.rejection===2&&K(se),se.rejection=1),ie===!0?oe=ge:(de&&de.enter(),oe=ie(ge),de&&(de.exit(),pe=!0)),oe===re.promise?ye(Y("Promise-chain cycle")):(ae=D(oe))?m(ae,oe,me,ye):me(oe)):ye(ge)}catch(ue){de&&!pe&&de.exit(),ye(ue)}},G=function(re,se){re.notified||(re.notified=!0,I(function(){for(var oe,ae=re.reactions;oe=ae.get();)Q(oe,re);re.notified=!1,se&&!re.rejection&&q(re)}))},B=function(re,se,oe){var ae,pe;V?((ae=W.createEvent("Event")).promise=se,ae.reason=oe,ae.initEvent(re,!1,!0),d.dispatchEvent(ae)):ae={promise:se,reason:oe},!A&&(pe=d["on"+re])?pe(ae):re==="unhandledrejection"&&R("Unhandled promise rejection",oe)},q=function(re){m(O,d,function(){var se,oe=re.facade,ae=re.value;if(H(re)&&(se=N(function(){p?ee.emit("unhandledRejection",ae,oe):B("unhandledrejection",oe,ae)}),re.rejection=p||H(re)?2:1,se.error))throw se.value})},H=function(re){return re.rejection!==1&&!re.parent},K=function(re){m(O,d,function(){var se=re.facade;p?ee.emit("rejectionHandled",se):B("rejectionhandled",se,re.value)})},Z=function(re,se,oe){return function(ae){re(se,ae,oe)}},te=function(re,se,oe){re.done||(re.done=!0,oe&&(re=oe),re.value=se,re.state=2,G(re,!0))},ne=function(re,se,oe){if(!re.done){re.done=!0,oe&&(re=oe);try{if(re.facade===se)throw Y("Promise can't be resolved itself");var ae=D(se);ae?I(function(){var pe={done:!1};try{m(ae,se,Z(ne,pe,re),Z(te,pe,re))}catch(ge){te(pe,ge,re)}}):(re.value=se,re.state=1,G(re,!1))}catch(pe){te({done:!1},pe,re)}}};if(C&&(X=($=function(re){b(this,X),T(re),m(r,this);var se=U(this);try{re(Z(ne,se),Z(te,se))}catch(oe){te(se,oe)}}).prototype,(r=function(re){E(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new F,rejection:!1,state:0,value:void 0})}).prototype=c(X,"then",function(re,se){var oe=U(this),ae=w(S(this,$));return oe.parent=!0,ae.ok=!v(re)||re,ae.fail=v(se)&&se,ae.domain=p?ee.domain:void 0,oe.state==0?oe.reactions.add(ae):I(function(){Q(ae,oe)}),ae.promise}),i=function(){var re=new r,se=U(re);this.promise=re,this.resolve=Z(ne,se),this.reject=Z(te,se)},_.f=w=function(re){return re===$||re===void 0?new i(re):J(re)},!u&&v(x)&&z!==Object.prototype)){s=z.then,M||c(z,"then",function(re,se){var oe=this;return new $(function(ae,pe){m(s,oe,ae,pe)}).then(re,se)},{unsafe:!0});try{delete z.constructor}catch{}h&&h(z,X)}n({global:!0,constructor:!0,wrap:!0,forced:C},{Promise:$}),a($,"Promise",!1,!0),y("Promise")},function(o,k,e){var r,i,s,n,u,p,d,m,c=e(14),h=e(34),a=e(90).f,y=e(239).set,T=e(241),v=e(395),g=e(396),b=e(114),S=c.MutationObserver||c.WebKitMutationObserver,O=c.document,I=c.process,R=c.Promise,N=a(c,"queueMicrotask"),F=N&&N.value;F||(r=function(){var P,x;for(b&&(P=I.domain)&&P.exit();i;){x=i.fn,i=i.next;try{x()}catch(L){throw i?n():s=void 0,L}}s=void 0,P&&P.enter()},T||b||g||!S||!O?!v&&R&&R.resolve?((d=R.resolve(void 0)).constructor=R,m=h(d.then,d),n=function(){m(r)}):b?n=function(){I.nextTick(r)}:(y=h(y,c),n=function(){y(r)}):(u=!0,p=O.createTextNode(""),new S(r).observe(p,{characterData:!0}),n=function(){p.data=u=!u})),o.exports=F||function(P){var x={fn:P,next:void 0};s&&(s.next=x),i||(i=x,n()),s=x}},function(o,k,e){var r=e(63),i=e(14);o.exports=/ipad|iphone|ipod/i.test(r)&&i.Pebble!==void 0},function(o,k,e){var r=e(63);o.exports=/web0s(?!.*chrome)/i.test(r)},function(o,k,e){var r=e(14);o.exports=function(i,s){var n=r.console;n&&n.error&&(arguments.length==1?n.error(i):n.error(i,s))}},function(o,k){var e=function(){this.head=null,this.tail=null};e.prototype={add:function(r){var i={item:r,next:null};this.head?this.tail.next=i:this.head=i,this.tail=i},get:function(){var r=this.head;if(r)return this.head=r.next,this.tail===r&&(this.tail=null),r.item}},o.exports=e},function(o,k,e){var r=e(242),i=e(114);o.exports=!r&&!i&&typeof window=="object"&&typeof document=="object"},function(o,k,e){var r=e(1),i=e(19),s=e(31),n=e(67),u=e(100),p=e(46);r({target:"Promise",stat:!0,forced:e(243)},{all:function(d){var m=this,c=n.f(m),h=c.resolve,a=c.reject,y=u(function(){var T=s(m.resolve),v=[],g=0,b=1;p(d,function(S){var O=g++,I=!1;b++,i(T,m,S).then(function(R){I||(I=!0,v[O]=R,--b||h(v))},a)}),--b||h(v)});return y.error&&a(y.value),c.promise}})},function(o,k,e){var r=e(1),i=e(48),s=e(115).CONSTRUCTOR,n=e(101),u=e(33),p=e(16),d=e(65),m=n&&n.prototype;if(r({target:"Promise",proto:!0,forced:s,real:!0},{catch:function(h){return this.then(void 0,h)}}),!i&&p(n)){var c=u("Promise").prototype.catch;m.catch!==c&&d(m,"catch",c,{unsafe:!0})}},function(o,k,e){var r=e(1),i=e(19),s=e(31),n=e(67),u=e(100),p=e(46);r({target:"Promise",stat:!0,forced:e(243)},{race:function(d){var m=this,c=n.f(m),h=c.reject,a=u(function(){var y=s(m.resolve);p(d,function(T){i(y,m,T).then(c.resolve,h)})});return a.error&&h(a.value),c.promise}})},function(o,k,e){var r=e(1),i=e(19),s=e(67);r({target:"Promise",stat:!0,forced:e(115).CONSTRUCTOR},{reject:function(n){var u=s.f(this);return i(u.reject,void 0,n),u.promise}})},function(o,k,e){var r=e(1),i=e(33),s=e(48),n=e(101),u=e(115).CONSTRUCTOR,p=e(245),d=i("Promise"),m=s&&!u;r({target:"Promise",stat:!0,forced:s||u},{resolve:function(c){return p(m&&this===d?n:this,c)}})},function(o,k,e){var r=e(1),i=e(48),s=e(101),n=e(4),u=e(33),p=e(16),d=e(238),m=e(245),c=e(65),h=s&&s.prototype;if(r({target:"Promise",proto:!0,real:!0,forced:!!s&&n(function(){h.finally.call({then:function(){}},function(){})})},{finally:function(y){var T=d(this,u("Promise")),v=p(y);return this.then(v?function(g){return m(T,y()).then(function(){return g})}:y,v?function(g){return m(T,y()).then(function(){throw g})}:y)}}),!i&&p(s)){var a=u("Promise").prototype.finally;h.finally!==a&&c(h,"finally",a,{unsafe:!0})}},function(o,k,e){o.exports=e(407)},function(o,k,e){var r=e(408);o.exports=r},function(o,k,e){var r=e(248);o.exports=r},function(o,k,e){e(410);var r=e(12).Object,i=o.exports=function(s,n,u){return r.defineProperty(s,n,u)};r.defineProperty.sham&&(i.sham=!0)},function(o,k,e){var r=e(1),i=e(27),s=e(38).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==s,sham:!i},{defineProperty:s})},function(o,k,e){var r=e(412),i=e(26).default;o.exports=function(s,n){if(i(s)!=="object"||s===null)return s;var u=s[r];if(u!==void 0){var p=u.call(s,n||"default");if(i(p)!=="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(s)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(413)},function(o,k,e){o.exports=e(414)},function(o,k,e){var r=e(415);o.exports=r},function(o,k,e){var r=e(416);o.exports=r},function(o,k,e){var r=e(417);o.exports=r},function(o,k,e){e(418),e(225);var r=e(133);o.exports=r.f("toPrimitive")},function(o,k){},function(o,k,e){var r=e(21),i=e(420),s=Array.prototype;o.exports=function(n){var u=n.slice;return n===s||r(s,n)&&u===s.slice?i:u}},function(o,k,e){e(421);var r=e(30);o.exports=r("Array").slice},function(o,k,e){var r=e(1),i=e(79),s=e(129),n=e(28),u=e(128),p=e(45),d=e(43),m=e(95),c=e(20),h=e(111),a=e(98),y=h("slice"),T=c("species"),v=Array,g=Math.max;r({target:"Array",proto:!0,forced:!y},{slice:function(b,S){var O,I,R,N=d(this),F=p(N),P=u(b,F),x=u(S===void 0?F:S,F);if(i(N)&&(O=N.constructor,(s(O)&&(O===v||i(O.prototype))||n(O)&&(O=O[T])===null)&&(O=void 0),O===v||O===void 0))return a(N,P,x);for(I=new(O===void 0?v:O)(g(x-P,0)),R=0;P<x;P++,R++)P in N&&m(I,R,N[P]);return I.length=R,I}})},function(o,k,e){var r=e(423);o.exports=r},function(o,k,e){var r=e(21),i=e(424),s=Array.prototype;o.exports=function(n){var u=n.some;return n===s||r(s,n)&&u===s.some?i:u}},function(o,k,e){e(425);var r=e(30);o.exports=r("Array").some},function(o,k,e){var r=e(1),i=e(84).some;r({target:"Array",proto:!0,forced:!e(94)("some")},{some:function(s){return i(this,s,arguments.length>1?arguments[1]:void 0)}})},function(o,k,e){var r=e(427);o.exports=r},function(o,k,e){var r=e(21),i=e(428),s=Array.prototype;o.exports=function(n){var u=n.splice;return n===s||r(s,n)&&u===s.splice?i:u}},function(o,k,e){e(429);var r=e(30);o.exports=r("Array").splice},function(o,k,e){var r=e(1),i=e(42),s=e(128),n=e(110),u=e(45),p=e(430),d=e(213),m=e(161),c=e(95),h=e(251),a=e(111)("splice"),y=Math.max,T=Math.min;r({target:"Array",proto:!0,forced:!a},{splice:function(v,g){var b,S,O,I,R,N,F=i(this),P=u(F),x=s(v,P),L=arguments.length;for(L===0?b=S=0:L===1?(b=0,S=P-x):(b=L-2,S=T(y(n(g),0),P-x)),d(P+b-S),O=m(F,S),I=0;I<S;I++)(R=x+I)in F&&c(O,I,F[R]);if(O.length=S,b<S){for(I=x;I<P-S;I++)N=I+b,(R=I+S)in F?F[N]=F[R]:h(F,N);for(I=P;I>P-S+b;I--)h(F,I-1)}else if(b>S)for(I=P-S;I>x;I--)N=I+b-1,(R=I+S-1)in F?F[N]=F[R]:h(F,N);for(I=0;I<b;I++)F[I+x]=arguments[I+2];return p(F,P-S+b),O}})},function(o,k,e){var r=e(27),i=e(79),s=TypeError,n=Object.getOwnPropertyDescriptor,u=r&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(p){return p instanceof TypeError}}();o.exports=u?function(p,d){if(i(p)&&!n(p,"length").writable)throw s("Cannot set read only .length");return p.length=d}:function(p,d){return p.length=d}},function(o,k,e){var r=e(432);o.exports=r},function(o,k,e){var r=e(21),i=e(433),s=Array.prototype;o.exports=function(n){var u=n.sort;return n===s||r(s,n)&&u===s.sort?i:u}},function(o,k,e){e(434);var r=e(30);o.exports=r("Array").sort},function(o,k,e){var r=e(1),i=e(11),s=e(31),n=e(42),u=e(45),p=e(251),d=e(49),m=e(4),c=e(435),h=e(94),a=e(436),y=e(437),T=e(93),v=e(438),g=[],b=i(g.sort),S=i(g.push),O=m(function(){g.sort(void 0)}),I=m(function(){g.sort(null)}),R=h("sort"),N=!m(function(){if(T)return T<70;if(!(a&&a>3)){if(y)return!0;if(v)return v<603;var F,P,x,L,_="";for(F=65;F<76;F++){switch(P=String.fromCharCode(F),F){case 66:case 69:case 70:case 72:x=3;break;case 68:case 71:x=4;break;default:x=2}for(L=0;L<47;L++)g.push({k:P+L,v:x})}for(g.sort(function(C,A){return A.v-C.v}),L=0;L<g.length;L++)P=g[L].k.charAt(0),_.charAt(_.length-1)!==P&&(_+=P);return _!=="DGBEFHACIJK"}});r({target:"Array",proto:!0,forced:O||!I||!R||!N},{sort:function(F){F!==void 0&&s(F);var P=n(this);if(N)return F===void 0?b(P):b(P,F);var x,L,_=[],C=u(P);for(L=0;L<C;L++)L in P&&S(_,P[L]);for(c(_,function(A){return function(M,U){return U===void 0?-1:M===void 0?1:A!==void 0?+A(M,U)||0:d(M)>d(U)?1:-1}}(F)),x=u(_),L=0;L<x;)P[L]=_[L++];for(;L<C;)p(P,L++);return P}})},function(o,k,e){var r=e(220),i=Math.floor,s=function(p,d){var m=p.length,c=i(m/2);return m<8?n(p,d):u(p,s(r(p,0,c),d),s(r(p,c),d),d)},n=function(p,d){for(var m,c,h=p.length,a=1;a<h;){for(c=a,m=p[a];c&&d(p[c-1],m)>0;)p[c]=p[--c];c!==a++&&(p[c]=m)}return p},u=function(p,d,m,c){for(var h=d.length,a=m.length,y=0,T=0;y<h||T<a;)p[y+T]=y<h&&T<a?c(d[y],m[T])<=0?d[y++]:m[T++]:y<h?d[y++]:m[T++];return p};o.exports=s},function(o,k,e){var r=e(63).match(/firefox\/(\d+)/i);o.exports=!!r&&+r[1]},function(o,k,e){var r=e(63);o.exports=/MSIE|Trident/.test(r)},function(o,k,e){var r=e(63).match(/AppleWebKit\/(\d+)\./);o.exports=!!r&&+r[1]},function(o,k,e){var r=e(440);o.exports=r},function(o,k,e){var r=e(21),i=e(441),s=Array.prototype;o.exports=function(n){var u=n.map;return n===s||r(s,n)&&u===s.map?i:u}},function(o,k,e){e(442);var r=e(30);o.exports=r("Array").map},function(o,k,e){var r=e(1),i=e(84).map;r({target:"Array",proto:!0,forced:!e(111)("map")},{map:function(s){return i(this,s,arguments.length>1?arguments[1]:void 0)}})},function(o,k,e){var r=e(444);o.exports=r},function(o,k,e){var r=e(21),i=e(445),s=Array.prototype;o.exports=function(n){var u=n.reduce;return n===s||r(s,n)&&u===s.reduce?i:u}},function(o,k,e){e(446);var r=e(30);o.exports=r("Array").reduce},function(o,k,e){var r=e(1),i=e(447).left,s=e(94),n=e(93),u=e(114);r({target:"Array",proto:!0,forced:!s("reduce")||!u&&n>79&&n<83},{reduce:function(p){var d=arguments.length;return i(this,p,d,d>1?arguments[1]:void 0)}})},function(o,k,e){var r=e(31),i=e(42),s=e(124),n=e(45),u=TypeError,p=function(d){return function(m,c,h,a){r(c);var y=i(m),T=s(y),v=n(y),g=d?v-1:0,b=d?-1:1;if(h<2)for(;;){if(g in T){a=T[g],g+=b;break}if(g+=b,d?g<0:v<=g)throw u("Reduce of empty array with no initial value")}for(;d?g>=0:v>g;g+=b)g in T&&(a=c(a,T[g],g,y));return a}};o.exports={left:p(!1),right:p(!0)}},function(o,k,e){var r=e(449);o.exports=r},function(o,k,e){var r=e(21),i=e(450),s=Array.prototype;o.exports=function(n){var u=n.lastIndexOf;return n===s||r(s,n)&&u===s.lastIndexOf?i:u}},function(o,k,e){e(451);var r=e(30);o.exports=r("Array").lastIndexOf},function(o,k,e){var r=e(1),i=e(452);r({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},function(o,k,e){var r=e(76),i=e(43),s=e(110),n=e(45),u=e(94),p=Math.min,d=[].lastIndexOf,m=!!d&&1/[1].lastIndexOf(1,-0)<0,c=u("lastIndexOf"),h=m||!c;o.exports=h?function(a){if(m)return r(d,this,arguments)||0;var y=i(this),T=n(y),v=T-1;for(arguments.length>1&&(v=p(v,s(arguments[1]))),v<0&&(v=T+v);v>=0;v--)if(v in y&&y[v]===a)return v||0;return-1}:d},function(o,k,e){e(252);var r=e(12);o.exports=r.setTimeout},function(o,k,e){var r=e(1),i=e(14),s=e(253)(i.setInterval,!0);r({global:!0,bind:!0,forced:i.setInterval!==s},{setInterval:s})},function(o,k){o.exports=typeof Bun=="function"&&Bun&&typeof Bun.version=="string"},function(o,k,e){var r=e(1),i=e(14),s=e(253)(i.setTimeout,!0);r({global:!0,bind:!0,forced:i.setTimeout!==s},{setTimeout:s})},function(o,k,e){var r=e(458);o.exports=r},function(o,k,e){var r=e(21),i=e(459),s=Array.prototype;o.exports=function(n){var u=n.filter;return n===s||r(s,n)&&u===s.filter?i:u}},function(o,k,e){e(460);var r=e(30);o.exports=r("Array").filter},function(o,k,e){var r=e(1),i=e(84).filter;r({target:"Array",proto:!0,forced:!e(111)("filter")},{filter:function(s){return i(this,s,arguments.length>1?arguments[1]:void 0)}})},function(o,k,e){o.exports=e(462)},function(o,k,e){e(66);var r=e(64),i=e(29),s=e(21),n=e(463),u=Array.prototype,p={DOMTokenList:!0,NodeList:!0};o.exports=function(d){var m=d.values;return d===u||s(u,d)&&m===u.values||i(p,r(d))?n:m}},function(o,k,e){var r=e(464);o.exports=r},function(o,k,e){e(82),e(96);var r=e(30);o.exports=r("Array").values},function(o,k,e){e(113),e(466);var r=e(12);o.exports=r.Array.from},function(o,k,e){var r=e(1),i=e(467);r({target:"Array",stat:!0,forced:!e(244)(function(s){Array.from(s)})},{from:i})},function(o,k,e){var r=e(34),i=e(19),s=e(42),n=e(468),u=e(234),p=e(129),d=e(45),m=e(95),c=e(235),h=e(136),a=Array;o.exports=function(y){var T=s(y),v=p(this),g=arguments.length,b=g>1?arguments[1]:void 0,S=b!==void 0;S&&(b=r(b,g>2?arguments[2]:void 0));var O,I,R,N,F,P,x=h(T),L=0;if(!x||this===a&&u(x))for(O=d(T),I=v?new this(O):a(O);O>L;L++)P=S?b(T[L],L):T[L],m(I,L,P);else for(F=(N=c(T,x)).next,I=v?new this:[];!(R=i(F,N)).done;L++)P=S?n(N,b,[R.value,L],!0):R.value,m(I,L,P);return I.length=L,I}},function(o,k,e){var r=e(36),i=e(236);o.exports=function(s,n,u,p){try{return p?n(r(u)[0],u[1]):n(u)}catch(d){i(s,"throw",d)}}},function(o,k,e){o.exports=e(470)},function(o,k,e){var r=e(471);o.exports=r},function(o,k,e){var r=e(472);o.exports=r},function(o,k,e){var r=e(473);e(66),o.exports=r},function(o,k,e){e(82),e(113);var r=e(136);o.exports=r},function(o,k,e){e(219);var r=e(12);o.exports=r.Object.getOwnPropertySymbols},function(o,k,e){var r=e(476);o.exports=r},function(o,k,e){e(477);var r=e(12).Object,i=o.exports=function(s,n){return r.getOwnPropertyDescriptor(s,n)};r.getOwnPropertyDescriptor.sham&&(i.sham=!0)},function(o,k,e){var r=e(1),i=e(4),s=e(43),n=e(90).f,u=e(27),p=i(function(){n(1)});r({target:"Object",stat:!0,forced:!u||p,sham:!u},{getOwnPropertyDescriptor:function(d,m){return n(s(d),m)}})},function(o,k,e){var r=e(479);o.exports=r},function(o,k,e){e(480);var r=e(12);o.exports=r.Object.getOwnPropertyDescriptors},function(o,k,e){var r=e(1),i=e(27),s=e(233),n=e(43),u=e(90),p=e(95);r({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(d){for(var m,c,h=n(d),a=u.f,y=s(h),T={},v=0;y.length>v;)(c=a(h,m=y[v++]))!==void 0&&p(T,m,c);return T}})},function(o,k,e){var r=e(482);o.exports=r},function(o,k,e){e(483);var r=e(12).Object,i=o.exports=function(s,n){return r.defineProperties(s,n)};r.defineProperties.sham&&(i.sham=!0)},function(o,k,e){var r=e(1),i=e(27),s=e(163).f;r({target:"Object",stat:!0,forced:Object.defineProperties!==s,sham:!i},{defineProperties:s})},function(o,k,e){var r=e(13);typeof window<"u"&&(window.console||r.isWeixinApp||(window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}))},function(o,k,e){var r=e(486),i=e(515),s=e(260),n=e(517),u=e(526),p=e(529),d=e(530),m=e(531),c=e(533),h=e(534),a=e(535),y=e(181),T=e(539),v=e(540),g=e(546),b=e(175),S=e(263),O=e(548),I=e(88),R=e(550),N=e(174),F=e(179),P={};P["[object Arguments]"]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object DataView]"]=P["[object Boolean]"]=P["[object Date]"]=P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Map]"]=P["[object Number]"]=P["[object Object]"]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object Symbol]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P["[object Error]"]=P["[object Function]"]=P["[object WeakMap]"]=!1,o.exports=function x(L,_,C,A,M,U){var E,z=1&_,$=2&_,X=4&_;if(C&&(E=M?C(L,A,M,U):C(L)),E!==void 0)return E;if(!I(L))return L;var Y=b(L);if(Y){if(E=T(L),!z)return d(L,E)}else{var W=y(L),ee=W=="[object Function]"||W=="[object GeneratorFunction]";if(S(L))return p(L,z);if(W=="[object Object]"||W=="[object Arguments]"||ee&&!M){if(E=$||ee?{}:g(L),!z)return $?c(L,u(E,L)):m(L,n(E,L))}else{if(!P[W])return M?L:{};E=v(L,W,z)}}U||(U=new r);var w=U.get(L);if(w)return w;U.set(L,E),R(L)?L.forEach(function(V){E.add(x(V,_,C,V,L,U))}):O(L)&&L.forEach(function(V,D){E.set(D,x(V,_,C,D,L,U))});var J=Y?void 0:(X?$?a:h:$?F:N)(L);return i(J||L,function(V,D){J&&(V=L[D=V]),s(E,D,x(V,_,C,D,L,U))}),E}},function(o,k,e){var r=e(140),i=e(492),s=e(493),n=e(494),u=e(495),p=e(496);function d(m){var c=this.__data__=new r(m);this.size=c.size}d.prototype.clear=i,d.prototype.delete=s,d.prototype.get=n,d.prototype.has=u,d.prototype.set=p,o.exports=d},function(o,k){o.exports=function(){this.__data__=[],this.size=0}},function(o,k,e){var r=e(141),i=Array.prototype.splice;o.exports=function(s){var n=this.__data__,u=r(n,s);return!(u<0)&&(u==n.length-1?n.pop():i.call(n,u,1),--this.size,!0)}},function(o,k,e){var r=e(141);o.exports=function(i){var s=this.__data__,n=r(s,i);return n<0?void 0:s[n][1]}},function(o,k,e){var r=e(141);o.exports=function(i){return r(this.__data__,i)>-1}},function(o,k,e){var r=e(141);o.exports=function(i,s){var n=this.__data__,u=r(n,i);return u<0?(++this.size,n.push([i,s])):n[u][1]=s,this}},function(o,k,e){var r=e(140);o.exports=function(){this.__data__=new r,this.size=0}},function(o,k){o.exports=function(e){var r=this.__data__,i=r.delete(e);return this.size=r.size,i}},function(o,k){o.exports=function(e){return this.__data__.get(e)}},function(o,k){o.exports=function(e){return this.__data__.has(e)}},function(o,k,e){var r=e(140),i=e(172),s=e(259);o.exports=function(n,u){var p=this.__data__;if(p instanceof r){var d=p.__data__;if(!i||d.length<199)return d.push([n,u]),this.size=++p.size,this;p=this.__data__=new s(d)}return p.set(n,u),this.size=p.size,this}},function(o,k,e){var r=e(256),i=e(500),s=e(88),n=e(258),u=/^\[object .+?Constructor\]$/,p=Function.prototype,d=Object.prototype,m=p.toString,c=d.hasOwnProperty,h=RegExp("^"+m.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");o.exports=function(a){return!(!s(a)||i(a))&&(r(a)?h:u).test(n(a))}},function(o,k,e){var r=e(173),i=Object.prototype,s=i.hasOwnProperty,n=i.toString,u=r?r.toStringTag:void 0;o.exports=function(p){var d=s.call(p,u),m=p[u];try{p[u]=void 0;var c=!0}catch{}var h=n.call(p);return c&&(d?p[u]=m:delete p[u]),h}},function(o,k){var e=Object.prototype.toString;o.exports=function(r){return e.call(r)}},function(o,k,e){var r,i=e(501),s=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";o.exports=function(n){return!!s&&s in n}},function(o,k,e){var r=e(50)["__core-js_shared__"];o.exports=r},function(o,k){o.exports=function(e,r){return e==null?void 0:e[r]}},function(o,k,e){var r=e(504),i=e(140),s=e(172);o.exports=function(){this.size=0,this.__data__={hash:new r,map:new(s||i),string:new r}}},function(o,k,e){var r=e(505),i=e(506),s=e(507),n=e(508),u=e(509);function p(d){var m=-1,c=d==null?0:d.length;for(this.clear();++m<c;){var h=d[m];this.set(h[0],h[1])}}p.prototype.clear=r,p.prototype.delete=i,p.prototype.get=s,p.prototype.has=n,p.prototype.set=u,o.exports=p},function(o,k,e){var r=e(142);o.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(o,k){o.exports=function(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}},function(o,k,e){var r=e(142),i=Object.prototype.hasOwnProperty;o.exports=function(s){var n=this.__data__;if(r){var u=n[s];return u==="__lodash_hash_undefined__"?void 0:u}return i.call(n,s)?n[s]:void 0}},function(o,k,e){var r=e(142),i=Object.prototype.hasOwnProperty;o.exports=function(s){var n=this.__data__;return r?n[s]!==void 0:i.call(n,s)}},function(o,k,e){var r=e(142);o.exports=function(i,s){var n=this.__data__;return this.size+=this.has(i)?0:1,n[i]=r&&s===void 0?"__lodash_hash_undefined__":s,this}},function(o,k,e){var r=e(143);o.exports=function(i){var s=r(this,i).delete(i);return this.size-=s?1:0,s}},function(o,k){o.exports=function(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}},function(o,k,e){var r=e(143);o.exports=function(i){return r(this,i).get(i)}},function(o,k,e){var r=e(143);o.exports=function(i){return r(this,i).has(i)}},function(o,k,e){var r=e(143);o.exports=function(i,s){var n=r(this,i),u=n.size;return n.set(i,s),this.size+=n.size==u?0:1,this}},function(o,k){o.exports=function(e,r){for(var i=-1,s=e==null?0:e.length;++i<s&&r(e[i],i,e)!==!1;);return e}},function(o,k,e){var r=e(83),i=function(){try{var s=r(Object,"defineProperty");return s({},"",{}),s}catch{}}();o.exports=i},function(o,k,e){var r=e(144),i=e(174);o.exports=function(s,n){return s&&r(n,i(n),s)}},function(o,k){o.exports=function(e,r){for(var i=-1,s=Array(e);++i<e;)s[i]=r(i);return s}},function(o,k,e){var r=e(520),i=e(104),s=Object.prototype,n=s.hasOwnProperty,u=s.propertyIsEnumerable,p=r(function(){return arguments}())?r:function(d){return i(d)&&n.call(d,"callee")&&!u.call(d,"callee")};o.exports=p},function(o,k,e){var r=e(119),i=e(104);o.exports=function(s){return i(s)&&r(s)=="[object Arguments]"}},function(o,k){o.exports=function(){return!1}},function(o,k,e){var r=e(523),i=e(176),s=e(177),n=s&&s.isTypedArray,u=n?i(n):r;o.exports=u},function(o,k,e){var r=e(119),i=e(264),s=e(104),n={};n["[object Float32Array]"]=n["[object Float64Array]"]=n["[object Int8Array]"]=n["[object Int16Array]"]=n["[object Int32Array]"]=n["[object Uint8Array]"]=n["[object Uint8ClampedArray]"]=n["[object Uint16Array]"]=n["[object Uint32Array]"]=!0,n["[object Arguments]"]=n["[object Array]"]=n["[object ArrayBuffer]"]=n["[object Boolean]"]=n["[object DataView]"]=n["[object Date]"]=n["[object Error]"]=n["[object Function]"]=n["[object Map]"]=n["[object Number]"]=n["[object Object]"]=n["[object RegExp]"]=n["[object Set]"]=n["[object String]"]=n["[object WeakMap]"]=!1,o.exports=function(u){return s(u)&&i(u.length)&&!!n[r(u)]}},function(o,k,e){var r=e(178),i=e(525),s=Object.prototype.hasOwnProperty;o.exports=function(n){if(!r(n))return i(n);var u=[];for(var p in Object(n))s.call(n,p)&&p!="constructor"&&u.push(p);return u}},function(o,k,e){var r=e(265)(Object.keys,Object);o.exports=r},function(o,k,e){var r=e(144),i=e(179);o.exports=function(s,n){return s&&r(n,i(n),s)}},function(o,k,e){var r=e(88),i=e(178),s=e(528),n=Object.prototype.hasOwnProperty;o.exports=function(u){if(!r(u))return s(u);var p=i(u),d=[];for(var m in u)(m!="constructor"||!p&&n.call(u,m))&&d.push(m);return d}},function(o,k){o.exports=function(e){var r=[];if(e!=null)for(var i in Object(e))r.push(i);return r}},function(o,k,e){(function(r){var i=e(50),s=k&&!k.nodeType&&k,n=s&&typeof r=="object"&&r&&!r.nodeType&&r,u=n&&n.exports===s?i.Buffer:void 0,p=u?u.allocUnsafe:void 0;r.exports=function(d,m){if(m)return d.slice();var c=d.length,h=p?p(c):new d.constructor(c);return d.copy(h),h}}).call(this,e(145)(o))},function(o,k){o.exports=function(e,r){var i=-1,s=e.length;for(r||(r=Array(s));++i<s;)r[i]=e[i];return r}},function(o,k,e){var r=e(144),i=e(180);o.exports=function(s,n){return r(s,i(s),n)}},function(o,k){o.exports=function(e,r){for(var i=-1,s=e==null?0:e.length,n=0,u=[];++i<s;){var p=e[i];r(p,i,e)&&(u[n++]=p)}return u}},function(o,k,e){var r=e(144),i=e(267);o.exports=function(s,n){return r(s,i(s),n)}},function(o,k,e){var r=e(270),i=e(180),s=e(174);o.exports=function(n){return r(n,s,i)}},function(o,k,e){var r=e(270),i=e(267),s=e(179);o.exports=function(n){return r(n,s,i)}},function(o,k,e){var r=e(83)(e(50),"DataView");o.exports=r},function(o,k,e){var r=e(83)(e(50),"Promise");o.exports=r},function(o,k,e){var r=e(83)(e(50),"WeakMap");o.exports=r},function(o,k){var e=Object.prototype.hasOwnProperty;o.exports=function(r){var i=r.length,s=new r.constructor(i);return i&&typeof r[0]=="string"&&e.call(r,"index")&&(s.index=r.index,s.input=r.input),s}},function(o,k,e){var r=e(182),i=e(542),s=e(543),n=e(544),u=e(545);o.exports=function(p,d,m){var c=p.constructor;switch(d){case"[object ArrayBuffer]":return r(p);case"[object Boolean]":case"[object Date]":return new c(+p);case"[object DataView]":return i(p,m);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return u(p,m);case"[object Map]":return new c;case"[object Number]":case"[object String]":return new c(p);case"[object RegExp]":return s(p);case"[object Set]":return new c;case"[object Symbol]":return n(p)}}},function(o,k,e){var r=e(50).Uint8Array;o.exports=r},function(o,k,e){var r=e(182);o.exports=function(i,s){var n=s?r(i.buffer):i.buffer;return new i.constructor(n,i.byteOffset,i.byteLength)}},function(o,k){var e=/\w*$/;o.exports=function(r){var i=new r.constructor(r.source,e.exec(r));return i.lastIndex=r.lastIndex,i}},function(o,k,e){var r=e(173),i=r?r.prototype:void 0,s=i?i.valueOf:void 0;o.exports=function(n){return s?Object(s.call(n)):{}}},function(o,k,e){var r=e(182);o.exports=function(i,s){var n=s?r(i.buffer):i.buffer;return new i.constructor(n,i.byteOffset,i.length)}},function(o,k,e){var r=e(547),i=e(269),s=e(178);o.exports=function(n){return typeof n.constructor!="function"||s(n)?{}:r(i(n))}},function(o,k,e){var r=e(88),i=Object.create,s=function(){function n(){}return function(u){if(!r(u))return{};if(i)return i(u);n.prototype=u;var p=new n;return n.prototype=void 0,p}}();o.exports=s},function(o,k,e){var r=e(549),i=e(176),s=e(177),n=s&&s.isMap,u=n?i(n):r;o.exports=u},function(o,k,e){var r=e(181),i=e(104);o.exports=function(s){return i(s)&&r(s)=="[object Map]"}},function(o,k,e){var r=e(551),i=e(176),s=e(177),n=s&&s.isSet,u=n?i(n):r;o.exports=u},function(o,k,e){var r=e(181),i=e(104);o.exports=function(s){return i(s)&&r(s)=="[object Set]"}},function(o,k,e){var r=e(2),i=e(5),s=e(6),n=e(68),u=e(10),p=e(15),d=e(7),m=e(3),c=e(74),h=e(0),a=e(13),y=e(44),T={};function v(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};!R.logLevel&&R.debug&&(R.logLevel="debug"),h.merge(this,{options:R,debugEnable:!1,api:"log",style:"color:blue;",logLevel:R.logLevel&&R.logLevel.toLowerCase()||"off",debug:h.emptyFunc,log:h.emptyFunc,info:h.emptyFunc,warn:h.emptyFunc,error:h.emptyFunc}),this.prefix=R.prefix||"",this.localEnable=T.enable&&R.dbLog&&R.account,this.setDebug(R.debug),this.localEnable&&(this._local=new T(R.account,R.expire),this._local.logError=this.error)}T=e(561);var g=v.prototype,b=["Chrome","Safari","Firefox"],S={debug:1e3,log:2e3,info:3e3,warn:4e3,error:5e3,off:6e3};function O(R){var N,F=[];return r(N=i(S)).call(N,function(P){S[P]>=S[R]&&F.push(P)}),F}g.setDebug=function(){var R=arguments.length>0&&arguments[0]!==void 0&&arguments[0],N=this;if(N.debugEnable=R||N.logLevel==="debug",R.style&&(N.style=R.style),h.exist(console)){if(N.logLevel!=="off"){var F=console,P=O(N.logLevel);r(P).call(P,function(L){N[L]=function(){var _=N.formatArgsAndSave(arguments,L);s(b).call(b,c.name)!==-1&&h.isString(_[0])&&(_[0]="%c"+_[0],n(_).call(_,1,0,N.style)),N._log(L,_)}}),N.options.logFunc?N._log=function(){}:N._log=function(L,_){if(L==="debug"&&(L="log"),F[L])try{F[L].apply?N.chrome(L,_):N.ie(L,_)}catch{}},N.chrome=function(L,_){s(b).call(b,c.name)!==-1?F[L].apply(F,_):N.ie(L,_)},N.ie=function(L,_){r(_).call(_,function(C){F[L](u(C,null,4))})}}else if(a.isRN||this.localEnable||this.options.logFunc){var x=!a.isRN&&!this.localEnable;N.log=function(){N.formatArgsAndSave(arguments,"log",x)},N.info=function(){N.formatArgsAndSave(arguments,"info",x)},N.warn=function(){N.formatArgsAndSave(arguments,"warn",x)},N.error=function(){N.formatArgsAndSave(arguments,"error",x)},N.debug=function(){N.formatArgsAndSave(arguments,"log",x)}}}},g.destroy=function(){this.localEnable=!1,this.log=function(){},this.info=function(){},this.warn=function(){},this.error=function(){},this.debug=function(){},this._local&&this._local.destroy()},g.formatArgsAndSave=function(R,N,F){var P,x;R=p([]).call(R,0);var L=new Date,_=I(L.getMonth()+1)+"-"+I(L.getDate())+" "+I(L.getHours())+":"+I(L.getMinutes())+":"+I(L.getSeconds())+":"+I(L.getMilliseconds(),3),C=d(P=d(x="[NIM ".concat(N.toUpperCase()," ")).call(x,_," ")).call(P,this.prefix.toUpperCase(),"]  "),A="";h.isString(R[0])?R[0]=C+R[0]:n(R).call(R,0,0,C),r(R).call(R,function(U,E){h.isArray(U)||h.isObject(U)?(R[E]=h.simpleClone(U),A+=u(R[E])+" "):A+=U+" "});var M=this.options.logFunc;return M&&h.isFunction(M[N])&&M[N].apply(M,R),!F&&this.writeLocalLog(A,N,+L),R},g.writeLocalLog=function(R,N,F){return a.isRN?this.writeLocalLogRN(R,N,F):a.isBrowser?this.writeLocalLogBrowser(R,N,F):void 0};var I=function(R,N){N=N||2;for(var F=""+R;F.length<N;)F="0"+F;return F};g.writeLocalLogBrowser=function(R,N,F){this._local&&this._local.saveLog({log:R,level:N,time:F})},g.writeLocalLogRN=function(R,N){if(y.rnfs&&y.rnfs.writeFile&&y.rnfs.appendFile&&y.rnfs.DocumentDirectoryPath&&/error|warn|info/.test(N)){var F,P=y.rnfs,x=P.size/2-256;R+=`\r
`,P.nimPromise=P.nimPromise.then(function(){return F=L(P.nimIndex),P.exists(F)}).then(function(_){return _?P.appendFile(F,R):P.writeFile(F,R)}).then(function(){return P.stat(F)}).then(function(_){if(_.size>x)return P.nimIndex++,P.nimIndex>1&&(P.nimIndex=P.nimIndex%2),P.unlink(L(P.nimIndex)).catch(function(){return m.resolve()})}).catch(function(){})}function L(_){return y.rnfs.DocumentDirectoryPath+"/nimlog_"+_+".log"}},o.exports=v},function(o,k,e){var r=e(554);o.exports=r},function(o,k,e){e(555);var r=e(12);o.exports=r.parseFloat},function(o,k,e){var r=e(1),i=e(556);r({global:!0,forced:parseFloat!=i},{parseFloat:i})},function(o,k,e){var r=e(14),i=e(4),s=e(11),n=e(49),u=e(183).trim,p=e(146),d=s("".charAt),m=r.parseFloat,c=r.Symbol,h=c&&c.iterator,a=1/m(p+"-0")!=-1/0||h&&!i(function(){m(Object(h))});o.exports=a?function(y){var T=u(n(y)),v=m(T);return v===0&&d(T,0)=="-"?-0:v}:m},function(o,k,e){var r=e(558);o.exports=r},function(o,k,e){e(559);var r=e(12);o.exports=r.parseInt},function(o,k,e){var r=e(1),i=e(560);r({global:!0,forced:parseInt!=i},{parseInt:i})},function(o,k,e){var r=e(14),i=e(4),s=e(11),n=e(49),u=e(183).trim,p=e(146),d=r.parseInt,m=r.Symbol,c=m&&m.iterator,h=/^[+-]?0x/i,a=s(h.exec),y=d(p+"08")!==8||d(p+"0x16")!==22||c&&!i(function(){d(Object(c))});o.exports=y?function(T,v){var g=u(n(T));return d(g,v>>>0||(a(h,g)?16:10))}:d},function(o,k,e){var r=e(15),i=e(23),s=e(3),n=e(562),u=e(563),p=e(0).getGlobal(),d=e(74).name,m=typeof n=="function",c=p.indexedDB&&!/^(IE)$/.test(d);function h(y,T){this.logWorker=null,this.db=null,this.logQueue=[],this.callbackList=[],this.preTime=null,this.lastTime=+new Date,this.saveLogTimer=void 0,this.initLogLocal({name:y,expire:T})}var a=h.prototype;h.enable=!0,a.saveLog=function(y){var T=this;try{if(!h.enable)return;var v,g=this.logQueue.length,b=this.logQueue[g-1];if(y.time===this.preTime&&b)return void(b.log+=`\r
`+y.log);this.logQueue.length>50||y.time-this.lastTime>3e3&&this.logQueue.length>0?(this.doSaveLog(r(v=this.logQueue).call(v,0)),this.lastTime=b.time,this.logQueue=[],clearTimeout(this.saveLogTimer)):(clearTimeout(this.saveLogTimer),this.saveLogTimer=i(function(){var S;T.logQueue.length>0&&(b=T.logQueue[T.logQueue.length-1],T.doSaveLog(r(S=T.logQueue).call(S,0)),T.lastTime=b.time,T.logQueue=[])},3e3-(y.time-this.lastTime))),this.logQueue.push(y),this.preTime=y.time}catch(S){console.error("saveLog Error",S)}},a.destroy=function(){if(this.logQueue.length>0){var y,T=this.logQueue[this.logQueue.length-1];this.doSaveLog(r(y=this.logQueue).call(y,0)),this.lastTime=T.time,this.logQueue=[]}clearTimeout(this.saveLogTimer)},a.doSaveLog=function(){},a.initLogLocal=function(){},a.fetchLog=function(){},a.deleteLogs=function(){},a.logError=function(){},c?m?(a.doSaveLog=function(y){this.logWorker.postMessage(y)},a.initLogLocal=function(y){var T=this;this.logWorker=new n({}),this.logWorker.onmessage=function(v){var g=v.data||{};switch(g.type){case"fetchDone":T.fetchLogDone(g.code,g.msg);break;case"error":T.logError(g.msg)}},this.logWorker.postMessage({type:"init",msg:y})},a.fetchLog=function(){var y=this;return new s(function(T,v){y.callbackList.length===0&&y.logWorker.postMessage({type:"fetch"}),y.callbackList.push(T),y.callbackList.push(v)})},a.fetchLogDone=function(y,T){for(var v=y===200?0:1,g=0;g<this.callbackList.length/2;g++)this.callbackList[2*g+v](T);this.callbackList=[]},a.deleteLogs=function(y){return this.logWorker.postMessage({type:"delete",msg:y}),s.resolve()}):(a.doSaveLog=function(y){var T=this;this.db.putLog(y).catch(function(v){T.logError({msg:"putLog error",error:v})})},a.initLogLocal=function(y){var T=this;this.db=new u(y),this.db.init().catch(function(v){T.logError({msg:"dbLog init error",error:v})})},a.fetchLog=function(){return this.db.getAllLogs()},a.deleteLogs=function(y){return this.db.deleteLogs(y)}):h.enable=!1,o.exports=h},function(o,k,e){e.r(k),e.d(k,"default",function(){return s});var r=e(297),i=e.n(r);function s(){return i()(`/*!
 * 
 * VERSION: 8.9.117
 * Git Hash: 34abf391f0556018489da1dd0fd37bc72560c33e
 * 
 * Create At: 2023/9/22 下午3:15:34
 * 
 * Target: NIM_Web_log.worker
 */!function(t){var n={};function r(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)r.d(e,o,function(n){return t[n]}.bind(null,o));return e},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=109)}([function(t,n,r){"use strict";var e=r(1),o=r(41),i=r(78),c=r(2),u=r(43).f,a=r(84),f=r(13),s=r(34),p=r(19),l=r(8),v=function(t){var n=function(r,e,i){if(this instanceof n){switch(arguments.length){case 0:return new t;case 1:return new t(r);case 2:return new t(r,e)}return new t(r,e,i)}return o(t,this,arguments)};return n.prototype=t.prototype,n};t.exports=function(t,n){var r,o,d,y,h,m,g,x,b,w=t.target,S=t.global,j=t.stat,O=t.proto,P=S?e:j?e[w]:(e[w]||{}).prototype,T=S?f:f[w]||p(f,w,{})[w],A=T.prototype;for(y in n)o=!(r=a(S?y:w+(j?".":"#")+y,t.forced))&&P&&l(P,y),m=T[y],o&&(g=t.dontCallGetSet?(b=u(P,y))&&b.value:P[y]),h=o&&g?g:n[y],o&&typeof m==typeof h||(x=t.bind&&o?s(h,e):t.wrap&&o?v(h):O&&c(h)?i(h):h,(t.sham||h&&h.sham||m&&m.sham)&&p(x,"sham",!0),p(T,y,x),O&&(l(f,d=w+"Prototype")||p(f,d,{}),p(f[d],y,h),t.real&&A&&(r||!A[y])&&p(A,y,h)))}},function(t,n,r){(function(n){var r=function(t){return t&&t.Math==Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n&&n)||function(){return this}()||Function("return this")()}).call(this,r(77))},function(t,n,r){var e=r(79),o=e.all;t.exports=e.IS_HTMLDDA?function(t){return"function"==typeof t||t===o}:function(t){return"function"==typeof t}},function(t,n,r){var e=r(13),o=r(8),i=r(75),c=r(16).f;t.exports=function(t){var n=e.Symbol||(e.Symbol={});o(n,t)||c(n,t,{value:i.f(t)})}},function(t,n,r){var e=r(1),o=r(33),i=r(8),c=r(60),u=r(24),a=r(82),f=o("wks"),s=e.Symbol,p=s&&s.for,l=a?s:s&&s.withoutSetter||c;t.exports=function(t){if(!i(f,t)||!u&&"string"!=typeof f[t]){var n="Symbol."+t;u&&i(s,t)?f[t]=s[t]:f[t]=a&&p?p(n):l(n)}return f[t]}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(42),o=Function.prototype,i=o.call,c=e&&o.bind.bind(i,i);t.exports=e?c:function(t){return function(){return i.apply(t,arguments)}}},function(t,n,r){var e=r(42),o=Function.prototype.call;t.exports=e?o.bind(o):function(){return o.apply(o,arguments)}},function(t,n,r){var e=r(6),o=r(25),i=e({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,n){return i(o(t),n)}},function(t,n,r){var e=r(13),o=r(1),i=r(2),c=function(t){return i(t)?t:void 0};t.exports=function(t,n){return arguments.length<2?c(e[t])||c(o[t]):e[t]&&e[t][n]||o[t]&&o[t][n]}},function(t,n,r){var e=r(2),o=r(79),i=o.all;t.exports=o.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:e(t)||t===i}:function(t){return"object"==typeof t?null!==t:e(t)}},function(t,n,r){var e=r(5);t.exports=!e((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(t,n,r){var e=r(10),o=String,i=TypeError;t.exports=function(t){if(e(t))return t;throw i(o(t)+" is not an object")}},function(t,n){t.exports={}},function(t,n,r){var e=r(6);t.exports=e({}.isPrototypeOf)},function(t,n){t.exports=!0},function(t,n,r){var e=r(11),o=r(83),i=r(85),c=r(12),u=r(45),a=TypeError,f=Object.defineProperty,s=Object.getOwnPropertyDescriptor;n.f=e?i?function(t,n,r){if(c(t),n=u(n),c(r),"function"==typeof t&&"prototype"===n&&"value"in r&&"writable"in r&&!r.writable){var e=s(t,n);e&&e.writable&&(t[n]=r.value,r={configurable:"configurable"in r?r.configurable:e.configurable,enumerable:"enumerable"in r?r.enumerable:e.enumerable,writable:!1})}return f(t,n,r)}:f:function(t,n,r){if(c(t),n=u(n),c(r),o)try{return f(t,n,r)}catch(t){}if("get"in r||"set"in r)throw a("Accessors not supported");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(2),o=r(32),i=TypeError;t.exports=function(t){if(e(t))return t;throw i(o(t)+" is not a function")}},function(t,n,r){var e=r(81),o=r(57);t.exports=function(t){return e(o(t))}},function(t,n,r){var e=r(11),o=r(16),i=r(20);t.exports=e?function(t,n,r){return o.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,r){var e=r(19);t.exports=function(t,n,r,o){return o&&o.enumerable?t[n]=r:e(t,n,r),t}},function(t,n,r){"use strict";var e=r(17),o=TypeError,i=function(t){var n,r;this.promise=new t((function(t,e){if(void 0!==n||void 0!==r)throw o("Bad Promise constructor");n=t,r=e})),this.resolve=e(n),this.reject=e(r)};t.exports.f=function(t){return new i(t)}},function(t,n,r){var e=r(6),o=e({}.toString),i=e("".slice);t.exports=function(t){return i(o(t),8,-1)}},function(t,n,r){var e=r(47),o=r(5);t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&e&&e<41}))},function(t,n,r){var e=r(57),o=Object;t.exports=function(t){return o(e(t))}},function(t,n,r){var e=r(124);t.exports=function(t){return e(t.length)}},function(t,n){t.exports={}},function(t,n,r){var e=r(70),o=r(2),i=r(23),c=r(4)("toStringTag"),u=Object,a="Arguments"==i(function(){return arguments}());t.exports=e?i:function(t){var n,r,e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,n){try{return t[n]}catch(t){}}(n=u(t),c))?r:a?i(n):"Object"==(e=i(n))&&o(n.callee)?"Arguments":e}},function(t,n,r){var e=r(70),o=r(16).f,i=r(19),c=r(8),u=r(136),a=r(4)("toStringTag");t.exports=function(t,n,r,f){if(t){var s=r?t:t.prototype;c(s,a)||o(s,a,{configurable:!0,value:n}),f&&!e&&i(s,"toString",u)}}},function(t,n,r){var e=r(1);t.exports=e.Promise},function(t,n,r){var e=r(9);t.exports=e("navigator","userAgent")||""},function(t,n){var r=String;t.exports=function(t){try{return r(t)}catch(t){return"Object"}}},function(t,n,r){var e=r(15),o=r(59);(t.exports=function(t,n){return o[t]||(o[t]=void 0!==n?n:{})})("versions",[]).push({version:"3.27.1",mode:e?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(t,n,r){var e=r(78),o=r(17),i=r(42),c=e(e.bind);t.exports=function(t,n){return o(t),void 0===n?t:i?c(t,n):function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(34),o=r(7),i=r(12),c=r(32),u=r(127),a=r(26),f=r(14),s=r(128),p=r(89),l=r(129),v=TypeError,d=function(t,n){this.stopped=t,this.result=n},y=d.prototype;t.exports=function(t,n,r){var h,m,g,x,b,w,S,j=r&&r.that,O=!(!r||!r.AS_ENTRIES),P=!(!r||!r.IS_RECORD),T=!(!r||!r.IS_ITERATOR),A=!(!r||!r.INTERRUPTED),E=e(n,j),k=function(t){return h&&l(h,"normal",t),new d(!0,t)},I=function(t){return O?(i(t),A?E(t[0],t[1],k):E(t[0],t[1])):A?E(t,k):E(t)};if(P)h=t.iterator;else if(T)h=t;else{if(!(m=p(t)))throw v(c(t)+" is not iterable");if(u(m)){for(g=0,x=a(t);x>g;g++)if((b=I(t[g]))&&f(y,b))return b;return new d(!1)}h=s(t,m)}for(w=P?t.next:h.next;!(S=o(w,h)).done;){try{b=I(S.value)}catch(t){l(h,"throw",t)}if("object"==typeof b&&b&&f(y,b))return b}return new d(!1)}},function(t,n,r){var e=r(28),o=String;t.exports=function(t){if("Symbol"===e(t))throw TypeError("Cannot convert a Symbol value to a string");return o(t)}},function(t,n){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},function(t,n,r){var e=r(1),o=r(30),i=r(2),c=r(84),u=r(94),a=r(4),f=r(147),s=r(98),p=r(15),l=r(47),v=o&&o.prototype,d=a("species"),y=!1,h=i(e.PromiseRejectionEvent),m=c("Promise",(function(){var t=u(o),n=t!==String(o);if(!n&&66===l)return!0;if(p&&(!v.catch||!v.finally))return!0;if(!l||l<51||!/native code/.test(t)){var r=new o((function(t){t(1)})),e=function(t){t((function(){}),(function(){}))};if((r.constructor={})[d]=e,!(y=r.then((function(){}))instanceof e))return!0}return!n&&(f||s)&&!h}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:h,SUBCLASSING:y}},function(t,n,r){var e=r(23);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){var e=r(13);t.exports=function(t){return e[t+"Prototype"]}},function(t,n,r){var e=r(42),o=Function.prototype,i=o.apply,c=o.call;t.exports="object"==typeof Reflect&&Reflect.apply||(e?c.bind(i):function(){return c.apply(i,arguments)})},function(t,n,r){var e=r(5);t.exports=!e((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},function(t,n,r){var e=r(11),o=r(7),i=r(80),c=r(20),u=r(18),a=r(45),f=r(8),s=r(83),p=Object.getOwnPropertyDescriptor;n.f=e?p:function(t,n){if(t=u(t),n=a(n),s)try{return p(t,n)}catch(t){}if(f(t,n))return c(!o(i.f,t,n),t[n])}},function(t,n){t.exports=function(t){return null==t}},function(t,n,r){var e=r(115),o=r(46);t.exports=function(t){var n=e(t,"string");return o(n)?n:n+""}},function(t,n,r){var e=r(9),o=r(2),i=r(14),c=r(82),u=Object;t.exports=c?function(t){return"symbol"==typeof t}:function(t){var n=e("Symbol");return o(n)&&i(n.prototype,u(t))}},function(t,n,r){var e,o,i=r(1),c=r(31),u=i.process,a=i.Deno,f=u&&u.versions||a&&a.version,s=f&&f.v8;s&&(o=(e=s.split("."))[0]>0&&e[0]<4?1:+(e[0]+e[1])),!o&&c&&(!(e=c.match(/Edge\\/(\\d+)/))||e[1]>=74)&&(e=c.match(/Chrome\\/(\\d+)/))&&(o=+e[1]),t.exports=o},function(t,n,r){var e=r(33),o=r(60),i=e("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,n){t.exports={}},function(t,n,r){var e,o=r(12),i=r(87),c=r(67),u=r(49),a=r(88),f=r(61),s=r(48),p=s("IE_PROTO"),l=function(){},v=function(t){return"<script>"+t+"<\\/script>"},d=function(t){t.write(v("")),t.close();var n=t.parentWindow.Object;return t=null,n},y=function(){try{e=new ActiveXObject("htmlfile")}catch(t){}var t,n;y="undefined"!=typeof document?document.domain&&e?d(e):((n=f("iframe")).style.display="none",a.appendChild(n),n.src=String("javascript:"),(t=n.contentWindow.document).open(),t.write(v("document.F=Object")),t.close(),t.F):d(e);for(var r=c.length;r--;)delete y.prototype[c[r]];return y()};u[p]=!0,t.exports=Object.create||function(t,n){var r;return null!==t?(l.prototype=o(t),r=new l,l.prototype=null,r[p]=t):r=y(),void 0===n?r:i.f(r,n)}},function(t,n,r){var e,o,i,c=r(133),u=r(1),a=r(10),f=r(19),s=r(8),p=r(59),l=r(48),v=r(49),d=u.TypeError,y=u.WeakMap;if(c||p.state){var h=p.state||(p.state=new y);h.get=h.get,h.has=h.has,h.set=h.set,e=function(t,n){if(h.has(t))throw d("Object already initialized");return n.facade=t,h.set(t,n),n},o=function(t){return h.get(t)||{}},i=function(t){return h.has(t)}}else{var m=l("state");v[m]=!0,e=function(t,n){if(s(t,m))throw d("Object already initialized");return n.facade=t,f(t,m,n),n},o=function(t){return s(t,m)?t[m]:{}},i=function(t){return s(t,m)}}t.exports={set:e,get:o,has:i,enforce:function(t){return i(t)?o(t):e(t,{})},getterFor:function(t){return function(n){var r;if(!a(n)||(r=o(n)).type!==t)throw d("Incompatible receiver, "+t+" required");return r}}}},function(t,n,r){var e=r(23),o=r(1);t.exports="process"==e(o.process)},function(t,n,r){var e=r(6);t.exports=e([].slice)},function(t,n,r){r(71);var e=r(158),o=r(1),i=r(28),c=r(19),u=r(27),a=r(4)("toStringTag");for(var f in e){var s=o[f],p=s&&s.prototype;p&&i(p)!==a&&c(p,a,f),u[f]=u.Array}},function(t,n,r){var e=r(5),o=r(4),i=r(47),c=o("species");t.exports=function(t){return i>=51||!e((function(){var n=[];return(n.constructor={})[c]=function(){return{foo:1}},1!==n[t](Boolean).foo}))}},function(t,n,r){var e=r(34),o=r(6),i=r(81),c=r(25),u=r(26),a=r(103),f=o([].push),s=function(t){var n=1==t,r=2==t,o=3==t,s=4==t,p=6==t,l=7==t,v=5==t||p;return function(d,y,h,m){for(var g,x,b=c(d),w=i(b),S=e(y,h),j=u(w),O=0,P=m||a,T=n?P(d,j):r||l?P(d,0):void 0;j>O;O++)if((v||O in w)&&(x=S(g=w[O],O,b),t))if(n)T[O]=x;else if(x)switch(t){case 3:return!0;case 5:return g;case 6:return O;case 2:f(T,g)}else switch(t){case 4:return!1;case 7:f(T,g)}return p?-1:o||s?s:T}};t.exports={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterReject:s(7)}},function(t,n,r){var e=r(44),o=TypeError;t.exports=function(t){if(e(t))throw o("Can't call method on "+t);return t}},function(t,n,r){var e=r(17),o=r(44);t.exports=function(t,n){var r=t[n];return o(r)?void 0:e(r)}},function(t,n,r){var e=r(1),o=r(117),i=e["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},function(t,n,r){var e=r(6),o=0,i=Math.random(),c=e(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+c(++o+i,36)}},function(t,n,r){var e=r(1),o=r(10),i=e.document,c=o(i)&&o(i.createElement);t.exports=function(t){return c?i.createElement(t):{}}},function(t,n,r){var e=r(8),o=r(2),i=r(25),c=r(48),u=r(118),a=c("IE_PROTO"),f=Object,s=f.prototype;t.exports=u?f.getPrototypeOf:function(t){var n=i(t);if(e(n,a))return n[a];var r=n.constructor;return o(r)&&n instanceof r?r.prototype:n instanceof f?s:null}},function(t,n,r){var e=r(6),o=r(12),i=r(119);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,n=!1,r={};try{(t=e(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),n=r instanceof Array}catch(t){}return function(r,e){return o(r),i(e),n?t(r,e):r.__proto__=e,r}}():void 0)},function(t,n,r){var e=r(86),o=r(67).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,o)}},function(t,n,r){var e=r(66),o=Math.max,i=Math.min;t.exports=function(t,n){var r=e(t);return r<0?o(r+n,0):i(r,n)}},function(t,n,r){var e=r(123);t.exports=function(t){var n=+t;return n!=n||0===n?0:e(n)}},function(t,n){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(86),o=r(67);t.exports=Object.keys||function(t){return e(t,o)}},function(t,n,r){var e={};e[r(4)("toStringTag")]="z",t.exports="[object z]"===String(e)},function(t,n,r){"use strict";var e=r(18),o=r(132),i=r(27),c=r(51),u=r(16).f,a=r(90),f=r(92),s=r(15),p=r(11),l=c.set,v=c.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,n){l(this,{type:"Array Iterator",target:e(t),index:0,kind:n})}),(function(){var t=v(this),n=t.target,r=t.kind,e=t.index++;return!n||e>=n.length?(t.target=void 0,f(void 0,!0)):f("keys"==r?e:"values"==r?n[e]:[e,n[e]],!1)}),"values");var d=i.Arguments=i.Array;if(o("keys"),o("values"),o("entries"),!s&&p&&"values"!==d.name)try{u(d,"name",{value:"values"})}catch(t){}},function(t,n){},function(t,n,r){var e=r(6),o=r(5),i=r(2),c=r(28),u=r(9),a=r(94),f=function(){},s=[],p=u("Reflect","construct"),l=/^\\s*(?:class|function)\\b/,v=e(l.exec),d=!l.exec(f),y=function(t){if(!i(t))return!1;try{return p(f,s,t),!0}catch(t){return!1}},h=function(t){if(!i(t))return!1;switch(c(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!v(l,a(t))}catch(t){return!0}};h.sham=!0,t.exports=!p||o((function(){var t;return y(y.call)||!y(Object)||!y((function(){t=!0}))||t}))?h:y},function(t,n,r){"use strict";var e=r(45),o=r(16),i=r(20);t.exports=function(t,n,r){var c=e(n);c in t?o.f(t,c,i(0,r)):t[c]=r}},function(t,n,r){var e=r(4);n.f=e},function(t,n,r){t.exports=r(111)},function(t,n){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,n,r){var e=r(23),o=r(6);t.exports=function(t){if("Function"===e(t))return o(t)}},function(t,n){var r="object"==typeof document&&document.all,e=void 0===r&&void 0!==r;t.exports={all:r,IS_HTMLDDA:e}},function(t,n,r){"use strict";var e={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!e.call({1:2},1);n.f=i?function(t){var n=o(this,t);return!!n&&n.enumerable}:e},function(t,n,r){var e=r(6),o=r(5),i=r(23),c=Object,u=e("".split);t.exports=o((function(){return!c("z").propertyIsEnumerable(0)}))?function(t){return"String"==i(t)?u(t,""):c(t)}:c},function(t,n,r){var e=r(24);t.exports=e&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,n,r){var e=r(11),o=r(5),i=r(61);t.exports=!e&&!o((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(t,n,r){var e=r(5),o=r(2),i=/#|\\.prototype\\./,c=function(t,n){var r=a[u(t)];return r==s||r!=f&&(o(n)?e(n):!!n)},u=c.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=c.data={},f=c.NATIVE="N",s=c.POLYFILL="P";t.exports=c},function(t,n,r){var e=r(11),o=r(5);t.exports=e&&o((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(t,n,r){var e=r(6),o=r(8),i=r(18),c=r(122).indexOf,u=r(49),a=e([].push);t.exports=function(t,n){var r,e=i(t),f=0,s=[];for(r in e)!o(u,r)&&o(e,r)&&a(s,r);for(;n.length>f;)o(e,r=n[f++])&&(~c(s,r)||a(s,r));return s}},function(t,n,r){var e=r(11),o=r(85),i=r(16),c=r(12),u=r(18),a=r(69);n.f=e&&!o?Object.defineProperties:function(t,n){c(t);for(var r,e=u(n),o=a(n),f=o.length,s=0;f>s;)i.f(t,r=o[s++],e[r]);return t}},function(t,n,r){var e=r(9);t.exports=e("document","documentElement")},function(t,n,r){var e=r(28),o=r(58),i=r(44),c=r(27),u=r(4)("iterator");t.exports=function(t){if(!i(t))return o(t,u)||o(t,"@@iterator")||c[e(t)]}},function(t,n,r){"use strict";var e=r(0),o=r(7),i=r(15),c=r(134),u=r(2),a=r(135),f=r(62),s=r(63),p=r(29),l=r(19),v=r(21),d=r(4),y=r(27),h=r(91),m=c.PROPER,g=c.CONFIGURABLE,x=h.IteratorPrototype,b=h.BUGGY_SAFARI_ITERATORS,w=d("iterator"),S=function(){return this};t.exports=function(t,n,r,c,d,h,j){a(r,n,c);var O,P,T,A=function(t){if(t===d&&L)return L;if(!b&&t in I)return I[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},E=n+" Iterator",k=!1,I=t.prototype,D=I[w]||I["@@iterator"]||d&&I[d],L=!b&&D||A(d),_="Array"==n&&I.entries||D;if(_&&(O=f(_.call(new t)))!==Object.prototype&&O.next&&(i||f(O)===x||(s?s(O,x):u(O[w])||v(O,w,S)),p(O,E,!0,!0),i&&(y[E]=S)),m&&"values"==d&&D&&"values"!==D.name&&(!i&&g?l(I,"name","values"):(k=!0,L=function(){return o(D,this)})),d)if(P={values:A("values"),keys:h?L:A("keys"),entries:A("entries")},j)for(T in P)(b||k||!(T in I))&&v(I,T,P[T]);else e({target:n,proto:!0,forced:b||k},P);return i&&!j||I[w]===L||v(I,w,L,{name:d}),y[n]=L,P}},function(t,n,r){"use strict";var e,o,i,c=r(5),u=r(2),a=r(10),f=r(50),s=r(62),p=r(21),l=r(4),v=r(15),d=l("iterator"),y=!1;[].keys&&("next"in(i=[].keys())?(o=s(s(i)))!==Object.prototype&&(e=o):y=!0),!a(e)||c((function(){var t={};return e[d].call(t)!==t}))?e={}:v&&(e=f(e)),u(e[d])||p(e,d,(function(){return this})),t.exports={IteratorPrototype:e,BUGGY_SAFARI_ITERATORS:y}},function(t,n){t.exports=function(t,n){return{value:t,done:n}}},function(t,n,r){var e=r(12),o=r(141),i=r(44),c=r(4)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||i(r=e(u)[c])?n:o(r)}},function(t,n,r){var e=r(6),o=r(2),i=r(59),c=e(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return c(t)}),t.exports=i.inspectSource},function(t,n,r){var e,o,i,c,u=r(1),a=r(41),f=r(34),s=r(2),p=r(8),l=r(5),v=r(88),d=r(53),y=r(61),h=r(96),m=r(97),g=r(52),x=u.setImmediate,b=u.clearImmediate,w=u.process,S=u.Dispatch,j=u.Function,O=u.MessageChannel,P=u.String,T=0,A={};try{e=u.location}catch(t){}var E=function(t){if(p(A,t)){var n=A[t];delete A[t],n()}},k=function(t){return function(){E(t)}},I=function(t){E(t.data)},D=function(t){u.postMessage(P(t),e.protocol+"//"+e.host)};x&&b||(x=function(t){h(arguments.length,1);var n=s(t)?t:j(t),r=d(arguments,1);return A[++T]=function(){a(n,void 0,r)},o(T),T},b=function(t){delete A[t]},g?o=function(t){w.nextTick(k(t))}:S&&S.now?o=function(t){S.now(k(t))}:O&&!m?(c=(i=new O).port2,i.port1.onmessage=I,o=f(c.postMessage,c)):u.addEventListener&&s(u.postMessage)&&!u.importScripts&&e&&"file:"!==e.protocol&&!l(D)?(o=D,u.addEventListener("message",I,!1)):o="onreadystatechange"in y("script")?function(t){v.appendChild(y("script")).onreadystatechange=function(){v.removeChild(this),E(t)}}:function(t){setTimeout(k(t),0)}),t.exports={set:x,clear:b}},function(t,n){var r=TypeError;t.exports=function(t,n){if(t<n)throw r("Not enough arguments");return t}},function(t,n,r){var e=r(31);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(e)},function(t,n){t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},function(t,n,r){var e=r(30),o=r(149),i=r(38).CONSTRUCTOR;t.exports=i||!o((function(t){e.all(t).then(void 0,(function(){}))}))},function(t,n,r){var e=r(12),o=r(10),i=r(22);t.exports=function(t,n){if(e(t),o(n)&&n.constructor===t)return n;var r=i.f(t);return(0,r.resolve)(n),r.promise}},function(t,n,r){"use strict";var e=r(157).charAt,o=r(36),i=r(51),c=r(90),u=r(92),a=i.set,f=i.getterFor("String Iterator");c(String,"String",(function(t){a(this,{type:"String Iterator",string:o(t),index:0})}),(function(){var t,n=f(this),r=n.string,o=n.index;return o>=r.length?u(void 0,!0):(t=e(r,o),n.index+=t.length,u(t,!1))}))},function(t,n,r){t.exports=r(159)},function(t,n,r){var e=r(168);t.exports=function(t,n){return new(e(t))(0===n?0:n)}},function(t,n,r){"use strict";var e=r(0),o=r(5),i=r(39),c=r(10),u=r(25),a=r(26),f=r(177),s=r(74),p=r(103),l=r(55),v=r(4),d=r(47),y=v("isConcatSpreadable"),h=d>=51||!o((function(){var t=[];return t[y]=!1,t.concat()[0]!==t})),m=l("concat"),g=function(t){if(!c(t))return!1;var n=t[y];return void 0!==n?!!n:i(t)};e({target:"Array",proto:!0,arity:1,forced:!h||!m},{concat:function(t){var n,r,e,o,i,c=u(this),l=p(c,0),v=0;for(n=-1,e=arguments.length;n<e;n++)if(g(i=-1===n?c:arguments[n]))for(o=a(i),f(v+o),r=0;r<o;r++,v++)r in i&&s(l,v,i[r]);else f(v+1),s(l,v++,i);return l.length=v,l}})},function(t,n,r){var e=r(7),o=r(9),i=r(4),c=r(21);t.exports=function(){var t=o("Symbol"),n=t&&t.prototype,r=n&&n.valueOf,u=i("toPrimitive");n&&!n[u]&&c(n,u,(function(t){return e(r,this)}),{arity:1})}},function(t,n,r){var e=r(24);t.exports=e&&!!Symbol.for&&!!Symbol.keyFor},function(t,n,r){r(3)("iterator")},function(t,n,r){"use strict";var e,o=r(1),i=r(41),c=r(2),u=r(220),a=r(31),f=r(53),s=r(96),p=o.Function,l=/MSIE .\\./.test(a)||u&&((e=o.Bun.version.split(".")).length<3||0==e[0]&&(e[1]<3||3==e[1]&&0==e[2]));t.exports=function(t,n){var r=n?2:1;return l?function(e,o){var u=s(arguments.length,1)>r,a=c(e)?e:p(e),l=u?f(arguments,r):[],v=u?function(){i(a,this,l)}:a;return n?t(v,o):t(v)}:t}},function(t,n,r){var e=r(110),o=null;function i(t){return t&&"string"!=typeof t?t.message?t.message:t.target&&t.target.error?t.target.error.message:"unknown error":t}self.onmessage=function(t){switch(t.data.type){case"init":r=t.data.msg,(o=new e(r)).init().catch((function(t){postMessage({type:"error",msg:{msg:"dbLog init error",error:i(t)}})}));break;case"fetch":o.getAllLogs().then((function(t){postMessage({type:"fetchDone",code:200,msg:t})})).catch((function(t){postMessage({type:"fetchDone",code:500,msg:i(t)})}));break;case"delete":o.deleteLogs(n).catch((function(t){postMessage({type:"deleteLogs",code:500,msg:i(t)})}));break;default:!function(t){if(!o)return;o.putLog(t).then((function(){postMessage(200)})).catch((function(t){postMessage({type:"error",msg:{msg:"putLog error",error:i(t)}})}))}(t.data)}var n,r}},function(t,n,r){var e=r(76),o=r(102),i=r(163),c=r(169),u={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.server=null,this.expire=t.expire||72,this.name=t.name}var f=a.prototype;f.init=function(){var t=this;if(!this.server)return c.open({server:"nim-log-"+this.name,version:1,schema:u}).then((function(n){t.server=n}))},f.putLog=function(t){var n=this;if(!this.server)return e.reject("no db server");var r=o(t).call(t,-1)[0].time-36e5*this.expire;return this.deleteLogs(r).then((function(){return n.server.add("log",t)}))},f.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then((function(t){var n={},r=o(t).call(t,-1)[0];return n.logs=i(t).call(t,(function(t){return t.log})).join("\\r\\n"),n.time=r&&r.time,n})):e.reject("no db server")},f.deleteLogs=function(t){return this.server?this.server.remove("log",null,"time",0,t):e.reject("no db server")},t.exports=a},function(t,n,r){var e=r(112);r(54),t.exports=e},function(t,n,r){r(113),r(71),r(72),r(137),r(154),r(155),r(156),r(101);var e=r(13);t.exports=e.Promise},function(t,n,r){r(114)},function(t,n,r){"use strict";var e=r(0),o=r(14),i=r(62),c=r(63),u=r(120),a=r(50),f=r(19),s=r(20),p=r(125),l=r(126),v=r(35),d=r(130),y=r(4),h=r(131),m=y("toStringTag"),g=Error,x=[].push,b=function(t,n){var r,e=arguments.length>2?arguments[2]:void 0,u=o(w,this);c?r=c(g(),u?i(this):w):(r=u?this:a(w),f(r,m,"Error")),void 0!==n&&f(r,"message",d(n)),h&&f(r,"stack",p(r.stack,1)),l(r,e);var s=[];return v(t,x,{that:s}),f(r,"errors",s),r};c?c(b,g):u(b,g,{name:!0});var w=b.prototype=a(g.prototype,{constructor:s(1,b),message:s(1,""),name:s(1,"AggregateError")});e({global:!0,constructor:!0,arity:2},{AggregateError:b})},function(t,n,r){var e=r(7),o=r(10),i=r(46),c=r(58),u=r(116),a=r(4),f=TypeError,s=a("toPrimitive");t.exports=function(t,n){if(!o(t)||i(t))return t;var r,a=c(t,s);if(a){if(void 0===n&&(n="default"),r=e(a,t,n),!o(r)||i(r))return r;throw f("Can't convert object to primitive value")}return void 0===n&&(n="number"),u(t,n)}},function(t,n,r){var e=r(7),o=r(2),i=r(10),c=TypeError;t.exports=function(t,n){var r,u;if("string"===n&&o(r=t.toString)&&!i(u=e(r,t)))return u;if(o(r=t.valueOf)&&!i(u=e(r,t)))return u;if("string"!==n&&o(r=t.toString)&&!i(u=e(r,t)))return u;throw c("Can't convert object to primitive value")}},function(t,n,r){var e=r(1),o=Object.defineProperty;t.exports=function(t,n){try{o(e,t,{value:n,configurable:!0,writable:!0})}catch(r){e[t]=n}return n}},function(t,n,r){var e=r(5);t.exports=!e((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},function(t,n,r){var e=r(2),o=String,i=TypeError;t.exports=function(t){if("object"==typeof t||e(t))return t;throw i("Can't set "+o(t)+" as a prototype")}},function(t,n,r){var e=r(8),o=r(121),i=r(43),c=r(16);t.exports=function(t,n,r){for(var u=o(n),a=c.f,f=i.f,s=0;s<u.length;s++){var p=u[s];e(t,p)||r&&e(r,p)||a(t,p,f(n,p))}}},function(t,n,r){var e=r(9),o=r(6),i=r(64),c=r(68),u=r(12),a=o([].concat);t.exports=e("Reflect","ownKeys")||function(t){var n=i.f(u(t)),r=c.f;return r?a(n,r(t)):n}},function(t,n,r){var e=r(18),o=r(65),i=r(26),c=function(t){return function(n,r,c){var u,a=e(n),f=i(a),s=o(c,f);if(t&&r!=r){for(;f>s;)if((u=a[s++])!=u)return!0}else for(;f>s;s++)if((t||s in a)&&a[s]===r)return t||s||0;return!t&&-1}};t.exports={includes:c(!0),indexOf:c(!1)}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=Math.trunc||function(t){var n=+t;return(n>0?e:r)(n)}},function(t,n,r){var e=r(66),o=Math.min;t.exports=function(t){return t>0?o(e(t),9007199254740991):0}},function(t,n,r){var e=r(6),o=Error,i=e("".replace),c=String(o("zxcasd").stack),u=/\\n\\s*at [^:]*:[^\\n]*/,a=u.test(c);t.exports=function(t,n){if(a&&"string"==typeof t&&!o.prepareStackTrace)for(;n--;)t=i(t,u,"");return t}},function(t,n,r){var e=r(10),o=r(19);t.exports=function(t,n){e(n)&&"cause"in n&&o(t,"cause",n.cause)}},function(t,n,r){var e=r(4),o=r(27),i=e("iterator"),c=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||c[i]===t)}},function(t,n,r){var e=r(7),o=r(17),i=r(12),c=r(32),u=r(89),a=TypeError;t.exports=function(t,n){var r=arguments.length<2?u(t):n;if(o(r))return i(e(r,t));throw a(c(t)+" is not iterable")}},function(t,n,r){var e=r(7),o=r(12),i=r(58);t.exports=function(t,n,r){var c,u;o(t);try{if(!(c=i(t,"return"))){if("throw"===n)throw r;return r}c=e(c,t)}catch(t){u=!0,c=t}if("throw"===n)throw r;if(u)throw c;return o(c),r}},function(t,n,r){var e=r(36);t.exports=function(t,n){return void 0===t?arguments.length<2?"":n:e(t)}},function(t,n,r){var e=r(5),o=r(20);t.exports=!e((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",o(1,7)),7!==t.stack)}))},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(1),o=r(2),i=e.WeakMap;t.exports=o(i)&&/native code/.test(String(i))},function(t,n,r){var e=r(11),o=r(8),i=Function.prototype,c=e&&Object.getOwnPropertyDescriptor,u=o(i,"name"),a=u&&"something"===function(){}.name,f=u&&(!e||e&&c(i,"name").configurable);t.exports={EXISTS:u,PROPER:a,CONFIGURABLE:f}},function(t,n,r){"use strict";var e=r(91).IteratorPrototype,o=r(50),i=r(20),c=r(29),u=r(27),a=function(){return this};t.exports=function(t,n,r,f){var s=n+" Iterator";return t.prototype=o(e,{next:i(+!f,r)}),c(t,s,!1,!0),u[s]=a,t}},function(t,n,r){"use strict";var e=r(70),o=r(28);t.exports=e?{}.toString:function(){return"[object "+o(this)+"]"}},function(t,n,r){r(138),r(148),r(150),r(151),r(152),r(153)},function(t,n,r){"use strict";var e,o,i,c=r(0),u=r(15),a=r(52),f=r(1),s=r(7),p=r(21),l=r(63),v=r(29),d=r(139),y=r(17),h=r(2),m=r(10),g=r(140),x=r(93),b=r(95).set,w=r(142),S=r(145),j=r(37),O=r(146),P=r(51),T=r(30),A=r(38),E=r(22),k=A.CONSTRUCTOR,I=A.REJECTION_EVENT,D=A.SUBCLASSING,L=P.getterFor("Promise"),_=P.set,C=T&&T.prototype,M=T,R=C,N=f.TypeError,F=f.document,B=f.process,G=E.f,U=G,z=!!(F&&F.createEvent&&f.dispatchEvent),q=function(t){var n;return!(!m(t)||!h(n=t.then))&&n},V=function(t,n){var r,e,o,i=n.value,c=1==n.state,u=c?t.ok:t.fail,a=t.resolve,f=t.reject,p=t.domain;try{u?(c||(2===n.rejection&&Y(n),n.rejection=1),!0===u?r=i:(p&&p.enter(),r=u(i),p&&(p.exit(),o=!0)),r===t.promise?f(N("Promise-chain cycle")):(e=q(r))?s(e,r,a,f):a(r)):f(i)}catch(t){p&&!o&&p.exit(),f(t)}},H=function(t,n){t.notified||(t.notified=!0,w((function(){for(var r,e=t.reactions;r=e.get();)V(r,t);t.notified=!1,n&&!t.rejection&&K(t)})))},J=function(t,n,r){var e,o;z?((e=F.createEvent("Event")).promise=n,e.reason=r,e.initEvent(t,!1,!0),f.dispatchEvent(e)):e={promise:n,reason:r},!I&&(o=f["on"+t])?o(e):"unhandledrejection"===t&&S("Unhandled promise rejection",r)},K=function(t){s(b,f,(function(){var n,r=t.facade,e=t.value;if(W(t)&&(n=j((function(){a?B.emit("unhandledRejection",e,r):J("unhandledrejection",r,e)})),t.rejection=a||W(t)?2:1,n.error))throw n.value}))},W=function(t){return 1!==t.rejection&&!t.parent},Y=function(t){s(b,f,(function(){var n=t.facade;a?B.emit("rejectionHandled",n):J("rejectionhandled",n,t.value)}))},X=function(t,n,r){return function(e){t(n,e,r)}},$=function(t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,H(t,!0))},Q=function(t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===n)throw N("Promise can't be resolved itself");var e=q(n);e?w((function(){var r={done:!1};try{s(e,n,X(Q,r,t),X($,r,t))}catch(n){$(r,n,t)}})):(t.value=n,t.state=1,H(t,!1))}catch(n){$({done:!1},n,t)}}};if(k&&(R=(M=function(t){g(this,R),y(t),s(e,this);var n=L(this);try{t(X(Q,n),X($,n))}catch(t){$(n,t)}}).prototype,(e=function(t){_(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new O,rejection:!1,state:0,value:void 0})}).prototype=p(R,"then",(function(t,n){var r=L(this),e=G(x(this,M));return r.parent=!0,e.ok=!h(t)||t,e.fail=h(n)&&n,e.domain=a?B.domain:void 0,0==r.state?r.reactions.add(e):w((function(){V(e,r)})),e.promise})),o=function(){var t=new e,n=L(t);this.promise=t,this.resolve=X(Q,n),this.reject=X($,n)},E.f=G=function(t){return t===M||void 0===t?new o(t):U(t)},!u&&h(T)&&C!==Object.prototype)){i=C.then,D||p(C,"then",(function(t,n){var r=this;return new M((function(t,n){s(i,r,t,n)})).then(t,n)}),{unsafe:!0});try{delete C.constructor}catch(t){}l&&l(C,R)}c({global:!0,constructor:!0,wrap:!0,forced:k},{Promise:M}),v(M,"Promise",!1,!0),d("Promise")},function(t,n,r){"use strict";var e=r(9),o=r(16),i=r(4),c=r(11),u=i("species");t.exports=function(t){var n=e(t),r=o.f;c&&n&&!n[u]&&r(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(14),o=TypeError;t.exports=function(t,n){if(e(n,t))return t;throw o("Incorrect invocation")}},function(t,n,r){var e=r(73),o=r(32),i=TypeError;t.exports=function(t){if(e(t))return t;throw i(o(t)+" is not a constructor")}},function(t,n,r){var e,o,i,c,u,a,f,s,p=r(1),l=r(34),v=r(43).f,d=r(95).set,y=r(97),h=r(143),m=r(144),g=r(52),x=p.MutationObserver||p.WebKitMutationObserver,b=p.document,w=p.process,S=p.Promise,j=v(p,"queueMicrotask"),O=j&&j.value;O||(e=function(){var t,n;for(g&&(t=w.domain)&&t.exit();o;){n=o.fn,o=o.next;try{n()}catch(t){throw o?c():i=void 0,t}}i=void 0,t&&t.enter()},y||g||m||!x||!b?!h&&S&&S.resolve?((f=S.resolve(void 0)).constructor=S,s=l(f.then,f),c=function(){s(e)}):g?c=function(){w.nextTick(e)}:(d=l(d,p),c=function(){d(e)}):(u=!0,a=b.createTextNode(""),new x(e).observe(a,{characterData:!0}),c=function(){a.data=u=!u})),t.exports=O||function(t){var n={fn:t,next:void 0};i&&(i.next=n),o||(o=n,c()),i=n}},function(t,n,r){var e=r(31),o=r(1);t.exports=/ipad|iphone|ipod/i.test(e)&&void 0!==o.Pebble},function(t,n,r){var e=r(31);t.exports=/web0s(?!.*chrome)/i.test(e)},function(t,n,r){var e=r(1);t.exports=function(t,n){var r=e.console;r&&r.error&&(1==arguments.length?r.error(t):r.error(t,n))}},function(t,n){var r=function(){this.head=null,this.tail=null};r.prototype={add:function(t){var n={item:t,next:null};this.head?this.tail.next=n:this.head=n,this.tail=n},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}},t.exports=r},function(t,n,r){var e=r(98),o=r(52);t.exports=!e&&!o&&"object"==typeof window&&"object"==typeof document},function(t,n,r){"use strict";var e=r(0),o=r(7),i=r(17),c=r(22),u=r(37),a=r(35);e({target:"Promise",stat:!0,forced:r(99)},{all:function(t){var n=this,r=c.f(n),e=r.resolve,f=r.reject,s=u((function(){var r=i(n.resolve),c=[],u=0,s=1;a(t,(function(t){var i=u++,a=!1;s++,o(r,n,t).then((function(t){a||(a=!0,c[i]=t,--s||e(c))}),f)})),--s||e(c)}));return s.error&&f(s.value),r.promise}})},function(t,n,r){var e=r(4)("iterator"),o=!1;try{var i=0,c={next:function(){return{done:!!i++}},return:function(){o=!0}};c[e]=function(){return this},Array.from(c,(function(){throw 2}))}catch(t){}t.exports=function(t,n){if(!n&&!o)return!1;var r=!1;try{var i={};i[e]=function(){return{next:function(){return{done:r=!0}}}},t(i)}catch(t){}return r}},function(t,n,r){"use strict";var e=r(0),o=r(15),i=r(38).CONSTRUCTOR,c=r(30),u=r(9),a=r(2),f=r(21),s=c&&c.prototype;if(e({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(t){return this.then(void 0,t)}}),!o&&a(c)){var p=u("Promise").prototype.catch;s.catch!==p&&f(s,"catch",p,{unsafe:!0})}},function(t,n,r){"use strict";var e=r(0),o=r(7),i=r(17),c=r(22),u=r(37),a=r(35);e({target:"Promise",stat:!0,forced:r(99)},{race:function(t){var n=this,r=c.f(n),e=r.reject,f=u((function(){var c=i(n.resolve);a(t,(function(t){o(c,n,t).then(r.resolve,e)}))}));return f.error&&e(f.value),r.promise}})},function(t,n,r){"use strict";var e=r(0),o=r(7),i=r(22);e({target:"Promise",stat:!0,forced:r(38).CONSTRUCTOR},{reject:function(t){var n=i.f(this);return o(n.reject,void 0,t),n.promise}})},function(t,n,r){"use strict";var e=r(0),o=r(9),i=r(15),c=r(30),u=r(38).CONSTRUCTOR,a=r(100),f=o("Promise"),s=i&&!u;e({target:"Promise",stat:!0,forced:i||u},{resolve:function(t){return a(s&&this===f?c:this,t)}})},function(t,n,r){"use strict";var e=r(0),o=r(7),i=r(17),c=r(22),u=r(37),a=r(35);e({target:"Promise",stat:!0},{allSettled:function(t){var n=this,r=c.f(n),e=r.resolve,f=r.reject,s=u((function(){var r=i(n.resolve),c=[],u=0,f=1;a(t,(function(t){var i=u++,a=!1;f++,o(r,n,t).then((function(t){a||(a=!0,c[i]={status:"fulfilled",value:t},--f||e(c))}),(function(t){a||(a=!0,c[i]={status:"rejected",reason:t},--f||e(c))}))})),--f||e(c)}));return s.error&&f(s.value),r.promise}})},function(t,n,r){"use strict";var e=r(0),o=r(7),i=r(17),c=r(9),u=r(22),a=r(37),f=r(35);e({target:"Promise",stat:!0},{any:function(t){var n=this,r=c("AggregateError"),e=u.f(n),s=e.resolve,p=e.reject,l=a((function(){var e=i(n.resolve),c=[],u=0,a=1,l=!1;f(t,(function(t){var i=u++,f=!1;a++,o(e,n,t).then((function(t){f||l||(l=!0,s(t))}),(function(t){f||l||(f=!0,c[i]=t,--a||p(new r(c,"No one promise resolved")))}))})),--a||p(new r(c,"No one promise resolved"))}));return l.error&&p(l.value),e.promise}})},function(t,n,r){"use strict";var e=r(0),o=r(15),i=r(30),c=r(5),u=r(9),a=r(2),f=r(93),s=r(100),p=r(21),l=i&&i.prototype;if(e({target:"Promise",proto:!0,real:!0,forced:!!i&&c((function(){l.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var n=f(this,u("Promise")),r=a(t);return this.then(r?function(r){return s(n,t()).then((function(){return r}))}:t,r?function(r){return s(n,t()).then((function(){throw r}))}:t)}}),!o&&a(i)){var v=u("Promise").prototype.finally;l.finally!==v&&p(l,"finally",v,{unsafe:!0})}},function(t,n,r){var e=r(6),o=r(66),i=r(36),c=r(57),u=e("".charAt),a=e("".charCodeAt),f=e("".slice),s=function(t){return function(n,r){var e,s,p=i(c(n)),l=o(r),v=p.length;return l<0||l>=v?t?"":void 0:(e=a(p,l))<55296||e>56319||l+1===v||(s=a(p,l+1))<56320||s>57343?t?u(p,l):e:t?f(p,l,l+2):s-56320+(e-55296<<10)+65536}};t.exports={codeAt:s(!1),charAt:s(!0)}},function(t,n){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,n,r){var e=r(160);t.exports=e},function(t,n,r){var e=r(14),o=r(161),i=Array.prototype;t.exports=function(t){var n=t.slice;return t===i||e(i,t)&&n===i.slice?o:n}},function(t,n,r){r(162);var e=r(40);t.exports=e("Array").slice},function(t,n,r){"use strict";var e=r(0),o=r(39),i=r(73),c=r(10),u=r(65),a=r(26),f=r(18),s=r(74),p=r(4),l=r(55),v=r(53),d=l("slice"),y=p("species"),h=Array,m=Math.max;e({target:"Array",proto:!0,forced:!d},{slice:function(t,n){var r,e,p,l=f(this),d=a(l),g=u(t,d),x=u(void 0===n?d:n,d);if(o(l)&&(r=l.constructor,(i(r)&&(r===h||o(r.prototype))||c(r)&&null===(r=r[y]))&&(r=void 0),r===h||void 0===r))return v(l,g,x);for(e=new(void 0===r?h:r)(m(x-g,0)),p=0;g<x;g++,p++)g in l&&s(e,p,l[g]);return e.length=p,e}})},function(t,n,r){t.exports=r(164)},function(t,n,r){var e=r(165);t.exports=e},function(t,n,r){var e=r(14),o=r(166),i=Array.prototype;t.exports=function(t){var n=t.map;return t===i||e(i,t)&&n===i.map?o:n}},function(t,n,r){r(167);var e=r(40);t.exports=e("Array").map},function(t,n,r){"use strict";var e=r(0),o=r(56).map;e({target:"Array",proto:!0,forced:!r(55)("map")},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){var e=r(39),o=r(73),i=r(10),c=r(4)("species"),u=Array;t.exports=function(t){var n;return e(t)&&(n=t.constructor,(o(n)&&(n===u||e(n.prototype))||i(n)&&null===(n=n[c]))&&(n=void 0)),void 0===n?u:n}},function(t,n,r){(function(e){var o,i=r(170),c=r(76),u=r(216),a=r(102),f=r(222),s=r(226),p=r(233),l=r(237),v=r(241),d=r(245);!function(y,h){"use strict";var m,g=(y=void 0!==y?y:"undefined"!=typeof self?self:void 0!==e?e:{}).IDBKeyRange||y.webkitIDBKeyRange,x="readonly",b="readwrite",w=Object.prototype.hasOwnProperty,S=function(){if(!m&&!(m=y.indexedDB||y.webkitIndexedDB||y.mozIndexedDB||y.oIndexedDB||y.msIndexedDB||(null===y.indexedDB&&y.shimIndexedDB?y.shimIndexedDB:void 0)))throw"IndexedDB required";return m},j=!1,O=navigator&&!navigator.userAgentData&&/Safari\\//.test(navigator.userAgent)&&!/Chrom(e|ium)\\//.test(navigator.userAgent),P=function(t){return t},T=function(t){var n;return a(n=Object.prototype.toString.call(t)).call(n,8,-1).toLowerCase()},A=function(t){return"function"==typeof t},E=function(t){return"number"===T(t)},k=function(t){return"array"===T(t)},I=function(t){return void 0===t},D=function(t,n){var r=this,e=!1;this.name=n,this.getIndexedDB=function(){return t},this.add=function(n){if(e)throw"Database has been closed";for(var o=[],i=0,u=0;u<arguments.length-1;u++)if(f(arguments[u+1]))for(var a=0;a<arguments[u+1].length;a++)o[i]=arguments[u+1][a],i++;else o[i]=arguments[u+1],i++;var l=t.transaction(n,b),v=l.objectStore(n);return new c((function(t,n){s(o).call(o,(function(t){var n;if(t.item&&t.key){var r=t.key;t=t.item,n=v.add(t,r)}else n=v.add(t);n.onsuccess=function(n){var r=n.target,e=r.source.keyPath;null===e&&(e="__id__"),p(t,e,{value:r.result,enumerable:!0})}})),l.oncomplete=function(){t(o,r)},l.onerror=function(t){t.preventDefault(),n(t)},l.onabort=function(t){n(t)}}))},this.updateAndDelete=function(n,r,o){if(e)throw"Database has been closed";var i=t.transaction(n,b),u=i.objectStore(n),a=u.keyPath;return new c((function(t,n){s(r).call(r,(function(t){if(t.item&&t.key){var n=t.key;t=t.item,u.put(t,n)}else u.put(t)})),s(o).call(o,(function(t){u.delete(t[a])})),i.oncomplete=function(){t([r,o])},i.onerror=function(t){n(t)}}))},this.update=function(n){if(e)throw"Database has been closed";for(var o,i=[],u=1;u<arguments.length;u++)f(o=arguments[u])?i=l(i).call(i,o):i.push(o);var a=t.transaction(n,b),p=a.objectStore(n);p.keyPath;return new c((function(t,n){s(i).call(i,(function(t){var n;if(t.item&&t.key){var r=t.key;t=t.item,n=p.put(t,r)}else n=p.put(t);n.onsuccess=function(t){},n.onerror=function(t){}})),a.oncomplete=function(){t(i,r)},a.onerror=function(t){n(t)},a.onabort=function(t){n(t)}}))},this.remove=function(n,r,o,i,u,a,p){if(e)throw"Database has been closed";var l=t.transaction(n,b),v=l.objectStore(n);return new c((function(t,n){function e(t){return null==t}var c;(e(i)&&(i=-1/0),e(u)&&(u=1/0),null===r||f(r)||(r=[r]),e(o))?null!==r?s(r).call(r,(function(t){v.delete(t)})):v.delete(range=g.bound(i,u,a,p)):(c=null!==r?g.only(r[0]):g.bound(i,u,a,p),v.index(o).openCursor(c).onsuccess=function(t){var n=t.target.result;n&&(n.delete(),n.continue())});l.oncomplete=function(){t()},l.onerror=function(t){n(t)},l.onabort=function(t){n(t)}}))},this.clear=function(n){if(e)throw"Database has been closed";var r=t.transaction(n,b);r.objectStore(n).clear();return new c((function(t,n){r.oncomplete=function(){t()},r.onerror=function(t){n(t)}}))},this.close=function(){e||(t.close(),e=!0,delete C[n])},this.get=function(n,r){if(e)throw"Database has been closed";var o=t.transaction(n),i=o.objectStore(n).get(r);return new c((function(t,n){i.onsuccess=function(n){t(n.target.result)},o.onerror=function(t){n(t)}}))},this.query=function(n,r){if(e)throw"Database has been closed";return new L(n,t,r)},this.count=function(n,r){if(e)throw"Database has been closed";t.transaction(n).objectStore(n)};for(var o=0,i=t.objectStoreNames.length;o<i;o++)!function(t){for(var n in r[t]={},r)w.call(r,n)&&"close"!==n&&(r[t][n]=function(n){return function(){var e,o=l(e=[t]).call(e,a([]).call(arguments,0));return r[n].apply(r,o)}}(n))}(t.objectStoreNames[o])},L=function(t,n,r){var e,o=this,u=!1,f=!1,p=function(e,o,a,p,l,d,y){return new c((function(c,h){var m=u||f?b:x,w=n.transaction(t,m),S=w.objectStore(t),j=r?S.index(r):S,O=e?g[e].apply(null,o):null,P=[],T=[O],E=0;l=l||null,d=d||[],"count"!==a&&T.push(p||"next");var k=!!u&&v(u);j[a].apply(j,T).onsuccess=function(t){var n=t.target.result;if(i(n)===i(0))P=n;else if(n)if(null!==l&&l[0]>E)E=l[0],n.advance(l[0]);else if(null!==l&&E>=l[0]+l[1]);else{var r=!0,e="value"in n?n.value:n.key;s(d).call(d,(function(t){t&&t.length&&(2===t.length?r=r&&e[t[0]]===t[1]:A(t[0])&&(r=r&&t[0].apply(void 0,[e])))})),r&&(E++,P.push(y(e)),f?n.delete():u&&(e=function(t){for(var n=0;n<k.length;n++){var r=k[n],e=u[r];e instanceof Function&&(e=e(t)),t[r]=e}return t}(e),n.update(e))),n.continue()}},w.oncomplete=function(){c(P)},w.onerror=function(t){h(t)},w.onabort=function(t){h(t)}}))},l=function(t,n){var r="next",e="openCursor",o=[],i=null,c=P,s=!1,l=function(){return p(t,n,e,s?r+"unique":r,i,o,c)},v=function(){return r=null,e="count",{execute:l}},d=function t(){return 1==(i=k(arguments[0])?arguments[0]:a(Array.prototype).call(arguments,0,2)).length&&i.unshift(0),E(i[1])||(i=null),{execute:l,count:v,keys:y,filter:h,asc:m,desc:g,distinct:x,modify:b,limit:t,map:w,remove:S}},y=function t(n){return(n=!!I(n)||!!n)&&(e="openKeyCursor"),{execute:l,keys:t,filter:h,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},h=function t(){return o.push(a(Array.prototype).call(arguments,0,2)),{execute:l,count:v,keys:y,filter:t,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},m=function t(n){return n=!!I(n)||!!n,r=n?"next":"prev",{execute:l,count:v,keys:y,filter:h,asc:t,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}},g=function t(n){return n=!!I(n)||!!n,r=n?"prev":"next",{execute:l,count:v,keys:y,filter:h,asc:m,desc:t,distinct:x,modify:b,limit:d,map:w,remove:S}},x=function t(n){return n=!!I(n)||!!n,s=n,{execute:l,count:v,keys:y,filter:h,asc:m,desc:g,distinct:t,modify:b,limit:d,map:w,remove:S}},b=function t(n){return u=n,{execute:l,count:v,keys:y,filter:h,asc:m,desc:g,distinct:x,modify:t,limit:d,map:w,remove:S}},w=function t(n){return A(n)&&(c=n),{execute:l,count:v,keys:y,filter:h,asc:m,desc:g,distinct:x,modify:b,limit:d,map:t,remove:S}},S=function t(n){return n=!!I(n)||!!n,f=n,{execute:l,count:v,keys:y,filter:h,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:t}};return{execute:l,count:v,keys:y,filter:h,asc:m,desc:g,distinct:x,modify:b,limit:d,map:w,remove:S}};s(e="only bound upperBound lowerBound".split(" ")).call(e,(function(t){o[t]=function(){return new l(t,arguments)}})),this.filter=function(){var t=new l(null,null);return d(t).apply(t,arguments)},this.all=function(){var t;return d(t=this).call(t)}},_=function(t,n,r,e){var o=t.target.result,i=new D(o,n);return C[n]=o,c.resolve(i)},C={},M={version:"0.10.2",open:function(t){var n;return new c((function(r,e){var o;C[t.server]?_({target:{result:C[t.server]}},t.server,t.version,t.schema).then(r,e):(j?c.resolve():O&&S().databases?new c((function(t){var n=function(){return S().databases().finally(t)};o=u(n,100),n()})).finally((function(){j=!0,clearInterval(o)})):(j=!0,c.resolve())).then((function(){try{n=S().open(t.server,t.version)}catch(t){e(t)}n.onsuccess=function(n){_(n,t.server,t.version,t.schema).then(r,e)},n.onupgradeneeded=function(n){!function(t,n,r){for(var e in"function"==typeof n&&(n=n()),n){var o,i=n[e];for(var c in o=!w.call(n,e)||r.objectStoreNames.contains(e)?t.currentTarget.transaction.objectStore(e):r.createObjectStore(e,i.key),i.indexes){var u=i.indexes[c];try{o.index(c)}catch(t){o.createIndex(c,u.key||c,v(u).length?u:{unique:!1})}}}}(n,t.schema,n.target.result)},n.onerror=function(t){e(t)}}))}))},remove:function(t){return new c((function(n,r){if(!t)return n();var e,o;i(t)===D&&(t=t.name),"string"==typeof t&&(e=C[t]),e&&"function"==typeof e.close&&e.close();try{o=S().deleteDatabase(t)}catch(t){r(t)}o.onsuccess=function(r){delete C[t],n(t)},o.onerror=function(t){r(t)},o.onblocked=function(t){r(t)}}))}};void 0!==t.exports?t.exports=M:void 0===(o=function(){return M}.call(n,r,n,t))||(t.exports=o)}(void 0)}).call(this,r(77))},function(t,n,r){var e=r(171),o=r(210);function i(n){return t.exports=i="function"==typeof e&&"symbol"==typeof o?function(t){return typeof t}:function(t){return t&&"function"==typeof e&&t.constructor===e&&t!==e.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,i(n)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,n,r){t.exports=r(172)},function(t,n,r){t.exports=r(173)},function(t,n,r){var e=r(174);r(203),r(204),r(205),r(206),r(207),r(208),r(209),t.exports=e},function(t,n,r){var e=r(175);r(202),t.exports=e},function(t,n,r){var e=r(176);r(54),t.exports=e},function(t,n,r){r(104),r(72),r(178),r(186),r(187),r(188),r(189),r(107),r(190),r(191),r(192),r(193),r(194),r(195),r(196),r(197),r(198),r(199),r(200),r(201);var e=r(13);t.exports=e.Symbol},function(t,n){var r=TypeError;t.exports=function(t){if(t>9007199254740991)throw r("Maximum allowed index exceeded");return t}},function(t,n,r){r(179),r(182),r(183),r(184),r(185)},function(t,n,r){"use strict";var e=r(0),o=r(1),i=r(7),c=r(6),u=r(15),a=r(11),f=r(24),s=r(5),p=r(8),l=r(14),v=r(12),d=r(18),y=r(45),h=r(36),m=r(20),g=r(50),x=r(69),b=r(64),w=r(180),S=r(68),j=r(43),O=r(16),P=r(87),T=r(80),A=r(21),E=r(33),k=r(48),I=r(49),D=r(60),L=r(4),_=r(75),C=r(3),M=r(105),R=r(29),N=r(51),F=r(56).forEach,B=k("hidden"),G=N.set,U=N.getterFor("Symbol"),z=Object.prototype,q=o.Symbol,V=q&&q.prototype,H=o.TypeError,J=o.QObject,K=j.f,W=O.f,Y=w.f,X=T.f,$=c([].push),Q=E("symbols"),Z=E("op-symbols"),tt=E("wks"),nt=!J||!J.prototype||!J.prototype.findChild,rt=a&&s((function(){return 7!=g(W({},"a",{get:function(){return W(this,"a",{value:7}).a}})).a}))?function(t,n,r){var e=K(z,n);e&&delete z[n],W(t,n,r),e&&t!==z&&W(z,n,e)}:W,et=function(t,n){var r=Q[t]=g(V);return G(r,{type:"Symbol",tag:t,description:n}),a||(r.description=n),r},ot=function(t,n,r){t===z&&ot(Z,n,r),v(t);var e=y(n);return v(r),p(Q,e)?(r.enumerable?(p(t,B)&&t[B][e]&&(t[B][e]=!1),r=g(r,{enumerable:m(0,!1)})):(p(t,B)||W(t,B,m(1,{})),t[B][e]=!0),rt(t,e,r)):W(t,e,r)},it=function(t,n){v(t);var r=d(n),e=x(r).concat(ft(r));return F(e,(function(n){a&&!i(ct,r,n)||ot(t,n,r[n])})),t},ct=function(t){var n=y(t),r=i(X,this,n);return!(this===z&&p(Q,n)&&!p(Z,n))&&(!(r||!p(this,n)||!p(Q,n)||p(this,B)&&this[B][n])||r)},ut=function(t,n){var r=d(t),e=y(n);if(r!==z||!p(Q,e)||p(Z,e)){var o=K(r,e);return!o||!p(Q,e)||p(r,B)&&r[B][e]||(o.enumerable=!0),o}},at=function(t){var n=Y(d(t)),r=[];return F(n,(function(t){p(Q,t)||p(I,t)||$(r,t)})),r},ft=function(t){var n=t===z,r=Y(n?Z:d(t)),e=[];return F(r,(function(t){!p(Q,t)||n&&!p(z,t)||$(e,Q[t])})),e};f||(A(V=(q=function(){if(l(V,this))throw H("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?h(arguments[0]):void 0,n=D(t),r=function(t){this===z&&i(r,Z,t),p(this,B)&&p(this[B],n)&&(this[B][n]=!1),rt(this,n,m(1,t))};return a&&nt&&rt(z,n,{configurable:!0,set:r}),et(n,t)}).prototype,"toString",(function(){return U(this).tag})),A(q,"withoutSetter",(function(t){return et(D(t),t)})),T.f=ct,O.f=ot,P.f=it,j.f=ut,b.f=w.f=at,S.f=ft,_.f=function(t){return et(L(t),t)},a&&(W(V,"description",{configurable:!0,get:function(){return U(this).description}}),u||A(z,"propertyIsEnumerable",ct,{unsafe:!0}))),e({global:!0,constructor:!0,wrap:!0,forced:!f,sham:!f},{Symbol:q}),F(x(tt),(function(t){C(t)})),e({target:"Symbol",stat:!0,forced:!f},{useSetter:function(){nt=!0},useSimple:function(){nt=!1}}),e({target:"Object",stat:!0,forced:!f,sham:!a},{create:function(t,n){return void 0===n?g(t):it(g(t),n)},defineProperty:ot,defineProperties:it,getOwnPropertyDescriptor:ut}),e({target:"Object",stat:!0,forced:!f},{getOwnPropertyNames:at}),M(),R(q,"Symbol"),I[B]=!0},function(t,n,r){var e=r(23),o=r(18),i=r(64).f,c=r(181),u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"Window"==e(t)?function(t){try{return i(t)}catch(t){return c(u)}}(t):i(o(t))}},function(t,n,r){var e=r(65),o=r(26),i=r(74),c=Array,u=Math.max;t.exports=function(t,n,r){for(var a=o(t),f=e(n,a),s=e(void 0===r?a:r,a),p=c(u(s-f,0)),l=0;f<s;f++,l++)i(p,l,t[f]);return p.length=l,p}},function(t,n,r){var e=r(0),o=r(9),i=r(8),c=r(36),u=r(33),a=r(106),f=u("string-to-symbol-registry"),s=u("symbol-to-string-registry");e({target:"Symbol",stat:!0,forced:!a},{for:function(t){var n=c(t);if(i(f,n))return f[n];var r=o("Symbol")(n);return f[n]=r,s[r]=n,r}})},function(t,n,r){var e=r(0),o=r(8),i=r(46),c=r(32),u=r(33),a=r(106),f=u("symbol-to-string-registry");e({target:"Symbol",stat:!0,forced:!a},{keyFor:function(t){if(!i(t))throw TypeError(c(t)+" is not a symbol");if(o(f,t))return f[t]}})},function(t,n,r){var e=r(0),o=r(9),i=r(41),c=r(7),u=r(6),a=r(5),f=r(39),s=r(2),p=r(10),l=r(46),v=r(53),d=r(24),y=o("JSON","stringify"),h=u(/./.exec),m=u("".charAt),g=u("".charCodeAt),x=u("".replace),b=u(1..toString),w=/[\\uD800-\\uDFFF]/g,S=/^[\\uD800-\\uDBFF]$/,j=/^[\\uDC00-\\uDFFF]$/,O=!d||a((function(){var t=o("Symbol")();return"[null]"!=y([t])||"{}"!=y({a:t})||"{}"!=y(Object(t))})),P=a((function(){return'"\\\\udf06\\\\ud834"'!==y("\\udf06\\ud834")||'"\\\\udead"'!==y("\\udead")})),T=function(t,n){var r=v(arguments),e=n;if((p(n)||void 0!==t)&&!l(t))return f(n)||(n=function(t,n){if(s(e)&&(n=c(e,this,t,n)),!l(n))return n}),r[1]=n,i(y,null,r)},A=function(t,n,r){var e=m(r,n-1),o=m(r,n+1);return h(S,t)&&!h(j,o)||h(j,t)&&!h(S,e)?"\\\\u"+b(g(t,0),16):t};y&&e({target:"JSON",stat:!0,arity:3,forced:O||P},{stringify:function(t,n,r){var e=v(arguments),o=i(O?T:y,null,e);return P&&"string"==typeof o?x(o,w,A):o}})},function(t,n,r){var e=r(0),o=r(24),i=r(5),c=r(68),u=r(25);e({target:"Object",stat:!0,forced:!o||i((function(){c.f(1)}))},{getOwnPropertySymbols:function(t){var n=c.f;return n?n(u(t)):[]}})},function(t,n,r){r(3)("asyncIterator")},function(t,n){},function(t,n,r){r(3)("hasInstance")},function(t,n,r){r(3)("isConcatSpreadable")},function(t,n,r){r(3)("match")},function(t,n,r){r(3)("matchAll")},function(t,n,r){r(3)("replace")},function(t,n,r){r(3)("search")},function(t,n,r){r(3)("species")},function(t,n,r){r(3)("split")},function(t,n,r){var e=r(3),o=r(105);e("toPrimitive"),o()},function(t,n,r){var e=r(9),o=r(3),i=r(29);o("toStringTag"),i(e("Symbol"),"Symbol")},function(t,n,r){r(3)("unscopables")},function(t,n,r){var e=r(1);r(29)(e.JSON,"JSON",!0)},function(t,n){},function(t,n){},function(t,n,r){r(3)("dispose")},function(t,n,r){r(3)("asyncDispose")},function(t,n,r){r(3)("matcher")},function(t,n,r){r(3)("metadataKey")},function(t,n,r){r(3)("observable")},function(t,n,r){r(3)("metadata")},function(t,n,r){r(3)("patternMatch")},function(t,n,r){r(3)("replaceAll")},function(t,n,r){t.exports=r(211)},function(t,n,r){t.exports=r(212)},function(t,n,r){var e=r(213);t.exports=e},function(t,n,r){var e=r(214);t.exports=e},function(t,n,r){var e=r(215);r(54),t.exports=e},function(t,n,r){r(71),r(72),r(101),r(107);var e=r(75);t.exports=e.f("iterator")},function(t,n,r){t.exports=r(217)},function(t,n,r){r(218);var e=r(13);t.exports=e.setInterval},function(t,n,r){r(219),r(221)},function(t,n,r){var e=r(0),o=r(1),i=r(108)(o.setInterval,!0);e({global:!0,bind:!0,forced:o.setInterval!==i},{setInterval:i})},function(t,n){t.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version},function(t,n,r){var e=r(0),o=r(1),i=r(108)(o.setTimeout,!0);e({global:!0,bind:!0,forced:o.setTimeout!==i},{setTimeout:i})},function(t,n,r){t.exports=r(223)},function(t,n,r){var e=r(224);t.exports=e},function(t,n,r){r(225);var e=r(13);t.exports=e.Array.isArray},function(t,n,r){r(0)({target:"Array",stat:!0},{isArray:r(39)})},function(t,n,r){t.exports=r(227)},function(t,n,r){r(54);var e=r(28),o=r(8),i=r(14),c=r(228),u=Array.prototype,a={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var n=t.forEach;return t===u||i(u,t)&&n===u.forEach||o(a,e(t))?c:n}},function(t,n,r){var e=r(229);t.exports=e},function(t,n,r){r(230);var e=r(40);t.exports=e("Array").forEach},function(t,n,r){"use strict";var e=r(0),o=r(231);e({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(t,n,r){"use strict";var e=r(56).forEach,o=r(232)("forEach");t.exports=o?[].forEach:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,n,r){"use strict";var e=r(5);t.exports=function(t,n){var r=[][t];return!!r&&e((function(){r.call(null,n||function(){return 1},1)}))}},function(t,n,r){t.exports=r(234)},function(t,n,r){var e=r(235);t.exports=e},function(t,n,r){r(236);var e=r(13).Object,o=t.exports=function(t,n,r){return e.defineProperty(t,n,r)};e.defineProperty.sham&&(o.sham=!0)},function(t,n,r){var e=r(0),o=r(11),i=r(16).f;e({target:"Object",stat:!0,forced:Object.defineProperty!==i,sham:!o},{defineProperty:i})},function(t,n,r){t.exports=r(238)},function(t,n,r){var e=r(239);t.exports=e},function(t,n,r){var e=r(14),o=r(240),i=Array.prototype;t.exports=function(t){var n=t.concat;return t===i||e(i,t)&&n===i.concat?o:n}},function(t,n,r){r(104);var e=r(40);t.exports=e("Array").concat},function(t,n,r){t.exports=r(242)},function(t,n,r){var e=r(243);t.exports=e},function(t,n,r){r(244);var e=r(13);t.exports=e.Object.keys},function(t,n,r){var e=r(0),o=r(25),i=r(69);e({target:"Object",stat:!0,forced:r(5)((function(){i(1)}))},{keys:function(t){return i(o(t))}})},function(t,n,r){t.exports=r(246)},function(t,n,r){var e=r(247);t.exports=e},function(t,n,r){var e=r(14),o=r(248),i=Array.prototype;t.exports=function(t){var n=t.filter;return t===i||e(i,t)&&n===i.filter?o:n}},function(t,n,r){r(249);var e=r(40);t.exports=e("Array").filter},function(t,n,r){"use strict";var e=r(0),o=r(56).filter;e({target:"Array",proto:!0,forced:!r(55)("filter")},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})}]);`,"Worker",void 0,void 0)}},function(o,k,e){var r=e(3),i=e(15),s=e(8),n=e(303),u={log:{key:{keyPath:"time"},indexes:{level:{unique:!1},time:{unique:!0}}}};function p(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.server=null,this.expire=m.expire||72,this.name=m.name}var d=p.prototype;d.init=function(){var m=this;if(!this.server)return n.open({server:"nim-log-"+this.name,version:1,schema:u}).then(function(c){m.server=c})},d.putLog=function(m){var c=this;if(!this.server)return r.reject("no db server");var h=i(m).call(m,-1)[0].time-36e5*this.expire;return this.deleteLogs(h).then(function(){return c.server.add("log",m)})},d.getAllLogs=function(){return this.server?this.server.query("log","time").all().execute().then(function(m){var c={},h=i(m).call(m,-1)[0];return c.logs=s(m).call(m,function(a){return a.log}).join(`\r
`),c.time=h&&h.time,c}):r.reject("no db server")},d.deleteLogs=function(m){return this.server?this.server.remove("log",null,"time",0,m):r.reject("no db server")},o.exports=p},function(o,k,e){e(252);var r=e(12);o.exports=r.setInterval},function(o,k,e){var r=e(21),i=e(566),s=Function.prototype;o.exports=function(n){var u=n.bind;return n===s||r(s,n)&&u===s.bind?i:u}},function(o,k,e){e(567);var r=e(30);o.exports=r("Function").bind},function(o,k,e){var r=e(1),i=e(273);r({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},function(o,k,e){var r=e(18),i=e(25),s=e(2),n=e(23),u=e(5),p=e(54),d=e(185);function m(a){a.onuploading&&this.on("uploading",a.onuploading),d.call(this,a)}var c=d.prototype,h=m.prototype=r(c);h.doSend=function(){var a,y,T,v=this.options,g=v.headers,b=this.xhr=new XMLHttpRequest;if(g["Content-Type"]==="multipart/form-data"){var S,O;delete g["Content-Type"],b.upload.onprogress=i(S=this.onProgress).call(S,this),b.upload.onload=i(O=this.onProgress).call(O,this);var I,R=v.data;v.data=new window.FormData,R&&s(I=p.getKeys(R,v.putFileAtEnd)).call(I,function(P){var x=R[P];x.tagName&&x.tagName.toUpperCase()==="INPUT"?x.type==="file"&&s([]).call(x.files,function(L){v.data.append(p.dataset(x,"name")||x.name||L.name||"file-"+p.uniqueID(),L)}):v.data.append(P,x)})}else if(g["x-nos-token"]){var N,F;b.upload.onprogress=i(N=this.onProgress).call(N,this),b.upload.onload=i(F=this.onProgress).call(F,this)}b.onreadystatechange=i(a=this.onStateChange).call(a,this),v.timeout!==0&&(this.timer=n(i(T=this.onTimeout).call(T,this),v.timeout)),b.open(v.method,v.url,!v.sync),s(y=u(g)).call(y,function(P){b.setRequestHeader(P,g[P])}),v.cookie&&"withCredentials"in b&&(b.withCredentials=!0),b.send(v.data),this.afterSend()},h.onProgress=function(a){a.lengthComputable&&a.loaded<=a.total&&this.emit("uploading",a)},h.onStateChange=function(){var a,y=this.xhr;y.readyState===4&&(a={status:y.status,result:y.responseText||""},this.onLoad(a))},h.getResponseHeader=function(a){var y=this.xhr;return y?y.getResponseHeader(a):""},h.destroy=function(){clearTimeout(this.timer);try{this.xhr.onreadystatechange=p.f,this.xhr.abort()}catch{}c.destroy.call(this)},o.exports=m},function(o,k,e){var r;/*!
 * EventEmitter v5.2.9 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */(function(i){function s(){}var n=s.prototype,u=i.EventEmitter;function p(m,c){for(var h=m.length;h--;)if(m[h].listener===c)return h;return-1}function d(m){return function(){return this[m].apply(this,arguments)}}n.getListeners=function(m){var c,h,a=this._getEvents();if(m instanceof RegExp)for(h in c={},a)a.hasOwnProperty(h)&&m.test(h)&&(c[h]=a[h]);else c=a[m]||(a[m]=[]);return c},n.flattenListeners=function(m){var c,h=[];for(c=0;c<m.length;c+=1)h.push(m[c].listener);return h},n.getListenersAsObject=function(m){var c,h=this.getListeners(m);return h instanceof Array&&((c={})[m]=h),c||h},n.addListener=function(m,c){if(!function T(v){return typeof v=="function"||v instanceof RegExp||!(!v||typeof v!="object")&&T(v.listener)}(c))throw new TypeError("listener must be a function");var h,a=this.getListenersAsObject(m),y=typeof c=="object";for(h in a)a.hasOwnProperty(h)&&p(a[h],c)===-1&&a[h].push(y?c:{listener:c,once:!1});return this},n.on=d("addListener"),n.addOnceListener=function(m,c){return this.addListener(m,{listener:c,once:!0})},n.once=d("addOnceListener"),n.defineEvent=function(m){return this.getListeners(m),this},n.defineEvents=function(m){for(var c=0;c<m.length;c+=1)this.defineEvent(m[c]);return this},n.removeListener=function(m,c){var h,a,y=this.getListenersAsObject(m);for(a in y)y.hasOwnProperty(a)&&(h=p(y[a],c))!==-1&&y[a].splice(h,1);return this},n.off=d("removeListener"),n.addListeners=function(m,c){return this.manipulateListeners(!1,m,c)},n.removeListeners=function(m,c){return this.manipulateListeners(!0,m,c)},n.manipulateListeners=function(m,c,h){var a,y,T=m?this.removeListener:this.addListener,v=m?this.removeListeners:this.addListeners;if(typeof c!="object"||c instanceof RegExp)for(a=h.length;a--;)T.call(this,c,h[a]);else for(a in c)c.hasOwnProperty(a)&&(y=c[a])&&(typeof y=="function"?T.call(this,a,y):v.call(this,a,y));return this},n.removeEvent=function(m){var c,h=typeof m,a=this._getEvents();if(h==="string")delete a[m];else if(m instanceof RegExp)for(c in a)a.hasOwnProperty(c)&&m.test(c)&&delete a[c];else delete this._events;return this},n.removeAllListeners=d("removeEvent"),n.emitEvent=function(m,c){var h,a,y,T,v=this.getListenersAsObject(m);for(T in v)if(v.hasOwnProperty(T))for(h=v[T].slice(0),y=0;y<h.length;y++)(a=h[y]).once===!0&&this.removeListener(m,a.listener),a.listener.apply(this,c||[])===this._getOnceReturnValue()&&this.removeListener(m,a.listener);return this},n.trigger=d("emitEvent"),n.emit=function(m){var c=Array.prototype.slice.call(arguments,1);return this.emitEvent(m,c)},n.setOnceReturnValue=function(m){return this._onceReturnValue=m,this},n._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},n._getEvents=function(){return this._events||(this._events={})},s.noConflict=function(){return i.EventEmitter=u,s},(r=function(){return s}.call(i,e,i,o))===void 0||(o.exports=r)})(typeof window<"u"?window:this||{})},function(o,k,e){var r=e(18),i=e(6),s=e(2),n=e(25),u=e(87),p=e(54),d=e(185),m=e(274),c="NEJ-UPLOAD-RESULT:",h={};function a(v){this.init(),d.call(this,v)}var y=d.prototype,T=a.prototype=r(y);T.init=function(){var v=!1;function g(b){var S=b.data;if(i(S).call(S,c)===0){var O=(S=JSON.parse(S.replace(c,""))).key,I=h[O];I&&(delete h[O],S.result=decodeURIComponent(S.result||""),I.onLoad(S.result))}}return function(){(function(){if(!v){v=!0;var b=p.getGlobal();b.postMessage?p.on(b,"message",g):(m.addMsgListener(g),m.startTimer())}})()}}(),T.doSend=function(){var v=this,g=v.options,b=v.key="zoro-ajax-upload-iframe-"+p.uniqueID();h[b]=v;var S=v.form=p.html2node('<form style="display:none;"></form>');typeof document>"u"||document.body.appendChild(S),S.target=b,S.method="POST",S.enctype="multipart/form-data",S.encoding="multipart/form-data";var O=g.url,I=p.genUrlSep(O);S.action=O+I+"_proxy_=form";var R,N=g.data,F=[],P=[];N&&s(R=p.getKeys(N,g.putFileAtEnd)).call(R,function(_){var C=N[_];if(C.tagName&&C.tagName.toUpperCase()==="INPUT"){if(C.type==="file"){var A=C,M=A.cloneNode(!0);A.parentNode.insertBefore(M,A);var U=p.dataset(A,"name");U&&(A.name=U),S.appendChild(A),p.isFunction(A.setAttribute)&&(A.setAttribute("form",""),A.removeAttribute("form")),F.push(C),P.push(M)}}else{var E=p.html2node('<input type="hidden"/>');E.name=_,E.value=C,S.appendChild(E)}});function x(){s(F).call(F,function(_,C){var A=P[C];A.parentNode&&(_.name=A.name,p.isFunction(_.setAttribute)&&_.setAttribute("form",A.getAttribute("form")),A.parentNode.replaceChild(_,A))})}var L=v.iframe=p.createIframe({name:b,onload:function(){var _;v.aborted?x():(p.on(L,"load",n(_=v.checkResult).call(_,v)),S.submit(),x(),v.afterSend())}})},T.checkResult=function(){var v,g;try{var b,S;if(v=this.iframe.contentWindow.document.body,g=u(b=v.innerText||v.textContent||"").call(b),i(g).call(g,c)>=0||i(S=v.innerHTML).call(S,c)>=0)return}catch{return}this.onLoad(g)},T.onLoad=function(v){y.onLoad.call(this,{status:200,result:v}),p.remove(this.form),p.remove(this.iframe),y.destroy.call(this)},T.destroy=function(){p.remove(this.iframe),p.remove(this.form)},T.abort=function(){this.aborted=!0,delete h[this.key],y.abort.call(this)},o.exports=a},function(o,k,e){var r=e(572);o.exports=r},function(o,k,e){var r=e(21),i=e(573),s=String.prototype;o.exports=function(n){var u=n.trim;return typeof n=="string"||n===s||r(s,n)&&u===s.trim?i:u}},function(o,k,e){e(574);var r=e(30);o.exports=r("String").trim},function(o,k,e){var r=e(1),i=e(183).trim;r({target:"String",proto:!0,forced:e(575)("trim")},{trim:function(){return i(this)}})},function(o,k,e){var r=e(226).PROPER,i=e(4),s=e(146);o.exports=function(n){return i(function(){return!!s[n]()||"​᠎"[n]()!=="​᠎"||r&&s[n].name!==n})}},function(o,k,e){var r=e(18),i=e(6),s=e(25),n=e(2),u=e(54),p=e(274),d=e(185),m={};function c(y){this.init(),d.call(this,y)}var h=d.prototype,a=c.prototype=r(h);a.init=function(){var y="NEJ-AJAX-DATA:",T=!1;function v(g){var b=g.data;if(i(b).call(b,y)===0){var S=(b=JSON.parse(b.replace(y,""))).key,O=m[S];O&&(delete m[S],b.result=decodeURIComponent(b.result||""),O.onLoad(b))}}return function(){(function(){if(!T){T=!0;var g=u.getGlobal();g.postMessage?u.on(g,"message",v):p.addMsgListener(v)}})()}}(),a.doSend=function(){var y=this.options,T=u.url2origin(y.url),v=y.proxyUrl||T+"/res/nej_proxy_frame.html",g=m[v];if(u.isArray(g)){var b;g.push(s(b=this.doSend).call(b,this,y))}else{var S;if(!g)return m[v]=[s(S=this.doSend).call(S,this,y)],void u.createIframe({src:v,onload:function(R){var N=m[v];m[v]=u.target(R).contentWindow,n(N).call(N,function(F){try{F()}catch{}})}});if(!this.aborted){var O=this.key=u.uniqueID();m[O]=this;var I=u.fetch({method:"GET",url:"",data:null,headers:{},timeout:0},y);I.key=O,p.postMessage(g,{data:I}),this.afterSend()}}},a.abort=function(){this.aborted=!0,delete m[this.key],h.abort.call(this)},o.exports=c},function(o,k,e){var r,i,s=e(10),n=e(54),u=e(116),p=(r=/json/i,i=/post/i,function(d,m){var c=(m=m||{}).data=m.data||{},h=m.headers=m.headers||{},a=n.checkWithDefault(h,"Accept","application/json"),y=n.checkWithDefault(h,"Content-Type","application/json");return r.test(a)&&(m.type="json"),i.test(m.method)&&r.test(y)&&(m.data=s(c)),u(d,m)});o.exports=p},function(o,k,e){var r=e(5),i=e(17),s=e(6),n=e(2),u=e(7),p=e(15),d=e(23);o.exports={wrapSafeCallback:function(m,c){if(m.__wrapSafeCallback__)return m;m.__wrapSafeCallback__=!0;var h=r(m);return h=i(h).call(h,function(a){return s(a).call(a,"on")===0&&Object.prototype.toString.call(m[a])==="[object Function]"}),n(h).call(h,function(a){var y=m[a];m[a]=function(){var T=this;try{var v;return y.call.apply(y,u(v=[this]).call(v,p(Array.prototype).call(arguments)))}catch(b){var g;this.logger.error(u(g="wrapSafeCallback. CallbackName: ".concat(a,". Error: ")).call(g,b)),d(function(){var S;throw T.logger.error(u(S="wrapSafeCallback. throw error in setTimeout. CallbackName: ".concat(a,". Error: ")).call(S,b)),b},0),c.logger&&c.logger.error("userOption:".concat(a," function error"),b)}}}),m}}},function(o,k,e){var r=e(580);o.exports=r},function(o,k,e){e(581);var r=e(12);o.exports=r.Date.now},function(o,k,e){var r=e(1),i=e(11),s=Date,n=i(s.prototype.getTime);r({target:"Date",stat:!0},{now:function(){return n(new s)}})},function(o,k,e){var r=e(73).fn,i=e(24).reportAPI;r.isConnected=function(){return i({instance:this,className:"ApiBaseFn",funcName:"isConnected",hasCallback:!1}),!!this.protocol&&this.protocol.isConnected()},r.connect=function(){i({instance:this,className:"ApiBaseFn",funcName:"connect",hasCallback:!1}),this.protocol.connect()},r.disconnect=function(){}},function(o,k,e){var r=e(26),i=e(10),s=e(25),n=e(8),u=e(41),p=e(15),d=e(139),m=e(87),c=e(6),h=e(52),a=e(23),y=e(9),T=e(32),v=e(2),g=e(7),b=e(5),S=e(58),O=e(17),I=e(59),R=e(60),N=e(61),F=e(47),P=e(57),x=e(120),L=["loc_x","loc_y","loc_z"];function _(w,J){var V=b(w);if(S){var D=S(w);J&&(D=O(D).call(D,function(Q){return I(w,Q).enumerable})),V.push.apply(V,D)}return V}function C(w){for(var J=1;J<arguments.length;J++){var V,D,Q=arguments[J]!=null?arguments[J]:{};J%2?v(V=_(Object(Q),!0)).call(V,function(G){P(w,G,Q[G])}):R?N(w,R(Q)):v(D=_(Object(Q))).call(D,function(G){F(w,G,I(Q,G))})}return w}var A=e(73).fn,M=e(0),U=e(602),E=e(40),z=e(13),$=e(276),X=e(277),Y=e(284),W=e(105).EMExceptionState,ee=e(24).reportAPI;A.sendText=function(w){(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"sendText",async:!0,done:w.done});var J=w,V=J.loc_x,D=J.loc_y,Q=J.loc_z,G=x(J,L);return V===void 0||D===void 0||Q===void 0?w=C({},G):(typeof w.loc_x!="number"&&(w.loc_x=0),typeof w.loc_y!="number"&&(w.loc_y=0),typeof w.loc_z!="number"&&(w.loc_z=0)),this.processCallback(w),w.msg=new this.message.TextMessage(w),this.sendMsg(w)},A.previewFile=function(w,J){var V;(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"previewFile",done:w.done});var D=this,Q=D.protocol.appGrayConfig;if(Q&&Q.grayConfig&&Q.grayConfig.mixStoreEnable&&(w.mixEnable=!0),M.verifyOptions(w,"done","msg::previewFile"),w.type||(w.type="file"),M.verifyParamPresentJustOne(w,"dataURL blob fileInput filePath wxFilePath fileObject","msg::previewFile"),M.exist(w.maxSize)&&M.verifyParamType("maxSize",w.maxSize,"number","api::previewFile"),M.exist(w.commonUpload)&&M.verifyParamType("commonUpload",w.commonUpload,"boolean","api::previewFile"),w.nosSurvivalTime?(M.verifyParamType("nosSurvivalTime",w.nosSurvivalTime,"number","api::Base.getInstance"),M.verifyParamMin("nosSurvivalTime",w.nosSurvivalTime,86400,"api::Base.getInstance")):w.nosSurvivalTime=this.nosSurvivalTime,w.filePath=w.filePath||w.wxFilePath,delete w.wxFilePath,w.dataURL)w.blob=Y.fromDataURL(w.dataURL);else if(!w.blob){if(w.fileInput){if(w.fileInput=M.verifyFileInput(w.fileInput,"msg::previewFile"),w.fileInput.files){if(!w.fileInput.files.length)return void w.done(E.newNoFileError("请选择"+w.type+"文件",{callFunc:"msg::previewFile",fileInput:w.fileInput}),w);w.fileSize=w.fileInput.files[0].size}w.fileInputName=M.getFileName(w.fileInput)}}this.processCallback(w);var G=i($.genResponseBody(w.type)||{}).replace(/"/gi,'\\"'),B=null,q=w.transcode?"getNosTokenTrans":"getNosToken";if(w.transcode){M.verifyOptions(w,"fileInput","msg::previewFile");var H=M.getFileInfo(w.fileInput);B={transToken:{name:H.name,type:H.transcodeType,transType:w.transcode==="png"?11:10,size:H.size,body:G}}}else B=G;this[q]({responseBody:B,nosToken:{nosScene:w.nosScene||this.nosScene,nosSurvivalTime:w.nosSurvivalTime},callback:s(V=function(K,Z){if(K)w.done(K);else if(w.transcode?(w.nosToken=Z.nosToken,w.docId=Z.docId):w.nosToken=Z,w.logger=D.logger,w.mixEnable){var te,ne;if(!this.protocol.mixStorePolicy)try{this.protocol.mixStorePolicy=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[this.options.appKey]}catch(re){D.logger.error("error:","get last mixStorePolicy failed",re)}if(!this.protocol.mixStorePolicy)return void D.logger.error("error:","get mixStorePolicy failed");w.providers=n(te=this.protocol.mixStorePolicy.providers||[]).call(te,function(re){return Number(re)}),w.curProvider=w.providers[0]?Number(w.providers[0]):1,w.nosPolicy=this.protocol.mixStorePolicy.nosPolicy,w.s3Policy=this.protocol.mixStorePolicy.s3Policy,D.getMixStoreToken({curProvider:w.curProvider,responseBody:B,callback:s(ne=function(re,se){re?w.done(re):(w.mixStoreToken=se,w.getMixStoreToken=function(oe,ae){D.getMixStoreToken({curProvider:oe,responseBody:B,callback:function(pe,ge){pe?w.done(pe):ae(ge)}})},w.curProvider===1&&(w.nosToken=se),D._doPreviewFile(w,J))}).call(ne,D)})}else this._doPreviewFile(w,J)}).call(V,this)})},A._doPreviewFile=function(w,J){var V=this;w=M.merge(w,V.options.providers);var D=z.genUploadUrl(w.nosToken.bucket);w.mixEnable&&w.curProvider===1&&(D=z.genUploadUrl(w.mixStoreToken.bucket));var Q,G=z.chunkUploadUrl;V.logger.info("_doPreviewFile: start upload"),w.commonUpload||!G||z.isWeixinApp||z.isNodejs||z.isRN?(w.commonUpload=!0,Q=D):(Q=G,w.nosLbsUrls=z.nosLbsUrls,V.options.edgeList?w.edgeList=V.options.edgeList:w.updateNosEdgeList=function(Z){V.options.edgeList=Z}),V.protocol.reporterHook.emit("reporter/uploadStart");var B=this.assembleUploadParams(w.nosToken);w.mixEnable&&w.curProvider===1&&(B=this.assembleUploadParams(w.mixStoreToken));function q(Z,te,ne,re){if(Z){var se=M.get(Z,"msg.message")||M.get(Z,"message")||"Unknown error message",oe=M.get(Z,"msg.code")||M.get(Z,"code")||"Unknown error code";V.logger.warn("_doPreviewFile: upload done, failed ",oe,se),V.protocol.reporterHook.emit("reporter/uploadEnd",Z.code==="RequestAbortedError"||Z.code==="abort"?W.kCanceled:W.kFailed);var ae=u({},re||J,{status:"fail"}),pe=C(C({},w.callback.options),{},{msg:ae});return w.uploaddone&&w.uploaddone(Z,pe,ae),void w.done(Z,w.callback.options)}if(V.logger.info("_doPreviewFile: upload done, success"),V.protocol.reporterHook.emit("reporter/uploadEnd",W.kSucceed),w.uploaddone&&w.uploaddone(null,M.copy(te),re||J),te=$.parseResponse(te,V.options.exifOrientation),ne||te.isS3||(te.url=z.genDownloadUrl(w.nosToken,B.Object,z.serverNosConfig.cdnDomain),w.nosToken.shortUrl&&(te._url_safe=w.nosToken.shortUrl)),M.exist(w.fileInputName))te.name=w.fileInputName;else if(w.blob){var ge=w.blob.name;if(te.name=ge||"blob-"+te.md5,!ge){var fe=w.blob.type;te.ext=p(fe).call(fe,d(fe).call(fe,"/")+1)}}else w.filePath?te.name=w.filePath:w.fileObject&&(te.name=w.fileObject.fileName);if(!te.ext){var ie,me,ye=d(ie=te.name).call(ie,".");ye===-1?te.ext="unknown":te.ext=p(me=te.name).call(me,ye+1)}te.size=te.size||0,te.isS3&&te._url_safe?V.getNosOriginUrl({safeShortUrl:te._url_safe,done:function(de,ue){de?V.logger.error("error:","getNosOriginUrl failed",de):(te.url=ue,w.done(null,M.copy(te)))}}):w.done(null,M.copy(te))}if(z.isWeixinApp)M.verifyOptions(w,"filePath","msg::_doPreviewFile"),V.fileQuickTransfer(w,q,function(){var Z=wx.uploadFile({url:Q,filePath:w.filePath,name:"file",formData:B,fail:function(te){q({code:"FAILED",msg:te}),V.logger.error("error:","api::msg:upload file failed",te)},success:function(te){if(te.statusCode===200)try{q(null,JSON.parse(te.data))}catch(ne){V.logger.error("error:","parse wx upload file res error",ne),q({code:"PARSE_WX_UPLOAD_FILE_RES_ERROR",str:te.data,msg:te.errMsg})}else q({code:te.statusCode,msg:te.errMsg})}});typeof w.uploadprogress=="function"&&Z&&(w.beginupload(Z,J),V.logger.info("_doPreviewFile::mini uploadprogress"),Z.onProgressUpdate(function(te){w.uploadprogress({total:te.totalBytesExpectedToSend,loaded:te.totalBytesSent,percentage:te.progress,percentageText:te.progress+"%"},J)}))});else if(z.isNodejs){var H={url:Q,name:"file",formData:B,success:function(Z){if(Z.statusCode===200)try{q(null,JSON.parse(Z.data))}catch(te){V.protocol.logger.error("error:","parse nodejs upload file res error",te),q({code:"PARSE_NODEJS_UPLOAD_FILE_RES_ERROR",str:Z.data,msg:Z.errMsg})}else q({code:Z.statusCode,msg:Z.errMsg})},fail:function(Z){q({code:"FAILED",msg:Z}),V.protocol.logger.error("error:","api::msg:upload file failed",Z)}};if(w.filePath)H.filePath=w.filePath;else{if(r(w.fileObject)!=="object")throw new E("Nodejs上传fileObject参数类型应如 {fileName:..,fileData:..} ");H.fileData=w.fileObject.fileData}V.fileQuickTransfer(w,q,function(){X.uploadFile(H)})}else if(z.isRN){var K={url:Q,name:"file",formData:B,filePath:w.filePath,success:function(Z){if(Z.ok&&Z.status===200)try{var te=n(Z.headers)&&n(Z.headers).etag;Z.md5=te?typeof te=="string"?te:te[0]:"UNKNOWN",q(null,Z)}catch(ne){V.protocol.logger.error("error:","parse React Native upload file res error",ne),q({code:"PARSE_React_Native_UPLOAD_FILE_RES_ERROR",res:Z})}else q({code:Z.status,msg:Z.statusText})},fail:function(Z){q({code:"FAILED",msg:Z}),V.protocol.logger.error("error:","api::msg:upload file failed",Z)}};V.fileQuickTransfer(w,q,function(){X.uploadFile(K)})}else w.url=Q,w.params=B,w.fileName="file",V.fileQuickTransfer(w,q,function(){return V.protocol.adaptersUploadFile(u({},w,{uploaddone:q}),J)})},A.fileQuickTransfer=function(w,J,V){var D,Q=this;w=w||{},J instanceof Function||(J=function(){}),V instanceof Function||(V=function(){});var G=w.fastPass;if(G)try{G=JSON.parse(G),w.fastPass=G}catch{Q.protocol.logger.error("快传参数解析失败")}var B=w.fileInputName||w.name||w.blob&&w.blob.name||"",q=w.fileSize||w.size||w.blob&&w.blob.size||0,H=G?m(D=(G.md5||w.digest||"")+"").call(D):"",K=w.type||w.blob&&w.blob.type;if(H&&q>=z.threshold){var Z=!0,te={name:B,md5:H,ext:p(B).call(B,d(B).call(B,".")+1),type:K};switch(K){case"image":G&&G.w&&G.h?(te.w=G.w,te.h=G.h):(Z=!1,Q.protocol.logger.error("快传 image 文件缺少参数 w 或 h"));break;case"video":G&&G.w&&G.h&&G.dur?(te.w=G.w,te.h=G.h,te.dur=G.dur):(Z=!1,Q.protocol.logger.error("快传 video 文件缺少参数 w 或 h 或 dur"));break;case"audio":G&&G.dur?te.dur=G.dur:(Z=!1,Q.protocol.logger.error("快传 audio 文件缺少参数 dur"))}if(!Z)return void V();var ne={fileQuickTransfer:{md5:H}};return q&&(ne.fileQuickTransfer.size=q),this.protocol.sendCmd("fileQuickTransfer",ne,function(re,se,oe){!re&&oe&&oe.fileQuickTransfer&&oe.fileQuickTransfer.url||(Q.protocol.logger.error("misc::fileQuickTransfer: not found",re,se),V()),oe&&oe.fileQuickTransfer&&oe.fileQuickTransfer.threshold&&(z.threshold=oe.fileQuickTransfer.threshold||0),oe&&oe.fileQuickTransfer&&oe.fileQuickTransfer.url&&(te.size=q||oe.fileQuickTransfer.size,te.url=oe.fileQuickTransfer.url,oe.fileQuickTransfer._url_safe&&(te._url_safe=oe.fileQuickTransfer._url_safe),J(re,te,!0))})}V()},A.sendFile=function(w){if((w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"sendFile",done:w.done}),w.type||(w.type="file"),w=M.merge(w,this.options.providers),M.verifyParamPresentJustOne(w,"dataURL blob fileInput file filePath wxFilePath fileObject","msg::sendFile"),M.exist(w.maxSize)&&M.verifyParamType("maxSize",w.maxSize,"number","api::previewFile"),M.exist(w.commonUpload)&&M.verifyParamType("commonUpload",w.commonUpload,"boolean","api::previewFile"),this.processCallback(w),w.filePath=w.filePath||w.wxFilePath,delete w.wxFilePath,w.dataURL)return this._previewAndSendFile(w);if(w.blob)return this._previewAndSendFile(w);if(w.fileInput)return w.fileInput=M.verifyFileInput(w.fileInput,"msg::sendFile"),w.fileInput.files&&!w.fileInput.files.length?void w.done(E.newNoFileError("请选择"+w.type+"文件",{callFunc:"msg::sendFile",fileInput:w.fileInput}),w.callback.options):this._previewAndSendFile(w);if(w.filePath||w.fileObject)return this._previewAndSendFile(w);if(w.file){var J,V=w.file._url_safe;return V&&(J=w.file.url,w.file.url=V,delete w.file._url_safe),w.msg=new this.message.FileMessage(w),this.sendMsg(w,J)}},A._previewAndSendFile=function(w){var J=this;M.verifyCallback(w,"uploaddone beforesend","msg::_previewAndSendFile");var V=C({},w),D=new J.message.Message(V);D.type=w.type;var Q=J.formatReturnMsg(D),G=J.protocol.reporterHook.getSafeClock(),B={apiCallingTime:J.protocol.reporterHook.getNTPTime(G),attachUploadDuration:0},q=w.done;return w.done=function(H,K){if(w.done=q,H){var Z=u({},Q,{status:"fail"}),te=C(C({},w.callback.options),{},{msg:Z});w.done(H,te)}else{if(B.attachUploadDuration=J.protocol.reporterHook.getSafeClock()-G,/chatroom/.test(w.scene))return;var ne,re=K._url_safe;re&&!K.isS3&&(ne=K.url,K.url=re,delete K._url_safe),w.file=K,w.msg=new J.message.FileMessage(w,D.idClient),w.beforesend(J.sendMsg(w,ne,B))}},J.previewFile(w,Q),Q},A.assembleUploadParams=function(w){return w?{Object:decodeURIComponent(w.objectName),"x-nos-token":w.token,"x-nos-entity-type":"json"}:null},A.deleteFile=function(w){ee({instance:this,className:"ApiBaseFn",funcName:"deleteFile",hasCallback:!1}),M.verifyParamPresentJustOne(w,"docId","msg::deleteFile"),this.removeFile({docId:w.docId,callback:function(J,V){J?w.error&&w.error(J,V):w.success&&w.success(V)}})},A.getFile=function(w){ee({instance:this,className:"ApiBaseFn",funcName:"getFile",hasCallback:!1}),M.verifyParamPresentJustOne(w,"docId","msg::getFile"),this.fetchFile({docId:w.docId,callback:function(J,V){J?w.error&&w.error(J,V):w.success&&w.success(V.info)}})},A.getFileList=function(w){ee({instance:this,className:"ApiBaseFn",funcName:"getFileList",hasCallback:!1});var J=w.fromDocId,V=J===void 0?"":J,D=w.limit,Q=D===void 0?10:D,G={limit:Q};V&&(G.fromDocId=V),this.fetchFileList({fileListParam:G,callback:function(B,q){B?(Q>30&&(B.message=B.message+"::文档条数超过限制:30"),w.error&&w.error(B,q)):w.success&&w.success(q)}})},A.sendGeo=function(w){return(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"sendGeo",done:w.done}),this.processCallback(w),w.msg=new this.message.GeoMessage(w),this.sendMsg(w)},A.sendTipMsg=function(w){return(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"sendTipMsg",done:w.done}),this.processCallback(w),w.msg=new this.message.TipMessage(w),this.sendMsg(w)},A.sendCustomMsg=function(w){return(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"sendCustomMsg",done:w.done}),this.processCallback(w),w.msg=new this.message.CustomMessage(w),this.sendMsg(w)},A.sendRobotMsg=function(w){return(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"sendRobotMsg",done:w.done}),this.logger.warn("this api will be abandon"),this.processCallback(w),w.msg=new this.message.RobotMessage(w),this.sendMsg(w)},A.sendMsg=function(w,J,V){var D=this,Q=D.protocol,G=w.msg,B={};V=V||{apiCallingTime:Q.reporterHook.getNTPTime(),attachUploadDuration:0};var q,H=!!w.isLocal;if(this.logger.warn("sendMsg::start: "+G.idClient),H&&(w.time&&(G.time=w.time),w.idClient&&(G.idClient=w.idClient),w.localFrom&&(q=w.localFrom+"")),w.resend&&(w.flow!=="out"||w.status!=="fail"))return M.onError("只能重发发送失败的消息");w.callback.options.idClient=G.idClient,D.beforeSendMsg(w,B);var K=w.rtnMsg=D.formatReturnMsg(G,q);if(J&&!D.options.keepNosSafeUrl&&K.file&&(K.file._url_safe=K.file.url,K.file.url=J,K.type==="audio"&&(K.file.mp3Url=J+(~c(J).call(J,"?")?"&":"?")+"audioTrans&type=mp3")),K.hasOwnProperty("chatroomId")&&!K.chatroomId)return M.onError("聊天室未连接");if(H&&(K.status="success",K.isLocal=!0),Q.storeSendMsg&&(B.promise=Q.storeSendMsg(K)),w.cbaop=function(te,ne){if(te)return te.code===7101&&(K.isInBlackList=!0,K.idServer=ne.idServer,K.time=ne.time),te.from!=="server"?(K.status="fail",Q.updateSendMsgError&&Q.updateSendMsgError(K),K):void 0},!H){J&&!D.options.keepNosSafeUrl&&w.callback&&(w.callback.originUrl=J),w.toAccids&&w.toAccids.length&&(G.toAccids=i(w.toAccids)),B.msg=G,V.sendTime=Q.reporterHook.getNTPTime(),Q.reporterHook.hasOriginTimetick()&&(B.msg.__clientExt=i({statistics:V}));var Z=G;D.sendCmd(w.cmd,B,function(){if(z.isBrowser){var te=arguments[0],ne=arguments[1]||{},re=D.subType==="chatroom",se=Z.scene===0,oe=Q.reporterHook.getNTPTime(),ae={msgId:ne.idServer,clientId:Z.idClient,msgTime:ne.time||0,fromAccid:D.account,toAccid:se?Z.to:"",type:re?4:Z.scene,roomId:re?D.options.chatroomId:"",tid:re||se?"":Z.to,result:te?te.code:200,failReason:te?te.message:"",rt:h(oe-V.apiCallingTime),apiCallingTime:V.apiCallingTime,sendTime:V.sendTime,attachUploadDuration:V.attachUploadDuration,apiCallbackTime:oe};D.reporter&&D.reporter.report("msgSend",ae)}w.callback&&w.callback.apply(D,arguments);var pe=arguments[0],ge=arguments[1];!pe&&ge&&ge.from===ge.to&&D.protocol.markMsgRead(ge)})}return D.afterSendMsg(w),H&&a(function(){K=M.simpleClone(K),w.done(null,K)},0),M.copy(K)},A.beforeSendMsg=function(){},A.afterSendMsg=function(){},A.formatReturnMsg=function(w,J){var V;return w=M.copy(w),this.protocol.completeMsg(w),w.status="sending",J&&(w.from=J),w=y(V=this.message).call(V,w),w=this.protocol.amendMsg(w)},A.resendMsg=function(w){return(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"resendMsg",done:w.done}),M.verifyOptions(w,"msg","msg::resendMsg"),this.trimMsgFlag(w),w.resend=!0,this._sendMsgByType(w)},A.forwardMsg=function(w){return(w=w||{}).done=ee({instance:this,className:"ApiBaseFn",funcName:"forwardMsg",done:w.done}),M.verifyOptions(w,"msg","msg::forwardMsg"),this.trimMsgFlag(w),this.beforeForwardMsg(w),w.forward=!0,w.msg.idClient=M.guid(),this._sendMsgByType(w)},A.trimMsgFlag=function(w){w&&w.msg&&(w.msg=M.copy(w.msg),delete w.msg.resend,delete w.msg.forward)},A.beforeForwardMsg=function(){},A._sendMsgByType=function(w){switch(M.verifyOptions(w,"msg","msg::_sendMsgByType"),M.verifyParamValid("msg.type",w.msg.type,this.message.validTypes,"msg::_sendMsgByType"),M.merge(w,w.msg),w.type){case"text":return this.sendText(w);case"image":case"audio":case"video":case"file":return this.sendFile(w);case"geo":return this.sendGeo(w);case"custom":return this.sendCustomMsg(w);case"tip":return this.sendTipMsg(w);default:throw new E("不能发送类型为 "+w.type+" 的消息")}},A.parseRobotTemplate=function(w){if(this.logger.warn("this api will be abandon"),/<template[^>/]+\/>/.test(w))return{raw:w,json:[{type:"text",name:"",text:""}]};if(!/<template[^>/]+>/.test(w))return{raw:w,json:[{type:"text",name:"",text:w}]};var J=new U({escapeMode:!1});w=w.replace(/<template [^>]+>/,"<template>");var V=J.xml2js(w);V=V.template.LinearLayout,T(V)||(V=[V]);var D=[];return V=v(V).call(V,function(B){B.image&&(D=g(D).call(D,G(B))),B.text&&(D=g(D).call(D,Q(B))),B.link&&(D=g(D).call(D,function(q){if(q.link){var H=q.link;T(H)||(H=[H]),H=n(H).call(H,function(K){return K.image&&(K.image=G(K)),K.text&&(K.text=Q(K)),K._type==="url"?(K.type="url",K.style=K._style||"",K.target=K._target,delete K._target,delete K._style):K._type==="block"&&(K.type="block",K.style=K._style||"",K.params=K._params||"",K.target=K._target,delete K._params,delete K._target,delete K._style),delete K._type,K}),q.link=H}return q.link}(B)))}),{raw:w,json:D};function Q(B){var q;return T(B.text)||(B.text=[B.text]),B.text=n(q=B.text).call(q,function(H){return{type:"text",name:H._name,text:H.__text}}),B.text}function G(B){var q;return T(B.image)||(B.image=[B.image]),B.image=n(q=B.image).call(q,function(H){return{type:"image",name:H._name,url:H._url}}),B.image}}},function(o,k,e){e(585);var r=e(12);o.exports=r.Object.assign},function(o,k,e){var r=e(1),i=e(586);r({target:"Object",stat:!0,arity:2,forced:Object.assign!==i},{assign:i})},function(o,k,e){var r=e(27),i=e(11),s=e(19),n=e(4),u=e(118),p=e(132),d=e(148),m=e(42),c=e(124),h=Object.assign,a=Object.defineProperty,y=i([].concat);o.exports=!h||n(function(){if(r&&h({b:1},h(a({},"a",{enumerable:!0,get:function(){a(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var T={},v={},g=Symbol();return T[g]=7,"abcdefghijklmnopqrst".split("").forEach(function(b){v[b]=b}),h({},T)[g]!=7||u(h({},v)).join("")!="abcdefghijklmnopqrst"})?function(T,v){for(var g=m(T),b=arguments.length,S=1,O=p.f,I=d.f;b>S;)for(var R,N=c(arguments[S++]),F=O?y(u(N),O(N)):u(N),P=F.length,x=0;P>x;)R=F[x++],r&&!s(I,N,R)||(g[R]=N[R]);return g}:h},function(o,k,e){var r=e(21),i=e(588),s=Array.prototype;o.exports=function(n){var u=n.reverse;return n===s||r(s,n)&&u===s.reverse?i:u}},function(o,k,e){e(589);var r=e(30);o.exports=r("Array").reverse},function(o,k,e){var r=e(1),i=e(11),s=e(79),n=i([].reverse),u=[1,2];r({target:"Array",proto:!0,forced:String(u)===String(u.reverse())},{reverse:function(){return s(this)&&(this.length=this.length),n(this)}})},function(o,k,e){o.exports=e(591)},function(o,k,e){o.exports=e(592)},function(o,k,e){var r=e(593);o.exports=r},function(o,k,e){var r=e(254);o.exports=r},function(o,k,e){o.exports=e(595)},function(o,k,e){var r=e(596);o.exports=r},function(o,k,e){var r=e(206);o.exports=r},function(o,k,e){var r=e(598),i=e(186);o.exports=function(s,n){if(s==null)return{};var u,p,d={},m=r(s);for(p=0;p<m.length;p++)u=m[p],i(n).call(n,u)>=0||(d[u]=s[u]);return d},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(599)},function(o,k,e){o.exports=e(600)},function(o,k,e){var r=e(601);o.exports=r},function(o,k,e){var r=e(230);o.exports=r},function(o,k,e){var r,i,s;(function(n,u){i=[],(s=typeof(r=function(p){return function(d){(d=d||{}).arrayAccessForm=d.arrayAccessForm||"none",d.emptyNodeForm=d.emptyNodeForm||"text",d.jsAttributeFilter=d.jsAttributeFilter,d.jsAttributeConverter=d.jsAttributeConverter,d.attributeConverters=d.attributeConverters||[],d.datetimeAccessFormPaths=d.datetimeAccessFormPaths||[],d.arrayAccessFormPaths=d.arrayAccessFormPaths||[],d.xmldomOptions=d.xmldomOptions||{},d.enableToStringFunc===void 0&&(d.enableToStringFunc=!0),d.skipEmptyTextNodesForObj===void 0&&(d.skipEmptyTextNodesForObj=!0),d.stripWhitespaces===void 0&&(d.stripWhitespaces=!0),d.useDoubleQuotes===void 0&&(d.useDoubleQuotes=!0),d.ignoreRoot===void 0&&(d.ignoreRoot=!1),d.escapeMode===void 0&&(d.escapeMode=!0),d.attributePrefix===void 0&&(d.attributePrefix="_"),d.selfClosingElements===void 0&&(d.selfClosingElements=!0),d.keepCData===void 0&&(d.keepCData=!1),d.keepText===void 0&&(d.keepText=!1),d.jsDateUTC===void 0&&(d.jsDateUTC=!1),function(){function A(M){var U=String(M);return U.length===1&&(U="0"+U),U}typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),typeof Date.prototype.toISOString!="function"&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+A(this.getUTCMonth()+1)+"-"+A(this.getUTCDate())+"T"+A(this.getUTCHours())+":"+A(this.getUTCMinutes())+":"+A(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}();var m=1,c=3,h=4,a=8,y=9;function T(A){var M=A.localName;return M==null&&(M=A.baseName),M!=null&&M!==""||(M=A.nodeName),M}function v(A){return typeof A=="string"?A.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):A}function g(A,M,U){switch(d.arrayAccessForm){case"property":A[M]instanceof Array?A[M+"_asArray"]=A[M]:A[M+"_asArray"]=[A[M]]}if(!(A[M]instanceof Array)&&d.arrayAccessFormPaths.length>0){for(var E=!1,z=0;z<d.arrayAccessFormPaths.length;z++){var $=d.arrayAccessFormPaths[z];if(typeof $=="string"){if($===U){E=!0;break}}else if($ instanceof RegExp){if($.test(U)){E=!0;break}}else if(typeof $=="function"&&$(M,U)){E=!0;break}}E&&(A[M]=[A[M]])}}function b(A){var M=A.split(/[-T:+Z]/g),U=new Date(M[0],M[1]-1,M[2]),E=M[5].split(".");if(U.setHours(M[3],M[4],E[0]),E.length>1&&U.setMilliseconds(E[1]),M[6]&&M[7]){var z=60*M[6]+Number(M[7]);z=0+((/\d\d-\d\d:\d\d$/.test(A)?"-":"+")=="-"?-1*z:z),U.setMinutes(U.getMinutes()-z-U.getTimezoneOffset())}else A.indexOf("Z",A.length-1)!==-1&&(U=new Date(Date.UTC(U.getFullYear(),U.getMonth(),U.getDate(),U.getHours(),U.getMinutes(),U.getSeconds(),U.getMilliseconds())));return U}function S(A,M){for(var U={__cnt:0},E=A.childNodes,z=0;z<E.length;z++){var $=E.item(z),X=T($);$.nodeType!==a&&(U.__cnt++,U[X]==null?(U[X]=O($,M+"."+X),g(U,X,M+"."+X)):(U[X]instanceof Array||(U[X]=[U[X]],g(U,X,M+"."+X)),U[X][U[X].length]=O($,M+"."+X)))}for(var Y=0;Y<A.attributes.length;Y++){var W=A.attributes.item(Y);U.__cnt++;for(var ee=W.value,w=0;w<d.attributeConverters.length;w++){var J=d.attributeConverters[w];J.test.call(null,W.name,W.value)&&(ee=J.convert.call(null,W.name,W.value))}U[d.attributePrefix+W.name]=ee}var V=A.prefix;return V&&(U.__cnt++,U.__prefix=V),U["#text"]&&(U.__text=U["#text"],U.__text instanceof Array&&(U.__text=U.__text.join(`
`)),d.escapeMode&&(U.__text=U.__text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&amp;/g,"&")),d.stripWhitespaces&&(U.__text=U.__text.trim()),delete U["#text"],d.arrayAccessForm==="property"&&delete U["#text_asArray"],U.__text=function(D,Q,G){if(d.datetimeAccessFormPaths.length>0)for(var B=G.split(".#")[0],q=0;q<d.datetimeAccessFormPaths.length;q++){var H=d.datetimeAccessFormPaths[q];if(typeof H=="string"){if(H===B)return b(D)}else if(H instanceof RegExp){if(H.test(B))return b(D)}else if(typeof H=="function"&&H(B))return b(D)}return D}(U.__text,0,M+".#text")),U.hasOwnProperty("#cdata-section")&&(U.__cdata=U["#cdata-section"],delete U["#cdata-section"],d.arrayAccessForm==="property"&&delete U["#cdata-section_asArray"]),U.__cnt===1&&U.__text&&!d.keepText?U=U.__text:U.__cnt===0&&d.emptyNodeForm==="text"?U="":U.__cnt>1&&U.__text!==void 0&&d.skipEmptyTextNodesForObj&&(d.stripWhitespaces&&U.__text===""||U.__text.trim()==="")&&delete U.__text,delete U.__cnt,d.keepCData||U.hasOwnProperty("__text")||!U.hasOwnProperty("__cdata")||Object.keys(U).length!==1?(d.enableToStringFunc&&(U.__text||U.__cdata)&&(U.toString=function(){return(this.__text?this.__text:"")+(this.__cdata?this.__cdata:"")}),U):U.__cdata?U.__cdata:""}function O(A,M){return A.nodeType===y?function(U){for(var E={},z=U.childNodes,$=0;$<z.length;$++){var X=z.item($);if(X.nodeType===m){var Y=T(X);d.ignoreRoot?E=O(X,Y):E[Y]=O(X,Y)}}return E}(A):A.nodeType===m?S(A,M):A.nodeType===c||A.nodeType===h?A.nodeValue:null}function I(A,M,U,E){var z="<"+(A&&A.__prefix?A.__prefix+":":"")+M;if(U)for(var $=0;$<U.length;$++){var X=U[$],Y=A[X];d.escapeMode&&(Y=v(Y)),z+=" "+X.substr(d.attributePrefix.length)+"=",d.useDoubleQuotes?z+='"'+Y+'"':z+="'"+Y+"'"}return z+=E?" />":">"}function R(A,M){return"</"+(A&&A.__prefix?A.__prefix+":":"")+M+">"}function N(A,M){return d.arrayAccessForm==="property"&&(U=M.toString(),E="_asArray",U.indexOf(E,U.length-E.length)!==-1)||M.toString().indexOf(d.attributePrefix)===0||M.toString().indexOf("__")===0||A[M]instanceof Function;var U,E}function F(A){var M=0;if(A instanceof Object)for(var U in A)N(A,U)||M++;return M}function P(A){var M=[];if(A instanceof Object)for(var U in A)U.toString().indexOf("__")===-1&&U.toString().indexOf(d.attributePrefix)===0&&M.push(U);return M}function x(A){var M="";return A instanceof Object?M+=function(U){var E="";return U.__cdata&&(E+="<![CDATA["+U.__cdata+"]]>"),(U.__text||typeof U.__text=="number"||typeof U.__text=="boolean")&&(d.escapeMode?E+=v(U.__text):E+=U.__text),E}(A):A!==null&&(d.escapeMode?M+=v(A):M+=A),M}function L(A,M,U){var E="";return d.jsAttributeFilter&&d.jsAttributeFilter.call(null,M,A)||(d.jsAttributeConverter&&(A=d.jsAttributeConverter.call(null,M,A)),A!=null&&A!==""||!d.selfClosingElements?typeof A=="object"?Object.prototype.toString.call(A)==="[object Array]"?E+=function(z,$,X){var Y="";if(z.length===0)Y+=I(z,$,X,!0);else for(var W=0;W<z.length;W++)Y+=L(z[W],$,P(z[W]));return Y}(A,M,U):A instanceof Date?(E+=I(A,M,U,!1),E+=d.jsDateUTC?A.toUTCString():A.toISOString(),E+=R(A,M)):F(A)>0||typeof A.__text=="number"||typeof A.__text=="boolean"||A.__text||A.__cdata?(E+=I(A,M,U,!1),E+=_(A),E+=R(A,M)):d.selfClosingElements?E+=I(A,M,U,!0):(E+=I(A,M,U,!1),E+=R(A,M)):(E+=I(A,M,U,!1),E+=x(A),E+=R(A,M)):E+=I(A,M,U,!0)),E}function _(A){var M="";if(F(A)>0){for(var U in A)if(!N(A,U)){var E=A[U];M+=L(E,U,P(E))}}return M+=x(A)}function C(A){if(A===void 0||typeof A!="string")return null;var M=null,U=null;if(p)U=(M=new p(d.xmldomOptions)).parseFromString(A,"text/xml");else if(window&&window.DOMParser){M=new window.DOMParser;var E=null;if(!(window.ActiveXObject||"ActiveXObject"in window)&&document.all&&!document.addEventListener)try{E=M.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch{E=null}try{U=M.parseFromString(A,"text/xml"),E!==null&&U.getElementsByTagNameNS(E,"parsererror").length>0&&(U=null)}catch{U=null}}else A.indexOf("<?")===0&&(A=A.substr(A.indexOf("?>")+2)),(U=new ActiveXObject("Microsoft.XMLDOM")).async="false",U.loadXML(A);return U}this.asArray=function(A){return A==null?[]:A instanceof Array?A:[A]},this.toXmlDateTime=function(A){return A instanceof Date?A.toISOString():typeof A=="number"?new Date(A).toISOString():null},this.asDateTime=function(A){return typeof A=="string"?b(A):A},this.xml2dom=function(A){return C(A)},this.dom2js=function(A){return O(A,null)},this.js2dom=function(A){return C(this.js2xml(A))},this.xml2js=function(A){var M=C(A);return M!=null?this.dom2js(M):null},this.js2xml=function(A){return _(A)},this.getVersion=function(){return"3.4.4"}}})=="function"?r.apply(k,i):r)===void 0||(o.exports=s)})()},function(o,k,e){var r=e(116);o.exports=function(i,s){return s.method="POST",s.headers=s.headers||{},s.headers["Content-Type"]="multipart/form-data",s.timeout=0,s.type=s.type||"json",r(i,s)}},function(o,k,e){var r=e(15),i=e(52),s=e(6),n=e(3),u=e(13),p=u.chunkSize,d=e(116),m={mp4:"video/mp4",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",mpeg:"video/mpeg",mov:"video/quicktime",aac:"audio/x-aac",wma:"audio/x-ms-wma",wav:"audio/x-wav",mp3:"audio/mp3"};o.exports=function c(h,a,y,T){var v={file:h.data[a],fileSize:h.data[a].size,fileUploadedSize:0,percentage:0},g=h.url;function b(L){var _=v.fileUploadedSize+L.loaded,C=Math.floor(1e4*_/v.fileSize)/100;if(i(C)>=100&&(C=100,b=function(){}),v.percentage!==C){v.percentage=C;var A={docId:h.docId,total:v.fileSize,loaded:_,percentage:C,percentageText:C+"%"};h.fileInput&&(A.fileInput=h.fileInput),h.blob&&(A.blob=h.blob),h.uploadprogress(A)}}function S(L){try{L=JSON.parse(L)}catch(A){return void y.onError(A)}if(L.errMsg||L.errCode)y.onError(L);else if(L.offset<v.fileSize)delete N.onaftersend,v.fileUploadedSize=L.offset,function(A,M,U,E){var z=A.offset,$=A.offset+p;if(typeof FileReader<"u"){var X,Y=new FileReader;Y.readAsArrayBuffer(r(X=E.file).call(X,z,$)),Y.addEventListener("load",function(ee){M.data=ee.target.result,M.query.offset=A.offset,M.query.complete=$>=E.fileSize,M.query.context=A.context,M.onuploading=b,M.onload=S,M.onerror=O,y.sn=d(g,M)}),Y.addEventListener("error",function(ee){M.onerror(ee.target.error)})}else{var W;M.data=r(W=E.file).call(W,z,$),M.query.offset=A.offset,M.query.complete=$>=E.fileSize,M.query.context=A.context,M.onuploading=b,M.onload=S,M.onerror=O,y.sn=d(g,M)}}(L,N,0,v);else{var _=u.genFileUrl(h.nosToken);h.type==="image"?d(_+"?imageInfo",{onload:function(A){try{A=JSON.parse(A),h.uploaddone(null,{docId:L.docId,w:A.Width,h:A.Height,orientation:A.Orientation||"",type:A.Type,size:A.Size||v.fileSize})}catch(M){C(M)}},onerror:function(A){if(typeof Image<"u"){var M=new Image;M.src=_,M.onload=function(){h.uploaddone(null,{docId:L.docId,w:M.width,h:M.height,size:v.fileSize})},M.onerror=function(U){C(U)}}else C(A)}}):h.type==="video"||h.type==="audio"?d(_+"?vinfo",{onload:function(A){try{(A=JSON.parse(A)).GetVideoInfo&&A.GetVideoInfo.VideoInfo&&(A=A.GetVideoInfo.VideoInfo),h.uploaddone(null,{docId:L.docId,w:A.Width,h:A.Height,dur:A.Duration,orientation:A.Rotate,audioCodec:A.AudioCodec,videoCodec:A.VideoCodec,container:A.Container,size:A.Size||v.fileSize})}catch(M){C(M)}},onerror:C}):h.uploaddone(null,{docId:L.docId,size:v.fileSize})}function C(A){y.onError(A)}}function O(L){h.errorHook(L,{url:g,provider:"nos"});var _=L&&L.code;function C(){try{if(L.result)var A=JSON.parse(L.result);else A=L;y.onError(A)}catch(M){y.onError(M)}}v.fileUploadedSize===0&&_!=="abort"?h.edgeList?T<h.edgeList.length-1?c(h,a,y,T+1):C():h.nosLbsUrls&&h.nosLbsUrls.length>0?function(A,M,U,E,z){return new n(function($){function X(){z.adaptersRequest(U[A],{query:{version:"1.0",bucketname:M},method:"GET",onerror:Y,onload:function(W){try{(W=JSON.parse(W))&&W.upload&&W.upload.length?$(W.upload):Y()}catch{Y()}}},{exception_service:3})}function Y(){E.onLbsUrlFail(U[A]),A<U.length-1?(A++,X()):$([])}X()})}(0,h.nosToken.bucket,h.nosLbsUrls,y,h).then(function(A){A.length>0?(h.edgeList=A,h.updateNosEdgeList&&h.updateNosEdgeList(A),c(h,a,y,T+1)):C()}):(h.edgeList=u.edgeList,c(h,a,y,T+1)):C()}typeof T!="number"&&(T=-1),h.edgeList&&h.edgeList.length&&(T=T>0?T:0,g=h.edgeList[T]),g+="/"+h.nosToken.bucket+"/"+h.nosToken.objectName;var I=h.data.file&&h.data.file.type;if(!I||s(I).call(I,"/")<0){var R=(h.fileInputName||"").split(".").pop();h.type==="image"?I="image/"+(R==="jpg"?"jpeg":R):h.type!=="audio"&&h.type!=="video"||(I=m[R])}var N={query:{offset:0,complete:p>=v.fileSize,version:"1.0"},headers:{"Content-Type":I||"application/octet-stream","x-nos-token":h.nosToken.token},method:"POST",timeout:0,onaftersend:function(){h.beginupload(y)},onuploading:b,onload:S,onerror:O};if(typeof FileReader<"u"){var F,P=new FileReader;P.addEventListener("load",function(L){N.data=L.target.result,y.sn=d(g,N)}),P.addEventListener("error",function(L){N.onerror(L.target.error)}),P.readAsArrayBuffer(r(F=v.file).call(F,0,p))}else{var x;N.data=r(x=v.file).call(x,0,p),y.sn=d(g,N)}}},function(o,k,e){e(606);var r=e(12);o.exports=r.Reflect.construct},function(o,k,e){var r=e(1),i=e(33),s=e(76),n=e(273),u=e(169),p=e(36),d=e(28),m=e(80),c=e(4),h=i("Reflect","construct"),a=Object.prototype,y=[].push,T=c(function(){function b(){}return!(h(function(){},[],b)instanceof b)}),v=!c(function(){h(function(){})}),g=T||v;r({target:"Reflect",stat:!0,forced:g,sham:g},{construct:function(b,S){u(b),p(S);var O=arguments.length<3?b:u(arguments[2]);if(v&&!T)return h(b,S,O);if(b==O){switch(S.length){case 0:return new b;case 1:return new b(S[0]);case 2:return new b(S[0],S[1]);case 3:return new b(S[0],S[1],S[2]);case 4:return new b(S[0],S[1],S[2],S[3])}var I=[null];return s(y,I,S),new(s(n,b,I))}var R=O.prototype,N=m(d(R)?R:a),F=s(b,N,S);return d(F)?F:N}})},function(o,k,e){o.exports=e(608)},function(o,k,e){var r=e(609);o.exports=r},function(o,k,e){var r=e(215);o.exports=r},function(o,k,e){o.exports=e(611)},function(o,k,e){var r=e(612);o.exports=r},function(o,k,e){var r=e(613);o.exports=r},function(o,k,e){var r=e(614);o.exports=r},function(o,k,e){e(615);var r=e(12);o.exports=r.Object.setPrototypeOf},function(o,k,e){e(1)({target:"Object",stat:!0},{setPrototypeOf:e(135)})},function(o,k,e){o.exports=e(617)},function(o,k,e){var r=e(618);o.exports=r},function(o,k,e){var r=e(272);o.exports=r},function(o,k){o.exports=function(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(621)},function(o,k,e){var r=e(622);o.exports=r},function(o,k,e){var r=e(283);o.exports=r},function(o,k,e){e(624);var r=e(12);o.exports=r.Object.getPrototypeOf},function(o,k,e){var r=e(1),i=e(4),s=e(42),n=e(134),u=e(228);r({target:"Object",stat:!0,forced:i(function(){n(1)}),sham:!u},{getPrototypeOf:function(p){return n(s(p))}})},function(o,k,e){var r,i=e(139),s=e(6),n=e(10),u=e(25),p=e(8),d=e(15),m=e(5),c=e(0),h=e(73).fn,a=e(285),y=e(276),T=e(40),v=e(24).reportAPI;h.transDoc=function(g){var b;c.verifyOptions(g,"fileInput done","nos::transDoc");try{var S=g.fileInput.files[0],O=["ppt","pdf","pptx","doc","docx"],I=g.fileInputName=S.name,R={ppt:1,pptx:2,pdf:3,doc:6,docx:7},N=I.substring(i(I).call(I,".")+1);if(s(O).call(O,N)<0)return void g.done(T.newNoFileError("请上传正确格式的文件【ppt, pptx, pdf, doc, docx】",{callFunc:"nos: transDoc",fileInput:g.fileInput}),g)}catch{return void g.done(T.newNoFileError("请上传正确的文件节点",{callFunc:"msg::previewFile",fileInput:g.fileInput}),g)}var F=n(y.genResponseBody("file")||{}).replace(/"/gi,'\\"'),P={transToken:{name:I,type:R[N],transType:g.transcode==="png"?11:10,size:S.size,body:F}};this.getNosTokenTrans({responseBody:P,nosToken:{nosScene:g.nosScene||this.nosScene,nosSurvivalTime:g.nosSurvivalTime},callback:u(b=function(x,L){x?g.done(x):(g.nosToken=L.nosToken,g.docId=L.docId,this._doPreviewFile(g))}).call(b,this)})},h.getSimpleNosToken=function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g.num=1,c.verifyOptions(g),this.cbAndSendCmd("getSimpleNosToken",g)},h.getNosToken=function(g){var b=g.callback,S=g.nosToken,O=g.responseBody,I={tag:S.nosScene};S.nosSurvivalTime&&S.nosSurvivalTime!==1/0&&(I.expireSec=S.nosSurvivalTime),this.sendCmd("getNosToken",{responseBody:O,nosToken:I},b)},h.getNosTokenTrans=function(g){this.sendCmd("getNosTokenTrans",g.responseBody,g.callback)},h.getMixStoreToken=function(g){this.sendCmd("getMixStoreToken",{mixTokenReq:{provider:g.curProvider,tokenCount:g.tokenCount||1,tag:"im",returnBody:g.responseBody}},g.callback)},h.packFileDownloadName=function(g){v({instance:this,className:"ApiBaseFn",funcName:"packFileDownloadName",hasCallback:!1}),c.verifyOptions(g,"url name",!0,"","nos::packFileDownloadName");var b=g.url;return b+c.genUrlSep(b)+"download="+encodeURIComponent(g.name)},h.audioToMp3=function(g){v({instance:this,className:"ApiBaseFn",funcName:"audioToMp3",hasCallback:!1}),c.verifyOptions(g,"url","nos::audioToMp3");var b=g.url;return b+c.genUrlSep(b)+"audioTrans&type=mp3"},h.removeFile=function(g){this.sendCmd("removeFile",g,g.callback)},h.fetchFile=function(g){this.sendCmd("fetchFile",g,g.callback)},h.fetchFileList=function(g){this.sendCmd("fetchFileList",g,g.callback)},h.stripImageMeta=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"stripImageMeta",hasCallback:!1}),this.beforeProcessImage(g,"stripmeta")},h.qualityImage=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"qualityImage",hasCallback:!1}),this.beforeProcessImage(g,"quality")},h.interlaceImage=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"interlaceImage",hasCallback:!1}),this.beforeProcessImage(g,"interlace")},h.rotateImage=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"rotateImage",hasCallback:!1}),this.beforeProcessImage(g,"rotate")},h.blurImage=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"blurImage",hasCallback:!1}),this.beforeProcessImage(g,"blur")},h.cropImage=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"cropImage",hasCallback:!1}),this.beforeProcessImage(g,"crop")},h.thumbnailImage=function(g){return v({instance:this,className:"ApiBaseFn",funcName:"thumbnailImage",hasCallback:!1}),this.beforeProcessImage(g,"thumbnail")},h.beforeProcessImage=function(g,b){var S=c.copy(g);return S.type=b,g.ops=[S],this.processImage(g)},h.processImage=function(g){var b;g.callback=v({instance:this,className:"ApiBaseFn",funcName:"processImage",done:g.callback});var S=this;c.verifyOptions(g,"url ops",!0,"","nos::processImage"),c.verifyParamType("ops",g.ops,"array","nos::processImage");var O=p(b=g.ops).call(b,function(I){var R,N;return c.verifyOptions(I,"type",!0,"","nos::processImage"),c.verifyParamValid("type",I.type,a.validTypes,"nos::processImage"),S["gen"+d(R=I.type).call(R,0,1).toUpperCase()+d(N=I.type).call(N,1)+"Op"](I)});S.processCallback(g),S.sendCmd("processImage",{url:g.url,imageOps:O},g.callback)},h.genStripmetaOp=function(g){return new a({type:g.type,stripmeta:g.strip?1:0})},h.genQualityOp=function(g){c.verifyOptions(g,"quality",!0,"","nos::genQualityOp"),c.verifyParamType("quality",g.quality,"number","nos::genQualityOp"),c.verifyParamMin("quality",g.quality,0,"nos::genQualityOp"),c.verifyParamMax("quality",g.quality,100,"nos::genQualityOp");var b=Math.round(g.quality);return new a({type:g.type,qualityQuality:b})},h.genInterlaceOp=function(g){return new a({type:g.type})},h.genRotateOp=function(g){for(c.verifyOptions(g,"angle",!0,"","nos::genRotateOp"),c.verifyParamType("angle",g.angle,"number","nos::genRotateOp");g.angle<0;)g.angle=g.angle+360;g.angle=g.angle%360;var b=Math.round(g.angle);return new a({type:g.type,rotateAngle:b})},h.genBlurOp=function(g){c.verifyOptions(g,"radius sigma","nos::genBlurOp"),c.verifyParamType("radius",g.radius,"number","nos::genBlurOp"),c.verifyParamMin("radius",g.radius,1,"nos::genBlurOp"),c.verifyParamMax("radius",g.radius,50,"nos::genBlurOp"),c.verifyParamType("sigma",g.sigma,"number","nos::genBlurOp"),c.verifyParamMin("sigma",g.sigma,0,"nos::genBlurOp");var b=Math.round(g.radius),S=Math.round(g.sigma);return new a({type:g.type,blurRadius:b,blurSigma:S})},h.genCropOp=function(g){c.verifyOptions(g,"x y width height","nos::genCropOp"),c.verifyParamType("x",g.x,"number","nos::genCropOp"),c.verifyParamMin("x",g.x,0,"nos::genCropOp"),c.verifyParamType("y",g.y,"number","nos::genCropOp"),c.verifyParamMin("y",g.y,0,"nos::genCropOp"),c.verifyParamType("width",g.width,"number","nos::genCropOp"),c.verifyParamMin("width",g.width,0,"nos::genCropOp"),c.verifyParamType("height",g.height,"number","nos::genCropOp"),c.verifyParamMin("height",g.height,0,"nos::genCropOp");var b=Math.round(g.x),S=Math.round(g.y),O=Math.round(g.width),I=Math.round(g.height);return new a({type:g.type,cropX:b,cropY:S,cropWidth:O,cropHeight:I})},h.genThumbnailOp=(r={cover:"z",contain:"x",crop:"y"},function(g){c.verifyOptions(g,"mode","nos::genThumbnailOp"),c.verifyParamValid("mode",g.mode,m(r),"nos::genThumbnailOp"),g.mode==="contain"?c.verifyParamAtLeastPresentOne(g,"width height","nos::genThumbnailOp"):c.verifyOptions(g,"width height","nos::genThumbnailOp"),c.undef(g.width)&&(g.width=0),c.undef(g.height)&&(g.height=0),c.verifyParamType("width",g.width,"number","nos::genThumbnailOp"),c.verifyParamMin("width",g.width,0,"nos::genThumbnailOp"),c.verifyParamType("height",g.height,"number","nos::genThumbnailOp"),c.verifyParamMin("height",g.height,0,"nos::genThumbnailOp");var b=Math.round(g.width),S=Math.round(g.height),O=new a({type:g.type,thumbnailMode:r[g.mode],thumbnailWidth:b,thumbnailHeight:S});if(g.mode==="crop"&&c.notundef(g.axis)){c.undef(g.axis.x)&&(g.axis.x=5),c.undef(g.axis.y)&&(g.axis.y=5),c.verifyParamMin("axis.x",g.axis.x,0,"nos::genThumbnailOp"),c.verifyParamMax("axis.x",g.axis.x,10,"nos::genThumbnailOp"),c.verifyParamMin("axis.y",g.axis.y,0,"nos::genThumbnailOp"),c.verifyParamMax("axis.y",g.axis.y,10,"nos::genThumbnailOp");var I=Math.round(g.axis.x),R=Math.round(g.axis.y);O.thumbnailAxisX=I,O.thumbnailAxisY=R}return c.notundef(g.enlarge)&&(c.verifyParamType("enlarge",g.enlarge,"boolean","nos::genThumbnailOp"),g.enlarge&&(O.thumbnailEnlarge=1)),O.thumbnailToStatic=this.options.thumbnailToStatic?1:0,O}),h.getNosOriginUrl=function(g){var b;(g=g||{}).done=v({instance:this,className:"ApiBaseFn",funcName:"getNosOriginUrl",done:g.done}),c.verifyOptions(g,"safeShortUrl",!0,"","nos::getNosOriginUrl"),c.verifyParamType("safeShortUrl",g.safeShortUrl,"string","nos::getNosOriginUrl"),/^http(s)?:/.test(g.safeShortUrl)&&~s(b=g.safeShortUrl).call(b,"im_url=1")?(this.processCallback(g),this.sendCmd("getNosOriginUrl",{nosFileUrlTag:{safeUrl:g.safeShortUrl}},g.callback)):g.done(new T("参数 “safeShortUrl” 内容非文件安全短链",{callFunc:"nos: getNosOriginUrl"}),g)}},function(o,k,e){var r,i=e(7),s=e(6),n=e(5),u=e(26),p=e(106),d=p.genUrlSep,m=p.url2object,c=p.object2url,h=e(0),a=e(73).fn,y=e(24).reportAPI;a.viewImageSync=function(T){y({instance:this,className:"ApiBaseFn",funcName:"viewImageSync",hasCallback:!1});var v=this.options;h.verifyOptions(T,"url","nos::viewImageSync");var g=T.url,b=m(g),S=b.protocol,O=b.hostname,I=b.path,R=b.query;if(typeof T.strip=="boolean"&&(R.stripmeta=T.strip?1:0),typeof T.quality=="number"&&(h.verifyParamMin("quality",T.quality,0,"nos::viewImageSync"),h.verifyParamMax("quality",T.quality,100,"nos::viewImageSync"),R.quality=Math.round(T.quality)),typeof T.interlace=="boolean"&&(R.interlace=T.interlace?1:0),typeof T.rotate=="number"&&(R.rotate=Math.round(T.rotate)),u(T.thumbnail)==="object"){var N=T.thumbnail.mode||"crop",F=T.thumbnail.width,P=T.thumbnail.height;if(F>=0&&P>=0&&F<4096&&P<4096&&(F>0||P>0)){var x,L;switch(N){case"crop":N="y";break;case"contain":N="x";break;case"cover":N="z";break;default:N="x"}R.thumbnail=i(x=i(L="".concat(F)).call(L,N)).call(x,P)}}if(v.downloadUrl){var _=m(T.url),C=v.downloadUrl,A=_.path,M=s(A).call(A,"/");if(M!==-1){var U=A.substring(0,M),E=A.substring(M+1);C=C.replace("{bucket}",U).replace("{object}",E)}var z=m(C);return c({protocol:z.protocol,hostname:z.hostname,path:z.path,query:h.merge(z.query,R)})}return c({protocol:S,hostname:O,path:I,query:R})},a.viewImageStripMeta=function(T){y({instance:this,className:"ApiBaseFn",funcName:"viewImageStripMeta",hasCallback:!1}),h.verifyOptions(T,"url strip","nos::viewImageStripMeta"),h.verifyParamType("strip",T.strip,"boolean","nos::viewImageStripMeta");var v="stripmeta="+(T.strip?1:0),g=d(T.url);return T.url+g+v},a.viewImageQuality=function(T){y({instance:this,className:"ApiBaseFn",funcName:"viewImageQuality",hasCallback:!1}),h.verifyOptions(T,"url quality","nos::viewImageQuality"),h.verifyParamType("quality",T.quality,"number","nos::viewImageQuality"),h.verifyParamMin("quality",T.quality,0,"nos::viewImageQuality"),h.verifyParamMax("quality",T.quality,100,"nos::viewImageQuality");var v="quality="+Math.round(T.quality),g=d(T.url);return T.url+g+v},a.viewImageInterlace=function(T){y({instance:this,className:"ApiBaseFn",funcName:"viewImageInterlace",hasCallback:!1}),h.verifyOptions(T,"url","nos::viewImageInterlace");var v=d(T.url);return T.url+v+"interlace=1"},a.viewImageRotate=function(T){for(y({instance:this,className:"ApiBaseFn",funcName:"viewImageRotate",hasCallback:!1}),h.verifyOptions(T,"url angle","nos::viewImageRotate"),h.verifyParamType("angle",T.angle,"number","nos::viewImageRotate");T.angle<0;)T.angle=T.angle+360;T.angle=T.angle%360;var v="rotate="+Math.round(T.angle),g=d(T.url);return T.url+g+v},a.viewImageBlur=function(T){y({instance:this,className:"ApiBaseFn",funcName:"viewImageBlur",hasCallback:!1}),h.verifyOptions(T,"url radius sigma","nos::viewImageBlur"),h.verifyParamType("radius",T.radius,"number","nos::viewImageBlur"),h.verifyParamMin("radius",T.radius,1,"nos::viewImageBlur"),h.verifyParamMax("radius",T.radius,50,"nos::viewImageBlur"),h.verifyParamType("sigma",T.sigma,"number","nos::viewImageBlur"),h.verifyParamMin("sigma",T.sigma,0,"nos::viewImageBlur");var v="blur="+Math.round(T.radius)+"x"+Math.round(T.sigma),g=d(T.url);return T.url+g+v},a.viewImageCrop=function(T){y({instance:this,className:"ApiBaseFn",funcName:"viewImageCrop",hasCallback:!1}),h.verifyOptions(T,"url x y width height","nos::viewImageCrop"),h.verifyParamType("x",T.x,"number","nos::viewImageCrop"),h.verifyParamMin("x",T.x,0,"nos::viewImageCrop"),h.verifyParamType("y",T.y,"number","nos::viewImageCrop"),h.verifyParamMin("y",T.y,0,"nos::viewImageCrop"),h.verifyParamType("width",T.width,"number","nos::viewImageCrop"),h.verifyParamMin("width",T.width,0,"nos::viewImageCrop"),h.verifyParamType("height",T.height,"number","nos::viewImageCrop"),h.verifyParamMin("height",T.height,0,"nos::viewImageCrop");var v="crop="+Math.round(T.x)+"_"+Math.round(T.y)+"_"+Math.round(T.width)+"_"+Math.round(T.height),g=d(T.url);return T.url+g+v},a.viewImageThumbnail=(r={cover:"z",contain:"x",crop:"y"},function(T){h.verifyOptions(T,"url mode","nos::viewImageThumbnail"),h.verifyParamValid("mode",T.mode,n(r),"nos::viewImageThumbnail"),T.mode==="contain"?h.verifyParamAtLeastPresentOne(T,"width height","nos::viewImageThumbnail"):h.verifyOptions(T,"width height","nos::viewImageThumbnail"),h.undef(T.width)&&(T.width=0),h.undef(T.height)&&(T.height=0),h.verifyParamType("width",T.width,"number","nos::viewImageThumbnail"),h.verifyParamMin("width",T.width,0,"nos::viewImageThumbnail"),h.verifyParamType("height",T.height,"number","nos::viewImageThumbnail"),h.verifyParamMin("height",T.height,0,"nos::viewImageThumbnail");var v=Math.round(T.width),g=Math.round(T.height),b="thumbnail="+v+r[T.mode]+g;T.mode==="crop"&&h.notundef(T.axis)&&(h.undef(T.axis.x)&&(T.axis.x=5),h.undef(T.axis.y)&&(T.axis.y=5),h.verifyParamMin("axis.x",T.axis.x,0,"nos::viewImageThumbnail"),h.verifyParamMax("axis.x",T.axis.x,10,"nos::viewImageThumbnail"),h.verifyParamMin("axis.y",T.axis.y,0,"nos::viewImageThumbnail"),h.verifyParamMax("axis.y",T.axis.y,10,"nos::viewImageThumbnail"),b=b+"&axis="+Math.round(T.axis.x)+"_"+Math.round(T.axis.y)),h.notundef(T.enlarge)&&(h.verifyParamType("enlarge",T.enlarge,"boolean","nos::viewImageThumbnail"),T.enlarge&&(b+="&enlarge=1"));var S=d(T.url);return T.url+S+b})},function(o,k,e){var r=e(628);o.exports=r},function(o,k,e){var r=e(21),i=e(629),s=e(631),n=Array.prototype,u=String.prototype;o.exports=function(p){var d=p.includes;return p===n||r(n,p)&&d===n.includes?i:typeof p=="string"||p===u||r(u,p)&&d===u.includes?s:d}},function(o,k,e){e(630);var r=e(30);o.exports=r("Array").includes},function(o,k,e){var r=e(1),i=e(160).includes,s=e(4),n=e(196);r({target:"Array",proto:!0,forced:s(function(){return!Array(1).includes()})},{includes:function(u){return i(this,u,arguments.length>1?arguments[1]:void 0)}}),n("includes")},function(o,k,e){e(632);var r=e(30);o.exports=r("String").includes},function(o,k,e){var r=e(1),i=e(11),s=e(633),n=e(108),u=e(49),p=e(635),d=i("".indexOf);r({target:"String",proto:!0,forced:!p("includes")},{includes:function(m){return!!~d(u(n(this)),u(s(m)),arguments.length>1?arguments[1]:void 0)}})},function(o,k,e){var r=e(634),i=TypeError;o.exports=function(s){if(r(s))throw i("The method doesn't accept regular expressions");return s}},function(o,k,e){var r=e(28),i=e(62),s=e(20)("match");o.exports=function(n){var u;return r(n)&&((u=n[s])!==void 0?!!u:i(n)=="RegExp")}},function(o,k,e){var r=e(20)("match");o.exports=function(i){var s=/./;try{"/./"[i](s)}catch{try{return s[r]=!1,"/./"[i](s)}catch{}}return!1}},function(o,k,e){var r=e(26),i=e(10),s=e(6),n=e(305),u=e(0),p=e(73).fn,d=e(13),m=e(24).reportAPI;function c(a,y,T,v){var g=!1,b="";if(T===1?s(a).call(a,y)>=0&&(g=!0,b=y):T===2&&(b=new RegExp(y,"g")).test(a)&&(g=!0),g&&b!=="")switch(v){case 1:return a.replace(b,"**");case 2:return{code:2};case 3:return{code:3}}return a}function h(a,y){for(var T=y.match,v=y.operate,g=a,b=0;b<n(y).length;b++){var S=n(y)[b],O=S.match||T,I=S.operate||v;try{if(g=c(g,S.key,O,I),r(g)==="object")return g}catch(R){this.logger.warn("misc::filterContent: js cannot parse this regexp ",R)}}return g}p.uploadSdkLogUrl=function(a){return u.verifyOptions(a,"url","misc::uploadSdkLogUrl"),this.cbAndSendCmd("uploadSdkLogUrl",a)},p.getClientAntispamLexicon=function(a){var y=this;(a=a||{}).done=m({instance:this,className:"ApiBaseFn",funcName:"getClientAntispamLexicon",done:a.done});var T=(a=a||{}).done;T instanceof Function||(T=function(){}),a={clientAntispam:{version:0}};var v=this;if(d.hasLocalStorage&&localStorage.getItem("antispamLexicon")&&localStorage.getItem("antispamLexicon")!=="{}")try{v.antispamLexicon=JSON.parse(localStorage.getItem("antispamLexicon"))}catch(g){this.logger.error("JSON parse antispamLexicon error",g)}v.antispamLexicon&&T.call(this,null,{clientAntispam:v.antispamLexicon}),this.protocol.sendCmd("getClientAntispam",a,function(g,b,S){g?(v.protocol.logger.error("misc::getClientAntispamLexicon:",g),T.call(y,g,{})):(d.hasLocalStorage&&localStorage.setItem("antispamLexicon",i(S.clientAntispam)),v.antispamLexicon||T.call(y,null,S),v.antispamLexicon=S.clientAntispam||{})})},p.filterClientAntispam=function(a){m({instance:this,className:"ApiBaseFn",funcName:"filterClientAntispam",hasCallback:!1});var y=a.content;if(!y)return{code:404,errmsg:"待反垃圾文本content不存在"};var T=this.antispamLexicon&&this.antispamLexicon.thesaurus;if(!T)return{code:404,errmsg:"没有反垃圾词库或者词库格式不合法"};try{T=JSON.parse(T).thesaurus}catch{return this.protocol.logger.error("misc::filterClientAntispam: parse thesaurus error"),{code:500,errmsg:"反垃圾词库格式不合法"}}for(var v=y,g=0;g<T.length;g++)if(v=h.call(this,v,T[g]),r(v)==="object"){if(v.code===2)return{code:200,type:2,errmsg:"建议拒绝发送",content:y,result:""};if(v.code===3)return{code:200,type:3,errmsg:"建议服务器处理反垃圾，发消息带上字段clientAntiSpam",content:y,result:y}}return v===y?{code:200,type:0,errmsg:"",content:y,result:v}:{code:200,type:1,errmsg:"已对特殊字符做了过滤",content:y,result:v}},p.getServerTime=function(a){(a=a||{}).done=m({instance:this,className:"ApiBaseFn",funcName:"getServerTime",done:a.done}),this.processCallback(a),this.sendCmd("getServerTime",{},a.callback)},p.getNosAccessToken=function(a){(a=a||{}).done=m({instance:this,className:"ApiBaseFn",funcName:"getNosAccessToken",done:a.done}),u.verifyOptions(a,"url","misc::getNosAccessToken"),this.processCallback(a);var y={url:a.url};a.userAgent&&(y.userAgent=a.userAgent),a.ext&&(y.ext=a.ext),this.sendCmd("getNosAccessToken",{nosAccessTokenTag:y},function(T,v,g){var b=g&&g.nosAccessTokenTag&&g.nosAccessTokenTag.token,S=a.url,O=b?{token:b,resUrl:s(S).call(S,"?")!==-1?S+"&token="+b:S+"?token="+b}:{};a.done(T,O)})},p.deleteNosAccessToken=function(a){(a=a||{}).done=m({instance:this,className:"ApiBaseFn",funcName:"deleteNosAccessToken",done:a.done}),u.verifyOptions(a,"token","misc::deleteNosAccessToken"),this.processCallback(a),this.sendCmd("deleteNosAccessToken",{nosAccessTokenTag:{token:a.token}},a.callback)}},function(o,k,e){e(66);var r=e(64),i=e(29),s=e(21),n=e(638),u=Array.prototype,p={DOMTokenList:!0,NodeList:!0};o.exports=function(d){var m=d.keys;return d===u||s(u,d)&&m===u.keys||i(p,r(d))?n:m}},function(o,k,e){var r=e(639);o.exports=r},function(o,k,e){e(82),e(96);var r=e(30);o.exports=r("Array").keys},function(o,k,e){var r=e(26),i=e(3),s=e(8),n=e(10),u=e(73).fn,p=e(0),d=e(191),m=e(286),c=e(24).reportAPI;u.signalingCreate=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.type,y=h.channelName,T=h.ext;return p.verifyOptions(h,"type","api::signalling"),this.sendCmdUsePromise("signalingCreate",{avSignalTag:{type:a,channelName:y,ext:T}}).then(function(v){var g=v.avSignalTag;return i.resolve(g)}).catch(function(v){return i.reject(m.parseAvSignalError(v))})},u.signalingDelay=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return p.verifyOptions(h,"channelId","api::signalling"),this.sendCmdUsePromise("signalingDelay",{avSignalTag:h}).then(function(a){var y=a.avSignalTag;return i.resolve(y)}).catch(function(a){return i.reject(m.parseAvSignalError(a))})},u.signalingClose=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.offlineEnabled;return p.verifyOptions(h,"channelId","api::signalling"),this.sendCmdUsePromise("signalingClose",{avSignalTag:p.merge(h,{isSave:a===!0?1:0})}).then(function(y){var T=y.avSignalTag;return T.offlineEnabled=T.isSave===1,delete T.isSave,i.resolve(T)}).catch(function(y){return i.reject(m.parseAvSignalError(y))})},u.signalingJoin=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.offlineEnabled;return p.verifyOptions(h,"channelId","api::signalling"),this.sendCmdUsePromise("signalingJoin",{avSignalTag:p.merge(h,{isSave:a===!0?1:0})}).then(function(y){var T,v=y.avSignalTag,g=v.members;return typeof v.members=="string"&&(g=s(T=JSON.parse(v.members)).call(T,function(b){return m.parseAvSignalMember(b)})),v.members=g,i.resolve(v)}).catch(function(y){return i.reject(m.parseAvSignalError(y))})},u.signalingLeave=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.offlineEnabled;return p.verifyOptions(h,"channelId","api::signalling"),this.sendCmdUsePromise("signalingLeave",{avSignalTag:p.merge(h,{isSave:a===!0?1:0})}).then(function(y){var T=y.avSignalTag;return T.offlineEnabled=T.isSave===1,delete T.isSave,i.resolve(T)}).catch(function(y){return i.reject(m.parseAvSignalError(y))})},u.signalingGetChannelInfo=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.channelName;return p.verifyOptions(h,"channelName","api::signalling"),this.sendCmdUsePromise("signalingGetChannelInfo",{avSignalTag:{channelName:a}}).then(function(y){var T,v=y.avSignalTag,g=v.members;return typeof v.members=="string"&&(g=s(T=JSON.parse(v.members)).call(T,function(b){return m.parseAvSignalMember(b)})),v.members=g,i.resolve(v)}).catch(function(y){return i.reject(m.parseAvSignalError(y))})},u.signalingInvite=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.account,y=h.offlineEnabled,T=h.pushInfo,v=T===void 0?{}:T;p.verifyOptions(h,"channelId requestId account","api::signalling"),r(v.pushPayload)==="object"&&(v.pushPayload=n(v.pushPayload));var g=p.merge(h,v,{to:a,isSave:y===!0?1:0,needPush:v.needPush===!0?1:0,needBadge:v.needBadge===!1?0:1});return this.sendCmdUsePromise("signalingInvite",{avSignalTag:g}).then(function(b){var S=b.avSignalTag;return S.offlineEnabled=S.isSave===1,S.needBadge=S.needBadge===1,S.needPush=S.needPush===1,delete S.isSave,i.resolve(S)}).catch(function(b){return i.reject(m.parseAvSignalError(b))})},u.signalingCancel=function(h){var a=h.account,y=h.offlineEnabled;return p.verifyOptions(h,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingCancel",{avSignalTag:p.merge(h,{to:a,isSave:y===!0?1:0})}).then(function(T){var v=T.avSignalTag;return v.offlineEnabled=v.isSave===1,delete v.isSave,i.resolve(v)}).catch(function(T){return i.reject(m.parseAvSignalError(T))})},u.signalingCreateAndJoin=function(h){var a=this,y=c({instance:this,className:"ApiBaseFn",funcName:"signalingCreateAndJoin",hasCallback:!0}),T=h.channelName,v=h.uid,g=v===void 0?0:v,b=h.offlineEnabled,S=b===void 0||b,O=h.attachExt,I=O===void 0?"":O;return this.signalingCreate(h).catch(function(R){return R.code===10405?(a.logger.warn("api::avSignal:signalingCall room already exists:",R),a.signalingGetChannelInfo({channelName:T})):i.reject(R)}).then(function(R){var N={channelId:R.channelId,offlineEnabled:S,attachExt:I,nertcChannelName:h.nertcChannelName,nertcTokenTtl:h.nertcTokenTtl,nertcJoinRoomQueryParamMap:h.nertcJoinRoomQueryParamMap};return g&&p.merge(N,{uid:g}),a.signalingJoin(N)}).then(function(R){return typeof y=="function"&&y(void 0),R}).catch(function(R){throw typeof y=="function"&&y(R),R})},u.signalingCall=function(h){var a=this,y=c({instance:this,className:"ApiBaseFn",funcName:"signalingCall",hasCallback:!0}),T=h.account,v=h.offlineEnabled,g=h.requestId;p.verifyOptions(h,"type requestId account","api::signalling");var b="";return this.signalingCreateAndJoin(h).then(function(S){b=S.channelId||b,a.logger.info("api::avSignal:signalingCall join:",b);var O={channelId:b,account:T,requestId:g,offlineEnabled:v,attachExt:h.attachExt||"",pushInfo:h.pushInfo||{},nertcTokenTtl:S.nertcTokenTtl,nertcToken:S.nertcToken};return a.signalingInvite(O)}).then(function(S){return typeof y=="function"&&y(void 0),S}).catch(function(S){throw typeof y=="function"&&y(S),S})},u.signalingReject=function(h){var a=h.account,y=h.offlineEnabled;return p.verifyOptions(h,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingReject",{avSignalTag:p.merge(h,{to:a,isSave:y===!0?1:0})}).then(function(T){var v=T.avSignalTag;return v.offlineEnabled=v.isSave===1,delete v.isSave,i.resolve(v)}).catch(function(T){return i.reject(m.parseAvSignalError(T))})},u.signalingAccept=function(h){var a=this,y=h.account,T=h.offlineEnabled;return p.verifyOptions(h,"channelId requestId account","api::signalling"),this.sendCmdUsePromise("signalingAccept",{avSignalTag:p.merge(h,{to:y,isSave:T===!0?1:0})}).then(function(v){var g=v.avSignalTag;return g.offlineEnabled=g.isSave===1,delete g.isSave,i.resolve(g)}).catch(function(v){return i.reject(m.parseAvSignalError(v))}).then(function(v){if(h.autoJoin){var g={channelId:h.channelId,offlineEnabled:h.offlineEnabled,attachExt:h.joinAttachExt,uid:h.uid,nertcChannelName:h.nertcChannelName,nertcTokenTtl:h.nertcTokenTtl,nertcJoinRoomQueryParamMap:h.nertcJoinRoomQueryParamMap};return a.signalingJoin(g)}return v})},u.signalingControl=function(h){var a=h.account;return p.verifyOptions(h,"channelId","api::signalling"),this.sendCmdUsePromise("signalingControl",{avSignalTag:p.merge(h,a?{to:a}:{})}).then(function(y){var T=y.avSignalTag;return i.resolve(T)}).catch(function(y){return i.reject(m.parseAvSignalError(y))})},u.signalingSync=function(){return this.sendCmdUsePromise("sync",{sync:{avSignal:0}}).then(function(h){var a=h.avSignalTag;return i.resolve(a)}).catch(function(h){return i.reject(m.parseAvSignalError(h))})},u.signalingMarkMsgRead=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};c({instance:this,className:"ApiBaseFn",funcName:"signalingMarkMsgRead",hasCallback:!1}),p.verifyOptions(h,"msgid","api::signalling");var a,y=d.idMap.avSignal;return a=typeof h.msgid=="string"?[h.msgid]:h.msgid,this.sendCmd("batchMarkRead",{sid:y.id,cid:y.signalingNotify,ids:a})},u.signalingCallEx=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.account,y=h.offlineEnabled,T=h.pushInfo,v=T===void 0?{}:T;r(v.pushPayload)==="object"&&(v.pushPayload=n(v.pushPayload)),p.verifyOptions(h,"type","api::signalling"),p.verifyOptions(h,"account","api::signalling");var g=p.merge(h,v,{to:a,isSave:y===!0?1:0,needPush:v.needPush===!0?1:0,needBadge:v.needBadge===!1?0:1});return this.sendCmdUsePromise("signalingCallEx",{avSignalTag:g}).then(function(b){var S,O=b.avSignalTag,I=O.members;return typeof O.members=="string"&&(I=s(S=JSON.parse(O.members)).call(S,function(R){return m.parseAvSignalMember(R)})),O.members=I,i.resolve(O)}).catch(function(b){return i.reject(m.parseAvSignalError(b))})},u.signalingJoinAndAccept=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=h.channelId,y=h.attachExt,T=h.offlineEnabled,v=h.uid,g=h.account,b=h.requestId,S=h.nertcChannelName,O=h.nertcTokenTtl,I=h.nertcJoinRoomQueryParamMap;return p.verifyOptions(h,"channelId","api::signalling"),p.verifyOptions(h,"account","api::signalling"),p.verifyOptions(h,"requestId","api::signalling"),this.sendCmdUsePromise("signalingJoinAndAccept",{avSignalTag:{channelId:a,attachExt:y,isSave:T===!0?1:0,uid:v,to:g,requestId:b,nertcChannelName:S,nertcTokenTtl:O,nertcJoinRoomQueryParamMap:I}}).then(function(R){var N,F=R.avSignalTag,P=F.members;return typeof F.members=="string"&&(P=s(N=JSON.parse(F.members)).call(N,function(x){return m.parseAvSignalMember(x)})),F.members=P,i.resolve(F)}).catch(function(R){return i.reject(m.parseAvSignalError(R))})}},function(o,k,e){var r=e(2),i=e(121),s=e(122),n=e(54).getPromiseWithAbort,u=function(){function p(){i(this,p),this.abortFns=[]}return s(p,[{key:"add",value:function(d){var m=n(d);return this.abortFns.push(m.abort),m.promise}},{key:"clear",value:function(){var d;r(d=this.abortFns).call(d,function(m){return m("Request aborted")}),this.abortFns=[]}},{key:"destroy",value:function(){this.clear()}}]),p}();o.exports=u},function(o,k,e){var r=e(102),i=e(103),s=e(2),n=e(68),u=e(3),p=e(8),d=e(56),m=e(15),c=e(7),h=e(10),a=e(25),y=e(121),T=e(122),v=e(0),g=e(13),b=e(74),S=e(288),O=e(40);o.exports=function(){function I(N){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{socketConcurrent:1};y(this,I),this.clientProto=N,this.logger=N.logger,this.urls=[],this.sockets=[],this.config=F}var R;return T(I,[{key:"setConfig",value:function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{socketConcurrent:1};this.config=N}},{key:"setUrls",value:function(N){this.urls=N}},{key:"resetSockets",value:function(){var N;s(N=this.sockets).call(N,function(F){F&&(F.removeAllListenersX("info"),F.disconnect())}),this.sockets=[]}},{key:"connect",value:(R=i(r.mark(function N(){var F,P,x,L=this;return r.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(this.clientProto.statusProtector.emit("auth/loginLifeCycleConnect"),(P=n(F=this.urls).call(F,0,this.config.socketConcurrent)).length!==0){_.next=4;break}throw new O("no_socket_url",408,{});case 4:return _.prev=4,_.next=7,u.any(p(P).call(P,function(C,A){return L.doConnect(C,A)}));case 7:return _.abrupt("return",_.sent);case 10:throw _.prev=10,_.t0=_.catch(4),s(x=_.t0.errors).call(x,function(C,A){L.logger.warn("imsocket::connect failed ".concat(A),C)}),_.t0;case 14:case"end":return _.stop()}},N,this,[[4,10]])})),function(){return R.apply(this,arguments)})},{key:"success",value:function(N){var F;return s(F=this.sockets).call(F,function(P,x){N!==x&&P&&(P.removeAllListenersX("info"),P.disconnect())}),this.sockets[N]}},{key:"failed",value:function(N){var F=this.sockets[N];F&&(F.removeAllListenersX("info"),F.disconnect())}},{key:"getTransport",value:function(N){var F=v.getGlobal();if(typeof window>"u"){var P=N.split(":");return F&&!F.location&&P.length>1&&(F.location={protocol:P.shift(),port:P.pop(),hostname:P.join("")}),["websocket"]}return this.clientProto.options.transports?this.clientProto.options.transports:b.name!=="IE"||F.WebSocket?["websocket"]:["xhr-polling"]}},{key:"doConnect",value:function(N,F){var P=this;if(this.clientProto&&this.clientProto.__destroyed===!0)return u.reject("instance has been destroyed");var x=this.getTransport(N),L=d();return new u(function(_,C){var A,M,U,E;try{E=S.connect(N,{transports:m(x).call(x),reconnect:!1,"force new connection":!0,"connect timeout":g.connectTimeout,needToXHR:typeof P.clientProto.options.needToXHR=="boolean"?P.clientProto.options.needToXHR:g.needToXHR}),P.sockets[F]=E}catch($){var z;return P.logger.warn(c(z="link::connectToUrl ".concat(F,":io.connect caught exception: ")).call(z,$&&$.message),$),void C(new O("socket_error",408,{startTime:L,url:N,reason:$.message,rawError:$}))}P.logger.info(c(A=c(M="link::connectToUrl ".concat(F,": socket url: ")).call(M,N,", transports: ")).call(A,h(x))),E.on("connect",function(){P.logger.info("link::connectToUrl ".concat(F," success")),P.success(F),P.clientProto.url=N,_(E)}),E.on("handshake_failed",function(){P.failed(F),C(new O("handshake_failed",408,{startTime:L,url:N}))}),E.on("connect_failed",function($){P.failed(F),C(new O("connect_failed",408,{startTime:L,url:N,reason:$}))}),E.on("error",function(){var $,X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",Y=arguments.length>1?arguments[1]:void 0,W=Y&&Y.message||X;P.logger.warn(c($="link::onSocketError ".concat(F,": reason is ")).call($,W,", error is "),Y),C(new O("socket_error",408,{startTime:L,url:N,reason:W,rawError:Y}))}),E.on("info",function($,X){var Y,W;X?P.logger.info(c(Y="link::onSocketInfo ".concat(F,": ")).call(Y,$,", extraInfo:"),X):P.logger.info(c(W="link::onSocketInfo ".concat(F,": ")).call(W,$,"."))}),E.on("message",a(U=P.clientProto.onMessage).call(U,P.clientProto)),E.on("disconnect",function($){P.logger.warn("link::onSocketDisconnect: socket url: ".concat(N,", disconnected"),$),P.clientProto.hasLogin=!1,P.clientProto.doLogout?P.clientProto.logout():P.clientProto.onDisconnect("link::socketDisconnect"),P.clientProto.statusProtector.emit("auth/loginLifeCycleDisconnected",new Error("disconnect due to internal reasons"))})})}},{key:"destroy",value:function(){this.urls=[],this.resetSockets()}}]),I}()},function(o,k,e){var r=e(26).default,i=e(137),s=e(153),n=e(187),u=e(282),p=e(644),d=e(189),m=e(287),c=e(655),h=e(308);function a(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o.exports=a=function(){return y},o.exports.__esModule=!0,o.exports.default=o.exports;var y={},T=Object.prototype,v=T.hasOwnProperty,g=i||function(J,V,D){J[V]=D.value},b=typeof s=="function"?s:{},S=b.iterator||"@@iterator",O=b.asyncIterator||"@@asyncIterator",I=b.toStringTag||"@@toStringTag";function R(J,V,D){return i(J,V,{value:D,enumerable:!0,configurable:!0,writable:!0}),J[V]}try{R({},"")}catch{R=function(V,D,Q){return V[D]=Q}}function N(J,V,D,Q){var G=V&&V.prototype instanceof x?V:x,B=n(G.prototype),q=new W(Q||[]);return g(B,"_invoke",{value:z(J,D,q)}),B}function F(J,V,D){try{return{type:"normal",arg:J.call(V,D)}}catch(Q){return{type:"throw",arg:Q}}}y.wrap=N;var P={};function x(){}function L(){}function _(){}var C={};R(C,S,function(){return this});var A=u&&u(u(ee([])));A&&A!==T&&v.call(A,S)&&(C=A);var M=_.prototype=x.prototype=n(C);function U(J){var V;p(V=["next","throw","return"]).call(V,function(D){R(J,D,function(Q){return this._invoke(D,Q)})})}function E(J,V){var D;g(this,"_invoke",{value:function(Q,G){function B(){return new V(function(q,H){(function K(Z,te,ne,re){var se=F(J[Z],J,te);if(se.type!=="throw"){var oe=se.arg,ae=oe.value;return ae&&r(ae)=="object"&&v.call(ae,"__await")?V.resolve(ae.__await).then(function(pe){K("next",pe,ne,re)},function(pe){K("throw",pe,ne,re)}):V.resolve(ae).then(function(pe){oe.value=pe,ne(oe)},function(pe){return K("throw",pe,ne,re)})}re(se.arg)})(Q,G,q,H)})}return D=D?D.then(B,B):B()}})}function z(J,V,D){var Q="suspendedStart";return function(G,B){if(Q==="executing")throw new Error("Generator is already running");if(Q==="completed"){if(G==="throw")throw B;return w()}for(D.method=G,D.arg=B;;){var q=D.delegate;if(q){var H=$(q,D);if(H){if(H===P)continue;return H}}if(D.method==="next")D.sent=D._sent=D.arg;else if(D.method==="throw"){if(Q==="suspendedStart")throw Q="completed",D.arg;D.dispatchException(D.arg)}else D.method==="return"&&D.abrupt("return",D.arg);Q="executing";var K=F(J,V,D);if(K.type==="normal"){if(Q=D.done?"completed":"suspendedYield",K.arg===P)continue;return{value:K.arg,done:D.done}}K.type==="throw"&&(Q="completed",D.method="throw",D.arg=K.arg)}}}function $(J,V){var D=V.method,Q=J.iterator[D];if(Q===void 0)return V.delegate=null,D==="throw"&&J.iterator.return&&(V.method="return",V.arg=void 0,$(J,V),V.method==="throw")||D!=="return"&&(V.method="throw",V.arg=new TypeError("The iterator does not provide a '"+D+"' method")),P;var G=F(Q,J.iterator,V.arg);if(G.type==="throw")return V.method="throw",V.arg=G.arg,V.delegate=null,P;var B=G.arg;return B?B.done?(V[J.resultName]=B.value,V.next=J.nextLoc,V.method!=="return"&&(V.method="next",V.arg=void 0),V.delegate=null,P):B:(V.method="throw",V.arg=new TypeError("iterator result is not an object"),V.delegate=null,P)}function X(J){var V={tryLoc:J[0]};1 in J&&(V.catchLoc=J[1]),2 in J&&(V.finallyLoc=J[2],V.afterLoc=J[3]),this.tryEntries.push(V)}function Y(J){var V=J.completion||{};V.type="normal",delete V.arg,J.completion=V}function W(J){this.tryEntries=[{tryLoc:"root"}],p(J).call(J,X,this),this.reset(!0)}function ee(J){if(J){var V=J[S];if(V)return V.call(J);if(typeof J.next=="function")return J;if(!isNaN(J.length)){var D=-1,Q=function G(){for(;++D<J.length;)if(v.call(J,D))return G.value=J[D],G.done=!1,G;return G.value=void 0,G.done=!0,G};return Q.next=Q}}return{next:w}}function w(){return{value:void 0,done:!0}}return L.prototype=_,g(M,"constructor",{value:_,configurable:!0}),g(_,"constructor",{value:L,configurable:!0}),L.displayName=R(_,I,"GeneratorFunction"),y.isGeneratorFunction=function(J){var V=typeof J=="function"&&J.constructor;return!!V&&(V===L||(V.displayName||V.name)==="GeneratorFunction")},y.mark=function(J){return d?d(J,_):(J.__proto__=_,R(J,I,"GeneratorFunction")),J.prototype=n(M),J},y.awrap=function(J){return{__await:J}},U(E.prototype),R(E.prototype,O,function(){return this}),y.AsyncIterator=E,y.async=function(J,V,D,Q,G){G===void 0&&(G=m);var B=new E(N(J,V,D,Q),G);return y.isGeneratorFunction(V)?B:B.next().then(function(q){return q.done?q.value:B.next()})},U(M),R(M,I,"Generator"),R(M,S,function(){return this}),R(M,"toString",function(){return"[object Generator]"}),y.keys=function(J){var V=Object(J),D=[];for(var Q in V)D.push(Q);return c(D).call(D),function G(){for(;D.length;){var B=D.pop();if(B in V)return G.value=B,G.done=!1,G}return G.done=!0,G}},y.values=ee,W.prototype={constructor:W,reset:function(J){var V;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,p(V=this.tryEntries).call(V,Y),!J)for(var D in this)D.charAt(0)==="t"&&v.call(this,D)&&!isNaN(+h(D).call(D,1))&&(this[D]=void 0)},stop:function(){this.done=!0;var J=this.tryEntries[0].completion;if(J.type==="throw")throw J.arg;return this.rval},dispatchException:function(J){if(this.done)throw J;var V=this;function D(K,Z){return B.type="throw",B.arg=J,V.next=K,Z&&(V.method="next",V.arg=void 0),!!Z}for(var Q=this.tryEntries.length-1;Q>=0;--Q){var G=this.tryEntries[Q],B=G.completion;if(G.tryLoc==="root")return D("end");if(G.tryLoc<=this.prev){var q=v.call(G,"catchLoc"),H=v.call(G,"finallyLoc");if(q&&H){if(this.prev<G.catchLoc)return D(G.catchLoc,!0);if(this.prev<G.finallyLoc)return D(G.finallyLoc)}else if(q){if(this.prev<G.catchLoc)return D(G.catchLoc,!0)}else{if(!H)throw new Error("try statement without catch or finally");if(this.prev<G.finallyLoc)return D(G.finallyLoc)}}}},abrupt:function(J,V){for(var D=this.tryEntries.length-1;D>=0;--D){var Q=this.tryEntries[D];if(Q.tryLoc<=this.prev&&v.call(Q,"finallyLoc")&&this.prev<Q.finallyLoc){var G=Q;break}}G&&(J==="break"||J==="continue")&&G.tryLoc<=V&&V<=G.finallyLoc&&(G=null);var B=G?G.completion:{};return B.type=J,B.arg=V,G?(this.method="next",this.next=G.finallyLoc,P):this.complete(B)},complete:function(J,V){if(J.type==="throw")throw J.arg;return J.type==="break"||J.type==="continue"?this.next=J.arg:J.type==="return"?(this.rval=this.arg=J.arg,this.method="return",this.next="end"):J.type==="normal"&&V&&(this.next=V),P},finish:function(J){for(var V=this.tryEntries.length-1;V>=0;--V){var D=this.tryEntries[V];if(D.finallyLoc===J)return this.complete(D.completion,D.afterLoc),Y(D),P}},catch:function(J){for(var V=this.tryEntries.length-1;V>=0;--V){var D=this.tryEntries[V];if(D.tryLoc===J){var Q=D.completion;if(Q.type==="throw"){var G=Q.arg;Y(D)}return G}}throw new Error("illegal catch attempt")},delegateYield:function(J,V,D){return this.delegate={iterator:ee(J),resultName:V,nextLoc:D},this.method==="next"&&(this.arg=void 0),P}},y}o.exports=a,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(645)},function(o,k,e){o.exports=e(646)},function(o,k,e){var r=e(647);o.exports=r},function(o,k,e){var r=e(229);o.exports=r},function(o,k,e){o.exports=e(649)},function(o,k,e){var r=e(650);e(651),e(652),e(653),e(654),o.exports=r},function(o,k,e){var r=e(231);o.exports=r},function(o,k,e){e(232)},function(o,k,e){e(246)},function(o,k,e){var r=e(1),i=e(67),s=e(100);r({target:"Promise",stat:!0,forced:!0},{try:function(n){var u=i.f(this),p=s(n);return(p.error?u.reject:u.resolve)(p.value),u.promise}})},function(o,k,e){e(247)},function(o,k,e){o.exports=e(656)},function(o,k,e){o.exports=e(657)},function(o,k,e){var r=e(658);o.exports=r},function(o,k,e){var r=e(275);o.exports=r},function(o,k,e){o.exports=e(660)},function(o,k,e){var r=e(661);o.exports=r},function(o,k,e){var r=e(250);o.exports=r},function(o,k,e){var r=e(102),i=e(103),s=e(2),n=e(7),u=e(15),p=e(68),d=e(23),m=e(3),c=e(25),h=e(75).fn,a=e(40),y=e(663),T=e(13),v=e(0),g=e(664);function b(){this.logger.log("offlineListener enter"),this.forceDisconnect(),this.statusProtector.emit("auth/loginLifeCycleDisconnected",new Error("disconnect due to network offline")),this.options.ondisconnect&&this.options.ondisconnect({code:"offlineListener",callFunc:"link::offlineListener",message:"offlineListener disconnect"}),this.onDisconnect("link::offlineListener","broken")}function S(){var O=this;this.logger.log("onlineListener start"),this&&this.isConnected()&&!this.connecting?(this.stopHeartbeat(),this.sendCmd("heartbeat",null,function(I){if(I){O.logger.info("onlineListener heartbeat detect error",I);try{O.forceDisconnect(),O.onDisconnect("link::onHeartbeat","broken")}catch(R){O.logger.info("onlineListener heartbeat websocket.onclose",R)}}else O.logger.log("onlineListener heartbeat detect success")})):this.logger.log("onlineListener disconnected or connecting",this&&this.isConnected(),this.connecting)}h.initConnect=function(){this.socket=null,this.retryCount=0,this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.doLogout=!1},h.resetConnect=function(){var O=this.options;v.notundef(O.needReconnect)?(v.verifyParamType("needReconnect",O.needReconnect,"boolean","link::resetConnect"),this.needReconnect=O.needReconnect):this.needReconnect=!0,this.logger.info("link::resetConnect: needReconnect ".concat(this.needReconnect)),v.notundef(O.reconnectionAttempts)&&v.verifyParamType("reconnectionAttempts",O.reconnectionAttempts,"number","link::resetConnect"),v.notundef(O.noCacheLinkUrl)&&v.verifyParamType("noCacheLinkUrl",O.noCacheLinkUrl,"boolean","link::resetConnect"),this.reconnectionAttempts=typeof O.reconnectionAttempts=="number"?O.reconnectionAttempts:1/0,this.backoff=new y({min:T.reconnectionDelay,max:T.reconnectionDelayMax,jitter:T.reconnectionJitter})},h.reportTCPException=function(O){var I=this;s(O).call(O,function(R,N){var F,P=R.event,x=P===void 0?{}:P,L=R.message,_=x.startTime,C=x.code,A=x.reason,M=x.url,U="";L==="handshake_failed"?U="handshake_failed":L==="connect_failed"?U=A?"connect_failed:".concat(A):"connect_failed":L==="socket_error"&&(U=A?"socket.io error:".concat(A):"socket.io error"),I.logger.warn(n(F="connect::failed ".concat(N,", ")).call(F,U),R),I.reporter.reportTraceStart("exceptions",{user_id:I.options.account,trace_id:v.get(self,"socket.socket.sessionid"),start_time:_,action:0,exception_service:6}),I.reporter.reportTraceUpdateV2("exceptions",{code:C,description:L,operation_type:0,target:M}),I.reporter.reportTraceEnd("exceptions",1)})},h.connect=i(r.mark(function O(){var I,R,N,F,P;return r.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(N=this,clearTimeout(N.connectTimer),!N.isConnected()){x.next=5;break}return N.logger.warn("link::connect: already connected"),x.abrupt("return");case 5:if(!N.connecting){x.next=8;break}return N.logger.warn("link::connect: already connecting"),x.abrupt("return");case 8:if(N.connecting=!0,N.hasNotifyDisconnected=!1,N.shouldReconnect=!0,N.socket&&N.forceDisconnect(),N.logger.info("link::connect: connect to new socket, autoconnect is "+N.autoconnect),typeof N.options.socketUrl=="string"&&(N.logger.info("link::connect: try to options.socketUrl ",N.options.socketUrl),N.socketUrls=[N.options.socketUrl]),x.prev=14,N.socketUrls&&N.socketUrls.length>0){x.next=20;break}return x.next=18,N.refreshSocketUrl();case 18:N.socketUrls=g(N.socketUrls),N.logger.info("link::connect: refreshSocketUrl success, socketConcurrent ".concat(N.imsocket.config.socketConcurrent),N.socketUrls);case 20:x.next=28;break;case 22:return x.prev=22,x.t0=x.catch(14),N.logger.warn("connect::refreshSocketUrl: catch exception,",x.t0&&x.t0.message),N.connecting=!1,this.options.ondisconnect({code:"initConnectFail",callFunc:"ProtocolFn.connect",message:"refresh socket url fail"}),x.abrupt("return");case 28:return N.imsocket.resetSockets(),N.imsocket.setUrls(u(I=N.socketUrls).call(I,0)),p(R=N.socketUrls).call(R,0,N.imsocket.config.socketConcurrent),x.prev=31,x.next=34,N.imsocket.connect();case 34:N.socket=x.sent,N.onConnect(),x.next=46;break;case 38:x.prev=38,x.t1=x.catch(31),P="",x.t1.errors&&(N.reportTCPException(x.t1.errors),F=x.t1.errors[0]),F.message==="handshake_failed"?(N.onHandshakeFailed(F.event.startTime,F.event.url),P="link::onHandshakeFailed"):F.message==="connect_failed"?(N.onConnectFailed(F.event.reason,F.event.startTime,F.event.url),P="link::onConnectFailed"):F.message==="socket_error"?(N.onSocketError(F.event.reason,F.event.startTime,F.event.url),P="link::onSocketError"):(P="link::otherFailed",N.logger.warn("link::otherFailed",F)),this.statusProtector.emit("auth/loginLifeCycleConnectFail",new Error("".concat(P," 408"))),N.connecting=!1,N.willReconnect()?N.onDisconnect(P):this.options.ondisconnect({code:"initConnectFail",callFunc:"ProtocolFn.connect",message:"init connect fail"});case 46:case"end":return x.stop()}},O,this,[[14,22],[31,38]])})),h.isConnected=function(){return!!this.socket&&!!this.socket.socket&&this.socket.socket.connected},h.disconnect=function(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(){},I=this;function R(N){clearTimeout(I.disconnectCallbackTimer),I.msgAckBufferManager&&I.msgAckBufferManager.clear(),I.statusProtector.emit("auth/loginLifeCycleDisconnected",new Error("disconnect due to active action")),I.statusProtector.emit("auth/loginLifeCycleLogout"),d(function(){O(N)},0)}clearTimeout(I.connectTimer),I.disconnectCallbackTimer=d(function(){O.call(I,"mark disconnected due to timeout")},1e4),I.mixStorePolicy=null,I.appGrayConfig=null,I.resetReconnectStatus(),clearTimeout(I.mixStorePolicyClock),this.onlineListener&&typeof window<"u"&&v.isFunction(window.removeEventListener)&&(window.removeEventListener("online",this.onlineListener),window.removeEventListener("offline",this.offlineListener),this.onlineListener=null,this.offlineListener=null),I.isConnected()?(I.logger.warn("link::disconnect: start disconnecting"),I.logout()):I.connecting?(I.logger.warn("link::disconnect: abort connecting"),I.disconnectSocket()):(I.logger.warn("link::disconnect: already disconnected"),I.connecting=!1,I.shouldReconnect=!1,I.socket=null,I.autoconnect=!1,I.options.ondisconnect({code:"alreadyDisconnected",callFunc:"link::disconnect",message:"manually disconnect status"})),I.socket&&I.socket.socket&&I.socket.socket.transport?I.socket.socket.transport.onDisconnectDone=function(N){I.logger.warn("link::disconnect: invoke [done] when socket closed",N),R(N)}:(I.logger.warn("link::disconnect: invoke [done]"),R(null))},h.resetReconnectStatus=function(){this.backoff&&(this.backoff.setMin(T.reconnectionDelay),this.backoff.setMax(T.reconnectionDelayMax),this.backoff.reset()),this.retryCount=0,this.autoconnect=!0,this.logger.info("link::resetReconnectStatus: reset retryCount and backoff")},h.onConnect=function(){this.connecting=!1,this.shouldReconnect=!0,this.hasNotifyDisconnected=!1,this.logger.info("link::onConnect success"),this.statusProtector.emit("auth/loginLifeCycleConnectSucc"),this.login()},h.onDisconnect=function(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,I=arguments.length>1?arguments[1]:void 0,R=this;this.logger.warn("socket::onDisconnect: "+O),R.connecting=!1,R.markAllCallbackInvalid(a.newNetworkError({callFunc:O,uploadCode:415,disconnectReason:I})),R.msgAckBufferManager&&R.msgAckBufferManager.clear(),R.stopHeartbeat(),R.reconnect()},h.willReconnect=function(){return this.shouldReconnect&&this.needReconnect&&this.retryCount<this.reconnectionAttempts},h.reconnect=function(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.__destroyed)if(this.willReconnect()){if(this.socket&&(this.logger.info("link::reconnect: try to force disconnect"),this.forceDisconnect()),this.socketUrls.length===0&&!this.options.socketUrl&&typeof O.allFailedCB=="function")return this.logger.log("reconnect: All socket links have been polled, trigger hooks"),void O.allFailedCB();this.doReconnect()}else this.notifyDisconnect({code:"allAttemptsFailed",message:"All attempts failed"})},h.doReconnect=function(){var O,I=this;I.socket=null,I.retryCount++,I.hasLogin=!1;var R,N=I.backoff.duration();I.logger.info(n(O="link::reconnect: will retry after ".concat(N,"ms, retryCount ")).call(O,I.retryCount)),R=I.options.onwillreconnect({retryCount:I.retryCount,duration:N}),I.statusProtector.emit("auth/loginLifeCycleWaiting"),clearTimeout(I.connectTimer),I.connectTimer=d(function(){+I.options.authType==1&&R instanceof m?(I.logger.info("link::reconnect: wait onwillreconnect promise"),R.finally(function(){return I.connect()})):I.connect()},N)},h.notifyConnectError=function(O){var I=a.newConnectError({message:O,callFunc:"link::notifyConnectError"});this.logger.error("link::notifyConnectError:",I),this.options.onerror(I)},h.notifyDisconnect=function(O){this.hasNotifyDisconnected?this.logger.warn("notifyDisconnect:: already notified"):(this.hasNotifyDisconnected=!0,this.disconnectSocket(),this.forceDisconnect(),(O=O||new a).retryCount=this.retryCount,O.willReconnect=this.willReconnect(),this.backoff&&this.backoff.reset(),this.retryCount=0,this.autoconnect=!1,this.logger.info("link::notifyDisconnect: ondisconnected",O),this.options.ondisconnect(O),this.onWbNotifyHangup instanceof Function&&this.onWbNotifyHangup({content:{account:this.account,channelId:null,timetag:+Date()}}))},h.disconnectSocket=function(){if(this.isConnected()||this.connecting){this.connecting=!1,this.shouldReconnect=!1;try{this.socket&&this.socket.disconnect()}catch(O){this.socket&&typeof this.socket.removeAllListenersX=="function"&&this.socket.removeAllListenersX("info"),this.logger.info("link::disconnectSocket: disconnect failed, error ",O&&O.message)}}},h.initOnlineListener=function(){this.needReconnect&&this.options&&this.options.quickReconnect?typeof window<"u"&&v.isFunction(window.addEventListener)?this.onlineListener||(this.onlineListener=c(S).call(S,this),this.offlineListener=c(b).call(b,this),this.logger.info("initOnlineListener success"),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener no window.addEventListener"):this.logger.warn("initOnlineListener no quickReconnect")},h.forceDisconnect=function(){var O=this.socket||{};this.socket=null;try{typeof O.removeAllListenersX=="function"&&O.removeAllListenersX("info"),typeof O.disconnect=="function"&&O.disconnect()}catch(I){this.logger.error("forceDisconnect:: oldSocket error",I||I.message)}this.hasLogin=!1}},function(o,k){function e(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}o.exports=e,e.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),s=Math.floor(i*this.jitter*r);r=1&Math.floor(10*i)?r+s:r-s}return 0|Math.min(r,this.max)},e.prototype.reset=function(){this.attempts=0},e.prototype.setMin=function(r){this.ms=r},e.prototype.setMax=function(r){this.max=r},e.prototype.setJitter=function(r){this.jitter=r}},function(o,k,e){var r=e(665);o.exports=function(i){return i&&i.length?r(i):[]}},function(o,k,e){var r=e(666),i=e(669),s=e(674),n=e(675),u=e(676),p=e(289);o.exports=function(d,m,c){var h=-1,a=i,y=d.length,T=!0,v=[],g=v;if(c)T=!1,a=s;else if(y>=200){var b=m?null:u(d);if(b)return p(b);T=!1,a=n,g=new r}else g=m?[]:v;e:for(;++h<y;){var S=d[h],O=m?m(S):S;if(S=c||S!==0?S:0,T&&O==O){for(var I=g.length;I--;)if(g[I]===O)continue e;m&&g.push(O),v.push(S)}else a(g,O,c)||(g!==v&&g.push(O),v.push(S))}return v}},function(o,k,e){var r=e(259),i=e(667),s=e(668);function n(u){var p=-1,d=u==null?0:u.length;for(this.__data__=new r;++p<d;)this.add(u[p])}n.prototype.add=n.prototype.push=i,n.prototype.has=s,o.exports=n},function(o,k){o.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(o,k){o.exports=function(e){return this.__data__.has(e)}},function(o,k,e){var r=e(670);o.exports=function(i,s){return!!(i!=null&&i.length)&&r(i,s,0)>-1}},function(o,k,e){var r=e(671),i=e(672),s=e(673);o.exports=function(n,u,p){return u==u?s(n,u,p):r(n,i,p)}},function(o,k){o.exports=function(e,r,i,s){for(var n=e.length,u=i+(s?1:-1);s?u--:++u<n;)if(r(e[u],u,e))return u;return-1}},function(o,k){o.exports=function(e){return e!=e}},function(o,k){o.exports=function(e,r,i){for(var s=i-1,n=e.length;++s<n;)if(e[s]===r)return s;return-1}},function(o,k){o.exports=function(e,r,i){for(var s=-1,n=e==null?0:e.length;++s<n;)if(i(r,e[s]))return!0;return!1}},function(o,k){o.exports=function(e,r){return e.has(r)}},function(o,k,e){var r=e(271),i=e(677),s=e(289),n=r&&1/s(new r([,-0]))[1]==1/0?function(u){return new r(u)}:i;o.exports=n},function(o,k){o.exports=function(){}},function(o,k,e){var r,i=e(75).fn,s=e(40),n=e(193),u=e(0),p=e(13),d=e(44),m=e(74),c=u.notundef;i.genSessionKey=(r={},function(){var h=this.name;return r[h]=r[h]||u.guid()}),i.afterLogin=u.emptyFunc,i.assembleIMLogin=function(){var h=this.options,a=h.account;this.sdkSession=this.genSessionKey();var y={appLogin:this.autoconnect?0:1,appKey:h.appKey,account:a,token:h.token,sdkVersion:p.info.sdkVersion,sdkHumanVersion:p.info.sdkHumanVersion,protocolVersion:p.info.protocolVersion,os:m.os.toString()==="[object Object]"?m.os.family:m.os.toString(),browser:m.name+" "+m.version,clientType:p.CLIENTTYPE||16,session:this.sdkSession,deviceId:d.deviceId,isReactNative:p.isRN?1:0,customTag:h.customTag||"",sdkType:0};return y.userAgent="Native/".concat(p.info.sdkHumanVersion),p.isBrowser?y.sdkType=0:p.isRN?y.sdkType=2:p.isWeixinApp&&(y.sdkType=6),h.customClientType&&(y.customClientType=+h.customClientType),h.authType&&(y.authType=+h.authType),h.loginExt&&(y.loginExt=h.loginExt),y},i.notifyLogin=function(h){this.logger.info("link::notifyLogin: on connect",h),this.options.onconnect(h)},i.logout=function(){if(this.doLogout)return this.doLogout=!1,void this.onAuthError(new s("done logout","logout",{disconnectReason:"close",uploadCode:415}),"link::logout");this.isConnected()&&this.onAuthError(new s("done disconnect","logout",{disconnectReason:"close",uploadCode:415}),"link::logout")},i.onKicked=function(h){var a=h.content,y=a.from,T=a.reason,v=a.custom,g=a.customClientType,b={reason:this.kickedReasons[T]||"unknown",message:this.kickedMessages[T]||"未知原因"};c(y)&&(b.from=n.reverseType(y)),c(v)&&(b.custom=v),+g>0&&(b.customClientType=g),this.logger.warn("link::onKicked:",b);var S=new s("被踢了","kicked",{disconnectReason:"kicked",uploadCode:415});u.merge(S,b),this.onAuthError(S,"link::onKicked"),this.statusProtector.emit("auth/loginLifeCycleDisconnected",new Error("disconnect due to kicked")),this.statusProtector.emit("auth/loginLifeCycleKicked",b)},i.onAuthError=function(h,a){var y=h&&h.code;if(this.logger.error("onAuthError ",a,y),/^(Error_Internet_Disconnected|Error_Timeout|Error_Connection_Socket_State_not_Match)$/.test(y))return this.forceDisconnect(),void this.onDisconnect("link::onAuthError::"+y,"broken");(h=h||s.newConnectionError({callFunc:a,uploadCode:415,disconnectReason:"close"})).callFunc=h.callFunc||a||null,this.shouldReconnect=!1,this.markAllCallbackInvalid(h),this.notifyDisconnect(h)}},function(o,k,e){var r=e(23),i=e(25),s=e(26),n=e(75).fn,u=e(13),p=e(0);n.processLink=function(d){switch(d.cmd){case"heartbeat":this.startHeartbeat();break;case"notifyDetect":s(p._get(d,"content.notifyDetectTag"))==="object"&&(d.content.notifyDetectTag.t3=new Date().getTime(),this.startDetect(d))}},n.startHeartbeat=function(){var d=this;d.stopHeartbeat(),d.heartbeatTimer=r(function(){var m;d.sendCmd("heartbeat",null,i(m=d.onHeartbeat).call(m,d))},u.heartbeatInterval)},n.startDetect=function(d){var m=d.content.notifyDetectTag;m.t4=new Date().getTime(),this.sendCmd("uploadDetect",{notifyDetectTag:m})},n.stopHeartbeat=function(){this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},n.onHeartbeat=function(d){if(d){if(this.syncing)return this.logger.warn("onHeartbeat::ignore error in connecting"),void this.startHeartbeat();var m;d.callFunc="link::onHeartbeat",this.onCustomError("heartbeat error",d),this.heartbeatFail++,this.logger.warn("onHeartbeat::error ",d.code,d),d.code==="Error_Timeout"&&(this.checkNetworkAvailable()!==!1?this.heartbeatFail>1?(this.forceDisconnect(),this.onDisconnect("link::onHeartbeat","broken")):this.sendCmd("heartbeat",null,i(m=this.onHeartbeat).call(m,this)):this.startHeartbeat())}else this.heartbeatFail=0},n.checkNetworkAvailable=typeof navigator<"u"&&typeof navigator.onLine=="boolean"?function(){return navigator.onLine}:function(){},n.heartbeat=function(){}},function(o,k,e){var r=e(3),i=e(6),s=e(23),n=e(52),u=e(75).fn,p=e(285),d=e(13),m=e(44);u.processMisc=function(c){switch(c.cmd){case"getSimpleNosToken":c.error||(c.obj=c.content.nosTokens[0]);break;case"getNosToken":c.error||(c.obj=c.content.nosToken);break;case"getGrayscaleConfig":c.error||(c.obj=c.content.appGrayConfigTag);break;case"getMixStorePolicy":c.error||(c.obj=c.content.mixStorePolicyTag);break;case"getMixStoreToken":c.error||(c.obj=c.content.mixStoreTokenTag);break;case"getBackSourceToken":c.error||(c.obj=c.content.backSourceTokenTag);break;case"uploadSdkLogUrl":c.error?this.logger.error("uploadSdkLogUrl::error",c.error):this.logger.info("uploadSdkLogUrl::success",c.obj&&c.obj.url);break;case"notifyUploadLog":c.error||(d.isRN?this.uploadLocalLogRN():d.isBrowser&&this.uploadLocalLogWeb(),this.emitAPI({type:"notifyUploadLog"}));break;case"audioToText":c.error||(c.obj.text=c.content.text);break;case"processImage":c.obj.imageOps=p.reverseImageOps(c.obj.imageOps),c.error||(c.obj={url:c.content.url});break;case"getNosTokenTrans":c.error||(c.obj={nosToken:c.content.nosToken,docId:c.content.docId});break;case"getNosOriginUrl":c.error||(c.obj=c.content.nosFileUrlTag.originUrl);break;case"notifyTransLog":c.error||this.emitAPI({type:"notifyTransLog",obj:c.content.transInfo});break;case"fetchFile":case"fetchFileList":case"removeFile":c.error||(c.obj=c.content);break;case"getServerTime":c.obj=c.content&&c.content.time;break;case"getNosCdnHost":this.getNosCdnHost(c)}},u.uploadLocalLogRN=function(){if(d.isRN&&m.rnfs){var c=m.rnfs,h=this,a=c.nimIndex,y=(c.nimIndex+1)%2;c.nimPromise=c.nimPromise.then(function(){return r.all([c.exists(T(a)),c.exists(T(y))])}).then(function(v){return v&&(v[0]||v[1])?v[0]&&v[1]?c.copyFile(T(y),T(2)).then(function(){return c.readFile(T(a))}).then(function(g){return c.appendFile(T(2),g)}):v[0]?c.copyFile(T(a),T(2)):void(v[1]&&c.copyFile(T(y),T(2))):r.reject()}).then(function(){return new r(function(v){h.api.previewFile({filePath:T(2),done:function(g,b){if(r.all([c.unlink(T(2)),c.unlink(T(1)),c.unlink(T(0))]).finally(function(){v()}),g)h.logger.error("nim::uploadLocalLogRN:previewFile:error",g);else{var S=b.url;i(S).call(S,"?")>0?S+="&":S+="?",S+="download="+new Date().getTime()+"_rn.log",h.api.uploadSdkLogUrl({url:S})}}})})}).catch(function(v){c.unlink(T(2)).catch(function(){}),h.logger.error("nim::protocol::uploadLocalLogRN",v)})}function T(v){return c.DocumentDirectoryPath+"/nimlog_"+v+".log"}},u.uploadLocalLogWeb=function(){var c=this;this.options.dbLog!==!1&&this.logger._local?this.logger._local.fetchLog().then(function(h){c.api.previewFile({blob:new Blob([h.logs],{type:"text/plain"}),done:function(a,y){if(a)c.logger.error("uploadLocalLogWeb::previewFile:error",a);else{c.logger.log("uploadLocalLogWeb::previewFile:success",y);var T=y.url;T+=(i(T).call(T,"?")>0?"&":"?")+"download="+new Date().getTime()+"_web.log",c.api.uploadSdkLogUrl({url:T}),c.logger._local.deleteLogs(h.time).then(function(){c.logger.log("uploadLocalLogWeb::deleteLogs success")}).catch(function(v){return c.logger.error("uploadLocalLogWeb::deleteLogs:error ,",v)})}}})}).catch(function(h){c.logger.error("uploadLocalLogWeb::fetchLog:error",h)}):this.logger.warn("uploadLocalLogWeb::no dbLog")},u.getNosCdnHost=function(c){var h=this,a=c.error;if(a&&(a.callFunc="events::getNosCdnHost",h.onCustomError("getNosCdnHost","EVENT_GET_NOS_CDN_HOST_ERROR",a)),c.content&&c.content.nosConfigTag){var y=c.content.nosConfigTag,T="",v="";y.expire!==0&&y.cdnDomain?y.expire===-1?(T=y.cdnDomain,v=y.objectNamePrefix):(T=y.cdnDomain,v=y.objectNamePrefix,h.nosCdnHostTimer&&clearTimeout(h.nosCdnHostTimer),h.nosCdnHostTimer=s(function(){h.sendCmd("getNosCdnHost",{})},800*n(y.expire))):(T="",v=""),d.serverNosConfig.cdnDomain=T,d.serverNosConfig.objectPrefix=v,d.hasLocalStorage&&(localStorage.setItem("nim_cdn_domain",T),localStorage.setItem("nim_object_prefix",v))}}},function(o,k,e){var r=e(8),i=e(32),s=e(75).fn,n=e(0),u=e(286),p=e(105).EMSyncType;s.processAvSignal=function(m){switch(m.cmd){case"signalingCreate":case"signalingDelay":case"signalingClose":case"signalingJoin":case"signalingLeave":case"signalingInvite":case"signalingCancel":case"signalingReject":case"signalingAccept":case"signalingControl":case"signalingSyncMsgRead":case"signalingGetChannelInfo":case"signalingCallEx":break;case"signalingNotify":this.onSignalingNotify(m);break;case"signalingMutilClientSyncNotify":this.onSignalingMutilClientSyncNotify(m);break;case"signalingUnreadMessageSyncNotify":this.onSignalingUnreadMessageSyncNotify(m);break;case"signalingChannelsSyncNotify":this.onSignalingMembersSyncNotify(m);break;default:this.logger.warn("avSignal::unhandled cmd:",m.cmd)}};var d=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(m.needPush&&(m.needPush=m.needPush==="1"),m.needBadge&&(m.needBadge=m.needBadge==="1"),m.channelInValid&&(m.channelInValid=m.channelInValid==="1"),m.attach){var c=JSON.parse(m.attach);m.eventType=u.parseAvSignalType(c.type)}if(m.members){var h=JSON.parse(m.members);m.members=r(h).call(h,function(a){return u.parseAvSignalMember(a)})}return m};s.onSignalingNotify=function(m){if(m.error){var c=m.error;this.logger.error("protocal::avSignal:onSignalingNotify error",c),this.emitAPI({type:"error",error:c}),this.options.onerror(c)}else{m.raw&&m.raw.r&&m.raw.r.length&&m.content&&m.content.avSignalTag&&(m.content.avSignalTag.msgid=m.raw.r[0]);var h=m.content.avSignalTag;h=i(h)?r(h).call(h,function(a){return d(a)}):d(h),this.emitAPI({type:"signalingNotify",obj:h}),n.isFunction(this.options.onSignalingNotify)&&this.options.onSignalingNotify(h)}},s.onSignalingMutilClientSyncNotify=function(m){if(m.error){var c=m.error;this.logger.error("protocal::avSignal:onSignalingMutilClientSyncNotify error",c),this.emitAPI({type:"error",error:c}),this.options.onerror(c)}else{var h=m.content.avSignalTag;h=i(h)?r(h).call(h,function(a){return d(a)}):d(h),this.emitAPI({type:"signalingMutilClientSyncNotify",obj:h}),n.isFunction(this.options.onSignalingMutilClientSyncNotify)&&this.options.onSignalingMutilClientSyncNotify(h)}},s.onSignalingUnreadMessageSyncNotify=function(m){if(m.error){var c=m.error;this.logger.error("protocal::avSignal:onSignalingUnreadMessageSyncNotify error",c),this.emitAPI({type:"error",error:c}),this.options.onerror(c)}else{var h=m.content.avSignalTag;i(h)&&(h=r(h).call(h,function(a){return d(a)})),this.emitAPI({type:"signalingUnreadMessageSyncNotify",obj:h}),this.reporterHook.emit("reporter/syncItemComplete",p.kSyncType15_13),n.isFunction(this.options.onSignalingUnreadMessageSyncNotify)&&this.options.onSignalingUnreadMessageSyncNotify(h)}},s.onSignalingMembersSyncNotify=function(m){if(m.error){var c=m.error;this.logger.error("protocal::avSignal:onSignalingMembersSyncNotify error",c),this.emitAPI({type:"error",error:c}),this.options.onerror(c)}else{var h=m.content.avSignalTag;i(h)||(h=[h]),h=r(h).call(h,function(a){return d(a)}),this.emitAPI({type:"signalingChannelsSyncNotify",obj:h}),n.isFunction(this.options.onSignalingMembersSyncNotify)&&this.options.onSignalingMembersSyncNotify(h)}}},function(o,k,e){var r=e(10),i=e(25),s=e(0),n=e(75).fn,u=e(116),p=e(277);n.adaptersRequest=function(d){var m=this,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,a=c.onerror||function(){},y=new Date().getTime(),T=s.get(h,"exception_service")||0;return c.onerror=function(){a.apply(void 0,arguments);var v=arguments.length<=0?void 0:arguments[0];m.reporter.reportTraceStart("exceptions",{user_id:m.account,trace_id:s.get(self,"socket.socket.sessionid"),start_time:y,action:1,exception_service:T}),m.reporter.reportTraceUpdateV2("exceptions",{code:typeof v.status=="number"?v.status:typeof v.code=="number"?v.code:0,description:v.message||"".concat(v.code),operation_type:0,target:d,context:c?r(c):"",net_connect:m.checkNetworkAvailable()}),m.reporter.reportTraceEnd("exceptions",1)},u(d,c)},n.adaptersUploadFile=function(d,m){var c,h=this;d.adaptersRequest=i(c=n.adaptersRequest).call(c,this);var a=new Date().getTime();return d.errorHook=function(y){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(y){h.reporter.reportTraceStart("exceptions",{user_id:h.account,trace_id:s.get(self,"socket.socket.sessionid"),start_time:a,action:1,exception_service:T.provider==="s3"?4:3});var v=T.url||d.url;y.bucket&&(v=r(y)),h.reporter.reportTraceUpdateV2("exceptions",{code:typeof y.status=="number"?y.status:typeof y.code=="number"?y.code:0,description:y.message||"".concat(y.code),operation_type:1,target:v,net_connect:h.checkNetworkAvailable()}),h.reporter.reportTraceEnd("exceptions",1)}},new p(d,this,m)}},function(o,k,e){e(291);var r,i,s,n=e(47),u=e(56),p=e(41),d=e(2),m=e(3),c=e(5),h=e(23),a=e(17),y=e(15),T=e(7),v=e(26);s=function(){function g(O,I){for(var R=0;R<I.length;R++){var N=I[R];N.enumerable=N.enumerable||!1,N.configurable=!0,"value"in N&&(N.writable=!0),n(O,N.key,N)}}var b={isDataReportEnable:!0,maxSize:100,msgListMaxSize:1e3,cacheMaxSize:1e3,maxDelay:3e5,maxInterval:3e4,minInterval:1e4,timeout:5e3,autoStart:!0},S=function(){};return function(){function O(N){(function(F,P){if(!(F instanceof P))throw new TypeError("Cannot call a class as a function")})(this,O),this.isUploadEnable=!1,this.initConfigLoaded=!1,this.loading=!1,this.isDestroyed=!1,this.reportConfig=b,this.traceMsgCache={},this.highPriorityMsgList=[],this.msgList=[],this.lowPriorityMsgList=[],this.cacheMsgList=[],this.lastReportTime=u(),this.timer=null,this.setConfig(N),this.reportConfig.isDataReportEnable&&this.reportConfig.autoStart&&this.initUploadConfig()}var I,R;return I=O,(R=[{key:"setConfig",value:function(N){this.reportConfig=p({},this.reportConfig,N),this.reportConfig.common.sdk_type||(this.reportConfig.common.sdk_type="im")}},{key:"reportImmediately",value:function(N,F){var P=this;this.reportConfig.isDataReportEnable&&this.reportConfig.request(N,p({dataType:"json",method:"POST",timeout:this.reportConfig.timeout},F)).catch(function(x){var L,_;(_=(L=P.reportConfig)===null||L===void 0?void 0:L.logger)===null||_===void 0||_.warn("Reporter immediately upload failed",x)})}},{key:"report",value:function(N,F){var P=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(P.priority||(P.priority=this.getEventPriority(N,F)),this.reportConfig.isDataReportEnable&&N){var x=u();P.priority==="HIGH"?this.highPriorityMsgList.push({module:N,msg:F,createTime:x}):P.priority==="NORMAL"?this.msgList.push({module:N,msg:F,createTime:x}):P.priority==="LOW"&&this.lowPriorityMsgList.push({module:N,msg:F,createTime:x}),this.highPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.highPriorityMsgList.shift(),this.msgList.length>this.reportConfig.msgListMaxSize&&this.msgList.shift(),this.lowPriorityMsgList.length>this.reportConfig.msgListMaxSize&&this.lowPriorityMsgList.shift(),this.doReport()}}},{key:"reportTraceStart",value:function(N,F){if(this.reportConfig.isDataReportEnable&&N&&!this.traceMsgCache[N]){var P=p(p({start_time:u()},F),{extension:[]});this.traceMsgCache[N]=P}}},{key:"reportTraceUpdate",value:function(N){}},{key:"reportTraceUpdateV2",value:function(N,F,P){var x,L=this;if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[N]){var _=this.traceMsgCache[N].extension.length,C=new Date().getTime();F.duration=_===0?C-this.traceMsgCache[N].start_time:C-this.traceMsgCache[N].extension[_-1].end_time,this.traceMsgCache[N].extension.push(p({end_time:C},F)),P!=null&&P.asyncParams&&((x=this.traceMsgCache[N]).asyncPromiseArray||(x.asyncPromiseArray=[]),this.traceMsgCache[N].asyncPromiseArray.push(P.asyncParams.then(function(A){var M=L.traceMsgCache[N].extension.length-1;p(L.traceMsgCache[N].extension[M],A)})))}}},{key:"reportTraceEnd",value:function(N){var F,P=this,x=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reportConfig.isDataReportEnable&&this.traceMsgCache[N])if(N!=="nos"||x===!1)if(typeof x=="boolean"?this.traceMsgCache[N].succeed=!!x:this.traceMsgCache[N].state=x,this.traceMsgCache[N].duration=u()-this.traceMsgCache[N].start_time,d(F=this.traceMsgCache[N].extension).call(F,function(_){delete _.end_time}),this.traceMsgCache[N].asyncPromiseArray){var L=this.traceMsgCache[N];m.all(this.traceMsgCache[N].asyncPromiseArray).finally(function(){L===P.traceMsgCache[N]&&(delete P.traceMsgCache[N].asyncPromiseArray,P.report(N,P.traceMsgCache[N],{priority:P.getEventPriority(N,P.traceMsgCache[N])}),P.traceMsgCache[N]=null)})}else this.report(N,this.traceMsgCache[N],{priority:this.getEventPriority(N,this.traceMsgCache[N])}),this.traceMsgCache[N]=null;else this.traceMsgCache[N]=null}},{key:"getEventPriority",value:function(N,F){if(N==="exceptions"){if(F.action===0||F.action===2||F.action===1&&F.exception_service!==0)return"HIGH"}else if(N==="msgReceive"||N==="nim_api_trace")return"LOW";return"NORMAL"}},{key:"reportTraceCancel",value:function(N){this.reportConfig.isDataReportEnable&&(this.traceMsgCache[N]=null)}},{key:"pause",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!1)}},{key:"restore",value:function(){this.reportConfig.isDataReportEnable&&(this.isUploadEnable=!0,this.initConfigLoaded||this.initUploadConfig())}},{key:"destroy",value:function(){var N,F=this;this.reportConfig.isDataReportEnable&&(d(N=c(this.traceMsgCache)).call(N,function(P){F.reportTraceEnd(P,1)}),this.timer!==null&&clearTimeout(this.timer),this.setConfig=S,this.report=S,this.reportTraceStart=S,this.reportTraceUpdate=S,this.reportTraceEnd=S,this.pause=S,this.restore=S,this.destroy=S,this.cacheMsgList=[],this.traceMsgCache={},this.lowPriorityMsgList=[],this.msgList=[],this.highPriorityMsgList=[],this.reportConfig={},this.isDestroyed=!0)}},{key:"initUploadConfig",value:function(){var N,F,P=this;if(!this.loading){this.loading=!0;var x=this.reportConfig.common||{};try{this.reportConfig.request(this.reportConfig.reportConfigUrl,{method:"GET",dataType:"json",params:{deviceId:x.dev_id,sdkVer:x.sdk_ver,platform:x.platform,appkey:x.app_key},timeout:this.reportConfig.timeout}).then(function(L){var _,C;if(!P.isDestroyed){if(L.status===200&&L.data&&L.data.code===200){var A=L.data.data||{};P.reportConfig.maxSize=A.maxSize>1e3?1e3:A.maxSize,P.reportConfig.maxInterval=A.maxInterval>1e4?1e4:A.maxInterval,P.reportConfig.maxInterval=A.maxInterval<10?10:A.maxInterval,P.reportConfig.minInterval=A.minInterval<2?2:A.minInterval,P.reportConfig.maxDelay=A.maxDelay||300,P.reportConfig.maxInterval=1e3*P.reportConfig.maxInterval,P.reportConfig.minInterval=1e3*P.reportConfig.minInterval,P.reportConfig.maxDelay=1e3*P.reportConfig.maxDelay,P.isUploadEnable=!0,P.initConfigLoaded=!0,P.loading=!1,P.reportHeartBeat()}(C=(_=P.reportConfig)===null||_===void 0?void 0:_.logger)===null||C===void 0||C.log("Get reporter upload config success")}}).catch(function(L){var _,C;P.loading=!1,(C=(_=P.reportConfig)===null||_===void 0?void 0:_.logger)===null||C===void 0||C.error("Get reporter upload config failed",L)})}catch(L){this.loading=!1,(F=(N=this.reportConfig)===null||N===void 0?void 0:N.logger)===null||F===void 0||F.error("Exec reporter request failed",L)}}}},{key:"reportHeartBeat",value:function(){var N=this;this.isDestroyed||(this.timer=h(function(){N.reportHeartBeat()},this.reportConfig.minInterval),this.doReport())}},{key:"doReport",value:function(){if(!this.isDestroyed){var N=this.highPriorityMsgList.length+this.msgList.length+this.lowPriorityMsgList.length+this.cacheMsgList.length>2*this.reportConfig.maxSize?this.reportConfig.minInterval:this.reportConfig.maxInterval;u()-this.lastReportTime>=N&&this.upload()}}},{key:"getUploadMsg",value:function(){var N,F,P,x,L,_,C=this,A={},M=u();this.highPriorityMsgList=a(N=this.highPriorityMsgList).call(N,function(V){return M-V.createTime<C.reportConfig.maxDelay}),this.msgList=a(F=this.msgList).call(F,function(V){return M-V.createTime<C.reportConfig.maxDelay}),this.lowPriorityMsgList=a(P=this.lowPriorityMsgList).call(P,function(V){return M-V.createTime<C.reportConfig.maxDelay}),this.cacheMsgList=a(x=this.cacheMsgList).call(x,function(V){return M-V.createTime<C.reportConfig.maxDelay});var U=y(L=this.highPriorityMsgList).call(L,0,this.reportConfig.maxSize);if(this.highPriorityMsgList=y(_=this.highPriorityMsgList).call(_,U.length),U.length<this.reportConfig.maxSize){var E,z,$=this.reportConfig.maxSize-U.length;U=T(U).call(U,y(E=this.msgList).call(E,0,$)),this.msgList=y(z=this.msgList).call(z,$)}if(U.length<this.reportConfig.maxSize){var X,Y,W=this.reportConfig.maxSize-U.length;U=T(U).call(U,y(X=this.lowPriorityMsgList).call(X,0,W)),this.lowPriorityMsgList=y(Y=this.lowPriorityMsgList).call(Y,W)}if(U.length<this.reportConfig.maxSize){var ee,w,J=this.reportConfig.maxSize-U.length;U=T(U).call(U,y(ee=this.cacheMsgList).call(ee,0,J)),this.cacheMsgList=y(w=this.cacheMsgList).call(w,J)}return d(U).call(U,function(V){A[V.module]?A[V.module].push(V.msg):A[V.module]=[V.msg]}),{uploadMsgArr:U,uploadMsg:A}}},{key:"upload",value:function(){var N,F,P=this;if(this.isUploadEnable&&!(this.lastReportTime&&u()-this.lastReportTime<this.reportConfig.minInterval)){var x=this.getUploadMsg(),L=x.uploadMsgArr,_=x.uploadMsg;if(L.length){this.lastReportTime=u();try{this.reportConfig.request(this.reportConfig.reportUrl,{dataType:"json",method:"POST",data:{common:this.reportConfig.common,event:_},headers:{sdktype:"im"},timeout:this.reportConfig.timeout}).catch(function(C){var A,M,U,E;P.cacheMsgList=y(A=T(M=P.cacheMsgList).call(M,L)).call(A,0,P.reportConfig.cacheMaxSize),(E=(U=P.reportConfig)===null||U===void 0?void 0:U.logger)===null||E===void 0||E.warn("Reporter upload failed",C)})}catch(C){(F=(N=this.reportConfig)===null||N===void 0?void 0:N.logger)===null||F===void 0||F.warn("Exec reporter request failed",C)}clearTimeout(this.timer),this.reportHeartBeat()}}}}])&&g(I.prototype,R),n(I,"prototype",{writable:!1}),O}()},v(k)==="object"&&o!==void 0?o.exports=s():(i=typeof(r=s)=="function"?r.call(k,e,k,o):r)===void 0||(o.exports=i)},function(o,k,e){o.exports=e(685)},function(o,k,e){e(686);var r=e(687);o.exports=r},function(o,k,e){e(292)},function(o,k,e){var r=e(688);o.exports=r},function(o,k,e){var r=e(689);o.exports=r},function(o,k,e){e(292),o.exports=e(14)},function(o,k,e){var r,i,s,n=e(122),u=e(121),p=e(280),d=e(281),m=e(190),c=e(691),h=(e(291),e(2)),a=e(5),y=e(7),T=e(3),v=e(23),g=e(10),b=e(278),S=e(26);function O(I){var R=function(){if(typeof Reflect>"u"||!b||b.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(b(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var N,F=m(I);if(R){var P=m(this).constructor;N=b(F,arguments,P)}else N=F.apply(this,arguments);return d(this,N)}}s=function(){function I(N){if(N){var F,P="";return h(F=a(N)).call(F,function(x,L){var _;P+=L===0?"?":"&",P+=y(_="".concat(x,"=")).call(_,N[x])}),P}return""}var R=function(N){p(P,N);var F=O(P);function P(x,L,_,C){var A;return u(this,P),(A=F.call(this,_)).source=x,A.code=L,A.desc=_,A.detail=C||{},A}return n(P)}(c(Error));return function(N){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{dataType:"json",method:"GET",timeout:5e3},P=F.dataType==="text"?"text/plain; charset=UTF-8":"application/json; charset=UTF-8",x=F.method==="GET"?I(F.params):"";return new T(function(L,_){if(window.XMLHttpRequest){var C,A,M=new XMLHttpRequest;if(M.onreadystatechange=function(){if(M.readyState===4)if(M.status===200){try{A=JSON.parse(M.response||"{}")}catch{A=M.response}L({status:M.status,data:A})}else v(function(){var E;_(new R(1,M.status,y(E="readyState: ".concat(M.readyState,"; statusText: ")).call(E,M.statusText)))},0)},M.open(F.method,y(C="".concat(N)).call(C,x)),M.timeout=F.timeout||5e3,M.setRequestHeader("Content-Type",P),F.headers)for(var U in F.headers)M.setRequestHeader(U,F.headers[U]);M.ontimeout=function(E){_(new R(1,408,E&&E.message?E.message:"request timeout"))},M.send(g(F.data))}else _(new R(2,10400,"request no suppout"))})}},S(k)==="object"&&o!==void 0?o.exports=s():(i=typeof(r=s)=="function"?r.call(k,e,k,o):r)===void 0||(o.exports=i)},function(o,k,e){var r=e(692),i=e(187),s=e(190),n=e(188),u=e(731),p=e(732);function d(m){var c=typeof r=="function"?new r:void 0;return o.exports=d=function(h){if(h===null||!u(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(h))return c.get(h);c.set(h,a)}function a(){return p(h,arguments,s(this).constructor)}return a.prototype=i(h.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),n(a,h)},o.exports.__esModule=!0,o.exports.default=o.exports,d(m)}o.exports=d,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(693)},function(o,k,e){o.exports=e(694)},function(o,k,e){var r=e(695);e(706),e(708),e(710),e(712),e(713),e(715),e(716),e(717),e(718),e(719),e(721),e(722),e(723),e(724),e(725),e(726),e(727),e(728),e(729),e(730),o.exports=r},function(o,k,e){var r=e(696);o.exports=r},function(o,k,e){var r=e(697);e(66),o.exports=r},function(o,k,e){e(82),e(698),e(96),e(113);var r=e(12);o.exports=r.Map},function(o,k,e){e(699)},function(o,k,e){e(700)("Map",function(r){return function(){return r(this,arguments.length?arguments[0]:void 0)}},e(704))},function(o,k,e){var r=e(1),i=e(14),s=e(293),n=e(4),u=e(53),p=e(46),d=e(168),m=e(16),c=e(28),h=e(81),a=e(38).f,y=e(84).forEach,T=e(27),v=e(97),g=v.set,b=v.getterFor;o.exports=function(S,O,I){var R,N=S.indexOf("Map")!==-1,F=S.indexOf("Weak")!==-1,P=N?"set":"add",x=i[S],L=x&&x.prototype,_={};if(T&&m(x)&&(F||L.forEach&&!n(function(){new x().entries().next()}))){var C=(R=O(function(M,U){g(d(M,C),{type:S,collection:new x}),U!=null&&p(U,M[P],{that:M,AS_ENTRIES:N})})).prototype,A=b(S);y(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(M){var U=M=="add"||M=="set";!(M in L)||F&&M=="clear"||u(C,M,function(E,z){var $=A(this).collection;if(!U&&F&&!c(E))return M=="get"&&void 0;var X=$[M](E===0?0:E,z);return U?this:X})}),F||a(C,"size",{configurable:!0,get:function(){return A(this).collection.size}})}else R=I.getConstructor(O,S,N,P),s.enable();return h(R,S,!1,!0),_[S]=R,r({global:!0,forced:!0},_),F||I.setStrong(R,S,N),R}},function(o,k,e){var r=e(4),i=e(28),s=e(62),n=e(702),u=Object.isExtensible,p=r(function(){});o.exports=p||n?function(d){return!!i(d)&&(!n||s(d)!="ArrayBuffer")&&(!u||u(d))}:u},function(o,k,e){var r=e(4);o.exports=r(function(){if(typeof ArrayBuffer=="function"){var i=new ArrayBuffer(8);Object.isExtensible(i)&&Object.defineProperty(i,"a",{value:8})}})},function(o,k,e){var r=e(4);o.exports=!r(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(o,k,e){var r=e(38).f,i=e(80),s=e(705),n=e(34),u=e(168),p=e(91),d=e(46),m=e(166),c=e(167),h=e(237),a=e(27),y=e(293).fastKey,T=e(97),v=T.set,g=T.getterFor;o.exports={getConstructor:function(b,S,O,I){var R=b(function(L,_){u(L,N),v(L,{type:S,index:i(null),first:void 0,last:void 0,size:0}),a||(L.size=0),p(_)||d(_,L[I],{that:L,AS_ENTRIES:O})}),N=R.prototype,F=g(S),P=function(L,_,C){var A,M,U=F(L),E=x(L,_);return E?E.value=C:(U.last=E={index:M=y(_,!0),key:_,value:C,previous:A=U.last,next:void 0,removed:!1},U.first||(U.first=E),A&&(A.next=E),a?U.size++:L.size++,M!=="F"&&(U.index[M]=E)),L},x=function(L,_){var C,A=F(L),M=y(_);if(M!=="F")return A.index[M];for(C=A.first;C;C=C.next)if(C.key==_)return C};return s(N,{clear:function(){for(var L=F(this),_=L.index,C=L.first;C;)C.removed=!0,C.previous&&(C.previous=C.previous.next=void 0),delete _[C.index],C=C.next;L.first=L.last=void 0,a?L.size=0:this.size=0},delete:function(L){var _=F(this),C=x(this,L);if(C){var A=C.next,M=C.previous;delete _.index[C.index],C.removed=!0,M&&(M.next=A),A&&(A.previous=M),_.first==C&&(_.first=A),_.last==C&&(_.last=M),a?_.size--:this.size--}return!!C},forEach:function(L){for(var _,C=F(this),A=n(L,arguments.length>1?arguments[1]:void 0);_=_?_.next:C.first;)for(A(_.value,_.key,this);_&&_.removed;)_=_.previous},has:function(L){return!!x(this,L)}}),s(N,O?{get:function(L){var _=x(this,L);return _&&_.value},set:function(L,_){return P(this,L===0?0:L,_)}}:{add:function(L){return P(this,L=L===0?0:L,L)}}),a&&r(N,"size",{get:function(){return F(this).size}}),R},setStrong:function(b,S,O){var I=S+" Iterator",R=g(S),N=g(I);m(b,S,function(F,P){v(this,{type:I,target:F,state:R(F),kind:P,last:void 0})},function(){for(var F=N(this),P=F.kind,x=F.last;x&&x.removed;)x=x.previous;return F.target&&(F.last=x=x?x.next:F.state.first)?c(P=="keys"?x.key:P=="values"?x.value:[x.key,x.value],!1):(F.target=void 0,c(void 0,!0))},O?"entries":"values",!O,!0),h(S)}}},function(o,k,e){var r=e(65);o.exports=function(i,s,n){for(var u in s)n&&n.unsafe&&i[u]?i[u]=s[u]:r(i,u,s[u],n);return i}},function(o,k,e){e(1)({target:"Map",stat:!0,forced:!0},{from:e(707)})},function(o,k,e){var r=e(34),i=e(19),s=e(31),n=e(169),u=e(91),p=e(46),d=[].push;o.exports=function(m){var c,h,a,y,T=arguments.length,v=T>1?arguments[1]:void 0;return n(this),(c=v!==void 0)&&s(v),u(m)?new this:(h=[],c?(a=0,y=r(v,T>2?arguments[2]:void 0),p(m,function(g){i(d,h,y(g,a++))})):p(m,d,{that:h}),new this(h))}},function(o,k,e){e(1)({target:"Map",stat:!0,forced:!0},{of:e(709)})},function(o,k,e){var r=e(98);o.exports=function(){return new this(r(arguments))}},function(o,k,e){var r=e(1),i=e(37),s=e(55).remove;r({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var n,u=i(this),p=!0,d=0,m=arguments.length;d<m;d++)n=s(u,arguments[d]),p=p&&n;return!!p}})},function(o,k){o.exports=function(e,r){return r==1?function(i,s){return i[e](s)}:function(i,s,n){return i[e](s,n)}}},function(o,k,e){var r=e(1),i=e(37),s=e(55),n=s.get,u=s.has,p=s.set;r({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(d,m){var c,h,a=i(this);return u(a,d)?(c=n(a,d),"update"in m&&(c=m.update(c,d,a),p(a,d,c)),c):(h=m.insert(d,a),p(a,d,h),h)}})},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(51);r({target:"Map",proto:!0,real:!0,forced:!0},{every:function(u){var p=s(this),d=i(u,arguments.length>1?arguments[1]:void 0);return n(p,function(m,c){if(!d(m,c,p))return!1},!0)!==!1}})},function(o,k,e){var r=e(19);o.exports=function(i,s,n){for(var u,p,d=n||i.next;!(u=r(d,i)).done;)if((p=s(u.value))!==void 0)return p}},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(55),u=e(51),p=n.Map,d=n.set;r({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(m){var c=s(this),h=i(m,arguments.length>1?arguments[1]:void 0),a=new p;return u(c,function(y,T){h(y,T,c)&&d(a,T,y)}),a}})},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(51);r({target:"Map",proto:!0,real:!0,forced:!0},{find:function(u){var p=s(this),d=i(u,arguments.length>1?arguments[1]:void 0),m=n(p,function(c,h){if(d(c,h,p))return{value:c}},!0);return m&&m.value}})},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(51);r({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(u){var p=s(this),d=i(u,arguments.length>1?arguments[1]:void 0),m=n(p,function(c,h){if(d(c,h,p))return{key:h}},!0);return m&&m.key}})},function(o,k,e){var r=e(1),i=e(19),s=e(11),n=e(16),u=e(31),p=e(46),d=e(55).Map,m=s([].push);r({target:"Map",stat:!0,forced:!0},{groupBy:function(c,h){var a=new(n(this)?this:d);u(h);var y=u(a.has),T=u(a.get),v=u(a.set);return p(c,function(g){var b=h(g);i(y,a,b)?m(i(T,a,b),g):i(v,a,b,[g])}),a}})},function(o,k,e){var r=e(1),i=e(720),s=e(37),n=e(51);r({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(u){return n(s(this),function(p){if(i(p,u))return!0},!0)===!0}})},function(o,k){o.exports=function(e,r){return e===r||e!=e&&r!=r}},function(o,k,e){var r=e(1),i=e(19),s=e(46),n=e(16),u=e(31),p=e(55).Map;r({target:"Map",stat:!0,forced:!0},{keyBy:function(d,m){var c=new(n(this)?this:p);u(m);var h=u(c.set);return s(d,function(a){i(h,c,m(a),a)}),c}})},function(o,k,e){var r=e(1),i=e(37),s=e(51);r({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(n){var u=s(i(this),function(p,d){if(p===n)return{key:d}},!0);return u&&u.key}})},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(55),u=e(51),p=n.Map,d=n.set;r({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(m){var c=s(this),h=i(m,arguments.length>1?arguments[1]:void 0),a=new p;return u(c,function(y,T){d(a,h(y,T,c),y)}),a}})},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(55),u=e(51),p=n.Map,d=n.set;r({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(m){var c=s(this),h=i(m,arguments.length>1?arguments[1]:void 0),a=new p;return u(c,function(y,T){d(a,T,h(y,T,c))}),a}})},function(o,k,e){var r=e(1),i=e(37),s=e(46),n=e(55).set;r({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(u){for(var p=i(this),d=arguments.length,m=0;m<d;)s(arguments[m++],function(c,h){n(p,c,h)},{AS_ENTRIES:!0});return p}})},function(o,k,e){var r=e(1),i=e(31),s=e(37),n=e(51),u=TypeError;r({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(p){var d=s(this),m=arguments.length<2,c=m?void 0:arguments[1];if(i(p),n(d,function(h,a){m?(m=!1,c=h):c=p(c,h,a,d)}),m)throw u("Reduce of empty map with no initial value");return c}})},function(o,k,e){var r=e(1),i=e(34),s=e(37),n=e(51);r({target:"Map",proto:!0,real:!0,forced:!0},{some:function(u){var p=s(this),d=i(u,arguments.length>1?arguments[1]:void 0);return n(p,function(m,c){if(d(m,c,p))return!0},!0)===!0}})},function(o,k,e){var r=e(1),i=e(31),s=e(37),n=e(55),u=TypeError,p=n.get,d=n.has,m=n.set;r({target:"Map",proto:!0,real:!0,forced:!0},{update:function(c,h){var a=s(this),y=arguments.length;i(h);var T=d(a,c);if(!T&&y<3)throw u("Updating absent value");var v=T?p(a,c):i(y>2?arguments[2]:void 0)(c,a);return m(a,c,h(v,c,a)),a}})},function(o,k,e){e(1)({target:"Map",proto:!0,real:!0,forced:!0},{upsert:e(294)})},function(o,k,e){e(1)({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:e(294)})},function(o,k,e){var r=e(186);o.exports=function(i){var s;return r(s=Function.toString.call(i)).call(s,"[native code]")!==-1},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(149),i=e(295),s=e(188),n=e(736);function u(p,d,m){var c;return n()?(o.exports=u=r(c=i).call(c),o.exports.__esModule=!0,o.exports.default=o.exports):(o.exports=u=function(h,a,y){var T=[null];T.push.apply(T,a);var v=new(r(Function).apply(h,T));return y&&s(v,y.prototype),v},o.exports.__esModule=!0,o.exports.default=o.exports),u.apply(null,arguments)}o.exports=u,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(734)},function(o,k,e){var r=e(735);o.exports=r},function(o,k,e){var r=e(279);o.exports=r},function(o,k,e){var r=e(295);o.exports=function(){if(typeof Reflect>"u"||!r||r.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(r(Boolean,[],function(){})),!0}catch{return!1}},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(17),i=e(0),s=e(191),n=i.merge({},s.idMap,{auth:{id:2,login:3,kicked:5,logout:6,multiPortLogin:7,kick:8},user:{id:3,updatePushToken:1,appBackground:2,markInBlacklist:3,getBlacklist:4,markInMutelist:5,getMutelist:6,getRelations:8,getUsers:7,updateMyInfo:10,updateDonnop:15,syncMyInfo:109,syncUpdateMyInfo:110},notify:{id:4,markRead:3,syncOfflineMsgs:4,batchMarkRead:5,syncOfflineSysMsgs:6,syncOfflineNetcallMsgs:8,syncRoamingMsgs:9,syncMsgReceipts:12,syncRobots:15,syncBroadcastMsgs:16,syncSuperTeamRoamingMsgs:17,syncOfflineSuperTeamSysMsgs:18,syncDeleteSuperTeamMsgOfflineRoaming:19,syncDeleteMsgSelf:21,syncSessionsWithMoreRoaming:22,syncStickTopSessions:23,syncSessionHistoryMsgsDelete:24,syncSessionReliableInfo:25},sync:{id:5,sync:1,syncTeamMembers:2,syncSuperTeamMembers:3},msg:{id:7,sendMsg:1,msg:2,sysMsg:3,getHistoryMsgs:6,sendCustomSysMsg:7,searchHistoryMsgs:8,deleteSessions:9,getSessions:10,syncSendMsg:101,sendMsgReceipt:11,msgReceipt:12,deleteMsg:13,msgDeleted:14,markSessionAck:16,markSessionAckBatch:25,broadcastMsg:17,clearServerHistoryMsgs:18,getServerSessions:19,getServerSession:20,updateServerSession:21,deleteServerSessions:22,deleteMsgSelf:23,deleteMsgSelfBatch:24,msgFtsInServer:26,msgFtsInServerByTiming:27,onClearServerHistoryMsgs:118,syncUpdateServerSession:121,onDeleteMsgSelf:123,onDeleteMsgSelfBatch:124},msgExtend:{id:23,getThreadMsgs:1,getMsgsByIdServer:2,addQuickComment:3,deleteQuickComment:4,onQuickComment:5,onDeleteQuickComment:6,getQuickComments:7,addCollect:8,deleteCollects:9,updateCollect:10,getCollects:11,addStickTopSession:12,deleteStickTopSession:13,updateStickTopSession:14,addMsgPin:15,updateMsgPin:16,deleteMsgPin:17,onAddMsgPin:18,onUpdateMsgPin:19,onDeleteMsgPin:20,getMsgPins:21,syncAddQuickComment:103,syncDeleteQuickComment:104,syncAddStickTopSession:112,syncDeleteStickTopSession:113,syncUpdateStickTopSession:114,syncAddMsgPin:115,syncUpdateMsgPin:116,syncDeleteMsgPin:117},team:{id:8,createTeam:1,sendTeamMsg:2,teamMsg:3,teamMsgs:4,addTeamMembers:5,removeTeamMembers:6,updateTeam:7,leaveTeam:8,getTeam:9,getTeams:10,getTeamMembers:11,dismissTeam:12,applyTeam:13,passTeamApply:14,rejectTeamApply:15,addTeamManagers:16,removeTeamManagers:17,transferTeam:18,updateInfoInTeam:19,updateNickInTeam:20,acceptTeamInvite:21,rejectTeamInvite:22,getTeamHistoryMsgs:23,searchTeamHistoryMsgs:24,updateMuteStateInTeam:25,getMyTeamMembers:26,getMutedTeamMembers:27,sendTeamMsgReceipt:28,getTeamMsgReads:29,getTeamMsgReadAccounts:30,notifyTeamMsgReads:31,muteTeamAll:32,getTeamMemberInvitorAccid:33,getTeamsById:34,syncMyTeamMembers:126,syncTeams:109,syncTeamMembers:111,syncCreateTeam:101,syncSendTeamMsg:102,syncUpdateTeamMember:119},superTeam:{id:21,sendSuperTeamMsg:2,superTeamMsg:3,addSuperTeamMembers:5,removeSuperTeamMembers:6,leaveSuperTeam:7,updateSuperTeam:8,getSuperTeam:9,getSuperTeams:12,updateInfoInSuperTeam:10,getMySuperTeamMembers:11,getSuperTeamMembers:13,getSuperTeamHistoryMsgs:14,getSuperTeamMembersByJoinTime:15,sendSuperTeamCustomSysMsg:16,deleteSuperTeamMsg:17,superTeamMsgDelete:18,superTeamCustomSysMsg:19,applySuperTeam:20,passSuperTeamApply:21,rejectSuperTeamApply:22,acceptSuperTeamInvite:23,rejectSuperTeamInvite:24,markSuperTeamSessionAck:25,addSuperTeamManagers:26,removeSuperTeamManagers:27,updateSuperTeamMute:28,updateSuperTeamMembersMute:29,updateNickInSuperTeam:30,transferSuperTeam:31,markSuperTeamSessionsAck:32,getSuperTeamMembersByAccounts:33,getMutedSuperTeamMembers:34,syncMySuperTeamMembers:111,syncSuperTeams:109,syncSuperTeamMembers:113,syncCreateSuperTeam:101,syncSendSuperTeamMsg:102,syncUpdateSuperTeamMember:110,syncDeleteSuperTeamMsg:117},friend:{id:12,friendRequest:1,syncFriendRequest:101,deleteFriend:2,syncDeleteFriend:102,updateFriend:3,syncUpdateFriend:103,getFriends:4},chatroom:{id:13,getChatroomAddress:1},filter:{id:101,sendFilterMsg:1,filterMsg:2,filterSysMsg:3,sendFilterCustomSysMsg:7},eventService:{id:14,publishEvent:1,pushEvent:2,subscribeEvent:3,unSubscribeEventsByAccounts:4,unSubscribeEventsByType:5,querySubscribeEventsByAccounts:6,querySubscribeEventsByType:7,pushEvents:9},proxyService:{id:22,httpProxy:1,onProxyMsg:2},qchat:{id:24,getQChatAddress:1}}),u=i.merge({},s.cmdConfig,{login:{sid:n.auth.id,cid:n.auth.login,params:[{type:"Property",name:"login"}]},logout:{sid:n.auth.id,cid:n.auth.logout},kick:{sid:n.auth.id,cid:n.auth.kick,params:[{type:"StrArray",name:"deviceIds"}]},updatePushToken:{sid:n.user.id,cid:n.user.updatePushToken,params:[{type:"String",name:"tokenName"},{type:"String",name:"token"},{type:"int",name:"pushkit"}]},appBackground:{sid:n.user.id,cid:n.user.appBackground,params:[{type:"bool",name:"isBackground"},{type:"Int",name:"badge"}]},markInBlacklist:{sid:n.user.id,cid:n.user.markInBlacklist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getBlacklist:{sid:n.user.id,cid:n.user.getBlacklist,params:[{type:"long",name:"time"}]},markInMutelist:{sid:n.user.id,cid:n.user.markInMutelist,params:[{type:"String",name:"account"},{type:"bool",name:"isAdd"}]},getMutelist:{sid:n.user.id,cid:n.user.getMutelist,params:[{type:"long",name:"time"}]},getRelations:{sid:n.user.id,cid:n.user.getRelations,params:[{type:"long",name:"timetag"}]},getUsers:{sid:n.user.id,cid:n.user.getUsers,params:[{type:"StrArray",name:"accounts"}]},updateMyInfo:{sid:n.user.id,cid:n.user.updateMyInfo,params:[{type:"Property",name:"user"},{type:"Property",name:"antispamTag"}]},updateDonnop:{sid:n.user.id,cid:n.user.updateDonnop,params:[{type:"Property",name:"donnop"}]},markRead:{sid:n.notify.id,cid:n.notify.markRead,params:[{type:"long",name:"id"},{type:"ph",name:"ph"}]},batchMarkRead:{sid:n.notify.id,cid:n.notify.batchMarkRead,params:[{type:"byte",name:"sid"},{type:"byte",name:"cid"},{type:"LongArray",name:"ids"}]},sync:{sid:n.sync.id,cid:n.sync.sync,isAwaitable:!1,params:[{type:"Property",name:"sync"}]},syncTeamMembers:{sid:n.sync.id,cid:n.sync.syncTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},syncSuperTeamMembers:{sid:n.sync.id,cid:n.sync.syncSuperTeamMembers,params:[{type:"LongLongMap",name:"sync"}]},sendMsg:{sid:n.msg.id,cid:n.msg.sendMsg,params:[{type:"Property",name:"msg"}]},getHistoryMsgs:{sid:n.msg.id,cid:n.msg.getHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},sendCustomSysMsg:{sid:n.msg.id,cid:n.msg.sendCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},searchHistoryMsgs:{sid:n.msg.id,cid:n.msg.searchHistoryMsgs,params:[{type:"String",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSessions:{sid:n.msg.id,cid:n.msg.getSessions,params:[{type:"long",name:"time"}]},deleteSessions:{sid:n.msg.id,cid:n.msg.deleteSessions,params:[{type:"StrArray",name:"sessions"}]},sendMsgReceipt:{sid:n.msg.id,cid:n.msg.sendMsgReceipt,params:[{type:"Property",name:"msgReceipt"}]},deleteMsg:{sid:n.msg.id,cid:n.msg.deleteMsg,params:[{type:"Property",name:"sysMsg"}]},markSessionAck:{sid:n.msg.id,cid:n.msg.markSessionAck,params:[{type:"byte",name:"scene"},{type:"String",name:"to"},{type:"long",name:"timetag"}]},markSessionAckBatch:{sid:n.msg.id,cid:n.msg.markSessionAckBatch,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},clearServerHistoryMsgs:{sid:n.msg.id,cid:n.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParams"}]},clearServerHistoryMsgsWithSync:{sid:n.msg.id,cid:n.msg.clearServerHistoryMsgs,params:[{type:"Property",name:"clearMsgsParamsWithSync"}]},msgFtsInServer:{sid:n.msg.id,cid:n.msg.msgFtsInServer,params:[{type:"Property",name:"msgFullSearchRequestTag"}]},msgFtsInServerByTiming:{sid:n.msg.id,cid:n.msg.msgFtsInServerByTiming,params:[{type:"Property",name:"msgTimingFullSearchRequestTag"}]},onClearServerHistoryMsgs:{sid:n.msg.id,cid:n.msg.clearServerHistoryMsgs},getServerSessions:{sid:n.msg.id,cid:n.msg.getServerSessions,params:[{type:"Property",name:"sessionReqTag"}]},getServerSession:{sid:n.msg.id,cid:n.msg.getServerSession,params:[{type:"Property",name:"session"}]},updateServerSession:{sid:n.msg.id,cid:n.msg.updateServerSession,params:[{type:"Property",name:"session"}]},deleteServerSessions:{sid:n.msg.id,cid:n.msg.deleteServerSessions,params:[{type:"PropertyArray",name:"sessions",entity:"session"}]},deleteMsgSelf:{sid:n.msg.id,cid:n.msg.deleteMsgSelf,params:[{type:"Property",name:"deleteMsgSelfTag"}]},deleteMsgSelfBatch:{sid:n.msg.id,cid:n.msg.deleteMsgSelfBatch,params:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},onDeleteMsgSelf:{sid:n.msg.id,cid:n.msg.onDeleteMsgSelf},onDeleteMsgSelfBatch:{sid:n.msg.id,cid:n.msg.onDeleteMsgSelfBatch},sendSuperTeamMsg:{sid:n.superTeam.id,cid:n.superTeam.sendSuperTeamMsg,params:[{type:"Property",name:"msg"}]},addSuperTeamMembers:{sid:n.superTeam.id,cid:n.superTeam.addSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"}]},removeSuperTeamMembers:{sid:n.superTeam.id,cid:n.superTeam.removeSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},leaveSuperTeam:{sid:n.superTeam.id,cid:n.superTeam.leaveSuperTeam,params:[{type:"long",name:"teamId"}]},updateSuperTeam:{sid:n.superTeam.id,cid:n.superTeam.updateSuperTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},getSuperTeam:{sid:n.superTeam.id,cid:n.superTeam.getSuperTeam,params:[{type:"long",name:"teamId"}]},getSuperTeams:{sid:n.superTeam.id,cid:n.superTeam.getSuperTeams,params:[{type:"long",name:"timetag"}]},getSuperTeamMembers:{sid:n.superTeam.id,cid:n.superTeam.getSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},updateInfoInSuperTeam:{sid:n.superTeam.id,cid:n.superTeam.updateInfoInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},getSuperTeamHistoryMsgs:{sid:n.superTeam.id,cid:n.superTeam.getSuperTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},applySuperTeam:{sid:n.superTeam.id,cid:n.superTeam.applySuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passSuperTeamApply:{sid:n.superTeam.id,cid:n.superTeam.passSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamApply:{sid:n.superTeam.id,cid:n.superTeam.rejectSuperTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},acceptSuperTeamInvite:{sid:n.superTeam.id,cid:n.superTeam.acceptSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectSuperTeamInvite:{sid:n.superTeam.id,cid:n.superTeam.rejectSuperTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},markSuperTeamSessionAck:{sid:n.superTeam.id,cid:n.superTeam.markSuperTeamSessionAck,params:[{type:"long",name:"to"},{type:"long",name:"timetag"}]},addSuperTeamManagers:{sid:n.superTeam.id,cid:n.superTeam.addSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeSuperTeamManagers:{sid:n.superTeam.id,cid:n.superTeam.removeSuperTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateSuperTeamMute:{sid:n.superTeam.id,cid:n.superTeam.updateSuperTeamMute,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},updateSuperTeamMembersMute:{sid:n.superTeam.id,cid:n.superTeam.updateSuperTeamMembersMute,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"int",name:"mute"}]},updateNickInSuperTeam:{sid:n.superTeam.id,cid:n.superTeam.updateNickInSuperTeam,params:[{type:"Property",name:"superTeamMember"}]},transferSuperTeam:{sid:n.superTeam.id,cid:n.superTeam.transferSuperTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},markSuperTeamSessionsAck:{sid:n.superTeam.id,cid:n.superTeam.markSuperTeamSessionsAck,params:[{type:"PropertyArray",name:"sessionAckTags",entity:"sessionAckTag"}]},getSuperTeamMembersByJoinTime:{sid:n.superTeam.id,cid:n.superTeam.getSuperTeamMembersByJoinTime,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},getSuperTeamMembersByAccounts:{sid:n.superTeam.id,cid:n.superTeam.getSuperTeamMembersByAccounts,params:[{type:"StrArray",name:"memberIds"}]},getMutedSuperTeamMembers:{sid:n.superTeam.id,cid:n.superTeam.getMutedSuperTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"joinTime"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},sendSuperTeamCustomSysMsg:{sid:n.superTeam.id,cid:n.superTeam.sendSuperTeamCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},deleteSuperTeamMsg:{sid:n.superTeam.id,cid:n.superTeam.deleteSuperTeamMsg,params:[{type:"Property",name:"sysMsg"}]},getMySuperTeamMembers:{sid:n.superTeam.id,cid:n.superTeam.getMySuperTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},createTeam:{sid:n.team.id,cid:n.team.createTeam,params:[{type:"Property",name:"team"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"Property",name:"antispamTag"}]},sendTeamMsg:{sid:n.team.id,cid:n.team.sendTeamMsg,params:[{type:"Property",name:"msg"}]},addTeamMembers:{sid:n.team.id,cid:n.team.addTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"},{type:"String",name:"ps"},{type:"String",name:"attach"}]},removeTeamMembers:{sid:n.team.id,cid:n.team.removeTeamMembers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},updateTeam:{sid:n.team.id,cid:n.team.updateTeam,params:[{type:"Property",name:"team"},{type:"Property",name:"antispamTag"}]},leaveTeam:{sid:n.team.id,cid:n.team.leaveTeam,params:[{type:"long",name:"teamId"}]},getTeam:{sid:n.team.id,cid:n.team.getTeam,params:[{type:"long",name:"teamId"}]},getTeams:{sid:n.team.id,cid:n.team.getTeams,params:[{type:"long",name:"timetag"}]},getTeamsById:{sid:n.team.id,cid:n.team.getTeamsById,params:[{type:"longArray",name:"teamIds"}]},getTeamMembers:{sid:n.team.id,cid:n.team.getTeamMembers,params:[{type:"long",name:"teamId"},{type:"long",name:"timetag"}]},dismissTeam:{sid:n.team.id,cid:n.team.dismissTeam,params:[{type:"long",name:"teamId"}]},applyTeam:{sid:n.team.id,cid:n.team.applyTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"ps"}]},passTeamApply:{sid:n.team.id,cid:n.team.passTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamApply:{sid:n.team.id,cid:n.team.rejectTeamApply,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},addTeamManagers:{sid:n.team.id,cid:n.team.addTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},removeTeamManagers:{sid:n.team.id,cid:n.team.removeTeamManagers,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},transferTeam:{sid:n.team.id,cid:n.team.transferTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"bool",name:"leave"}]},updateInfoInTeam:{sid:n.team.id,cid:n.team.updateInfoInTeam,params:[{type:"Property",name:"teamMember"}]},updateNickInTeam:{sid:n.team.id,cid:n.team.updateNickInTeam,params:[{type:"Property",name:"teamMember"}]},acceptTeamInvite:{sid:n.team.id,cid:n.team.acceptTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"}]},rejectTeamInvite:{sid:n.team.id,cid:n.team.rejectTeamInvite,params:[{type:"long",name:"teamId"},{type:"String",name:"from"},{type:"String",name:"ps"}]},getTeamHistoryMsgs:{sid:n.team.id,cid:n.team.getTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"long",name:"lastMsgId"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},searchTeamHistoryMsgs:{sid:n.team.id,cid:n.team.searchTeamHistoryMsgs,params:[{type:"long",name:"to"},{type:"long",name:"beginTime"},{type:"long",name:"endTime"},{type:"String",name:"keyword"},{type:"int",name:"limit"},{type:"bool",name:"reverse"}]},updateMuteStateInTeam:{sid:n.team.id,cid:n.team.updateMuteStateInTeam,params:[{type:"long",name:"teamId"},{type:"String",name:"account"},{type:"int",name:"mute"}]},getMyTeamMembers:{sid:n.team.id,cid:n.team.getMyTeamMembers,params:[{type:"LongArray",name:"teamIds"}]},getMutedTeamMembers:{sid:n.team.id,cid:n.team.getMutedTeamMembers,params:[{type:"long",name:"teamId"}]},sendTeamMsgReceipt:{sid:n.team.id,cid:n.team.sendTeamMsgReceipt,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReads:{sid:n.team.id,cid:n.team.getTeamMsgReads,params:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},getTeamMsgReadAccounts:{sid:n.team.id,cid:n.team.getTeamMsgReadAccounts,params:[{type:"Property",name:"teamMsgReceipt"}]},muteTeamAll:{sid:n.team.id,cid:n.team.muteTeamAll,params:[{type:"long",name:"teamId"},{type:"int",name:"mute"}]},getTeamMemberInvitorAccid:{sid:n.team.id,cid:n.team.getTeamMemberInvitorAccid,params:[{type:"long",name:"teamId"},{type:"StrArray",name:"accounts"}]},friendRequest:{sid:n.friend.id,cid:n.friend.friendRequest,params:[{type:"String",name:"account"},{type:"byte",name:"type"},{type:"String",name:"ps"}]},deleteFriend:{sid:n.friend.id,cid:n.friend.deleteFriend,params:[{type:"String",name:"account"},{type:"Property",name:"delFriendParams"}]},updateFriend:{sid:n.friend.id,cid:n.friend.updateFriend,params:[{type:"Property",name:"friend"}]},getFriends:{sid:n.friend.id,cid:n.friend.getFriends,params:[{type:"long",name:"timetag"}]},getChatroomAddress:{sid:n.chatroom.id,cid:n.chatroom.getChatroomAddress,params:[{type:"long",name:"chatroomId"},{type:"bool",name:"isWeixinApp"},{type:"number",name:"type"}]},sendFilterMsg:{sid:r(n).id,cid:r(n).sendFilterMsg,params:[{type:"Property",name:"msg"}]},sendFilterCustomSysMsg:{sid:r(n).id,cid:r(n).sendFilterCustomSysMsg,params:[{type:"Property",name:"sysMsg"}]},publishEvent:{sid:n.eventService.id,cid:n.eventService.publishEvent,params:[{type:"Property",name:"msgEvent"}]},pushEvent:{sid:n.eventService.id,cid:n.eventService.pushEvent},subscribeEvent:{sid:n.eventService.id,cid:n.eventService.subscribeEvent,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByAccounts:{sid:n.eventService.id,cid:n.eventService.unSubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},unSubscribeEventsByType:{sid:n.eventService.id,cid:n.eventService.unSubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},querySubscribeEventsByAccounts:{sid:n.eventService.id,cid:n.eventService.querySubscribeEventsByAccounts,params:[{type:"Property",name:"msgEventSubscribe"},{type:"StrArray",name:"accounts"}]},querySubscribeEventsByType:{sid:n.eventService.id,cid:n.eventService.querySubscribeEventsByType,params:[{type:"Property",name:"msgEventSubscribe"}]},pushEvents:{sid:n.eventService.id,cid:n.eventService.pushEvents},getThreadMsgs:{sid:n.msgExtend.id,cid:n.msgExtend.getThreadMsgs,params:[{type:"Property",name:"msg"},{type:"Property",name:"threadMsgReq"}]},getMsgsByIdServer:{sid:n.msgExtend.id,cid:n.msgExtend.getMsgsByIdServer,params:[{type:"PropertyArray",name:"reqMsgs",entity:"msg"}]},addQuickComment:{sid:n.msgExtend.id,cid:n.msgExtend.addQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},deleteQuickComment:{sid:n.msgExtend.id,cid:n.msgExtend.deleteQuickComment,params:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},getQuickComments:{sid:n.msgExtend.id,cid:n.msgExtend.getQuickComments,params:[{type:"PropertyArray",name:"commentReq",entity:"commentReq"}]},addCollect:{sid:n.msgExtend.id,cid:n.msgExtend.addCollect,params:[{type:"Property",name:"collect"}]},deleteCollects:{sid:n.msgExtend.id,cid:n.msgExtend.deleteCollects,params:[{type:"PropertyArray",name:"collectList",entity:"collect"}]},updateCollect:{sid:n.msgExtend.id,cid:n.msgExtend.updateCollect,params:[{type:"Property",name:"collect"}]},getCollects:{sid:n.msgExtend.id,cid:n.msgExtend.getCollects,params:[{type:"Property",name:"collectQuery"}]},addStickTopSession:{sid:n.msgExtend.id,cid:n.msgExtend.addStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},updateStickTopSession:{sid:n.msgExtend.id,cid:n.msgExtend.updateStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},deleteStickTopSession:{sid:n.msgExtend.id,cid:n.msgExtend.deleteStickTopSession,params:[{type:"Property",name:"stickTopSession"}]},addMsgPin:{sid:n.msgExtend.id,cid:n.msgExtend.addMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},updateMsgPin:{sid:n.msgExtend.id,cid:n.msgExtend.updateMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},deleteMsgPin:{sid:n.msgExtend.id,cid:n.msgExtend.deleteMsgPin,params:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"}]},getMsgPins:{sid:n.msgExtend.id,cid:n.msgExtend.getMsgPins,params:[{type:"Property",name:"msgPinReq"}]},httpProxy:{sid:n.proxyService.id,cid:n.proxyService.httpProxy,params:[{type:"Property",name:"proxyTag"}]},getQChatAddress:{sid:n.qchat.id,cid:n.qchat.getQChatAddress,params:[{type:"Property",name:"getQChatAddressTag"}]}}),p=i.merge({},s.packetConfig,{"2_3":{service:"auth",cmd:"login",response:[{type:"Property",name:"loginRes"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"},{type:"Property",name:"aosPushInfo"}]},"2_5":{service:"auth",cmd:"kicked",response:[{type:"Number",name:"from"},{type:"Number",name:"reason"},{type:"String",name:"custom"},{type:"Number",name:"customClientType"}]},"2_6":{service:"auth",cmd:"logout"},"2_7":{service:"auth",cmd:"multiPortLogin",response:[{type:"Number",name:"state"},{type:"PropertyArray",name:"loginPorts",entity:"loginPort"}]},"2_8":{service:"auth",cmd:"kick",response:[{type:"StrArray",name:"deviceIds"}]},"3_1":{service:"user",cmd:"updatePushToken"},"3_2":{service:"user",cmd:"appBackground"},"3_3":{service:"user",cmd:"markInBlacklist"},"3_103":{service:"user",cmd:"syncMarkInBlacklist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_4":{service:"user",cmd:"getBlacklist",response:[{type:"StrArray",name:"blacklist"}]},"3_5":{service:"user",cmd:"markInMutelist"},"3_105":{service:"user",cmd:"syncMarkInMutelist",response:[{type:"String",name:"account"},{type:"Boolean",name:"isAdd"}]},"3_6":{service:"user",cmd:"getMutelist",response:[{type:"StrArray",name:"mutelist"}]},"3_8":{service:"user",cmd:"getRelations",response:[{type:"PropertyArray",name:"specialRelations",entity:"specialRelation"},{type:"Number",name:"timetag"}]},"3_7":{service:"user",cmd:"getUsers",response:[{type:"PropertyArray",name:"users",entity:"user"}]},"3_10":{service:"user",cmd:"updateMyInfo",response:[{type:"Number",name:"timetag"}]},"3_15":{service:"user",cmd:"updateDonnop",response:[{type:"Number",name:"timetag"}]},"3_115":{service:"user",cmd:"syncUpdateDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"3_109":{service:"user",cmd:"syncMyInfo",response:[{type:"Property",name:"user"},{type:"Number",name:"timetag"}]},"3_110":{service:"user",cmd:"syncUpdateMyInfo",response:[{type:"Property",name:"user"}]},"4_1":{service:"notify"},"4_2":{service:"notify"},"4_3":{service:"notify",cmd:"markRead"},"4_4":{service:"notify",cmd:"syncOfflineMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_5":{service:"notify",cmd:"batchMarkRead"},"4_6":{service:"notify",cmd:"syncOfflineSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_8":{service:"notify",cmd:"syncOfflineNetcallMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_9":{service:"notify",cmd:"syncRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_12":{service:"notify",cmd:"syncMsgReceipts",response:[{type:"PropertyArray",name:"msgReceipts",entity:"msgReceipt"},{type:"Number",name:"timetag"}]},"4_13":{service:"notify",cmd:"syncDonnop",response:[{type:"Property",name:"donnop"},{type:"Number",name:"timetag"}]},"4_14":{service:"notify",cmd:"syncSessionAck",response:[{type:"StrLongMap",name:"p2p"},{type:"LongLongMap",name:"team"},{type:"Number",name:"timetag"}]},"4_15":{service:"notify",cmd:"syncRobots",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"4_16":{service:"notify",cmd:"syncBroadcastMsgs",response:[{type:"PropertyArray",name:"broadcastMsgs",entity:"broadcastMsg"}]},"4_17":{service:"notify",cmd:"syncSuperTeamRoamingMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_18":{service:"notify",cmd:"syncOfflineSuperTeamSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"4_19":{service:"notify",cmd:"syncDeleteSuperTeamMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"4_20":{service:"notify",cmd:"syncSuperTeamSessionAck",response:[{type:"LongLongMap",name:"superTeam"},{type:"Number",name:"timetag"}]},"4_21":{service:"notify",cmd:"syncDeleteMsgSelf",response:[{type:"PropertyArray",name:"deletedMsgs",entity:"deleteMsgSelfTag"}]},"4_22":{service:"notify",cmd:"syncSessionsWithMoreRoaming",response:[{type:"PropertyArray",name:"sessions",entity:"msg"}]},"4_23":{service:"notify",cmd:"syncStickTopSessions",response:[{type:"Number",name:"timetag"},{type:"boolean",name:"modify"},{type:"PropertyArray",name:"sessions",entity:"stickTopSession"}]},"4_24":{service:"notify",cmd:"syncSessionHistoryMsgsDelete",response:[{type:"PropertyArray",name:"sessionHistoryMsgsDeleteTags",entity:"clearMsgsParamsWithSync"}]},"4_25":{service:"notify",cmd:"syncSessionReliableInfo",response:[{type:"Property",name:"context",entity:"sessionReliableSyncContextTag"},{type:"PropertyArray",name:"datas",entity:"sessionReliableSyncTag"}]},"4_100":{service:"notify",cmd:"syncOfflineFilterMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"4_101":{service:"notify",cmd:"syncOfflineFilterSysMsgs",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"}]},"5_1":{service:"sync",cmd:"syncDone",response:[{type:"Number",name:"timetag"}]},"5_2":{service:"sync",cmd:"syncTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"5_3":{service:"sync",cmd:"syncSuperTeamMembersDone",response:[{type:"Number",name:"timetag"}]},"7_1":{service:"msg",cmd:"sendMsg",response:[{type:"Property",name:"msg"}],trivialErrorCodes:[7101]},"7_2":{service:"msg",cmd:"msg",response:[{type:"Property",name:"msg"}]},"7_3":{service:"msg",cmd:"sysMsg",response:[{type:"Property",name:"sysMsg"}]},"7_6":{service:"msg",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_7":{service:"msg",cmd:"sendCustomSysMsg",trivialErrorCodes:[7101]},"7_8":{service:"msg",cmd:"searchHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_9":{service:"msg",cmd:"deleteSessions"},"7_10":{service:"msg",cmd:"getSessions",response:[{type:"StrArray",name:"sessions"}]},"7_101":{service:"msg",cmd:"syncSendMsg",response:[{type:"Property",name:"msg"}]},"7_11":{service:"msg",cmd:"sendMsgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_12":{service:"msg",cmd:"msgReceipt",response:[{type:"Property",name:"msgReceipt"}]},"7_13":{service:"msg",cmd:"onDeleteMsg"},"7_14":{service:"msg",cmd:"onMsgDeleted",response:[{type:"Property",name:"sysMsg"}]},"7_15":{service:"msg",cmd:"onDeleteMsgOfflineRoaming",response:[{type:"PropertyArray",name:"sysMsgs",entity:"sysMsg"},{type:"Number",name:"timetag"},{type:"Number",name:"type"}]},"7_16":{service:"msg",cmd:"onMarkSessionAck"},"7_17":{service:"msg",cmd:"broadcastMsg",response:[{type:"Property",name:"broadcastMsg"}]},"7_18":{service:"msg",cmd:"clearServerHistoryMsgs",response:[{type:"Long",name:"timetag"}]},"7_19":{service:"session",cmd:"getServerSessions",response:[{type:"Property",name:"sessionReqTag"},{type:"PropertyArray",name:"sessionList",entity:"session"}]},"7_20":{service:"session",cmd:"getServerSession",response:[{type:"Property",name:"session"}]},"7_21":{service:"session",cmd:"updateServerSession"},"7_22":{service:"session",cmd:"deleteServerSessions"},"7_23":{service:"msg",cmd:"deleteMsgSelf",response:[{type:"Long",name:"timetag"}]},"7_24":{service:"msg",cmd:"deleteMsgSelfBatch",response:[{type:"Long",name:"timetag"}]},"7_25":{service:"msg",cmd:"onMarkSessionAckBatch"},"7_26":{service:"msg",cmd:"msgFtsInServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_27":{service:"msg",cmd:"msgFtsInServerByTiming",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"7_118":{service:"msg",cmd:"onClearServerHistoryMsgs",response:[{type:"Property",name:"sessionHistoryMsgsDeleteTag",entity:"clearMsgsParamsWithSync"}]},"7_123":{service:"msg",cmd:"onDeleteMsgSelf",response:[{type:"Property",name:"deleteMsgSelfTag"}]},"7_124":{service:"msg",cmd:"onDeleteMsgSelfBatch",response:[{type:"PropertyArray",name:"deleteMsgSelfTags",entity:"deleteMsgSelfTag"}]},"7_116":{service:"msg",cmd:"syncMarkSessionAck",response:[{type:"Number",name:"scene"},{type:"String",name:"to"},{type:"Number",name:"timetag"}]},"7_121":{service:"msg",cmd:"syncUpdateServerSession",response:[{type:"Property",name:"session"}]},"23_1":{service:"msgExtend",cmd:"getThreadMsgs",response:[{type:"Property",name:"threadMsg",entity:"msg"},{type:"Property",name:"threadMsgsMeta"},{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_2":{service:"msgExtend",cmd:"getMsgsByIdServer",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"23_3":{service:"msgExtend",cmd:"addQuickComment",response:[{type:"Number",name:"timetag"}]},"23_4":{service:"msgExtend",cmd:"deleteQuickComment",response:[{type:"Number",name:"timetag"}]},"23_5":{service:"msgExtend",cmd:"onQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_6":{service:"msgExtend",cmd:"onDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_7":{service:"msgExtend",cmd:"getQuickComments",response:[{type:"PropertyArray",name:"commentRes",entity:"commentRes"}]},"23_8":{service:"msgExtend",cmd:"addCollect",response:[{type:"Property",name:"collect"}]},"23_9":{service:"msgExtend",cmd:"deleteCollects",response:[{type:"Number",name:"deleteNum"}]},"23_10":{service:"msgExtend",cmd:"updateCollect",response:[{type:"Property",name:"collect"}]},"23_11":{service:"msgExtend",cmd:"getCollects",response:[{type:"Number",name:"total"},{type:"PropertyArray",name:"collectList",entity:"collect"}]},"23_12":{service:"msgExtend",cmd:"addStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_13":{service:"msgExtend",cmd:"deleteStickTopSession",response:[{type:"Number",name:"timetag"}]},"23_14":{service:"msgExtend",cmd:"updateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_15":{service:"msgExtend",cmd:"addMsgPin",response:[{type:"Number",name:"timetag"}]},"23_16":{service:"msgExtend",cmd:"updateMsgPin",response:[{type:"Number",name:"timetag"}]},"23_17":{service:"msgExtend",cmd:"deleteMsgPin",response:[{type:"Number",name:"timetag"}]},"23_18":{service:"msgExtend",cmd:"onAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_19":{service:"msgExtend",cmd:"onUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_20":{service:"msgExtend",cmd:"onDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_21":{service:"msgExtend",cmd:"getMsgPins",response:[{type:"Number",name:"timetag"},{type:"Boolean",name:"modify"},{type:"PropertyArray",name:"pins",entity:"msgPinRes"}]},"23_103":{service:"msgExtend",cmd:"syncAddQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_104":{service:"msgExtend",cmd:"syncDeleteQuickComment",response:[{type:"Property",name:"msg"},{type:"Property",name:"comment"}]},"23_112":{service:"msgExtend",cmd:"syncAddStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_113":{service:"msgExtend",cmd:"syncDeleteStickTopSession",response:[{type:"Number",name:"timetag"},{type:"Property",name:"stickTopSession"}]},"23_114":{service:"msgExtend",cmd:"syncUpdateStickTopSession",response:[{type:"Property",name:"stickTopSession"}]},"23_115":{service:"msgExtend",cmd:"syncAddMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_116":{service:"msgExtend",cmd:"syncUpdateMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"23_117":{service:"msgExtend",cmd:"syncDeleteMsgPin",response:[{type:"Property",name:"msg"},{type:"Property",name:"pinTag"},{type:"Number",name:"timetag"}]},"21_2":{service:"superTeam",cmd:"sendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_3":{service:"superTeam",cmd:"superTeamMsg",response:[{type:"Property",name:"msg"}]},"21_5":{service:"superTeam",cmd:"addSuperTeamMembers",response:[{type:"StrArray",name:"abortedAccidList"},{type:"long",name:"timetag"}]},"21_6":{service:"superTeam",cmd:"removeSuperTeamMembers"},"21_7":{service:"superTeam",cmd:"leaveSuperTeam"},"21_8":{service:"superTeam",cmd:"updateSuperTeam",response:[{type:"long",name:"timetag"}]},"21_9":{service:"superTeam",cmd:"getSuperTeam",response:[{type:"Property",name:"team"}]},"21_12":{service:"superTeam",cmd:"getSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_10":{service:"superTeam",cmd:"updateInfoInSuperTeam"},"21_13":{service:"superTeam",cmd:"getSuperTeamMembers",response:[{type:"long",name:"timetag"}]},"21_11":{service:"superTeam",cmd:"getMySuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_14":{service:"superTeam",cmd:"getSuperTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"21_15":{service:"superTeam",cmd:"getSuperTeamMembersByJoinTime",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_16":{service:"superTeam",cmd:"sendSuperTeamCustomSysMsg",trivialErrorCodes:[7101]},"21_17":{service:"superTeam",cmd:"onDeleteSuperTeamMsg"},"21_18":{service:"superTeam",cmd:"onSuperTeamMsgDelete",response:[{type:"Property",name:"sysMsg"}]},"21_19":{service:"superTeam",cmd:"superTeamCustomSysMsg",response:[{type:"Property",name:"sysMsg"}]},"21_20":{service:"superTeam",cmd:"applySuperTeam",response:[{type:"Property",name:"team"}]},"21_21":{service:"superTeam",cmd:"passSuperTeamApply"},"21_22":{service:"superTeam",cmd:"rejectSuperTeamApply"},"21_23":{service:"superTeam",cmd:"acceptSuperTeamInvite",response:[{type:"Property",name:"team"}]},"21_24":{service:"superTeam",cmd:"rejectSuperTeamInvite"},"21_25":{service:"superTeam",cmd:"onMarkSuperTeamSessionAck"},"21_26":{service:"superTeam",cmd:"addSuperTeamManagers"},"21_27":{service:"superTeam",cmd:"removeSuperTeamManagers"},"21_28":{service:"superTeam",cmd:"updateSuperTeamMute"},"21_29":{service:"superTeam",cmd:"updateSuperTeamMembersMute",response:[{type:"long",name:"timetag"}]},"21_30":{service:"superTeam",cmd:"updateNickInSuperTeam"},"21_31":{service:"superTeam",cmd:"transferSuperTeam"},"21_32":{service:"superTeam",cmd:"onMarkSuperTeamSessionsAck"},"21_33":{service:"superTeam",cmd:"getSuperTeamMembersByAccounts",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_34":{service:"superTeam",cmd:"getMutedSuperTeamMembers",response:[{type:"PropertyArray",name:"members",entity:"superTeamMember"}]},"21_113":{service:"superTeam",cmd:"syncSuperTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"superTeamMember"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_111":{service:"superTeam",cmd:"syncMySuperTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"superTeamMember"},{type:"long",name:"timetag"}]},"21_109":{service:"superTeam",cmd:"syncSuperTeams",response:[{type:"PropertyArray",name:"teams",entity:"superTeam"},{type:"bool",name:"isAll"},{type:"long",name:"timetag"}]},"21_101":{service:"superTeam",cmd:"syncCreateSuperTeam",response:[{type:"Property",name:"team"}]},"21_102":{service:"superTeam",cmd:"syncSendSuperTeamMsg",response:[{type:"Property",name:"msg"}]},"21_110":{service:"superTeam",cmd:"syncUpdateSuperTeamMember",response:[{type:"Property",name:"teamMember",entity:"superTeamMember"}]},"21_117":{service:"superTeam",cmd:"syncDeleteSuperTeamMsg",response:[{type:"Property",name:"sysMsg"}]},"21_125":{service:"superTeam",cmd:"syncMarkSuperTeamSessionAck",response:[{type:"Long",name:"to"},{type:"Long",name:"timetag"}]},"8_1":{service:"team",cmd:"createTeam",response:[{type:"Property",name:"team"},{type:"StrArray",name:"abortedAccidList"}]},"8_2":{service:"team",cmd:"sendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_3":{service:"team",cmd:"teamMsg",response:[{type:"Property",name:"msg"}]},"8_4":{service:"team",cmd:"teamMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_5":{service:"team",cmd:"addTeamMembers",response:[{type:"long",name:"time"},{type:"StrArray",name:"abortedAccidList"}]},"8_6":{service:"team",cmd:"removeTeamMembers"},"8_7":{service:"team",cmd:"updateTeam",response:[{type:"Number",name:"id"},{type:"Number",name:"time"}]},"8_8":{service:"team",cmd:"leaveTeam"},"8_9":{service:"team",cmd:"getTeam",response:[{type:"Property",name:"team"}]},"8_10":{service:"team",cmd:"getTeams",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"Number",name:"timetag"}]},"8_11":{service:"team",cmd:"getTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_12":{service:"team",cmd:"dismissTeam"},"8_13":{service:"team",cmd:"applyTeam",response:[{type:"Property",name:"team"}]},"8_14":{service:"team",cmd:"passTeamApply"},"8_15":{service:"team",cmd:"rejectTeamApply"},"8_16":{service:"team",cmd:"addTeamManagers"},"8_17":{service:"team",cmd:"removeTeamManagers"},"8_18":{service:"team",cmd:"transferTeam"},"8_19":{service:"team",cmd:"updateInfoInTeam"},"8_20":{service:"team",cmd:"updateNickInTeam"},"8_21":{service:"team",cmd:"acceptTeamInvite",response:[{type:"Property",name:"team"}]},"8_22":{service:"team",cmd:"rejectTeamInvite"},"8_23":{service:"team",cmd:"getTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_24":{service:"team",cmd:"searchTeamHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"8_25":{service:"team",cmd:"updateMuteStateInTeam"},"8_26":{service:"team",cmd:"getMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_27":{service:"team",cmd:"getMutedTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"teamMembers",entity:"teamMember"}]},"8_28":{service:"team",cmd:"sendTeamMsgReceipt",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_29":{service:"team",cmd:"getTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_30":{service:"team",cmd:"getTeamMsgReadAccounts",response:[{type:"Property",name:"teamMsgReceipt"},{type:"StrArray",name:"readAccounts"},{type:"StrArray",name:"unreadAccounts"}]},"8_31":{service:"team",cmd:"notifyTeamMsgReads",response:[{type:"PropertyArray",name:"teamMsgReceipts",entity:"teamMsgReceipt"}]},"8_32":{service:"team",cmd:"muteTeamAll",response:[]},"8_33":{service:"team",cmd:"getTeamMemberInvitorAccid",response:[{type:"object",name:"accountsMap"}]},"8_34":{service:"team",cmd:"getTeamsById",response:[{type:"PropertyArray",name:"teams",entity:"team"},{type:"StrArray",name:"tids"}],trivialErrorCodes:[816]},"8_126":{service:"team",cmd:"syncMyTeamMembers",response:[{type:"PropertyArray",name:"teamMembers",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_109":{service:"team",cmd:"syncTeams",response:[{type:"Number",name:"timetag"},{type:"PropertyArray",name:"teams",entity:"team"}]},"8_111":{service:"team",cmd:"syncTeamMembers",response:[{type:"Number",name:"teamId"},{type:"PropertyArray",name:"members",entity:"teamMember"},{type:"Number",name:"timetag"}]},"8_101":{service:"team",cmd:"syncCreateTeam",response:[{type:"Property",name:"team"}]},"8_102":{service:"team",cmd:"syncSendTeamMsg",response:[{type:"Property",name:"msg"}]},"8_119":{service:"team",cmd:"syncUpdateTeamMember",response:[{type:"Property",name:"teamMember"}]},"12_1":{service:"friend",cmd:"friendRequest"},"12_101":{service:"friend",cmd:"syncFriendRequest",response:[{type:"String",name:"account"},{type:"Number",name:"type"},{type:"String",name:"ps"}]},"12_2":{service:"friend",cmd:"deleteFriend"},"12_102":{service:"friend",cmd:"syncDeleteFriend",response:[{type:"String",name:"account"}]},"12_3":{service:"friend",cmd:"updateFriend"},"12_103":{service:"friend",cmd:"syncUpdateFriend",response:[{type:"Property",name:"friend"}]},"12_4":{service:"friend",cmd:"getFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_5":{service:"friend",cmd:"syncFriends",response:[{type:"PropertyArray",name:"friends",entity:"friend"},{type:"Number",name:"timetag"}]},"12_6":{service:"friend",cmd:"syncFriendUsers",response:[{type:"PropertyArray",name:"users",entity:"user"},{type:"Number",name:"timetag"}]},"13_1":{service:"chatroom",cmd:"getChatroomAddress",response:[{type:"StrArray",name:"address"}]},"14_1":{service:"eventService",cmd:"publishEvent",response:[{type:"Property",name:"msgEvent"}]},"14_2":{service:"eventService",cmd:"pushEvent",response:[{type:"Property",name:"msgEvent"}]},"14_3":{service:"eventService",cmd:"subscribeEvent",response:[{type:"StrArray",name:"accounts"}]},"14_4":{service:"eventService",cmd:"unSubscribeEventsByAccounts",response:[{type:"StrArray",name:"accounts"}]},"14_5":{service:"eventService",cmd:"unSubscribeEventsByType"},"14_6":{service:"eventService",cmd:"querySubscribeEventsByAccounts",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_7":{service:"eventService",cmd:"querySubscribeEventsByType",response:[{type:"PropertyArray",name:"msgEventSubscribes",entity:"msgEventSubscribe"}]},"14_9":{service:"eventService",cmd:"pushEvents",response:[{type:"PropertyArray",name:"msgEvents",entity:"msgEvent"}]},"22_1":{service:"proxyService",cmd:"httpProxy",response:[{type:"Property",name:"proxyTag"}]},"22_2":{service:"proxyService",cmd:"onProxyMsg",response:[{type:"Property",name:"proxyMsg",entity:"proxyMsgTag"}]},"24_1":{service:"qchat",cmd:"getQChatAddress",response:[{type:"StrArray",name:"address"}]},"101_1":{service:"filter",cmd:"sendFilterMsg",response:[{type:"Property",name:"msg"}]},"101_2":{service:"filter",cmd:"filterMsg",response:[{type:"Property",name:"msg"}]},"101_3":{service:"filter",cmd:"filterSysMsg",response:[{type:"Property",name:"sysMsg"}]},"101_7":{service:"filter",cmd:"sendFilterCustomSysMsg"}});o.exports={idMap:n,cmdConfig:u,packetConfig:p}},function(o,k){o.exports={negotiateTransportTag:{version:-1,serializeList:1,serialize:101},initTransportTag:{},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},login:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,token:1e3,customTag:38,customClientType:39,sdkHumanVersion:40,authType:115,loginExt:116},loginRes:{lastLoginDeviceId:17,customTag:38,connectionId:102,ip:103,port:104,country:106,hasXMPush:111},loginPort:{type:3,os:4,mac:5,deviceId:13,account:19,deviceInfo:32,connectionId:102,ip:103,time:109,customTag:38,customClientType:39},aosPushInfo:{pushType:110,hasTokenPreviously:111},sync:{myInfo:1,offlineMsgs:2,teams:3,netcallMsgs:6,roamingMsgs:7,relations:9,friends:11,sessions:12,friendUsers:13,msgReceipts:14,myTeamMembers:15,donnop:16,deleteMsg:17,sessionAck:18,robots:19,broadcastMsgs:20,avSignal:21,superTeams:22,myInfoInSuperTeams:23,superTeamRoamingMsgs:24,deleteSuperTeamMsg:25,superTeamSessionAck:26,deleteMsgSelf:27,stickTopSessions:28,sessionHistoryMsgsDelete:29,filterMsgs:100},donnop:{open:1},sessionReqTag:{minTimestamp:1,maxTimestamp:2,needLastMsg:3,limit:4,hasMore:5},session:{id:1,updateTime:2,ext:3,lastMsg:4},superTeam:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},superTeamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,createTime:10,updateTime:11,custom:12,mute:13,invitoraccid:14,joinTime:15},team:{teamId:1,name:3,type:4,owner:5,level:6,selfCustom:7,valid:8,memberNum:9,memberUpdateTime:10,createTime:11,updateTime:12,validToCurrentUser:13,intro:14,announcement:15,joinMode:16,bits:17,custom:18,serverCustom:19,avatar:20,beInviteMode:21,inviteMode:22,updateTeamMode:23,updateCustomMode:24,mute:100,muteType:101},teamMember:{teamId:1,account:3,type:4,nickInTeam:5,bits:7,active:8,valid:9,joinTime:10,updateTime:11,custom:12,mute:13,invitorAccid:14},msg:{scene:0,to:1,from:2,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,type:8,body:9,attach:10,idClient:11,idServer:12,resend:13,userUpdateTime:14,custom:15,pushPayload:16,pushContent:17,apnsAccounts:18,apnsContent:19,apnsForcePush:20,yidunEnable:21,antiSpamContent:22,antiSpamBusinessId:23,clientAntiSpam:24,antiSpamUsingYidun:25,needMsgReceipt:26,needUpdateSession:28,replyMsgFromAccount:29,replyMsgToAccount:30,replyMsgTime:31,replyMsgIdServer:32,replyMsgIdClient:33,threadMsgFromAccount:34,threadMsgToAccount:35,threadMsgTime:36,threadMsgIdServer:37,threadMsgIdClient:38,delete:39,callbackExt:40,subType:41,yidunAntiCheating:42,env:43,yidunAntiSpamExt:44,yidunAntiSpamRes:45,__clientExt:46,robotInfoFunction:47,robotInfoTopic:48,robotInfoCustomContent:49,robotInfoAccount:50,isHistoryable:100,isRoamingable:101,isSyncable:102,isMuted:104,cc:105,isInBlackList:106,isPushable:107,isOfflinable:108,isUnreadable:109,needPushNick:110,isReplyMsg:111,tempTeamMemberCount:112},threadMsgReq:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5},threadMsgsMeta:{total:1,lastMsgTime:2},comment:{from:1,body:2,time:3,custom:4,needPush:5,needBadge:6,pushTitle:7,apnsText:8,pushPayload:9},commentReq:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,timestamp:100},commentRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,detail:7,modify:8,timestamp:100},collect:{id:1,type:2,data:3,custom:4,uniqueId:5,createTime:6,updateTime:7},collectQuery:{beginTime:1,endTime:2,lastMsgId:3,limit:4,reverse:5,type:6},stickTopSession:{id:1,topCustom:2,createTime:3,updateTime:4},pinTag:{pinFrom:1,pinCustom:2,createTime:3,updateTime:4},msgPinReq:{sessionId:1,timetag:2},msgPinRes:{scene:1,from:2,to:3,time:4,idServer:5,idClient:6,pinFrom:7,pinCustom:8},msgReceipt:{to:1,from:2,time:7,idClient:11},teamMsgReceipt:{teamId:0,idServer:1,read:100,unread:101,idClient:102,account:103},deleteMsgSelfTag:{scene:1,from:2,to:3,idServer:4,idClient:5,time:6,deletedTime:7,custom:8},sysMsg:{time:0,type:1,to:2,from:3,ps:4,attach:5,idServer:6,sendToOnlineUsersOnly:7,apnsText:8,pushPayload:9,deletedIdClient:10,deletedIdServer:11,yidunEnable:12,antiSpamContent:13,deletedMsgTime:14,deletedMsgFromNick:15,opeAccount:16,env:21,idClient:23,callbackExt:22,cc:105,isPushable:107,isUnreadable:109,needPushNick:110},broadcastMsg:{broadcastId:1,fromAccid:2,fromUid:3,timestamp:4,body:5},friend:{account:4,flag:5,beflag:6,source:7,alias:8,bits:9,custom:10,createTime:11,updateTime:12,serverex:13},user:{account:1,nick:3,avatar:4,sign:5,gender:6,email:7,birth:8,tel:9,custom:10,createTime:12,updateTime:13},antispamTag:{antiSpamBusinessId:1},specialRelation:{account:0,isMuted:1,isBlacked:2,createTime:3,updateTime:4},msgType:{text:0,picture:1,audio:2,video:3,location:4,notification:5,file:6,netcall_audio:7,netcall_vedio:8,datatunnel_new:9,tips:10,robot:11,custom:100},msgEvent:{type:1,value:2,idClient:3,custom:4,validTime:5,broadcastType:6,sync:7,validTimeType:8,durable:9,time:10,idServer:11,clientType:12,serverConfig:13,serverCustom:14,appid:101,account:103,enableMultiClient:104,consid:106},msgEventSubscribe:{type:1,subscribeTime:2,sync:3,to:102,from:104,time:105},clearMsgsParams:{account:1,delRoam:2},clearMsgsParamsWithSync:{type:0,otherAccid:1,isDeleteRoam:2,toTid:3,isSyncSelf:4,fromAccid:5,time:6,ext:7},msgFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,sessionLimit:4,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},msgTimingFullSearchRequestTag:{keyword:1,fromTime:2,toTime:3,msgLimit:5,order:6,p2pList:7,teamList:8,senderList:9,msgTypeList:10,msgSubTypeList:11},delFriendParams:{delAlias:1},proxyTag:{zone:1,path:2,method:3,header:4,body:5},proxyMsgTag:{from:1,body:2,time:3},sessionAckTag:{scene:1,to:2,timetag:3},mixTokenReq:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},mixAuthTokenReq:{type:1,urls:2},notifyDetectTag:{type:1,params:2,result:3,t1:100,t2:101,t3:102,t4:103,t5:104,t6:105},getQChatAddressTag:{ipType:1}}},function(o,k){o.exports={negotiateTransportTag:{"-1":"version",1:"serializeList",101:"serialize"},initTransportTag:{},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},appGrayConfigTag:{0:"grayConfig",1:"ttl"},mixStorePolicyTag:{0:"providers",1:"ttl",2:"mixEnable",3:"nosPolicy",4:"s3Policy"},mixStoreTokenTag:{0:"provider",1:"accessKeyId",2:"secretAccessKey",3:"sessionToken",4:"token",5:"expireAt",6:"bucket",7:"objectName",8:"fileExpireSec",9:"tag",10:"shortUrl",11:"region"},notifyDetectTag:{1:"type",2:"params",3:"result",100:"t1",101:"t2",102:"t3",103:"t4",104:"t5",105:"t6"},backSourceTokenTag:{1:"type",2:"tokens",3:"token",4:"ttl"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time",25:"nertcChannelName",26:"nertcTokenTtl",27:"nertcToken",28:"nertcJoinRoomQueryParamMap",29:"nertcJoinRoomResponse",30:"callStatus"},login:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",39:"customClientType",40:"sdkHumanVersion",112:"isReactNative",115:"authType",116:"loginExt",1e3:"token"},loginRes:{17:"lastLoginDeviceId",38:"customTag",102:"connectionId",103:"ip",104:"port",106:"country",111:"hasXMPush"},loginPort:{3:"type",4:"os",5:"mac",13:"deviceId",19:"account",32:"deviceInfo",38:"customTag",39:"customClientType",102:"connectionId",103:"ip",109:"time"},aosPushInfo:{110:"pushType",111:"hasTokenPreviously"},sync:{1:"myInfo",2:"offlineMsgs",3:"teams",6:"netcallMsgs",7:"roamingMsgs",9:"relations",11:"friends",12:"sessions",13:"friendUsers",14:"msgReceipts",15:"myTeamMembers",16:"donnop",17:"deleteMsg",18:"sessionAck",19:"robots",20:"broadcastMsgs",21:"avSignal",22:"superTeams",23:"myInfoInSuperTeams",24:"superTeamRoamingMsgs",25:"deleteSuperTeamMsg",26:"superTeamSessionAck",27:"deleteMsgSelf",28:"stickTopSessions",29:"sessionHistoryMsgsDelete",100:"filterMsgs"},donnop:{1:"open"},sessionReqTag:{1:"minTimestamp",2:"maxTimestamp",3:"needLastMsg",4:"limit",5:"hasMore"},session:{1:"id",2:"updateTime",3:"ext",4:"lastMsg",5:"lastMsgType"},superTeam:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},superTeamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"createTime",11:"updateTime",12:"custom",13:"mute",14:"invitoraccid",15:"joinTime"},team:{1:"teamId",3:"name",4:"type",5:"owner",6:"level",7:"selfCustom",8:"valid",9:"memberNum",10:"memberUpdateTime",11:"createTime",12:"updateTime",13:"validToCurrentUser",14:"intro",15:"announcement",16:"joinMode",17:"bits",18:"custom",19:"serverCustom",20:"avatar",21:"beInviteMode",22:"inviteMode",23:"updateTeamMode",24:"updateCustomMode",100:"mute",101:"muteType",_20_safe:"_avatar_safe"},teamMember:{1:"teamId",3:"account",4:"type",5:"nickInTeam",7:"bits",8:"active",9:"valid",10:"joinTime",11:"updateTime",12:"custom",13:"mute",14:"invitorAccid"},msg:{0:"scene",1:"to",2:"from",4:"fromClientType",5:"fromDeviceId",6:"fromNick",7:"time",8:"type",9:"body",10:"attach",11:"idClient",12:"idServer",13:"resend",14:"userUpdateTime",15:"custom",16:"pushPayload",17:"pushContent",18:"apnsAccounts",19:"apnsContent",20:"apnsForcePush",21:"yidunEnable",22:"antiSpamContent",23:"antiSpamBusinessId",24:"clientAntiSpam",25:"antiSpamUsingYidun",26:"needMsgReceipt",28:"needUpdateSession",29:"replyMsgFromAccount",30:"replyMsgToAccount",31:"replyMsgTime",32:"replyMsgIdServer",33:"replyMsgIdClient",34:"threadMsgFromAccount",35:"threadMsgToAccount",36:"threadMsgTime",37:"threadMsgIdServer",38:"threadMsgIdClient",39:"delete",40:"callbackExt",41:"subType",42:"yidunAntiCheating",43:"env",44:"yidunAntiSpamExt",45:"yidunAntiSpamRes",46:"__clientExt",47:"robotInfoFunction",48:"robotInfoTopic",49:"robotInfoCustomContent",50:"robotInfoAccount",100:"isHistoryable",101:"isRoamingable",102:"isSyncable",104:"isMuted",105:"cc",106:"isInBlackList",107:"isPushable",108:"isOfflinable",109:"isUnreadable",110:"needPushNick",111:"isReplyMsg",112:"tempTeamMemberCount"},threadMsgReq:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse"},threadMsgsMeta:{1:"total",2:"lastMsgTime"},comment:{1:"from",2:"body",3:"time",4:"custom",5:"needPush",6:"needBadge",7:"pushTitle",8:"apnsText",9:"pushPayload"},commentReq:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",100:"timestamp"},commentRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"detail",8:"modify",100:"timestamp"},collect:{1:"id",2:"type",3:"data",4:"custom",5:"uniqueId",6:"createTime",7:"updateTime"},collectQuery:{1:"beginTime",2:"endTime",3:"lastMsgId",4:"limit",5:"reverse",6:"type"},stickTopSession:{1:"id",2:"topCustom",3:"createTime",4:"updateTime"},pinTag:{1:"pinFrom",2:"pinCustom",3:"createTime",4:"updateTime"},msgPinReq:{1:"sessionId",2:"timetag"},msgPinRes:{1:"scene",2:"from",3:"to",4:"time",5:"idServer",6:"idClient",7:"pinFrom",8:"pinCustom"},msgReceipt:{1:"to",2:"from",7:"time",11:"idClient"},teamMsgReceipt:{0:"teamId",1:"idServer",100:"read",101:"unread",102:"idClient",103:"account"},deleteMsgSelfTag:{1:"scene",2:"from",3:"to",4:"idServer",5:"idClient",6:"time",7:"deletedTime",8:"custom"},sysMsg:{0:"time",1:"type",2:"to",3:"from",4:"ps",5:"attach",6:"idServer",7:"sendToOnlineUsersOnly",8:"apnsText",9:"pushPayload",10:"deletedIdClient",11:"deletedIdServer",12:"yidunEnable",13:"antiSpamContent",14:"deletedMsgTime",15:"deletedMsgFromNick",16:"opeAccount",21:"env",22:"callbackExt",23:"idClient",105:"cc",107:"isPushable",109:"isUnreadable",110:"needPushNick"},broadcastMsg:{1:"broadcastId",2:"fromAccid",3:"fromUid",4:"timestamp",5:"body"},friend:{4:"account",5:"flag",6:"beflag",7:"source",8:"alias",9:"bits",10:"custom",11:"createTime",12:"updateTime",13:"serverex"},user:{1:"account",3:"nick",4:"avatar",5:"sign",6:"gender",7:"email",8:"birth",9:"tel",10:"custom",12:"createTime",13:"updateTime",_4_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},specialRelation:{0:"account",1:"isMuted",2:"isBlacked",3:"createTime",4:"updateTime"},msgType:{0:"text",1:"picture",2:"audio",3:"video",4:"location",5:"notification",6:"file",7:"netcall_audio",8:"netcall_vedio",9:"datatunnel_new",10:"tips",11:"robot",100:"custom"},msgEvent:{1:"type",2:"value",3:"idClient",4:"custom",5:"validTime",6:"broadcastType",7:"sync",8:"validTimeType",9:"durable",10:"time",11:"idServer",12:"clientType",13:"serverConfig",14:"serverCustom",101:"appid",103:"account",104:"enableMultiClient",106:"consid"},msgEventSubscribe:{1:"type",2:"subscribeTime",3:"sync",102:"to",104:"from",105:"time"},clearMsgsParams:{1:"account",2:"delRoam"},clearMsgsParamsWithSync:{0:"type",1:"otherAccid",2:"delRoam",3:"toTid",4:"isSyncSelf",5:"fromAccid",6:"time",7:"ext"},msgFullSearchRequestTag:{1:"keyword",2:"fromTime",3:"toTime",4:"sessionLimit",5:"msgLimit",6:"order",7:"p2pList",8:"teamList",9:"senderList",10:"msgTypeList",11:"msgSubTypeList"},delFriendParams:{1:"delAlias"},proxyTag:{1:"zone",2:"path",3:"method",4:"header",5:"body"},proxyMsgTag:{1:"from",2:"body",3:"time"},sessionReliableSyncTag:{1:"scene",2:"sessionId",3:"syncStatus",4:"syncEndMsgId",5:"syncEndMsgidClient",6:"syncEndMsgTime",7:"syncStartMsgid",8:"syncStartMsgidClient",9:"syncStartMsgTime",10:"nextMsgid",11:"nextMsgidClient",12:"nextMsgTime",13:"roamMsgSync",14:"offlineMsgSync",15:"netCallOfflineMsgSync"},sessionReliableSyncContextTag:{1:"timetag",2:"type"}}},function(o,k,e){var r=e(0),i=e(191),s=r.merge({},i.idMap,{chatroom:{id:13,login:2,kicked:3,logout:4,sendMsg:6,msg:7,getChatroomMembers:8,getHistoryMsgs:9,markChatroomMember:11,closeChatroom:12,getChatroom:13,updateChatroom:14,updateMyChatroomMemberInfo:15,getChatroomMembersInfo:16,kickChatroomMember:17,updateChatroomMemberTempMute:19,queueOffer:20,queuePoll:21,queueList:22,peak:23,queueDrop:24,queueInit:25,queueChange:26,updateTagMembersTempMute:30,getChatroomMembersByTag:31,getChatroomMemberCountByTag:32,updateCoordinate:33,updateChatroomTags:34,sendChatroomMsgAck:35,getHistoryMsgsByTags:36,notifyCdnInfo:99},user:{id:3,syncRobot:16}}),n=r.merge({},i.cmdConfig,{login:{sid:s.chatroom.id,cid:s.chatroom.login,params:[{type:"byte",name:"type"},{type:"Property",name:"login"},{type:"Property",name:"imLogin"}]},logout:{sid:s.chatroom.id,cid:s.chatroom.logout},sendMsg:{sid:s.chatroom.id,cid:s.chatroom.sendMsg,params:[{type:"Property",name:"msg"}]},getChatroomMembers:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembers,params:[{type:"byte",name:"type"},{type:"long",name:"time"},{type:"int",name:"limit"}]},getHistoryMsgs:{sid:s.chatroom.id,cid:s.chatroom.getHistoryMsgs,params:[{type:"long",name:"timetag"},{type:"int",name:"limit"},{type:"bool",name:"reverse"},{type:"LongArray",name:"msgTypes"}]},markChatroomMember:{sid:s.chatroom.id,cid:s.chatroom.markChatroomMember,params:[{type:"string",name:"account"},{type:"int",name:"type"},{type:"bool",name:"isAdd"},{type:"int",name:"level"},{type:"string",name:"custom"}]},closeChatroom:{sid:s.chatroom.id,cid:s.chatroom.closeChatroom,params:[{type:"string",name:"custom"}]},getChatroom:{sid:s.chatroom.id,cid:s.chatroom.getChatroom},updateChatroom:{sid:s.chatroom.id,cid:s.chatroom.updateChatroom,params:[{type:"Property",name:"chatroom"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"Property",name:"antispamTag"}]},updateMyChatroomMemberInfo:{sid:s.chatroom.id,cid:s.chatroom.updateMyChatroomMemberInfo,params:[{type:"Property",name:"chatroomMember"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"},{type:"bool",name:"needSave"},{type:"Property",name:"antispamTag"}]},getChatroomMembersInfo:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembersInfo,params:[{type:"StrArray",name:"accounts"}]},kickChatroomMember:{sid:s.chatroom.id,cid:s.chatroom.kickChatroomMember,params:[{type:"string",name:"account"},{type:"string",name:"custom"}]},updateChatroomMemberTempMute:{sid:s.chatroom.id,cid:s.chatroom.updateChatroomMemberTempMute,params:[{type:"String",name:"account"},{type:"long",name:"duration"},{type:"bool",name:"needNotify"},{type:"String",name:"custom"}]},queueOffer:{sid:s.chatroom.id,cid:s.chatroom.queueOffer,params:[{type:"string",name:"elementKey"},{type:"string",name:"elementValue"},{type:"bool",name:"transient"},{type:"string",name:"elementAccount"}]},queuePoll:{sid:s.chatroom.id,cid:s.chatroom.queuePoll,params:[{type:"string",name:"elementKey"}]},queueList:{sid:s.chatroom.id,cid:s.chatroom.queueList},peak:{sid:s.chatroom.id,cid:s.chatroom.peak},queueDrop:{sid:s.chatroom.id,cid:s.chatroom.queueDrop},queueInit:{sid:s.chatroom.id,cid:s.chatroom.queueInit,params:[{type:"int",name:"limit"}]},queueChange:{sid:s.chatroom.id,cid:s.chatroom.queueChange,params:[{type:"StrStrMap",name:"elementMap"},{type:"bool",name:"needNotify"},{type:"string",name:"notifyExt"}]},updateTagMembersTempMute:{sid:s.chatroom.id,cid:s.chatroom.updateTagMembersTempMute,params:[{type:"Property",name:"tagMuteReq"}]},updateCoordinate:{sid:s.chatroom.id,cid:s.chatroom.updateCoordinate,params:[{type:"Property",name:"coordinateReq"}]},getChatroomMemberCountByTag:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMemberCountByTag,params:[{type:"String",name:"tag"}]},getChatroomMembersByTag:{sid:s.chatroom.id,cid:s.chatroom.getChatroomMembersByTag,params:[{type:"Property",name:"tagMemberReq"}]},updateChatroomTags:{sid:s.chatroom.id,cid:s.chatroom.updateChatroomTags,params:[{type:"Property",name:"chatRoomTagsUpdateTag"}]},sendChatroomMsgAck:{sid:s.chatroom.id,cid:s.chatroom.sendChatroomMsgAck,params:[{type:"Property",name:"chatRoomMsgAckTag"}]},getHistoryMsgsByTags:{sid:s.chatroom.id,cid:s.chatroom.getHistoryMsgsByTags,params:[{type:"Property",name:"chatRoomTagHistoryMsgRequestTag"}]},notifyCdnInfo:{sid:s.chatroom.id,cid:s.chatroom.notifyCdnInfo},syncRobot:{sid:s.user.id,cid:s.user.syncRobot,params:[{type:"long",name:"timetag"}]}}),u=r.merge({},i.packetConfig,{"4_10":{service:"notify"},"4_11":{service:"notify"},"3_16":{service:"chatroom",cmd:"syncRobot",response:[{type:"PropertyArray",name:"robots",entity:"robot"}]},"13_2":{service:"chatroom",cmd:"login",response:[{type:"Property",name:"chatroom"},{type:"Property",name:"chatroomMember"},{type:"Property",name:"chatroomCdnInfo"}]},"13_3":{service:"chatroom",cmd:"kicked",response:[{type:"Number",name:"reason"},{type:"String",name:"custom"}]},"13_4":{service:"chatroom",cmd:"logout"},"13_6":{service:"chatroom",cmd:"sendMsg",response:[{type:"Property",name:"msg"}]},"13_7":{service:"chatroom",cmd:"msg",response:[{type:"Property",name:"msg"}]},"13_8":{service:"chatroom",cmd:"getChatroomMembers",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_9":{service:"chatroom",cmd:"getHistoryMsgs",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_11":{service:"chatroom",cmd:"markChatroomMember",response:[{type:"Property",name:"chatroomMember"}]},"13_12":{service:"chatroom",cmd:"closeChatroom"},"13_13":{service:"chatroom",cmd:"getChatroom",response:[{type:"Property",name:"chatroom"}]},"13_14":{service:"chatroom",cmd:"updateChatroom"},"13_15":{service:"chatroom",cmd:"updateMyChatroomMemberInfo"},"13_16":{service:"chatroom",cmd:"getChatroomMembersInfo",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_17":{service:"chatroom",cmd:"kickChatroomMember"},"13_19":{service:"chatroom",cmd:"updateChatroomMemberTempMute"},"13_20":{service:"chatroom",cmd:"queueOffer"},"13_21":{service:"chatroom",cmd:"queuePoll",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_22":{service:"chatroom",cmd:"queueList",response:[{type:"KVArray",name:"queueList"}]},"13_23":{service:"chatroom",cmd:"peak",response:[{type:"String",name:"elementKey"},{type:"String",name:"elementValue"}]},"13_24":{service:"chatroom",cmd:"queueDrop"},"13_25":{service:"chatroom",cmd:"queueInit"},"13_26":{service:"chatroom",cmd:"queueChange",response:[{type:"StrArray",name:"elementKeyArray"}]},"13_30":{service:"chatroom",cmd:"updateTagMembersTempMute"},"13_33":{service:"chatroom",cmd:"updateCoordinate"},"13_31":{service:"chatroom",cmd:"getChatroomMembersByTag",response:[{type:"PropertyArray",name:"members",entity:"chatroomMember"}]},"13_32":{service:"chatroom",cmd:"getChatroomMemberCountByTag",response:[{type:"long",name:"count"}]},"13_34":{service:"chatroom",cmd:"updateChatroomTags"},"13_36":{service:"chatroom",cmd:"getHistoryMsgsByTags",response:[{type:"PropertyArray",name:"msgs",entity:"msg"}]},"13_99":{service:"chatroom",cmd:"notifyCdnInfo",response:[{type:"Property",name:"chatroomCdnInfo"}]},"13_101":{service:"chatroom",cmd:"updateChatroomTag",response:[{type:"Property",name:"updateTags"}]}});o.exports={idMap:s,cmdConfig:n,packetConfig:u}},function(o,k){o.exports={imLogin:{clientType:3,os:4,sdkVersion:6,appLogin:8,protocolVersion:9,pushTokenName:10,pushToken:11,deviceId:13,appKey:18,account:19,browser:24,session:26,deviceInfo:32,sdkType:41,userAgent:42,isReactNative:112,authType:115,loginExt:116,token:1e3,customTag:38},nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},audioToText:{url:2},imageOp:{type:0,stripmeta:1,typeType:2,blurRadius:3,blurSigma:4,qualityQuality:5,cropX:6,cropY:7,cropWidth:8,cropHeight:9,rotateAngle:10,pixelPixel:11,thumbnailMode:12,thumbnailWidth:13,thumbnailHeight:14,thumbnailAxisX:15,thumbnailAxisY:16,thumbnailCenterX:17,thumbnailCenterY:18,thumbnailEnlarge:19,thumbnailToStatic:20,watermarkType:21,watermarkGravity:22,watermarkDissolve:23,watermarkDx:24,watermarkDy:25,watermarkImage:26,watermarkText:27,watermarkFont:28,watermarkFontSize:29,watermarkFontColor:30,interlace:31},robot:{account:4,nick:5,avatar:6,intro:7,config:8,valid:9,createTime:10,updateTime:11,custid:12,botid:13,bindTime:14},clientAntispam:{version:1,md5:2,nosurl:3,thesaurus:4},fileQuickTransfer:{md5:1,url:2,size:3,threshold:4},transToken:{name:1,type:2,transType:3,size:4,extra:5,body:6},transInfo:{docId:1,name:2,prefix:3,size:4,type:5,state:6,transType:7,transSize:8,pageCount:9,picInfo:10,extra:11,flag:12},nosFileUrlTag:{safeUrl:0,originUrl:1},nosAccessTokenTag:{token:0,url:1,userAgent:2,ext:3},fileListParam:{fromDocId:1,limit:2},avSignalTag:{type:1,channelName:2,channelId:3,channelCreateTime:4,channelExpireTime:5,creator:6,ext:7,channelInValid:8,from:10,to:11,requestId:12,needPush:13,pushTitle:14,pushContent:15,pushPayload:16,needBadge:17,members:18,attach:19,attachExt:20,isSave:21,msgid:22,uid:23,time:24,nertcChannelName:25,nertcTokenTtl:26,nertcToken:27,nertcJoinRoomQueryParamMap:28,nertcJoinRoomResponse:29,callStatus:30},login:{appKey:1,account:2,deviceId:3,chatroomId:5,appLogin:8,chatroomNick:20,chatroomAvatar:21,chatroomCustom:22,chatroomEnterCustom:23,session:26,isAnonymous:38,tags:39,notifyTargetTags:40,loginAuthType:41,loginExt:42,loc_x:43,loc_y:44,loc_z:45,distance:46,antiSpamBusinessId:47},chatroom:{id:1,name:3,announcement:4,broadcastUrl:5,custom:12,createTime:14,updateTime:15,queuelevel:16,creator:100,onlineMemberNum:101,mute:102},msg:{idClient:1,type:2,attach:3,custom:4,resend:5,userUpdateTime:6,fromNick:7,fromAvatar:8,fromCustom:9,yidunEnable:10,antiSpamContent:11,skipHistory:12,body:13,antiSpamBusinessId:14,clientAntiSpam:15,antiSpamUsingYidun:16,time:20,from:21,chatroomId:22,fromClientType:23,highPriority:25,callbackExt:27,subType:28,yidunAntiCheating:29,env:30,notifyTargetTags:31,yidunAntiSpamExt:32,yidunAntiSpamRes:33,loc_x:34,loc_y:35,loc_z:36,toAccids:37,needHighPriorityMsgAck:38,__clientExt:39},chatroomMember:{chatroomId:1,account:2,type:3,level:4,nick:5,avatar:6,custom:7,online:8,guest:9,enterTime:10,blacked:12,gaged:13,valid:14,updateTime:15,tempMuted:16,tempMuteDuration:17},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{enable:1,cdnUrls:2,timestamp:3,interval:4,decryptType:5,decryptKey:6,timeout:7},tagMemberReq:{tag:1,time:2,limit:3},tagMuteReq:{tag:1,duration:2,needNotify:3,custom:4,notifyTargetTags:5},coordinateReq:{x:1,y:2,z:3,distance:4},chatRoomTagsUpdateTag:{tags:1,notifyTargetTags:2,needNotify:3,ext:4},chatRoomMsgAckTag:{idClient:1,chatroomId:2},chatRoomTagHistoryMsgRequestTag:{tags:1,types:2,fromTime:3,toTime:4,limit:5,reverse:6}}},function(o,k){o.exports={imLogin:{3:"clientType",4:"os",6:"sdkVersion",8:"appLogin",9:"protocolVersion",10:"pushTokenName",11:"pushToken",13:"deviceId",18:"appKey",19:"account",24:"browser",26:"session",32:"deviceInfo",38:"customTag",41:"sdkType",42:"userAgent",112:"isReactNative",1e3:"token"},nosToken:{1:"objectName",2:"token",3:"bucket",4:"expireTime",7:"expireSec",8:"tag",9:"shortUrl"},audioToText:{2:"url"},imageOp:{0:"type",1:"stripmeta",2:"typeType",3:"blurRadius",4:"blurSigma",5:"qualityQuality",6:"cropX",7:"cropY",8:"cropWidth",9:"cropHeight",10:"rotateAngle",11:"pixelPixel",12:"thumbnailMode",13:"thumbnailWidth",14:"thumbnailHeight",15:"thumbnailAxisX",16:"thumbnailAxisY",17:"thumbnailCenterX",18:"thumbnailCenterY",19:"thumbnailEnlarge",20:"thumbnailToStatic",21:"watermarkType",22:"watermarkGravity",23:"watermarkDissolve",24:"watermarkDx",25:"watermarkDy",26:"watermarkImage",27:"watermarkText",28:"watermarkFont",29:"watermarkFontSize",30:"watermarkFontColor",31:"interlace"},robot:{4:"account",5:"nick",6:"avatar",7:"intro",8:"config",9:"valid",10:"createTime",11:"updateTime",12:"custid",13:"botid",14:"bindTime",_6_safe:"_avatar_safe"},clientAntispam:{1:"version",2:"md5",3:"nosurl",4:"thesaurus"},fileQuickTransfer:{1:"md5",2:"url",3:"size",4:"threshold",_2_safe:"_url_safe"},transToken:{1:"name",2:"type",3:"transType",4:"size",5:"extra",6:"body"},transInfo:{1:"docId",2:"name",3:"prefix",4:"size",5:"type",6:"state",7:"transType",8:"transSize",9:"pageCount",10:"picInfo",11:"extra",12:"flag"},nosFileUrlTag:{0:"safeUrl",1:"originUrl"},nosAccessTokenTag:{0:"token",1:"url",2:"userAgent",3:"ext"},fileListParam:{1:"fromDocId",2:"limit"},avSignalTag:{1:"type",2:"channelName",3:"channelId",4:"channelCreateTime",5:"channelExpireTime",6:"creator",7:"ext",8:"channelInValid",10:"from",11:"to",12:"requestId",13:"needPush",14:"pushTitle",15:"pushContent",16:"pushPayload",17:"needBadge",18:"members",19:"attach",20:"attachExt",21:"isSave",22:"msgid",23:"uid",24:"time",25:"nertcChannelName",26:"nertcTokenTtl",27:"nertcToken",28:"nertcJoinRoomQueryParamMap",29:"nertcJoinRoomResponse",30:"callStatus"},login:{1:"appKey",2:"account",3:"deviceId",5:"chatroomId",8:"appLogin",20:"chatroomNick",21:"chatroomAvatar",22:"chatroomCustom",23:"chatroomEnterCustom",26:"session",38:"isAnonymous",39:"tags",40:"notifyTargetTags",41:"loginAuthType",42:"loginExt",43:"loc_x",44:"loc_y",45:"loc_z",46:"distance",47:"antiSpamBusinessId",_21_safe:"_chatroomAvatar_safe"},chatroom:{1:"id",3:"name",4:"announcement",5:"broadcastUrl",12:"custom",14:"createTime",15:"updateTime",16:"queuelevel",100:"creator",101:"onlineMemberNum",102:"mute"},msg:{1:"idClient",2:"type",3:"attach",4:"custom",5:"resend",6:"userUpdateTime",7:"fromNick",8:"fromAvatar",9:"fromCustom",10:"yidunEnable",11:"antiSpamContent",12:"skipHistory",13:"body",14:"antiSpamBusinessId",15:"clientAntiSpam",16:"antiSpamUsingYidun",20:"time",21:"from",22:"chatroomId",23:"fromClientType",25:"highPriority",27:"callbackExt",28:"subType",29:"yidunAntiCheating",30:"env",31:"notifyTargetTags",32:"yidunAntiSpamExt",33:"yidunAntiSpamRes",34:"loc_x",35:"loc_y",36:"loc_z",37:"toAccids",38:"needHighPriorityMsgAck",39:"__clientExt",_8_safe:"_fromAvatar_safe"},chatroomMember:{1:"chatroomId",2:"account",3:"type",4:"level",5:"nick",6:"avatar",7:"custom",8:"online",9:"guest",10:"enterTime",12:"blacked",13:"gaged",14:"valid",15:"updateTime",16:"tempMuted",17:"tempMuteDuration",_6_safe:"_avatar_safe"},antispamTag:{antiSpamBusinessId:1},chatroomCdnInfo:{1:"enable",2:"cdnUrls",3:"timestamp",4:"interval",5:"decryptType",6:"decryptKey",7:"timeout"},nosConfigTag:{1:"bucket",2:"cdnDomain",3:"expire",4:"objectNamePrefix"},updateTags:{1:"currentTags"}}},function(o,k,e){o.exports=e(783)},function(o,k){o.exports=function(e,r){(r==null||r>e.length)&&(r=e.length);for(var i=0,s=new Array(r);i<r;i++)s[i]=e[i];return s},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(787)},function(o,k,e){var r=e(308),i=e(745),s=e(744);o.exports=function(n,u){var p;if(n){if(typeof n=="string")return s(n,u);var d=r(p=Object.prototype.toString.call(n)).call(p,8,-1);return d==="Object"&&n.constructor&&(d=n.constructor.name),d==="Map"||d==="Set"?i(n):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?s(n,u):void 0}},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(791)},function(o,k,e){var r=e(5),i=e(41),s=e(0),n=s.notundef,u={addFriend:1,applyFriend:2,passFriendApply:3,rejectFriendApply:4},p={1:"addFriend",2:"applyFriend",3:"passFriendApply",4:"rejectFriendApply"};function d(m){s.verifyOptions(m,"account","friend::Friend"),s.verifyParamAtLeastPresentOne(m,"alias custom","friend::Friend"),this.account=m.account,n(m.alias)&&(this.alias=m.alias),n(m.custom)&&(this.custom=m.custom)}d.reverse=function(m){var c=s.filterObj(m,"account alias custom createTime updateTime serverex");return n(m.flag)&&(c.valid=m.flag==="1"),n(c.createTime)&&(c.createTime=+c.createTime),n(c.updateTime)&&(c.updateTime=+c.updateTime),c},d.validTypes=function(){return r(u)},d.getByteFromType=function(m){return u[m]},d.getTypeFromByte=function(m){return p[m]},d.assembleFriend=function(m){var c=+new Date;return i({},m,{alias:"",createTime:c,custom:"",updateTime:c,valid:!0})},o.exports=d},function(o,k,e){var r=e(750),i=e(41),s=e(0),n=s.notundef;function u(p,d){r(p.body)||s.onParamError("body只能是整数",d),this.body=p.body,this.from=p.from||"",this.custom=p.custom||"",n(p.pushTitle)&&(this.pushTitle=p.pushTitle),n(p.apnsText)&&(this.apnsText=p.apnsText),n(p.pushPayload)&&(this.pushPayload=p.pushPayload),n(p.needPush)&&(this.needPush=p.needPush===!0?1:0),n(p.needBadge)&&(this.needBadge=p.needBadge===!0?1:0)}u.reverse=function(p){var d=i({},p);return n(p.needBadge)&&(d.needBadge=+p.needBadge==1),n(p.needPush)&&(d.needPush=+p.needPush==1),d.body=+p.body,d.time=+p.time,d},o.exports=u},function(o,k,e){o.exports=e(809)},function(o,k,e){var r=e(750),i=e(41),s=e(0);function n(u,p){r(u.type)||s.onParamError("Collect.type只能是整数",p),s.notundef(u.uniqueId)&&(this.uniqueId=u.uniqueId),this.type=u.type,this.data=u.data||"",this.custom=u.custom||""}n.reverse=function(u){var p=i({},u);return p.type=+p.type,p.createTime=+p.createTime,p.updateTime=+p.updateTime,p},o.exports=n},function(o,k,e){var r=e(817),i=e(818),s=e(746),n=e(819);o.exports=function(u,p){return r(u)||i(u,p)||s(u,p)||n()},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(754),i=e(755),s=e(756),n=e(757);function u(m,c,h){var a=m;return i(c)?(h=c,typeof m=="string"&&(a={uri:m})):a=n(c,{uri:m}),a.callback=h,a}function p(m,c,h){return d(c=u(m,c,h))}function d(m){if(m.callback===void 0)throw new Error("callback argument missing");var c=!1,h=function(L,_,C){c||(c=!0,m.callback(L,_,C))};function a(){var L=void 0;if(L=b.response?b.response:b.responseText||function(_){try{if(_.responseType==="document")return _.responseXML;var C=_.responseXML&&_.responseXML.documentElement.nodeName==="parsererror";if(_.responseType===""&&!C)return _.responseXML}catch{}return null}(b),P)try{L=JSON.parse(L)}catch{}return L}function y(L){return clearTimeout(S),L instanceof Error||(L=new Error(""+(L||"Unknown XMLHttpRequest Error"))),L.statusCode=0,h(L,x)}function T(){if(!g){var L;clearTimeout(S),L=m.useXDR&&b.status===void 0?200:b.status===1223?204:b.status;var _=x,C=null;return L!==0?(_={body:a(),statusCode:L,method:I,headers:{},url:O,rawRequest:b},b.getAllResponseHeaders&&(_.headers=s(b.getAllResponseHeaders()))):C=new Error("Internal XMLHttpRequest Error"),h(C,_,_.body)}}var v,g,b=m.xhr||null;b||(b=m.cors||m.useXDR?new p.XDomainRequest:new p.XMLHttpRequest);var S,O=b.url=m.uri||m.url,I=b.method=m.method||"GET",R=m.body||m.data,N=b.headers=m.headers||{},F=!!m.sync,P=!1,x={body:void 0,headers:{},statusCode:0,method:I,url:O,rawRequest:b};if("json"in m&&m.json!==!1&&(P=!0,N.accept||N.Accept||(N.Accept="application/json"),I!=="GET"&&I!=="HEAD"&&(N["content-type"]||N["Content-Type"]||(N["Content-Type"]="application/json"),R=JSON.stringify(m.json===!0?R:m.json))),b.onreadystatechange=function(){b.readyState===4&&setTimeout(T,0)},b.onload=T,b.onerror=y,b.onprogress=function(){},b.onabort=function(){g=!0},b.ontimeout=y,b.open(I,O,!F,m.username,m.password),F||(b.withCredentials=!!m.withCredentials),!F&&m.timeout>0&&(S=setTimeout(function(){if(!g){g=!0,b.abort("timeout");var L=new Error("XMLHttpRequest timeout");L.code="ETIMEDOUT",y(L)}},m.timeout)),b.setRequestHeader)for(v in N)N.hasOwnProperty(v)&&b.setRequestHeader(v,N[v]);else if(m.headers&&!function(L){for(var _ in L)if(L.hasOwnProperty(_))return!1;return!0}(m.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in m&&(b.responseType=m.responseType),"beforeSend"in m&&typeof m.beforeSend=="function"&&m.beforeSend(b),b.send(R||null),b}o.exports=p,o.exports.default=p,p.XMLHttpRequest=r.XMLHttpRequest||function(){},p.XDomainRequest="withCredentials"in new p.XMLHttpRequest?p.XMLHttpRequest:r.XDomainRequest,function(m,c){for(var h=0;h<m.length;h++)c(m[h])}(["get","put","post","patch","head","delete"],function(m){p[m==="delete"?"del":m]=function(c,h,a){return(h=u(c,h,a)).method=m.toUpperCase(),d(h)}})},function(o,k,e){(function(r){var i;i=typeof window<"u"?window:r!==void 0?r:typeof self<"u"?self:{},o.exports=i}).call(this,e(70))},function(o,k){o.exports=function(r){if(!r)return!1;var i=e.call(r);return i==="[object Function]"||typeof r=="function"&&i!=="[object RegExp]"||typeof window<"u"&&(r===window.setTimeout||r===window.alert||r===window.confirm||r===window.prompt)};var e=Object.prototype.toString},function(o,k){var e=function(r){return r.replace(/^\s+|\s+$/g,"")};o.exports=function(r){if(!r)return{};for(var i,s={},n=e(r).split(`
`),u=0;u<n.length;u++){var p=n[u],d=p.indexOf(":"),m=e(p.slice(0,d)).toLowerCase(),c=e(p.slice(d+1));s[m]===void 0?s[m]=c:(i=s[m],Object.prototype.toString.call(i)==="[object Array]"?s[m].push(c):s[m]=[s[m],c])}return s}},function(o,k){o.exports=function(){for(var r={},i=0;i<arguments.length;i++){var s=arguments[i];for(var n in s)e.call(s,n)&&(r[n]=s[n])}return r};var e=Object.prototype.hasOwnProperty},function(o,k,e){var r=e(26),i=e(123),s=e(7),n=e(10);function u(p){var d=this,m=p.url||null;d.level={debug:0,log:1,info:2,warn:3,error:4}[p.level]||0,d.logCache=[],d.logNum=1,d.timeInterval=5e3,window.onerror=function(c,h,a,y,T){d.error(T)},i(function(){d.logCache.length>0&&m&&d.postLogs(m,d.logCache)},d.timeInterval)}u.prototype.debug=function(){var p;this.level>0||(console.debug.apply(this,arguments),this.cacheLogs.apply(this,s(p=["[degbug]"]).call(p,arguments)))},u.prototype.log=function(){var p;this.level>1||(console.log.apply(this,arguments),this.cacheLogs.apply(this,s(p=["[log]"]).call(p,arguments)))},u.prototype.info=function(){var p;this.level>2||(console.info.apply(this,arguments),this.cacheLogs.apply(this,s(p=["[info]"]).call(p,arguments)))},u.prototype.warn=function(){var p;this.level>3||(console.warn.apply(this,arguments),this.cacheLogs.apply(this,s(p=["[warn]"]).call(p,arguments)))},u.prototype.error=function(){var p;this.level>4||(console.error.apply(this,arguments),this.cacheLogs.apply(this,s(p=["[error]"]).call(p,arguments)))},u.prototype.cacheLogs=function(p,d){for(var m=[],c=0;c<d.length;c++){var h=d[c];r(h)==="object"?m.push(n(h)):m.push(h)}var a=this.logNum+++" "+p+" "+m.join("; ");this.logCache.push(a.replace("%c",""))},u.prototype.postLogs=function(p,d){var m=this,c=new XMLHttpRequest;c.onreadystatechange=function(){c.readyState===4&&(c.status===200?(console.info("LoggerPlugin::日志上报完成"),m.logCache=[],m.timeInterval=5e3):m.timeInterval+=5e3)},c.open("POST",p),c.setRequestHeader("Content-Type","plain/text;charset=utf-8"),c.timeout=360,c.send(d.join(`
`))},o.exports=u},function(o,k,e){var r=e(3),i=e(44);o.exports=function(s){var n,u,p,d;s.db&&(i.db=s.db),s.rnfs&&(i.rnfs=s.rnfs,i.rnfs.size||(i.rnfs.size=1048576),i.rnfs.nimPromise=(n=i.rnfs,u=n.size/2-256,d=0,p=i.rnfs.DocumentDirectoryPath+"/nimlog_"+d+".log",n.exists(p).then(function(m){return m?n.stat(p):r.reject(0)}).then(function(m){return m&&m.size>u?r.reject(1):r.reject(0)}).catch(function(m){return typeof m=="number"&&(n.nimIndex=m),r.resolve()})))}},function(o,k,e){var r=e(52),i=e(0),s=i.notundef,n=i.undef;function u(p){s(p.name)&&(this.name=""+p.name),s(p.announcement)&&(this.announcement=""+p.announcement),s(p.broadcastUrl)&&(this.broadcastUrl=""+p.broadcastUrl),s(p.custom)&&(this.custom=""+p.custom),s(p.queuelevel)&&(this.queuelevel=r(p.queuelevel))}u.reverse=function(p){var d=i.copy(p);return n(d.announcement)&&(d.announcement=""),n(d.broadcastUrl)&&(d.broadcastUrl=""),n(d.custom)&&(d.custom=""),s(d.createTime)&&(d.createTime=+d.createTime),s(d.updateTime)&&(d.updateTime=+d.updateTime),s(d.onlineMemberNum)&&(d.onlineMemberNum=+d.onlineMemberNum),s(d.mute)&&(d.mute=d.mute==="1"),d},o.exports=u},function(o,k,e){var r,i,s;o.exports=(s=e(89),i=(r=s).lib.WordArray,r.enc.Base64={stringify:function(n){var u=n.words,p=n.sigBytes,d=this._map;n.clamp();for(var m=[],c=0;c<p;c+=3)for(var h=(u[c>>>2]>>>24-c%4*8&255)<<16|(u[c+1>>>2]>>>24-(c+1)%4*8&255)<<8|u[c+2>>>2]>>>24-(c+2)%4*8&255,a=0;a<4&&c+.75*a<p;a++)m.push(d.charAt(h>>>6*(3-a)&63));var y=d.charAt(64);if(y)for(;m.length%4;)m.push(y);return m.join("")},parse:function(n){var u=n.length,p=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var m=0;m<p.length;m++)d[p.charCodeAt(m)]=m}var c=p.charAt(64);if(c){var h=n.indexOf(c);h!==-1&&(u=h)}return function(a,y,T){for(var v=[],g=0,b=0;b<y;b++)if(b%4){var S=T[a.charCodeAt(b-1)]<<b%4*2,O=T[a.charCodeAt(b)]>>>6-b%4*2,I=S|O;v[g>>>2]|=I<<24-g%4*8,g++}return i.create(v,g)}(n,u,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},s.enc.Base64)},function(o,k,e){var r,i,s,n,u,p,d,m;o.exports=(m=e(89),e(886),e(887),i=(r=m).lib,s=i.Base,n=i.WordArray,u=r.algo,p=u.MD5,d=u.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:p,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,h){for(var a,y=this.cfg,T=y.hasher.create(),v=n.create(),g=v.words,b=y.keySize,S=y.iterations;g.length<b;){a&&T.update(a),a=T.update(c).finalize(h),T.reset();for(var O=1;O<S;O++)a=T.finalize(a),T.reset();v.concat(a)}return v.sigBytes=4*b,v}}),r.EvpKDF=function(c,h,a){return d.create(a).compute(c,h)},m.EvpKDF)},function(o,k,e){e(298);var r=e(39);e(310)(r),o.exports=r},function(o,k,e){var r=e(52),i=e(3),s=e(15),n=e(10),u=e(2),p=e(7),d=e(305),m=e(8),c=e(17),h=e(74),a=e(198),y=e(303),T=e(765),v=e(0),g=e(306),b=e(40),S=b.newSupportDBError,O=b.noDBError,I=!1;function R(P){I=P,g.set("db",P,y)}if(R(!!v.getGlobal().indexedDB),h.name==="IE"&&R(!1),h.name==="Microsoft Edge"&&R(!1),h.name==="Safari")try{r(h.version.split(".")[0],10)<10&&R(!1)}catch{}function N(P){this.concurrency=0,this.pendingTasks=[],this.queue=i.resolve(),this.logger=P.logger,this.reporter=P.reporter,this.core=P.core,this.account=P.account,this.notifyError=P.notifyError}var F=N.prototype;F.reset=v.emptyFunc,I&&(F.reset=function(P){this.enable=P!==!1}),F.addTask=function(P){var x=this;return new i(function(L,_){function C(A){x.concurrency--;var M=x.pendingTasks.shift();M&&x.addTask(M),A()}if(x.concurrency<100)return x.concurrency++,P().then(function(A){C(function(){L(A),P.resolve&&P.resolve(A)})},function(A){C(function(){var M=(A=A||{}).event||A,U={event:M,callFunc:A.callFunc||"db::addTask"};x.logger.error("db::error event is",M,v.get(M,"target.error")),_(U),P.reject&&P.reject(U)})});P.resolve||(P.resolve=L,P.reject=_),x.pendingTasks.push(P)})},F.reportError=function(P){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.reporter.reportTraceStart("exceptions",{user_id:this.account,trace_id:v.get(this.core,"socket.socket.sessionid"),action:4,exception_service:0});var _,C=x.context||"";if(L)try{var A;_=s(A=n(L)).call(A,0,100),C+=". ".concat(_)}catch{_=""}var M=v.get(P,"code")||v.get(P,"target.error.code")||0,U=v.get(P,"message")||v.get(P,"target.error.message")||"unknown";this.reporter.reportTraceUpdateV2("exceptions",{code:M,description:U,operation_type:x.operation_type,target:x.target||this.name,context:C}),this.reporter.reportTraceEnd("exceptions",1)},F.init=function(P){var x=this;return x.addTask(function(){return x.enable?x.server?i.resolve():(x.name="nim-"+P,y.open({server:x.name,version:T.version,schema:T.schema}).then(function(L){x.logger.info("db::init: ".concat(x.name)),x.server=L},function(L){throw R(!1),x.server=null,x.name=null,L}).catch(function(L){throw x.reportError(L,{operation_type:0,context:"version ".concat(T.version),target:"nim-"+P}),L})):i.reject(S({callFunc:"db::init"}))})},F.destroy=function(){var P=this;return P.addTask(function(){if(!P.enable)return i.reject(S({callFunc:"db::destroy"}));if(!P.server)return i.resolve();try{return y.remove(P.name).then(function(){P.logger.info("db::destroy: ".concat(P.name)),P.server=null,P.name=null}).catch(function(x){throw P.reportError(x,{operation_type:1,context:"remove database failed"}),x})}catch(x){throw P.reportError(x,{operation_type:1,context:"remove database failed"}),x}})},F.clear=function(){var P=this;return P.addTask(function(){return P.enable?P.server?P.server.clear("timetag").then(function(){var x=s([]).call(P.server.getIndexedDB().objectStoreNames),L=[];if(u(x).call(x,function(_){L.push(P.server.clear(_).catch(function(C){throw P.reportError(C,{operation_type:3,context:"tableName: ".concat(_,". clear table failed")}),C}))}),L.length)return i.all(L).then(function(){P.logger.info("db::clear: ".concat(P.name))}).catch(function(_){return P.logger.error("db::clear: ",_),i.reject(_)})}):i.resolve():i.reject(S({callFunc:"db::clear"}))})},F.close=function(){this.server&&(this.server.close(),this.server=null,this.name=null)},F.remove=function(P,x,L,_,C,A,M){var U=this;return U.addTask(function(){U.checkDB();try{return U.server.remove(P,x,L,_,C,A,M).then(function(){var E;U.logger.info(p(E="db::delete: ".concat(P," ")).call(E,x||L))}).catch(function(E){throw U.reportError(E,{operation_type:3,context:"tableName: ".concat(P,", remove failed")},{name:P,keys:x,keyName:L,lowerBound:_,upperBound:C,lowerOpen:A,upperOpen:M}),U.logger.error("db::remove::server.remove error",E),E})}catch(E){throw U.reportError(E,{operation_type:3,context:"tableName: ".concat(P,", remove failed")},{name:P,keys:x,keyName:L,lowerBound:_,upperBound:C,lowerOpen:A,upperOpen:M}),U.logger.error("db::remove::server.remove error",E),E}})},F.put=function(P,x){var L=this;return L.addTask(function(){L.checkDB(),v.isArray(x)||(x=[x]);try{return L.server.update(P,x).then(function(_){var C=[P],A=T.keyPath(P),M=[];return A&&(u(_).call(_,function(U){M.push(a(U,A))}),C.push(M.length===1?M[0]:M)),C.unshift("db::put:"),P==="timetag"&&C.push(_[0]),L.logger.log.apply(L.logger.log,C),_}).catch(function(_){throw L.reportError(_,{operation_type:3,context:"tableName: ".concat(P,". put failed")},x),_})}catch(_){throw L.reportError(_,{operation_type:3,context:"tableName: ".concat(P,". put failed")},x),_}})},F.get=function(P,x){var L=this;return L.addTask(function(){L.checkDB();try{return L.server.get(P,x).catch(function(C){var A;throw L.reportError(C,{operation_type:3,context:p(A="tableName: ".concat(P,". get failed with key ")).call(A,x)}),C})}catch(C){var _;throw L.reportError(C,{operation_type:3,context:p(_="tableName: ".concat(P,". get failed with key ")).call(_,x)}),C}})},F.modifyOrPut=function(P){var x=this,L=P.table,_=v.copy(P.obj),C=P.key,A=P.modifyObjWhenPut,M=v.copy(_);return delete M[C],x.getOne(L,null,_[C],{modifyObj:M}).then(function(U){return U?(M.idClient?M={idClient:M.idClient,server:M.server,pinFrom:M.pinFrom}:(M.lastMsg=M.lastMsg&&M.lastMsg.idServer+"_"+M.lastMsg.idClient,M.localCustom=M.localCustom&&"***",M.topCustom=M.topCustom&&"***"),x.logger.log("db::modifyOrPut: update table ".concat(L),M),U):(_=v.merge(_,A),x.put(L,_).then(function(E){return E[0]}))})},F.updateAndDelete=function(P,x,L){var _=this;return _.addTask(function(){_.checkDB();try{return _.server.updateAndDelete(P,x,L).catch(function(C){throw _.reportError(C,{operation_type:3,context:"tableName: ".concat(P,". updateAndDelete failed")},{updates:x,deletes:L}),C})}catch(C){throw _.reportError(C,{operation_type:3,context:"tableName: ".concat(P,". updateAndDelete failed")},{updates:x,deletes:L}),C}})},F.getAll=function(P,x){var L=this;return L.addTask(function(){L.checkDB(),(x=x||{}).keys=d(x)===!0,x.desc=x.desc===!0,x.distinct=x.distinct===!0;try{var _,C,A;return m(_=d(C=c(A=L.server.query(P,x.index)).call(A,c(x))).call(C,d(x)).desc(x.desc).limit(x.limit).distinct(x.distinct)).call(_,x.mapper).modify(x.modifyObj).execute().catch(function(M){throw L.reportError(M,{operation_type:3,context:"tableName: ".concat(P,". getAll failed")},x),M})}catch(M){throw L.reportError(M,{operation_type:3,context:"tableName: ".concat(P,". getAll failed")},x),M}})},F.getOnly=function(P,x,L,_){var C=this;return C.addTask(function(){C.checkDB(),(_=_||{}).keys=d(_)===!0,_.desc=_.desc===!0,_.distinct=_.distinct===!0,_.remove=_.remove===!0;try{var A,M,U;return m(A=d(M=c(U=C.server.query(P,x).only(L)).call(U,c(_))).call(M,d(_)).desc(_.desc).limit(_.limit).distinct(_.distinct)).call(A,_.mapper).modify(_.modifyObj).remove(_.remove).execute().catch(function($){var X,Y;throw C.reportError($,{operation_type:3,context:p(X=p(Y="tableName: ".concat(P,". getOnly failed with index: ")).call(Y,x,", matchValue: ")).call(X,L)},_),$})}catch($){var E,z;throw C.reportError($,{operation_type:3,context:p(E=p(z="tableName: ".concat(P,". getOnly failed with index: ")).call(z,x,", matchValue: ")).call(E,L)},_),$}})},F.getOne=function(){var P=this;return P.getOnly.apply(P,arguments).then(function(x){return x[0]})},F.clearTable=function(P){var x=this;return x.addTask(function(){x.checkDB();try{return x.server.clear(P).catch(function(L){throw x.reportError(L,{operation_type:3,context:"tableName: ".concat(P,". clearTable failed")},options),L})}catch(L){throw x.reportError(L,{operation_type:3,context:"tableName: ".concat(P,". clearTable failed")},options),L}})},F.checkDB=function(){if(!this.enable)throw S({callFunc:"db::checkDB"});if(!this.server)throw O({callFunc:"db::checkDB"})},o.exports=N},function(o,k){var e={version:12},r={kv:{key:{keyPath:"key"}},timetag:{key:{keyPath:"name"}},sessionsWithMoreRoaming:{key:{keyPath:"id"}},msgReadDetail:{key:{keyPath:"idClient"}},blacklist:{key:{keyPath:"account"}},mutelist:{key:{keyPath:"account"}},friend:{key:{keyPath:"account"}},user:{key:{keyPath:"account"}},team:{key:{keyPath:"teamId"}},teamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1}}},superTeam:{key:{keyPath:"teamId"}},superTeamMember:{key:{keyPath:"id"},indexes:{teamId:{unique:!1},account:{unique:!1},id:{unique:!1}}},msg:{key:{autoIncrement:!0},indexes:{idClient:{unique:!0},sessionId:{unique:!1},time:{unique:!1},type:{unique:!1},sessionType:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msg1:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1},time:{unique:!1},status:{unique:!1},sessionTime:{key:["sessionId","time"],unique:!1}}},msgPin:{key:{keyPath:"idClient"},indexes:{sessionId:{unique:!1}}},broadcastMsg:{key:{keyPath:"broadcastId"},indexes:{time:{unique:!1}}},sysMsg:{key:{autoIncrement:!0},indexes:{idServer:{unique:!0},category:{unique:!1},type:{unique:!1}}},sysMsgUnread:{key:{keyPath:"type"}},session:{key:{keyPath:"id"},indexes:{updateTime:{unique:!1}}}};e.keyPath=function(i){return r[i].key.keyPath},e.schema=function(){return window._nimForceSyncIM=!0,r},o.exports=e},function(o,k,e){var r=e(71).fn;r.setKey=function(i,s){return this.put("kv",{key:i,value:s})},r.getKey=function(i){return this.get("kv",i).then(function(s){return s&&s.value})},r.setDonnop=function(i){return this.setKey("donnop",i)},r.getDonnop=function(){return this.getKey("donnop")}},function(o,k,e){var r=e(6),i=e(52),s=e(71).fn;s.getTimetags=function(n){var u={};return this.getAll("timetag",{filter:n,mapper:function(p){var d;return r(d=p.name).call(d,"team-")!==-1?u[p.name]=0:u[p.name]=p.value,p}}).then(function(){return u})},s.getTeamMemberTimetags=function(){return this.getTimetags(function(n){var u;return r(u=n.name).call(u,"team-")!==-1})},s.getTimetag=function(n){return this.getOne("timetag",null,n).then(function(u){return(u=u||{value:0}).value})},s.getTeamMemberTimetag=function(){return 0},s.updateTimetag=function(n,u){var p=this,d={name:n,value:u};return this.put("timetag",d).catch(function(m){p.notifyError&&p.notifyError(m)})},s.updateMyInfoTimetag=function(n){return this.updateTimetag("myInfo",n)},s.updateRelationTimetag=function(n){return this.updateTimetag("relations",n)},s.getRelationsTimetag=function(){return this.getTimetag("relations")},s.updateFriendTimetag=function(n){return this.updateTimetag("friends",n)},s.getFriendsTimetag=function(){return this.getTimetag("friends")},s.updateFriendUserTimetag=function(n){return this.updateTimetag("friendUsers",n)},s.updateTeamTimetag=function(n){return this.updateTimetag("teams",n)},s.getTeamsTimetag=function(){return this.getTimetag("teams")},s.updateSuperTeamTimetag=function(n){return this.updateTimetag("superTeams",n)},s.getSuperTeamsTimetag=function(){return this.getTimetag("superTeams")},s.updateTeamMemberTimetag=function(n,u){return this.updateTimetag("team-"+n,u)},s.getTeamMembersTimetag=function(n){return this.getTimetag("team-"+n)},s.updateSuperTeamMemberTimetag=function(n,u){return this.updateTimetag("superTeam-"+n,u)},s.getSuperTeamMembersTimetag=function(n){return this.getTimetag("superTeam-"+n)},s.updateMyTeamMembersTimetag=function(n){return this.updateTimetag("myTeamMembers",n)},s.updateMySuperTeamMembersTimetag=function(n){return this.updateTimetag("myInfoInSuperTeams",n)},s.getBroadcastMsgTimetag=function(){return this.getTimetag("broadcastMsg")},s.updateBroadcastMsgTimetag=function(n){return this.updateTimetag("broadcastMsg",i(n))},s.updateRoamingMsgTimetag=function(n){return this.updateTimetag("roamingMsgs",n)},s.updateSuperTeamRoamingMsgTimetag=function(n){return this.updateTimetag("superTeamRoamingMsgs",n)},s.updateMsgReceiptsTimetag=function(n){return this.updateTimetag("msgReceipts",n)},s.updateDonnopTimetag=function(n){return this.updateTimetag("donnop",n)},s.updateSessionAck=function(n){return this.updateTimetag("sessionAck",n)},s.updateDeleteMsgSelf=function(n){return this.updateTimetag("deleteMsgSelf",n)},s.updateSuperTeamSessionAck=function(n){return this.updateTimetag("superTeamSessionAck",n)},s.deleteTimetag=function(n){return this.remove("timetag",n)},s.deleteTeamMemberTimetag=function(n){return this.deleteTimetag("team-"+n)},s.deleteSuperTeamMemberTimetag=function(n){return this.deleteTimetag("superTeam-"+n)}},function(o,k,e){var r=e(3),i=e(71).fn,s=e(0);i.mergeRelations=function(n,u,p,d,m){var c=this,h=c.updateAndDelete("blacklist",n,u),a=c.updateAndDelete("mutelist",p,d);return r.all([h,a]).then(function(){return c.logger.info("db::mergeRelations: timetag ".concat(m)),c.updateRelationTimetag(m),[n,u,p,d,m]})},i.getRelations=function(){var n=this.getAll("blacklist"),u=this.getAll("mutelist");return r.all([n,u])},i.markInBlacklist=function(n){if((n=s.copy(n)).isAdd){var u=n.record;return this.put("blacklist",u)}var p=n.account;return this.remove("blacklist",p)},i.markInMutelist=function(n){if((n=s.copy(n)).isAdd){var u=n.record;return this.put("mutelist",u)}var p=n.account;return this.remove("mutelist",p)}},function(o,k,e){var r=e(8),i=e(3),s=e(71).fn,n=e(0);s.mergeFriends=function(u,p,d){var m=this;return m.updateAndDelete("friend",u,p).then(function(){return m.logger.log("db::mergeFriends: updateAndDelete done",u&&r(u).call(u,function(c){return c.account}).join(",")),d&&m.updateFriendTimetag(d),[u,p,d]})},s.putFriend=function(u){return this.put("friend",u)},s.updateFriend=function(u){var p=this,d=(u=n.copy(u)).account;return this.getOne("friend",null,d,{modifyObj:u}).then(function(m){return m?p.logger.log("db::updateFriend: ".concat(d)):p.logger.warn("db::updateFriend: no record ".concat(d)),m})},s.deleteFriend=function(u){var p=this.remove("friend",u),d=this.deleteUser(u);return i.all([p,d])},s.getFriends=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=function(d){return u.updateTime!==void 0?d.valid&&d.updateTime>u.updateTime:d.valid};return this.getAll("friend",{filter:p})},s.getFriend=function(u){return this.getOne("friend",null,u)},s.getUserFromBlackList=function(u){return this.getOne("blacklist",null,u)}},function(o,k,e){var r=e(3),i=e(2),s=e(7),n=e(8),u=e(71).fn,p=e(0),d=e(40),m=e(192),c=e(150);function h(T){return T.valid&&T.validToCurrentUser}function a(T){return T&&T.valid}function y(T){return T&&p.fillUndef(T,{mute:!1,custom:""}),T}u.mergeTeams=function(T,v,g){var b=this,S=b.put("team",T),O=b.leaveTeams(v,g);return r.all([S,O]).then(function(){return b.logger.log("db::mergeTeams:"),b.updateTeamTimetag(g),[T,v,g]})},u.putTeam=function(T){if(T)return p.isArray(T)||(T=[T]),i(T).call(T,function(v){v.validToCurrentUser=!0}),this.put("team",T)},u.updateTeam=function(T){var v=this,g=(T=p.copy(T)).teamId;return v.getOne("team",null,g,{modifyObj:T}).then(function(b){if(b)v.logger.log("db::updateTeam: ".concat(g));else if(v.logger.warn("db::updateTeam: no record ".concat(g)),T.validToCurrentUser)return v.putTeam(T);return b})},u.transferTeam=function(T,v,g){var b=this,S=T.teamId,O=T.memberUpdateTime,I={teamId:S,account:v,type:"normal",updateTime:O},R={teamId:S,account:g,type:"owner",updateTime:O};return b.updateTeamMembers([I,R]).then(function(){return b.putTeam(T).then(function(){var N,F;return b.logger.info(s(N=s(F="db::transferTeam: ".concat(T.teamId," ")).call(F,v," -> ")).call(N,g)),[T,v,g]})})},u.leaveTeam=function(T){var v=this;return v.updateTeam({teamId:T,validToCurrentUser:!1}).then(function(){return v.removeAllTeamMembers(T)})},u.dismissTeam=function(T,v){var g=this,b={teamId:T,valid:!1,validToCurrentUser:!1,updateTime:v};return g.updateTeam(b).then(function(){return g.removeAllTeamMembers(T)})},u.leaveTeams=function(T,v){var g,b=this,S=[];return i(T).call(T,function(O){g=b.leaveTeam(O.teamId,v),S.push(g)}),r.all(S)},u.getTeamsByTeamIds=function(T){var v,g=this,b=[];return i(T).call(T,function(S){v=g.getTeam(S),b.push(v)}),r.all(b)},u.getTeam=function(T){T=""+T;var v=this;return v.getOne("team",null,T).then(function(g){return g?(v.updateTeamProperties([g]),g):null})},u.getTeams=function(){var T=this;return T.getAll("team",{filter:h}).then(function(v){return T.updateTeamProperties(v),v})},u.updateTeamProperties=function(T){i(T).call(T,function(v){v&&m.fillProperties(v)})},u.mergeTeamMembers=function(T,v,g,b){var S=this,O=S.putTeamMembers(v),I=S.updateTeamMembers(g);return r.all([O,I]).then(function(){return S.logger.log("db::mergeTeamMembers: ".concat(T)),S.updateTeamMemberTimetag(T,b)})},u.putTeamMembers=function(T){return this.put("teamMember",T)},u.getTeamMembersByAccount=function(T){return this.getOnly("teamMember","account",T,{filter:a,mapper:y}).then()},u.getTeamMembers=function(T){var v=this;return T=""+T,v.getOnly("teamMember","teamId",T,{filter:function(g){return g.valid},mapper:y}).then(function(g){return v.updateTeamMemberProperties(g).then(function(){return g})})},u.updateTeamMemberProperties=function(T){var v,g=this,b=[];return i(T).call(T,function(S){c.fillProperties(S)&&(v=g.updateTeamMember(S),b.push(v))}),r.all(b)},u.getInvalidTeamMembers=function(T,v){var g=this;T=""+T;var b,S=[];return i(v).call(v,function(O){b=g.getOne("teamMember",null,c.genId(T,O)).then(function(I){return y(I)}),S.push(b)}),r.all(S)},u.updateTeamMember=function(T){var v=this,g=T.teamId,b=T.account,S=c.genId(g,b),O=p.filterObj(T,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("teamMember",null,S,{modifyObj:O,mapper:y}).then(function(I){var R,N;return I?v.logger.log(s(R="db::updateTeamMember: ".concat(g," ")).call(R,b),p.pickAsString(O,["muteTeam","mute","updateTime","type","valid"])):v.logger.warn(s(N="db::updateTeam: no record ".concat(g," ")).call(N,b)),I})},u.updateTeamMembers=function(T){var v=this;if(!T.length)return r.resolve();var g,b=[];return i(T).call(T,function(S){g=v.updateTeamMember(S),b.push(g)}),r.all(b)},u.updateTeamManagers=function(T,v,g,b){var S=n(v).call(v,function(O){return{teamId:T,account:O,type:g?"manager":"normal",updateTime:b}});return this.updateTeamMembers(S)},u.removeTeamMembersByAccounts=function(T,v){var g=n(v).call(v,function(b){return{teamId:T,account:b,valid:!1}});return this.updateTeamMembers(g)},u.removeAllTeamMembers=function(T){var v=this;return v.getOnly("teamMember","teamId",T,{modifyObj:{valid:!1}}).then(function(){return v.logger.warn("db::removeAllTeamMembers: ".concat(T)),v.deleteTeamMemberTimetag(T)})},u.deleteTeamMembers=function(T){var v=this;return v.getOnly("teamMember","teamId",T,{remove:!0}).then(function(){v.logger.warn("db::deleteTeamMembers: ".concat(T)),v.deleteTeamMemberTimetag(T)})},u.deleteTeam=function(T){var v,g=this,b=[];return p.isArray(T)||(T=[T]),i(T).call(T,function(S){S=""+S,v=g.get("team",S).then(function(O){if(O&&h(O))throw d.stillInTeamError({callFunc:"team::deleteTeam",team:O});var I=g.remove("team",S),R=g.deleteTeamMembers(S);return r.all([I,R])}),b.push(v)}),b.length===1?b[0]:r.all(b)}},function(o,k,e){var r=e(3),i=e(2),s=e(9),n=e(7),u=e(8),p=e(71).fn,d=e(0),m=e(40),c=e(307),h=e(202);function a(v){return v.valid&&v.validToCurrentUser}function y(v){return v&&v.valid}function T(v){return v&&d.fillUndef(v,{mute:!1,custom:""}),v}p.mergeSuperTeams=function(v,g,b){var S=this,O=S.put("superTeam",v),I=S.leaveTeams(g,b);return r.all([O,I]).then(function(){return S.logger.log("db::mergeSuperTeams:"),S.updateSuperTeamTimetag(b),[v,g,b]})},p.putSuperTeam=function(v){if(v)return d.isArray(v)||(v=[v]),i(v).call(v,function(g){g.validToCurrentUser=!0}),this.put("superTeam",v)},p.updateSuperTeam=function(v){var g=this,b=(v=d.copy(v)).teamId;return g.getOne("superTeam",null,b,{modifyObj:v}).then(function(S){return S?(g.logger.info("db::updateSuperTeam: ".concat(b)),S):(g.logger.warn("db::updateSuperTeam: no record ".concat(b)),g.putSuperTeam(v))})},p.leaveSuperTeam=function(v){var g=this;return g.updateSuperTeam({teamId:v,validToCurrentUser:!1}).then(function(){return g.removeAllSuperTeamMembers(v)})},p.dismissSuperTeam=function(v,g){var b=this,S={teamId:v,valid:!1,validToCurrentUser:!1,updateTime:g};return b.updateSuperTeam(S).then(function(){return b.removeAllSuperTeamMembers(v)})},p.leaveSuperTeams=function(v,g){var b,S=this,O=[];return i(v).call(v,function(I){b=S.leaveSuperTeam(I.teamId,g),O.push(b)}),r.all(O)},p.getSuperTeamsByTeamIds=function(v){var g,b=this,S=[];return i(v).call(v,function(O){g=b.getSuperTeam(O),S.push(g)}),r.all(S)},p.getSuperTeam=function(v){v=""+v;var g=this;return g.getOne("superTeam",null,v).then(function(b){return b?(g.updateSuperTeamProperties([b]),b):null})},p.getSuperTeams=function(){var v=this;return v.getAll("superTeam",{filter:a}).then(function(g){return v.updateSuperTeamProperties(g),g})},p.updateSuperTeamProperties=function(v){i(v).call(v,function(g){g&&c.fillProperties(g)})},p.mergeSuperTeamMembers=function(v,g,b,S){var O=this,I=O.putSuperTeamMembers(g),R=O.updateSuperTeamMembers(b);return r.all([I,R]).then(function(){return O.logger.log("db::mergeSuperTeamMembers: ".concat(v)),S!=null?O.updateSuperTeamMemberTimetag(v,S):r.resolve()})},p.putSuperTeamMembers=function(v){return this.put("superTeamMember",v)},p.getSuperTeamMemberById=function(v){return this.get("superTeamMember",v)},p.getSuperTeamMembers=function(v,g){var b=this;v=""+v;var S={filter:function(O){return O.valid},mapper:T};if(g){if(typeof g.joinTime!="number")return void b.logger.error("db::getSuperTeamMembers::params.joinTime should be number, not ",g.joinTime);g.limit&&(S.limit=g.limit),s(g)?S.filter=function(O){return O.valid&&O.joinTime<=g.joinTime}:S.filter=function(O){return O.valid&&O.joinTime>=g.joinTime}}return b.getOnly("superTeamMember","teamId",v,S).then(function(O){return b.updateSuperTeamMemberProperties(O).then(function(){return O})})},p.getSuperTeamMembersByAccount=function(v){return this.getOnly("superTeamMember","account",v,{filter:y,mapper:T}).then()},p.updateSuperTeamMemberProperties=function(v){var g,b=this,S=[];return i(v).call(v,function(O){h.fillProperties(O)&&(g=b.updateSuperTeamMember(O),S.push(g))}),r.all(S)},p.getInvalidSuperTeamMembers=function(v,g){var b=this;v=""+v;var S,O=[];return i(g).call(g,function(I){S=b.getOne("superTeamMember","id",h.genId(v,I)).then(function(R){return T(R)}),O.push(S)}),r.all(O)},p.updateSuperTeamMember=function(v){var g=this,b=v.teamId,S=v.account,O=h.genId(b,S),I=d.filterObj(v,"nickInTeam muteTeam mute custom updateTime type valid");return this.getOne("superTeamMember","id",O,{modifyObj:I,mapper:T}).then(function(R){var N,F;return R?g.logger.log(n(N="db::updateSuperTeamMember: ".concat(b," ")).call(N,S),d.pickAsString(I,["muteTeam","mute","updateTime","type","valid"])):g.logger.warn(n(F="db::updateSuperTeam: no record ".concat(b," ")).call(F,S)),R})},p.updateSuperTeamMembers=function(v){var g=this;if(!v.length)return r.resolve();var b,S=[];return i(v).call(v,function(O){b=g.updateSuperTeamMember(O),S.push(b)}),r.all(S)},p.removeSuperTeamMembersByAccounts=function(v,g){var b=u(g).call(g,function(S){return{teamId:v,account:S,valid:!1}});return this.updateSuperTeamMembers(b)},p.removeAllSuperTeamMembers=function(v){var g=this;return g.getOnly("superTeamMember","teamId",v,{modifyObj:{valid:!1}}).then(function(){return g.logger.warn("db::removeAllSuperTeamMembers: ".concat(v)),g.deleteSuperTeamMemberTimetag(v)})},p.deleteSuperTeamMembers=function(v){var g=this;return g.getOnly("superTeamMember","teamId",v,{remove:!0}).then(function(){g.logger.warn("db::deleteSuperTeamMembers: ".concat(v)),g.deleteSuperTeamMemberTimetag(v)})},p.deleteSuperTeam=function(v){var g,b=this,S=[];return d.isArray(v)||(v=[v]),i(v).call(v,function(O){O=""+O,g=b.get("superTeam",O).then(function(I){if(I&&a(I))throw m.stillInTeamError({callFunc:"team::deleteTeam",team:I});var R=b.remove("superTeam",O),N=b.deleteSuperTeamMembers(O);return r.all([R,N])}),S.push(g)}),S.length===1?S[0]:r.all(S)},p.transferSuperTeam=function(v,g,b){var S=this;return S.updateSuperTeamMembers([g,b]).then(function(){return S.putSuperTeam(v).then(function(){var O,I;return S.logger.info(n(O=n(I="db::transferSuperTeam: ".concat(v.teamId," ")).call(I,g.account," -> ")).call(O,b.account)),[v,g,b]})})}},function(o,k,e){var r=e(2),i=e(3),s=e(6),n=e(71).fn,u=e(0);n.mergeMyInfo=function(p,d){var m=this;return m.put("user",p).then(function(){return d?m.updateMyInfoTimetag(p.updateTime):p})},n.mergeFriendUsers=function(p,d){var m=this;return m.putUsers(p).then(function(){m.updateFriendUserTimetag(d)})},n.putUsers=function(p){return this.put("user",p)},n.putUser=function(p){return this.put("user",p)},n.updateUser=function(p){var d=this,m=(p=u.copy(p)).account;return this.getOne("user",null,m,{modifyObj:p}).then(function(c){return c?d.logger.log("db::updateUser: ".concat(m)):d.logger.warn("db::updateUser: no record ".concat(m)),c})},n.putUsersIfIsFriend=function(p){var d,m=this,c=[],h=[];return r(p).call(p,function(a){d=m.getFriend(a.account).then(function(y){return y&&(d=m.putUser(a),h.push(d)),y}),c.push(d)}),i.all(c).then(function(){return i.all(h).then(function(a){return a})})},n.deleteUser=function(p){return this.remove("user",p)},n.getUser=function(p){return this.getOne("user",null,p)},n.getUsers=function(p){return this.getAll("user",{filter:function(d){return s(p).call(p,d.account)!==-1}})},n.getAllUsers=function(){return this.getAll("user")}},function(o,k,e){var r=e(17),i=e(3),s=e(7),n=e(2),u=e(41),p=e(32),d=e(6),m=e(8),c=e(71).fn,h=e(0),a=e(13);c.putMsg=function(y){var T=this;return h.isArray(y)||(y=[y]),!y.length||r(y[0])?i.resolve():(y=r(y).call(y,function(v){return!v.ignore}),T.put("msg1",y).catch(function(v){return T.notifyError&&T.notifyError(v),i.resolve(y,v)}))},c.putMsgReadDetail=function(y){var T=this;if(y.idClient)return this.put("msgReadDetail",y).catch(function(v){T.logger.error("putMsgReadDetail error",v)})},c.getMsgReadDetail=function(y){return this.getOne("msgReadDetail",null,y)},c.updateMsg=function(y){var T=this;if(!r(y)){var v=y.idClient,g=h.filterObj(y,"resend status idServer time localCustom commentTimetag comments hasSendAck callbackExt");return T.getOne("msg1",null,v,{modifyObj:g}).then(function(b){var S,O,I;return b?T.logger.info(s(S=s(O=s(I="db::updateMsg: ".concat(v,"，idServer: ")).call(I,g.idServer,"，status: ")).call(O,g.status,"，time: ")).call(S,g.time)):T.logger.warn("db::updateMsg: no record ".concat(v)),b}).catch(function(b){return T.notifyError&&T.notifyError(b),i.resolve(y)})}},c.updateMsgBatch=function(y){var T=this;if(a.isRN)this.logger.warn("react native can not support updateMsgBatch");else{this.checkDB();var v=this.server.getIndexedDB().transaction(["msg1"],"readwrite").objectStore("msg1");n(y).call(y,function(g){if(g.idClient){var b=v.get(g.idClient);b.onerror=function(S){T.logger.error("updateMsgBatch::store.get:error",S)},b.onsuccess=function(){var S=b.result||g;v.put(u({},S,g)).onerror=function(O){T.logger.error("updateMsgBatch::store.put:error",O)}}}})}},c.getMsgs=function(y){return a.isBrowser?this.getMsgsIndexedDB(y):a.isRN?this.getMsgsRN(y):i.resolve()},c.getMsgsRN=function(y){var T={};return typeof y.start=="number"&&(T.lowerBound=["time",y.start]),typeof y.end=="number"&&y.end!==1/0&&(T.upperBound=["time",y.end]),T.desc=!1,T.index="time",typeof y.desc=="boolean"&&(T.desc=y.desc),typeof y.limit=="number"&&(T.limit=y.limit),T.searchIndex=[],y.sessionId&&T.searchIndex.push(["sessionId",y.sessionId]),typeof y.type=="string"&&T.searchIndex.push(["type",y.type]),this.getAll("msg1",T)},c.getMsgsIndexedDB=function(y){var T,v=this;v.checkDB();var g="time",b=!1,S=!1,O=(y=y||{}).sessionId||[],I=y.sessionIds||[];h.isString(O)?O=[O]:p(O)||(O=[]),h.isString(I)?I=[I]:p(I)||(I=[]);var R=s(O).call(O,I);R.length===1?(b=!0,g="sessionTime",O=R[0]):R.length>1&&(b=!0,S=!0,I=R);var N=y.start||0,F=y.end||1/0,P=N,x=F;b&&!S&&(P=[O,N],x=[O,F]);var L=y.desc!==!1,_=y.limit||100,C=!1,A=!1,M=y.type||[],U=y.types||[];h.isString(M)?M=[M]:p(M)||(M=[]),h.isString(U)?U=[U]:p(U)||(U=[]);var E=s(M).call(M,U);E.length===1?(C=!0,M=E[0]):E.length>1&&(C=!0,A=!0,U=E);var z,$=y.subTypes&&y.subTypes.length,X=y.keyword||"",Y=y.filterFunc;return(S||C||X||$||h.isFunction(Y))&&(z=function(W){var ee;if(S&&d(I).call(I,W.sessionId)===-1)return!1;if(C){if(A){if(d(U).call(U,W.type)===-1)return!1}else if(M!==W.type)return!1}if($&&d(ee=y.subTypes).call(ee,W.subType)===-1)return!1;if(X){var w=W.text||W.tip||"";if(d(w).call(w,X)===-1)return!1}return!Y||Y(W)}),r(T=v.server.query("msg1",g).bound(P,x,!0,!0).desc(L).limit(_)).call(T,z).execute().catch(function(W){throw v.reportError(W,{operation_type:3,context:"tableName: ".concat("msg1",", index ").concat(g,", getMsgsIndexedDB error")},y),W})},c.getMsgCountAfterAck=function(y){return a.isBrowser?this.getMsgCountAfterAckIndexedDB(y):a.isRN?this.getMsgCountAfterAckRN(y):i.resolve()},c.getMsgCountAfterAckRN=function(y){var T=this,v=y=y||{},g=v.sessionId,b=v.ack;return T.checkDB(),T.getAll("msg1",{searchIndex:["sessionId",g],lowerBound:["time",b]}).then(function(S){var O=r(S).call(S,function(I){if(I.flow==="out"||I.isUnreadable===!1)return!1;if(I.type==="notification")try{return y.shouldCountNotifyUnread(I)}catch(R){throw T.logger.error("userOption:shouldCountNotifyUnread function error",R),R}return!0});return i.resolve(O.length)})},c.getMsgCountAfterAckIndexedDB=function(y){var T=this,v=(y=y||{}).sessionId;return T.checkDB(),T.server.query("msg1","sessionTime").bound([v,y.ack],[v,1/0],!0,!0).execute().then(function(g){var b=r(g).call(g,function(S){if(S.flow==="out"||S.isUnreadable===!1)return!1;if(S.type==="notification")try{return y.shouldCountNotifyUnread(S)}catch(O){throw T.logger.error("userOption:shouldCountNotifyUnread function error",O),O}return!0});return i.resolve(b.length)}).catch(function(g){throw T.reportError(g,{operation_type:3,context:"tableName: ".concat("msg1",", IndexSessionTime ").concat("sessionTime",", getMsgCountAfterAckIndexedDB error")},y),g})},c.amendMsg=function(y){return y?(h.notexist(y.text)&&(y.text=""),y):null},c.getMsgByIdClient=function(y){var T=this;return T.getOne("msg1",null,y).then(function(v){return T.amendMsg(v)})},c.getMsgsByIdClients=function(y){var T,v=this,g=[];return n(y).call(y,function(b){T=v.getMsgByIdClient(b),g.push(T)}),i.all(g)},c.clearSendingMsgs=function(){var y=this;return y.getOnly("msg1","status","sending",{modifyObj:{status:"fail"}}).then(function(T){y.logger.info("db::clearSendingMsgs: msgs send failed",T&&m(T).call(T,function(v){return v.idClient}).join(","))})},c.deleteMsg=function(y){var T,v=this,g=[];return h.isArray(y)||(y=[y]),n(y).call(y,function(b){T=v.getOne("msg1",null,b,{remove:!0}).then(function(S){return v.logger.info("db::deleteMsg done",b,S&&S.idClient),S}).catch(function(S){throw v.logger.error("db::deleteMsg failed",b,S),S}),g.push(T)}),g.length===1?g[0]:i.all(g)},c.deleteMsgsBySessionId=function(y){var T=this,v=null,g=y.start,b=y.end;return g!==void 0&&b!==void 0?v=function(S){return S>g&&S<b}:g!==void 0?v=function(S){return S>g}:b!==void 0&&(v=function(S){return S<b}),v?T.getOnly("msg1","sessionId",y.sessionId).then(function(S){var O=[];return m(S=S||[]).call(S,function(I){v(I.time)&&O.push(I.idClient)}),T.logger.info("db::deleteMsgsBySessionId: session results",O),T.deleteMsg(O)}):T.getOnly("msg1","sessionId",y.sessionId,{remove:!0})},c.deleteMsgsByTime=function(y){return this.remove("msg1",null,"time",y.start,y.end,!0,!0)},c.getDeletedMsgsCountByTime=function(y){this.checkDB();var T=this.server.getIndexedDB().transaction(["msg1"],"readonly").objectStore("msg1").index("time"),v=IDBKeyRange.bound(y.start,y.end,!0,!0),g=T.count(v);return new i(function(b,S){g.onsuccess=function(O){b(O.target.result)},g.onerror=function(O){this.logger.error("countDeletedMsgsByTime::index.count:error",O),S(O)}})},c.deleteAllMsgs=function(){var y=this.clearTable("msg1"),T=this.clearTable("session");return i.all([y,T])},c.getMsgPins=function(y){return this.getOnly("msgPin","sessionId",y)},c.deleteMsgPins=function(y){return this.getOnly("msgPin","sessionId",y,{remove:!0})},c.putMsgPin=function(y){var T=this;return this.modifyOrPut({table:"msgPin",obj:y,key:"idClient"}).catch(function(v){T.notifyError&&T.notifyError(v)})},c.putMsgPins=function(y){return this.put("msgPin",y)},c.deleteMsgPin=function(y){var T=this;return this.getOne("msgPin",null,y.idClient,{remove:!0}).then(function(v){return T.logger.info("db::deleteMsgPin:",v.idClient),v})}},function(o,k,e){var r=e(3),i=e(17),s=e(2),n=e(9),u=e(5),p=e(71).fn,d=e(0),m=d.notundef;p.putSysMsg=function(c){var h=this;return new r(function(a){if(d.isArray(c)||(c=[c]),!i(c[0])){var y=[],T=c.length;s(c).call(c,function(g){g=d.copy(g),h.put("sysMsg",g).then(function(b){y.push(b[0]),v()},v)})}function v(){--T===0&&a(y)}})},p.getSysMsgs=function(c){var h=!n(c=c||{}),a=c.limit||100,y=null,T=null;c.category&&(y="category",T=c.category),c.type&&(y="type",T=c.type);var v,g=c.lastIdServer,b=!1,S=c.read;return(m(g)||m(S))&&(v=function(O){return m(g)?(g=""+g,b?I():(O.idServer===g&&(b=!0),!1)):I();function I(){return!m(S)||O.read===S}}),c={filter:v,desc:h,limit:a},y?this.getOnly("sysMsg",y,T,c):this.getAll("sysMsg",c)},p.getSysMsgByIdServer=function(c){return this.getOne("sysMsg","idServer",c)},p.updateSysMsg=function(c){var h=this;if(!i(c)){var a=""+c.idServer,y=d.filterObj(c,"read state error localCustom");return this.getOne("sysMsg","idServer",a,{modifyObj:y}).then(function(T){return T?h.logger.log("db::updateSysMsg: ".concat(a),d.pickAsString(y,["read","state","error"])):h.logger.warn("db::updateSession: ".concat(a)),T})}},p.markSysMsgRead=function(c){var h=this;return new r(function(a,y){d.isArray(c)||(c=[c]);var T,v,g=[],b=[];s(c).call(c,function(S){T=h.getSysMsgByIdServer(S.idServer).then(function(O){O&&!O.read&&(v=h.updateSysMsg({idServer:O.idServer,read:!0}),b.push(v))},y),g.push(T)}),r.all(g).then(function(){r.all(b).then(function(S){a(S)},y)},y)})},p.deleteSysMsg=function(c){var h,a=this,y=[];return d.isArray(c)||(c=[c]),s(c).call(c,function(T){T=""+T,h=a.getOne("sysMsg","idServer",T,{remove:!0}),y.push(h)}),y.length===1?y[0]:r.all(y)},p.deleteAllSysMsgs=function(){var c=this.clearTable("sysMsg"),h=this.clearTable("sysMsgUnread");return r.all([c,h])},p.getSysMsgUnread=function(){return this.getAll("sysMsgUnread").then(function(c){var h={};return s(c).call(c,function(a){h[a.type]=a.num}),h})},p.updateSysMsgUnread=function(c){var h,a=this;c=d.copy(c);var y=[];return s(h=u(c)).call(h,function(T){y.push({type:T,num:c[T]})}),this.put("sysMsgUnread",y).then(function(){return a.logger.info("db::updateSysMsgUnread: ",c),c})}},function(o,k,e){var r=e(3),i=e(2),s=e(71).fn,n=e(0);s.putBroadcastMsg=function(u){var p=this;return new r(function(d){n.isArray(u)||(u=[u]);var m=[],c=u.length;function h(){--c===0&&d(m)}i(u).call(u,function(a){a=n.copy(a),p.put("broadcastMsg",a).then(function(y){m.push(y[0]),h()},h)})})},s.getBroadcastMsgs=function(u){return u=u||{},this.getAll("broadcastMsg",u)}},function(o,k,e){var r=e(3),i=e(9),s=e(7),n=e(32),u=e(2),p=e(71).fn,d=e(0),m=d.notundef;p.putSession=function(c){var h=this,a=c.unread;return(c=d.merge({},c)).updateTime===void 0&&c.lastMsg&&c.lastMsg.time&&(c.updateTime=c.lastMsg.time),(c.lastMsg||!c.ack&&!c.msgReceiptTime)&&(c.isDeleted=!1),delete c.unread,this.modifyOrPut({table:"session",obj:c,key:"id",modifyObjWhenPut:{unread:0}}).catch(function(y){return h.notifyError&&h.notifyError(y),c.unread=a,r.resolve(c)})},p.getAllSessions=function(){return this.getAll("session",{index:"updateTime",desc:!0}).catch(function(c){self.notifyError&&self.notifyError(c)})},p.getSessions=function(c){var h=!i(c=c||{}),a=c.limit||100,y=c.lastSessionId,T=c.sessionId,v=!1,g=this,b=function(){return!0},S=function(){return!0};return m(T)?this.getSession(T,c.isDeleted):(m(y)&&(b=function(O){return O.id===y&&(v=!0),v}),c.includeDeleted||(S=function(O){return!O.isDeleted}),this.getAll("session",{index:"updateTime",desc:h,limit:a,filter:function(O){return b(O)&&S(O)}}).catch(function(O){g.notifyError&&g.notifyError(O)}))},p.getSession=function(c,h){var a=this;return this.get("session",c).then(function(y){return r.resolve(!h&&y&&y.isDeleted?void 0:y)}).catch(function(y){throw a.notifyError&&a.notifyError(y),y})},p.updateSession=function(c){var h=this,a=c.id,y=d.filterObj(c,"ack unread lastMsg localCustom msgReceiptTime msgReceiptServerTime isTop topCustom isDeleted");return c.lastMsg&&(y.lastMsg=c.lastMsg),this.getOne("session",null,a,{modifyObj:y}).then(function(T){if(T){var v,g=s(v="db::updateSession: ".concat(a," ")).call(v,d.pickAsString(y,["ack","unread","msgReceiptTime","msgReceiptServerTime","isTop","isDeleted"]));g+=y.lastMsg?" lastMsg.idClient:".concat(d.get(y,"lastMsg.idClient")):"",h.logger.info(g)}else h.logger.warn("db::updateSession: no record ".concat(a));return T}).catch(function(T){h.notifyError&&h.notifyError(T)})},p.getStickTopSessions=function(){var c=this;return this.getAll("session",{filter:function(h){return h&&h.isTop}}).catch(function(h){c.notifyError&&c.notifyError(h)})},p.deleteSession=function(c,h){var a=h&&h.scene||"";return a==="superTeam"?this.updateSuperTeamSessionAck(0):(a==="p2p"||a==="team"||this.updateSuperTeamSessionAck(0),this.updateSessionAck(0)),this.updateMsgReceiptsTimetag(0),this.remove("session",c)},p.deleteSessionLogic=function(c){var h=this;if(!n(c))return this.getOne("session",null,c,{modifyObj:{isDeleted:!0}});var a=[];return u(c).call(c,function(y){a.push(h.getOne("session",null,y,{modifyObj:{isDeleted:!0}}))}),r.all(a)},p.putSessionsWithMoreRoaming=function(c){return this.put("sessionsWithMoreRoaming",c)},p.updateSessionsWithMoreRoaming=function(c){var h=c.id;return delete c.id,this.getOne("sessionsWithMoreRoaming",null,h,{modifyObj:c})},p.deleteSessionsWithMoreRoaming=function(c){return this.remove("sessionsWithMoreRoaming",c)},p.getSessionsWithMoreRoaming=function(c){return c?this.get("sessionsWithMoreRoaming",c):this.getAll("sessionsWithMoreRoaming")}},function(o,k,e){var r=e(7),i=e(121),s=e(122),n=e(0).throttle,u=function(){function p(d){i(this,p),this.arr=[],this.timer=null,this.maxLength=d.maxLength||100,this.throttleTime=d.throttleTime||5e3,this.processFn=d.processFn||function(){},this.throttleFn=d.processFn||function(){},d.processFn&&(this.throttleFn=n(function(m){d.processFn(m),m.length=0},this.throttleTime,{leading:!1}))}return s(p,[{key:"add",value:function(d){var m;Object.prototype.toString.call(d)==="[object Array]"?this.arr=r(m=this.arr).call(m,d):this.arr.push(d),this.arr.length>=this.maxLength&&(this.processFn(this.arr),this.arr=[]),this.timer=this.throttleFn(this.arr)}},{key:"destroy",value:function(){this.arr=[],this.timer&&clearTimeout(this.timer),this.processFn=function(){},this.throttleFn=function(){}}},{key:"clear",value:function(){this.arr=[],this.timer&&clearTimeout(this.timer)}}]),p}();o.exports=u},function(o,k,e){var r=e(26),i=e(57),s=e(56),n=e(10),u=e(313),p=e(7),d=e(3),m=e(23),c=e(17),h=e(6),a=e(15),y=e(25),T=e(2),v=e(123),g=e(5),b=e(58),S=e(59),O=e(60),I=e(61),R=e(47);function N(E,z){var $=g(E);if(b){var X=b(E);z&&(X=c(X).call(X,function(Y){return S(E,Y).enumerable})),$.push.apply($,X)}return $}function F(E){for(var z=1;z<arguments.length;z++){var $,X,Y=arguments[z]!=null?arguments[z]:{};z%2?T($=N(Object(Y),!0)).call($,function(W){i(E,W,Y[W])}):O?I(E,O(Y)):T(X=N(Object(Y))).call(X,function(W){R(E,W,S(Y,W))})}return E}var P=e(35).fn,x=e(0),L=e(13),_=e(155).V2NIMConnectStatus;function C(E,z){var $,X,Y,W,ee=this,w=L.getDefaultLinkUrl(ee.options.secure);ee.socketUrls=[w],ee.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:z,code:200,net_connect:ee.checkNetworkAvailable(),succeed:!0}),ee.msgStatEnable=!!E.common["msg.stat.enable"],ee.msgStatEnable&&(ee.msgDelayTimer=m(y(X=ee.doReportMsgDelay).call(X,ee),1e4)),E.common&&E.common.link&&T(Y=E.common.link).call(Y,function(D){ee.socketUrls.unshift(L.formatSocketUrl({url:D,secure:ee.options.secure}))}),E.common&&E.common["link.default"]&&T(W=E.common["link.default"]).call(W,function(D){var Q,G;D=L.formatSocketUrl({url:D,secure:ee.options.secure}),h(Q=ee.socketUrls).call(Q,D)===-1&&(ee.socketUrls=p(G=ee.socketUrls).call(G,D))}),ee.socketUrls=c($=ee.socketUrls).call($,function(D,Q,G){return h(G).call(G,D)===Q});try{L.uploadUrl=E.nosup[0]}catch{}if(L.chunkUploadUrl=E["nos-chunk"]||L.chunkUploadUrl||"",ee.logger.info("link::refreshSocketUrl: ".concat(z," ajax load , got socket urls "),ee.socketUrls),L.hasLocalStorage){E.common["lbs.backup"]&&ee.options.lbsBackup&&localStorage.setItem("nim_lbs_backup",n(E.common["lbs.backup"]));var J=x.get(E,"common.report.apierror.on");E.common.report&&localStorage.setItem("nim_lbs_fail_report_on",J===!1?"0":"1")}if(E.common.socketConcurrent){var V=E.common.socketConcurrent;typeof V=="number"&&V>=1&&V<=3&&(ee.options.socketConcurrent=V,ee.imsocket.setConfig({socketConcurrent:V}))}}function A(E,z){if(this.statusProtector.getConnectStatus()===_.V2NIM_CONNECT_STATUS_DISCONNECTED)return d.reject(new Error("already disconnected"));if(E>=z){this.logger.warn("doRequestBackupLbsUrls backup lbs all tried");var $=L.getDefaultLinkUrl(this.options.secure);return this.logger.warn("doRequestBackupLbsUrls: use default socket link",$),this.socketUrls=[$],d.resolve()}return this.logger.warn("doRequestBackupLbsUrls: wait for next lbs request"),d.reject(new Error("lbs request failed"))}function M(E,z){var $=z.status||10001,X=typeof z=="string"?z:z&&z.message?z.message:"Unknown error";this.reporter.reportTraceUpdateV2("login",{operation_type:"HTTP",target:E,code:$,description:X,net_connect:this.checkNetworkAvailable(),succeed:!1})}function U(E){var z=this;if(!(E&&E.length>0))throw new Error("No  lbs url to try");var $=0,X=0,Y=!1,W=null;z.logger.log("doRequestBackupLbsUrls: use lbs url in index ",$,E);var ee=function(){var w=E[$++],J=new Date().getTime();return z.promiseAbortManager.add(z.doRequestLbs(w)).then(function(V){if(W&&clearInterval(W),Y===!1)return C.call(z,V,w),Y=!0,d.resolve()}).catch(function(V){return X+=1,z.logger.warn("doRequestBackupLbsUrls: ".concat(w," ajax lbs error"),V),M.call(z,w,V,J),A.call(z,X,E.length)})};return new d(function(w,J){W=v(function(){if(!($>=E.length))return z.statusProtector.getConnectStatus()===_.V2NIM_CONNECT_STATUS_DISCONNECTED?(W&&clearInterval(W),void J(new Error("already disconnected"))):void ee().then(function(){W&&clearInterval(W),w()}).catch(function(){});W&&clearInterval(W)},2e3),ee().then(function(){W&&clearInterval(W),w()}).catch(function(){})})}P.connect=function(){if(this.checkNetworkAvailable()===!1&&this.autoconnect)return this.logger.info("connect::skip this reconnection attempt because network is offline"),void this.reconnect();L.isBrowser&&this.reporter.restore(),this.createConnectTime=s(),this.reporter.reportTraceCancel("login"),this.reporter.reportTraceStart("login",{user_id:this.options.account,action:this.autoconnect?"auto_login":"manual_login"}),this.reporter.reportTraceUpdateV2("login",{code:0,description:n(F(F({},this.options),{},{account:"***",token:"***"}),function(E,z){return E===""||typeof z!="function"&&r(z)!=="object"?z:void 0}),operation_type:"conf_init",succeed:!0,target:""}),u(P).connect.call(this)},P.onConnect=function(){this.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:this.url,code:200,net_connect:this.checkNetworkAvailable(),succeed:!0}),u(P).onConnect.call(this)},P.onHandshakeFailed=function(E,z){var $;this.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:z,code:408,succeed:!1,net_connect:this.checkNetworkAvailable(),description:"ws_handshake_failed"}),this.reporter.reportTraceEnd("login",!1),this.logger.warn(p($="link::onHandshakeFailed: shandshake failed, startTime: ".concat(E,", targetUrl: ")).call($,z))},P.onConnectFailed=function(E,z,$){var X,Y;this.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:$,code:408,succeed:!1,net_connect:this.checkNetworkAvailable(),description:"ws_connect_failed"}),this.reporter.reportTraceEnd("login",!1),this.logger.warn(p(X=p(Y="link::onConnectFailed: connect failed due to ".concat(E,", startTime: ")).call(Y,z,", targetUrl: ")).call(X,$))},P.onSocketError=function(E,z,$){var X,Y;this.reporter.reportTraceUpdateV2("login",{operation_type:"TCP",target:$,description:"ws_onerror:"+E,code:0,succeed:!1}),this.reporter.reportTraceEnd("login",!1),this.logger.warn(p(X=p(Y="link::onSocketError: due to ".concat(E,", startTime: ")).call(Y,z,", targetUrl: ")).call(X,$))},P.probeIp=function(){var E=this,z=L.ipProbeAddr;return new d(function($){var X=0,Y=-1;function W(){++X===2&&(X=-1,$(Y))}E.adaptersRequest(z.ipv4,{timeout:2e3,onerror:W,onload:function(ee){Y++,W()}}),E.adaptersRequest(z.ipv6,{timeout:2e3,onerror:W,onload:function(ee){Y+=2,W()}}),m(function(){X||Y===-1||(X=-1,$(Y))},100)})},P.refreshSocketUrl=function(){var E=this;return this.statusProtector.emit("auth/loginLifeCycleAddressing"),L.isWeixinApp?this.doRefreshSocketUrl(2):this.options.ipVersion===2?this.probeIp().then(function(z){return E.doRefreshSocketUrl(z)}):this.doRefreshSocketUrl(this.options.ipVersion)},P.doRefreshSocketUrl=function(E){var z,$,X=this.options.lbsUrl||L.lbsUrl;E!==1&&E!==2&&(E=0),L.ipVersion=E;var Y=this.options.lbsBackupUrlsCustomer||[],W=[];this.options.lbsBackup&&L.hasLocalStorage&&(W=(W=localStorage.getItem("nim_lbs_backup"))?JSON.parse(W):[]);var ee=p(z=p($=[X]).call($,W)).call(z,Y);return ee=c(ee).call(ee,function(w,J,V){return h(V).call(V,w)===J}),U.call(this,ee)},P.doRequestLbs=function(E){var z=this,$=this.options,X=L.info;E=E+x.genUrlSep(E)+"id="+$.account+"&sv="+X.sdkVersion+"&pv="+X.protocolVersion+"&networkType="+L.ipVersion+"&hostEnv="+L.hostEnv+"&k="+$.appKey,this.logger.info("doRequestLbs ".concat(a(E).call(E,0,-32)));var Y=this;return new d(function(W,ee){L.isWeixinApp?wx.request({url:E,success:function(w){var J=w&&w.statusCode,V=w&&w.data;J===200?W(V):ee(V)},fail:function(w){ee(w)}}):z.adaptersRequest(E,{proxyUrl:x.url2origin(E)+"/lbs/res/cors/nej_proxy_frame.html",timeout:L.xhrTimeout,onload:function(w){try{var J=JSON.parse(w);W(J)}catch(V){Y.logger.warn("doRequestLbs parse JSON Error. request lbs failed"),ee(V)}},onerror:function(w){ee(w)}},{exception_service:1})})},P.disconnect=function(){var E=this,z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(){};if(this.isConnected())return this.sendCmd("logout"),void m(function(){u(P).disconnect.call(E,z)},0);this.connecting?this.logger.warn("IMProtocolFn api disconnect:: connecting but exiting"):this.statusProtector.getConnectStatus()!==_.V2NIM_CONNECT_STATUS_DISCONNECTED?this.logger.warn("IMProtocolFn api disconnect:: has tried to disconnect"):this.logger.warn("IMProtocolFn api disconnect:: other logic entered");var $=u(P);$.disconnect.call(this,z)},P.notifyDisconnect=function(E){u(P).notifyDisconnect.call(this,E)}},function(o,k,e){var r=e(102),i=e(57),s=e(103),n=e(3),u=e(10),p=e(23),d=e(25),m=e(6),c=e(2),h=e(17),a=e(5),y=e(58),T=e(59),v=e(60),g=e(61),b=e(47);function S(A,M){var U=a(A);if(y){var E=y(A);M&&(E=h(E).call(E,function(z){return T(A,z).enumerable})),U.push.apply(U,E)}return U}function O(A){for(var M=1;M<arguments.length;M++){var U,E,z=arguments[M]!=null?arguments[M]:{};M%2?c(U=S(Object(z),!0)).call(U,function($){i(A,$,z[$])}):v?g(A,v(z)):c(E=S(Object(z))).call(E,function($){b(A,$,T(z,$))})}return A}var I=e(35).fn,R=e(193),N=e(13),F="NIM-AllGrayscaleConfig",P="NIM-AllMixStorePolicy",x=e(0);function L(){var A=this;if(N.hasLocalStorage&&localStorage.getItem(F)){var M=null;try{M=JSON.parse(localStorage.getItem(F))[A.options.appKey]}catch(U){A.logger.error("appGrayConfig error",U)}M&&(A.appGrayConfig=M.timeStamp+1e3*M.ttl>new Date().getTime()?M:null,A.appGrayConfig&&_.apply(A))}A.appGrayConfig||A.sendCmd("getGrayscaleConfig",{providers:""},function(U,E){if(U)A.logger.error("Calculate Delay time, getGrayscaleConfig error",U);else if(E){var z=E;if(z.grayConfig=JSON.parse(z.grayConfig),z.ttl=Number(z.ttl),z.timeStamp=new Date().getTime(),A.appGrayConfig=z,N.hasLocalStorage){var $=localStorage.getItem(F)?JSON.parse(localStorage.getItem(F)):{};$[A.options.appKey]=z,localStorage.setItem(F,u($))}_.apply(A)}else A.logger.error("Calculate Delay time, getGrayscaleConfig error",E)})}function _(){var A=this;if(N.hasLocalStorage&&localStorage.getItem(P)){var M=null;try{M=JSON.parse(localStorage.getItem(P))[A.options.appKey]}catch(U){A.logger.error("mixStorePolicy error",U)}M&&(A.mixStorePolicy=M.timeStamp+1e3*M.ttl>new Date().getTime()?M:null,A.mixStorePolicy&&M.ttl&&M.ttl!==0&&(A.mixStorePolicyClock=p(d(_).call(_,A),1e3*M.ttl)))}A.mixStorePolicy||A.sendCmd("getMixStorePolicy",{providers:A.options.providers&&A.options.providers.s3?[1,2]:[1]},function(U,E){if(U){A.logger.error("Calculate Delay time, getMixStorePolicy error",U);try{E=JSON.parse(localStorage.getItem("NIM-AllMixStorePolicy"))[A.options.appKey]}catch(X){A.logger.error("error:","get last mixStorePolicy failed",X)}}else if(E){var z=E;if(z.ttl=Number(z.ttl),z.providers=z.providers.split(","),z.nosPolicy=z.nosPolicy?JSON.parse(z.nosPolicy):null,z.s3Policy=z.s3Policy?JSON.parse(z.s3Policy):null,z.timeStamp=new Date().getTime(),A.mixStorePolicy=z,z.ttl&&z.ttl!==0&&(A.mixStorePolicyClock=p(d(_).call(_,A),1e3*z.ttl)),N.hasLocalStorage){var $=localStorage.getItem(P)?JSON.parse(localStorage.getItem(P)):{};$[A.options.appKey]=z,localStorage.setItem(P,u($))}}else A.logger.error("Calculate Delay time, mixStorePolicy error",E)})}function C(A){var M=this,U=this;A.code===399?(this.logger.warn("pendingLoginFailed:399, refresh LBS url and reconnecting"),U.forceDisconnect(),U.doRefreshSocketUrl(N.ipVersion).then(function(){U.reconnect()}).catch(function(){M.logger.warn("pendingLoginFailed:399, refresh LBS url failed")})):A.code===398?(this.logger.warn("pendingLoginFailed:398 try to reconnect socket link，backoff set min 5s"),U.backoff.setMin(5e3),U.reconnect()):(this.logger.error("pendingLoginFailed: ",A.code,A),U.onAuthError(A,"link::onLogin"))}I.assembleLogin=function(){var A=this.assembleIMLogin();return this.addPushInfo instanceof Function?this.addPushInfo(A):n.resolve({login:A})},I.login=s(r.mark(function A(){var M,U,E,z=this;return r.wrap(function($){for(;;)switch($.prev=$.next){case 0:return M=this,$.next=3,M.assembleLogin();case 3:if(U=$.sent,!(E=this.socket&&this.socket.socket&&this.socket.socket.sessionid)){$.next=13;break}if(this.socketIds||(this.socketIds={}),!this.socketIds[E]){$.next=10;break}return this.logger.warn("onConnect::repeat login",E),$.abrupt("return");case 10:this.socketIds[E]=!0,$.next=14;break;case 13:this.logger.warn("onConnect:: no socketId ",this.socket&&this.socket.socket);case 14:this.logger.warn("link::doLogin: "+E+" appLogin is "+U.login.appLogin),M.sendCmd("login",O({},U),function(X,Y){if(X){var W=x.get(X,"event.uploadCode")||X&&X.code;W=typeof W!="number"?408:W;var ee=x.get(X,"event.disconnectReason"),w=ee?u({disconnect_reason:ee}):X&&X.message||"login failed";M.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",code:W,description:w,net_connect:M.checkNetworkAvailable(),succeed:!1}),M.reporter.reportTraceEnd("login",!1),C.call(M,X),M.statusProtector.emit("auth/loginLifeCycleLoginFail",X)}else M.reporter.reportTraceUpdateV2("login",{operation_type:"protocol",target:"2-3",succeed:!0,net_connect:M.checkNetworkAvailable(),code:200}),M.reporter.reportTraceEnd("login",!0),M.resetReconnectStatus(),z.heartbeatFail=0,z.hasLogin=!0,z.autoconnect=!0,M.startHeartbeat(),M.initOnlineListener(),M.statusProtector.emit("auth/loginLifeCycleLoginSucc"),M.afterLogin(Y)});case 16:case"end":return $.stop()}},A,this)})),I.afterLogin=function(A){var M=this;this.sendCmd("getNosCdnHost",{}),(typeof x.get(this.options,"privateConf.isMixStoreEnable")=="boolean"?this.options.privateConf.isMixStoreEnable:N.privateConf.isMixStoreEnable)&&L.apply(this),this.initPush instanceof Function&&this.initPush();var U=this.db;if(U.enable){var E=this.account;this.options.appendAppKeyForDBName&&(E+="-"+this.options.appKey),this.db.init(E).then(function(){M.notifyLogin(A),M.syncData()},function(z){M.logger.warn("link::afterLogin: no db",z),U.reset(!1),M.notifyLogin(A),M.syncData()})}else this.logger.info("link::afterLogin: no db"),this.notifyLogin(A),this.syncData()},I.getFileAuthToken=function(A){var M=this,U=M.mixStorePolicy.nosPolicy.authPolicy.policyType;U!==-1?m(U).call(U,A.type)<0?M.logger.error("this type Token error not support"):A.type!=3||A.urls&&A.urls.length?M.sendCmd("getBackSourceToken",{mixAuthTokenReq:A},function(E,z){if(E)return M.logger.error("getBackSourceToken error",E),E;A.done&&A.done(z)}):M.logger.error("urls is Required when type 3"):M.logger.error("don't need token")},I.processAuth=function(A){switch(A.cmd){case"login":A.error||(A.content=A.content||{},this.loginAndroidPush&&this.loginAndroidPush(A.content.aosPushInfo||{}),A.obj=A.content.loginRes,this.connectionId=A.content.loginRes.connectionId,this.onLoginPortsChange(A,2));break;case"kicked":return void this.onKicked(A);case"multiPortLogin":this.onLoginPortsChange(A,A.content.state);break;case"kick":A.error||(A.obj.deviceIds=A.content.deviceIds)}},I.onLoginPortsChange=function(A,M){var U=this,E=A.content.loginPorts;if(E&&E.length){var z=!0;switch(M){case 2:z=!0;break;case 3:z=!1}c(E).call(E,function($){$.type=R.reverseType($.type),$.customClientType&&($.customClientType=+$.customClientType),$.time=+$.time,$.online=z}),(E=h(E).call(E,function($){return $.connectionId!==U.connectionId})).length&&(U.logger.info("link::onLoginPortsChange:",E),U.options.onloginportschange(E))}},I.kickedReasons=["","samePlatformKick","serverKick","otherPlatformKick","silentlyKick"],I.kickedMessages=["","不允许同一个帐号在多个地方同时登录","被服务器踢了","被其它端踢了","悄悄被踢"]},function(o,k,e){var r=e(781),i=e(3),s=e(25),n=e(7),u=e(747),p=e(41),d=e(2),m=e(5),c=e(138),h=e(6),a=e(68),y=e(17),T=e(8),v=e(795),g=e(23),b=e(32),S=e(87),O=e(35).fn,I=e(0),R=e(40),N=I.undef,F=I.objs2ids,P=I.objs2accounts,x=I.teams2ids,L=e(152),_=I.getGlobal(),C=e(105).EMSyncType;O.beforeSync=function(){var A=this.db;return A.enable?A.clearSendingMsgs():i.resolve()},O.syncData=function(){var A=this,M=A.db,U=A.options,E=M.enable;function z($){var X;A.syncPromiseArray=[],A.syncResult={},A.syncTeamMembersPromiseArray=[],A.syncSuperTeamMembersPromiseArray=[],A.syncTeamMembersResult={},A.checkNosReqNum=0,A.getNosOriginUrlReqNum=0,I.verifyBooleanWithDefault(U,"syncRelations syncFriends syncFriendUsers syncTeams syncSuperTeams syncRoamingMsgs syncSuperTeamRoamingMsgs syncMsgReceipts syncExtraTeamInfo syncExtraSuperTeamInfo syncAvSignal",!0,"","sync::syncData"),I.verifyBooleanWithDefault(U,"syncFilter syncTeamMembers syncSuperTeamMembers",!1,"","sync::syncData");var Y={};$=$||{},_._nimForceSyncIM&&(A.logger.warn("sync::syncData: nimForceSyncIM"),delete $.teams,_._nimForceSyncIM=!1),Y.myInfo=$.myInfo||0,Y.deleteMsgSelf=$.deleteMsgSelf||0,Y.offlineMsgs=0,U.syncRelations&&(Y.relations=$.relations||0),U.syncFriends&&(Y.friends=$.friends||0),U.syncFriendUsers&&(Y.friendUsers=$.friendUsers||0),U.syncRobots&&(Y.robots=$.robots||0),U.syncTeams&&(Y.teams=$.teams||0),U.syncSuperTeams&&(Y.superTeams=$.superTeams||0),U.syncStickTopSessions&&(Y.stickTopSessions=$.stickTopSessions||0),U.syncSessionUnread&&(Y.sessionAck=E&&$.sessionAck||0,Y.superTeamSessionAck=E&&$.superTeamSessionAck||0),U.syncRoamingMsgs&&(Y.roamingMsgs=E&&$.roamingMsgs||$.roamingMsgs||0),U.syncSuperTeamRoamingMsgs&&(Y.superTeamRoamingMsgs=E&&$.superTeamRoamingMsgs||0),U.syncMsgReceipts&&(Y.msgReceipts=$.msgReceipts||0),U.syncExtraTeamInfo&&(Y.myTeamMembers=$.myTeamMembers||0),U.syncExtraSuperTeamInfo&&(Y.myInfoInSuperTeams=$.myInfoInSuperTeams||0),U.syncBroadcastMsgs&&(Y.broadcastMsgs=$.broadcastMsg||0),Y.donnop=$.donnop||0,Y.deleteMsg=$.deleteMsg||0,Y.deleteSuperTeamMsg=$.deleteSuperTeamMsg||0,Y.sessionHistoryMsgsDelete=$.sessionHistoryMsgsDelete||0,Y.netcallMsgs=0,U.syncFilter&&(Y.filterMsgs=0),U.syncAvSignal&&(Y.avSignal=0);var W=s(X=A.onSyncData).call(X,A);W.isImSyncDataCb=!0,A.logger.info("syncData:: start sync",Y),A.reporterHook.emit("reporter/syncStart"),A.sendCmd("sync",{sync:Y,isImSyncDataObj:!0},W)}A.syncing=!0,A.logger.log("sync::syncData: syncing = true"),E?A.beforeSync().then(function(){return A.db.getTimetags()}).then(function($){z($)},function(){z()}):z(A.timetags)},O.onSyncData=function(A){A&&(A.callFunc="sync::onSyncData",this.onCustomError("SYNC_DATA_ERROR",A))},O.processSync=function(A){switch(this.logger.log("sync::processSync cmd: ".concat(A.cmd)),A.cmd){case"syncDone":if(A.error){var M,U=I.get(A.error,"message"),E=I.get(A.error,"code");this.logger.error(n(M="sync::processSync syncDoneError errMsg: ".concat(U,", errCode: ")).call(M,E)),this.logger.error("sync::processSync disconnect because syncDone failed");var z=R.syncError({errMsg:U,errCode:E});this.shouldReconnect=!1,this.markAllCallbackInvalid(z),this.notifyDisconnect(z)}else this.timetags.sync=A.content.timetag,this.reporterHook.emit("reporter/syncRecv"),this.onSyncDone();break;case"syncTeamMembersDone":this.onSyncTeamMembersDone()}},O.onSyncDone=function(){var A,M,U,E,z,$,X,Y,W,ee,w,J,V,D,Q,G,B,q,H,K,Z,te,ne,re,se,oe,ae,pe,ge,fe,ie=this,me=ie.db,ye=me.enable,de=ie.options,ue=ie.syncPromiseArray,ce=ie.syncResult;function ve(){if(ue){ie.logger.info("sync::onSyncDone: after sync",I.promises2cmds(ue)),ue=[],M=ce.blacklist||[],U=ce.invalidBlacklist||[],E=ce.mutelist||[],z=ce.invalidMutelist||[],$=ce.friends,W=ce.myTeamMembers,ee=ce.mySuperTeamMembers,X=ce.invalidFriends||[],Y=ce.myInfo,w=ce.users,V=ce.superTeams,Q=ce.invalidSuperTeams,J=ce.teams,D=ce.invalidTeams||[],G=ce.sessions||{},B=u(p({},ie.sessionSet)),q=ce.ackMap,ce.msgReceipts,H=ce.roamingMsgs,K=ce.offlineMsgs,Z=ce.offlineFilterMsgs,ne=ce.offlineSysMsgs,re=ce.offlineCustomSysMsgs,se=ce.offlineFilterSysMsgs,oe=ce.offlineFilterCustomSysMsgs,ae=ce.sysMsgUnread,pe=ce.sessionsWithMoreRoaming,fe=ce.clearServerHistoryMsgs||[];var ke=i.resolve();(function(){if(ye){var Ie,Pe=[be()];G&&d(Ie=m(G)).call(Ie,function(le){Pe.push(me.putSession(G[le]))}),ke=i.all(Pe).then(function(){var le,Se=n(le=[]).call(le,r(m(q||{})),r(m(G||{})));Se=y(Se).call(Se,function(we,Ce,Me){return h(Me).call(Me,we)===Ce});var Ae=[];return d(Se).call(Se,function(we){var Ce,Me=G[we];(Me.lastMsg||Me.ack)&&(Ce=(Ce=Me.ack?i.resolve(Me):me.getSession(Me.id)).then(function(he){var Ne=he.ack||0;return me.getMsgCountAfterAck({shouldCountNotifyUnread:ie.options.shouldCountNotifyUnread,sessionId:we,ack:Ne}).then(function(Oe){return he.unread=Oe||0,G[we]=ie.mergeSession(he),me.updateSession(he)})}),Ae.push(Ce))}),i.all(Ae)}).then(function(){var le=[];return ie.saveAck.p2pTeam&&le.push(me.updateSessionAck(ie.saveAck.p2pTeam).catch(function(Se){return ie.logger.error("sessionAck::syncSessionAck::updatetimetag db",Se),i.reject(Se)})),ie.saveAck.superTeam&&le.push(me.updateSuperTeamSessionAck(ie.saveAck.superTeam).catch(function(Se){return ie.logger.error("sessionAck::syncSuperTeamSessionAck::updatetimetag db",Se),i.reject(Se)})),i.all(le)})}else if(G){var Ee,_e,je;d(Ee=[H,K]).call(Ee,function(le){le&&d(le).call(le,function(Se){var Ae;(_e=G[Se.sessionId]).unread=_e.unread||0,_e.unreadMsgs=_e.unreadMsgs||[],je=_e.ack||0,d(Ae=Se.msgs).call(Ae,function(we){if(!(je>=we.time))if(we.type==="notification"){var Ce;try{Ce=ie.options.shouldCountNotifyUnread(we)}catch(Me){throw ie.logger.error("userOption:shouldCountNotifyUnread function error",Me),Me}Ce&&_e.unread++}else we.flow==="in"&&we.isUnreadable!==!1&&(_e.unread++,_e.unreadMsgs.push(we))}),ie.mergeSession(_e)})})}})(),ie.syncDonePromiseArray=ie.syncDonePromiseArray||[],ke.then(function(){if(ye&&!ie.hasSynced)ie.hasSynced=!0,function(){de.syncRelations&&(A=me.getRelations().then(function(le){M=le[0],E=le[1],M.invalid=U,E.invalid=z}).catch(function(le){return le._msg="on relations error",ie.logger.error("sync::syncRelation: ",le),i.reject(le)}),ue.push(A)),de.syncFriends&&(A=me.getFriends().then(function(le){($=le).invalid=X}).catch(function(le){return le._msg="on friends error",ie.logger.error("sync::syncFriends: ",le),i.reject(le)}),ue.push(A)),N(Y)&&(A=me.getUser(ie.account).then(function(le){Y=le}).catch(function(le){return le._msg="on myInfo error",ie.logger.error("sync::syncMyInfo: ",le),i.reject(le)}),ue.push(A)),de.syncFriendUsers&&(A=me.getFriends().then(function(le){return T(le).call(le,function(Se){return Se.account})}).then(function(le){return me.getUsers(le)}).then(function(le){w=le}).catch(function(le){return le._msg="on users error",ie.logger.error("sync::syncFriendUser: ",le),i.reject(le)}),ue.push(A)),de.syncTeams&&(A=me.getTeams().then(function(le){(J=le).invalid=D}).catch(function(le){return le._msg="on teams error",ie.logger.error("sync::syncTeams: ",le),i.reject(le)}),ue.push(A)),de.syncSuperTeams&&(A=me.getSuperTeams().then(function(le){(V=le).invalid=Q}).catch(function(le){return le._msg="on superteams error",ie.logger.error("sync::syncSuperTeams: ",le),i.reject(le)}),ue.push(A)),A=me.getTeamMembersByAccount(ie.account).then(function(le){W=le,ie.mergeMyTeamMembers(le)}).catch(function(le){return ie.logger.error("sync::getTeamMembersByAccount: ",le),i.reject(le)}),ue.push(A),A=me.getSuperTeamMembersByAccount(ie.account).then(function(le){ee=le,ie.mergeMySuperTeamMembers(le)}).catch(function(le){return ie.logger.error("sync::getSuperTeamMembersByAccount: ",le),i.reject(le)}),ue.push(A),A=me.getDonnop().then(function(le){ie.mergeDonnop(le)}).catch(function(le){return ie.logger.error("sync::donnop: ",le),i.reject(le)}),ue.push(A),A=me.getAllSessions().then(function(le){G=le}).catch(function(le){return ie.logger.error("sync::getSession: ",le),i.reject(le)}),ue.push(A),A=me.getSysMsgUnread().then(function(le){ae=le}).catch(function(le){return le._msg="on sysMsgUnread error",ie.logger.error("sync::getSysMsgUnread: ",le),i.reject(le)}),ue.push(A),ue.push(me.getSessionsWithMoreRoaming().then(function(le){pe=le}))}();else{var Ie,Pe,Ee=[];d(Ie=m(G)).call(Ie,function(le){(Pe=G[le]).lastMsg&&Ee.push(Pe)}),G=c(Ee).call(Ee,function(le,Se){return Se.updateTime-le.updateTime})}var _e=i.all(ue);function je(le){var Se;le||(ie.syncDonePromiseSuccessCount+=1);var Ae,we=h(Se=ie.syncDonePromiseArray).call(Se,_e);we>-1&&a(Ae=ie.syncDonePromiseArray).call(Ae,we,1),ie.logger.log("afterSync::syncDonePromiseHandler syncPromiseArray length: ",ie.syncDonePromiseArray.length,"success count: ",ie.syncDonePromiseSuccessCount),ie.syncDonePromiseArray.length===0&&ie.syncDonePromiseSuccessCount>0?(ie.logger.log("onSyncDone afterSync last syncDonePromsie. Execute taskAfterSync and notifyData"),function(){ie.logger.info("sync::onSyncDone: taskAfterSync"),function(){if(ce.deleteMsgSysMsgs){var Me,he={};H&&d(H).call(H,function(Te){he[Te.sessionId]=Te});var Ne={};K&&d(K).call(K,function(Te){Ne[Te.sessionId]=Te});var Oe=ie.api;if(d(Me=ce.deleteMsgSysMsgs).call(Me,function(Te){var Re;d(Re=Te.sysMsgs).call(Re,function(Ve){var Be=Ve.msg,Ue=Be.sessionId;Te.type==="roaming"&&he[Ue]?he[Ue].msgs=Oe.cutMsgs(he[Ue].msgs,Be):Ne[Ue]&&(Ne[Ue].msgs=Oe.cutMsgs(Ne[Ue].msgs,Be))})}),!me.enable){var qe,He=n(qe=[]).call(qe,r(H||[]),r(K||[]));d(He).call(He,function(Te){if(Te.msgs.length){var Re=ie.genSessionByMsgs(Te.msgs);ie.cacheSyncedSession(Re),G.unshift(Re)}else{var Ve=v(G).call(G,function(Be){return Be.id===Te.sessionId});a(G).call(G,Ve,1)}});var Fe={};d(G).call(G,function(Te){if(Fe[Te.id]){var Re=Te.lastMsg.time>Fe[Te.id].lastMsg.time?Te.lastMsg:Fe[Te.id].lastMsg;Fe[Te.id]=Te,Fe[Te.id].lastMsg=Re}else Fe[Te.id]=Te}),G=u(Fe),G=c(G).call(G,function(Te,Re){return Re.updateTime-Te.updateTime})}}}(),ge=ie.syncResult.stickTopSessions||[],d(ge).call(ge,function(Me,he){ge[he]=ie.mergeSession(Me)}),d(G).call(G,function(Me){var he=ie.sessionSet[Me.id];he&&he.isTop&&(Me.isTop=!0)});var Ce=[ie.deleteMsgOfflineRoaming(ce.deleteMsgSysMsgs,G)];return fe&&d(fe).call(fe,function(Me){Ce.push(function(he,Ne){var Oe;ie.logger.info("sync::taskAfterSync:sessionHistoryMsgsDelete ".concat(he)),Ne=Ne||new Date().getTime();var qe=y(G).call(G,function(Re){return Re.id===he}),He=ie.getSessionInCache(he);Oe=He||qe[0];var Fe=de.rollbackClearMsgsUnread!==!1,Te=[];return me.enable&&Te.push(me.deleteMsgsBySessionId({sessionId:he,end:Ne})),Fe&&Oe&&(Oe.lastMsg=null,Oe.unread=0,Oe=ie.mergeSession(Oe),me.enable&&Te.push(me.updateSession(Oe))),i.all(Te)}(Me.sessionId,Me.time))}),i.all(Ce)}().then(xe,function(Ce){ie.logger.error("taskAfterSync syncDBDataPromise error:",Ce),Ce.callFunc="sync::onSyncDone",Ce.message="taskAfterSync+notifyData 出错",ie.onCustomError("SYNC_SESSION_ACK_ERROR",Ce)})):le?(ie.logger.error("onSyncDone afterSync syncDonePromise Error:",le),le.callFunc="sync::onSyncDone",le.message="pullFullData 出错",ie.onCustomError("SYNC_SESSION_ACK_ERROR",le)):ie.logger.log("onSyncDone afterSync syncDonePromise success, wait for next syncDonePromise")}ie.syncDonePromiseArray.length===0&&(ie.syncDonePromiseSuccessCount=0),ie.syncDonePromiseArray.push(_e),_e.then(function(){return je()}).catch(function(le){return je(le)})})}else ie.logger.warn("sync::onSyncDone: after sync --no promiseArray")}function be(){var ke=[];return H&&d(H).call(H,function(Ie){var Pe;ke=n(Pe=[]).call(Pe,r(ke),r(Ie.msgs))}),K&&d(K).call(K,function(Ie){var Pe;ke=n(Pe=[]).call(Pe,r(ke),r(Ie.msgs))}),ke.length?me.putMsg(ke).then(function(){return ke}):i.resolve(ke)}function xe(){g(Le,0)}function Le(){var ke,Ie,Pe=[],Ee=[];if(M&&M.length&&(ie.logger.info("sync::notifyDataAsync: on blacklist",P(M)),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType3_8),de.onblacklist(M)),E&&E.length&&(ie.logger.info("sync::notifyDataAsync: on mutelist",P(E)),de.onmutelist(E)),$&&(ie.logger.info("sync::notifyDataAsync: on friends",P($)),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType12_5),de.onfriends($)),Y&&(ie.logger.info("sync::notifyDataAsync: on myInfo"),ie.myInfo=Y,ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType3_109),de.onmyinfo(I.copy(Y))),W){ie.logger.info("sync::notifyDataAsync: on myTeamMembers",W),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType8_126);var _e=I.simpleClone(W);b(_e)||(_e=[_e]),de.onMyTeamMembers(_e)}if(ee){ie.logger.info("sync::notifyDataAsync: on mySuperTeamMembers",ee),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType21_111);var je=I.simpleClone(ee);b(je)||(je=[je]),de.onMySuperTeamMembers(je)}w&&(d(w).call(w,function(he){ie.mergeUser(he)}),ie.logger.info("sync::notifyDataAsync: on users",P(w)),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType12_6),de.onusers(w)),J&&(ie.logger.info("sync::notifyDataAsync: on teams",x(J)),de.onteams(J),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType8_109)),V&&(ie.logger.info("sync::notifyDataAsync: onSuperTeams",x(V)),de.onSuperTeams(V),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType21_109)),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_12),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_14),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_20),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_21),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType7_15),G&&G.length?(G=T(G).call(G,function(he){return ie.mergeSession(he),S(L).call(L,he)}),G=y(G).call(G,function(he){return!he.isDeleted}),ie.logger.info("sync::notifyDataAsync: on sessions",F(G),I.secureOutput("session",G)),!ye&&ie.timetags&&ie.timetags.roamingMsgs?de.onsessions(y(B).call(B,function(he){return L.isComplete(he)})):de.onsessions(G)):!ye&&B.length&&(ie.logger.info("sync::notifyDataAsync: on sessions",F(G),I.secureOutput("session",G)),de.onsessions(y(B).call(B,function(he){return L.isComplete(he)}))),ge&&ge.length&&(ge=T(ge).call(ge,function(he){return he=ie.mergeSession(he),S(L).call(L,he)}),ie.logger.info("sync::notifyDataAsync: onStickTopSessions",F(ge),I.secureOutput("session",ge)),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_23),de.onStickTopSessions(ge)),H&&d(H).call(H,function(he){he.scene==="superTeam"?Ee.push(he.timetag):Pe.push(he.timetag),(Ie=he.msgs).length&&(ie.logger.info("sync::notifyDataAsync: on roaming msgs",he.sessionId,Ie.length),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_9),de.onroamingmsgs(he))}),K&&(ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_4),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_17),d(K).call(K,function(he){he.scene==="superTeam"?Ee.push(he.timetag):Pe.push(he.timetag),(Ie=he.msgs).length&&(ie.logger.info("sync::notifyDataAsync: on offline msgs",he.sessionId,Ie.length,T(Ie).call(Ie,function(Ne){return Ne.idServer})),de.onofflinemsgs(he))})),Z&&(ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_100),d(Z).call(Z,function(he){Pe.push(he.timetag),(Ie=he.msgs).length&&(ie.logger.info("sync::notifyDataAsync: on offline filter msgs",he.sessionId,Ie.length),de.onofflinefiltermsgs(Ie))})),pe&&(ie.logger.info("sync::notifyDataAsync: on sessionsWithMoreRoaming",F(pe),pe),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_22),de.onSessionsWithMoreRoaming(pe));var le,Se=[],Ae=[];ce.deleteMsgSysMsgs&&d(le=ce.deleteMsgSysMsgs).call(le,function(he){he.type==="roaming"?Se=n(Se).call(Se,he.sysMsgs):Ae=n(Ae).call(Ae,he.sysMsgs)}),Se.length&&(te=n(te=te||[]).call(te,Se)),Ae.length&&(ne=n(ne=ne||[]).call(ne,Ae)),te&&(ie.logger.info("sync::notifyDataAsync: on roaming sys msgs",te.length),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_19),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_15),de.onroamingsysmsgs(te)),ne&&(ie.logger.info("sync::notifyDataAsync: on offline sys msgs",ne.length),de.onofflinesysmsgs(ne)),se&&(ie.logger.info("sync::notifyDataAsync: on offline filter sys msgs",se.length),de.onofflinefiltersysmsgs(se)),re&&(ie.logger.info("sync::notifyDataAsync: on offline custom sys msgs",re.length),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_6),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_18),de.onofflinecustomsysmsgs(re)),oe&&(ie.logger.info("sync::notifyDataAsync: on offline filter custom sys msgs",oe.length),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_101),de.onofflinefiltercustomsysmsgs(oe)),ae&&(ae=I.merge({},ie.sysMsgUnread,ae),ie.sysMsgUnread=I.merge({},ae),ie.logger.info("sync::notifyDataAsync: on sysMsgUnread",ae),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_6),de.onsysmsgunread(ae));var we=ie.getPushNotificationMultiportConfig();ie.logger.info("sync::notifyDataAsync: on pushNotificationMultiportConfig",we),ie.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_13),de.onPushNotificationMultiportConfig(we);var Ce=Ee.length&&Math.max.apply(Math,Ee);if(ke=Pe.length&&Math.max.apply(Math,Pe),me.enable){var Me=[];Ce&&Me.push(ie.db.updateSuperTeamRoamingMsgTimetag(Ce)),ke&&Me.push(ie.db.updateRoamingMsgTimetag(ke)),i.all(Me).then(De).catch(De)}else ie.timetags.superTeamRoamingMsgs=Ce,ie.timetags.roamingMsgs=ke||ie.timetags.roamingMsgs,De();ie.syncPromiseArray=[],ie.syncResult={}}function De(){if(ie.processUnsettledMsgs(),ie.msgPromise.then(function(){ie.canHandleDeletedMsgInSyncing=!0,g(function(){ie.processUnsettledSysMsgs()},0)}),ie.syncing&&de.onsyncdone(),ie.syncing=!1,ie.logger.log("sync::onsyncdone: syncing = false"),ie.reporterHook.emit("reporter/syncComplete"),de.syncTeamMembers&&J&&J.length)throw new R("sync team members api deprecated!")}ue&&ue.length?i.all(ue).then(ve).catch(function(ke){ve(),ie.logger.error(ke),ke.callFunc="sync::onSyncDone",ke.message="afterSync syncNormalPromise 出错",ie.onCustomError("SYNC_promiseArray_ERROR",ke)}):ve()},O.syncTeamMembers=function(A){var M,U,E=this;E.timetags,U={},d(A).call(A,function(z){U[z.teamId]=0},E),E.sendCmd("syncTeamMembers",{sync:U},s(M=E.onSyncTeamMembers).call(M,E))},O.onSyncTeamMembers=function(A){A.callFunc="sync::onSyncTeamMembers",A.message="同步群成员错误",this.onCustomError("SYNC_TEAM_MEMBERS_ERROR",A)},O.onSyncTeamMembersDone=function(){var A,M=this,U=M.db,E=M.options,z=M.syncTeamMembersResult,$=M.syncTeamMembersPromiseArray;function X(){M.logger.log("sync::onSyncTeamMembersDone: afterSync",I.promises2cmds($)),$=[],U.enable&&!M.hasSyncedTeamMembers?(M.hasSyncedTeamMembers=!0,function(){if(!E.syncTeams||!E.syncTeamMembers)return ee();U.getTeams().then(function(w){d(w).call(w,function(J){var V=J.teamId;A=new i(function(D,Q){M.api.getTeamMembers({teamId:V,done:function(G,B){G&&Q({callFunc:"sync::getTeamMembers: teamId-".concat(V),message:"sync team members error"}),z[V]=B.members||[],D()}})}),$.push(A)}),$.length?i.all($).then(Y,function(J){J.callFunc="sync::onSyncTeamMembersDone",J.message="pullFullData promiseArray notifyData 错误",M.onCustomError("SYNC_TEAM_MEMBERS_ERROR",J)}):Y()},function(w){w.callFunc="sync::onSyncTeamMembersDone",w.message="pullFullData getTeams 错误",M.onCustomError("SYNC_TEAM_MEMBERS_ERROR",w)})}()):Y()}function Y(){g(W,0)}function W(){var w,J,V;d(w=m(z)).call(w,function(D){h(D).call(D,"invalid")===-1&&(J=z[D],V=z[D+"-invalid"]||[],J.invalid=V,function(Q,G){M.logger.info("sync::onSyncTeamMembersDone: onTeamMembers",Q,P(G),G),E.onteammembers({teamId:Q,members:G})}(D,J))}),ee()}function ee(){M.logger.info("sync::onSyncTeamMembersDone: bingo"),E.onsyncteammembersdone(),M.syncTeamMembersResult=null,M.syncTeamMembersPromiseArray=null}$.length?i.all($).then(X,function(w){w.callFunc="sync::onSyncTeamMembersDone",w.message="同步群成员 syncTeamMembersPromiseArray 错误",M.onCustomError("SYNC_TEAM_MEMBERS_ERROR",w)}).catch(function(w){M.logger.log("sync::onSyncTeamMembersDone: syncTeamMembersPromiseArray promise ",w),X()}):X()}},function(o,k,e){var r=e(782),i=e(786),s=e(746),n=e(790);o.exports=function(u){return r(u)||i(u)||s(u)||n()},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(743),i=e(744);o.exports=function(s){if(r(s))return i(s)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(784)},function(o,k,e){var r=e(785);o.exports=r},function(o,k,e){var r=e(299);o.exports=r},function(o,k,e){var r=e(153),i=e(69),s=e(745);o.exports=function(n){if(r!==void 0&&i(n)!=null||n["@@iterator"]!=null)return s(n)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(788)},function(o,k,e){var r=e(789);o.exports=r},function(o,k,e){var r=e(300);o.exports=r},function(o,k){o.exports=function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(792);o.exports=r},function(o,k,e){e(793);var r=e(12);o.exports=r.Object.values},function(o,k,e){var r=e(1),i=e(794).values;r({target:"Object",stat:!0},{values:function(s){return i(s)}})},function(o,k,e){var r=e(27),i=e(11),s=e(118),n=e(43),u=i(e(148).f),p=i([].push),d=function(m){return function(c){for(var h,a=n(c),y=s(a),T=y.length,v=0,g=[];T>v;)h=y[v++],r&&!u(a,h)||p(g,m?[h,a[h]]:a[h]);return g}};o.exports={entries:d(!0),values:d(!1)}},function(o,k,e){o.exports=e(796)},function(o,k,e){var r=e(797);o.exports=r},function(o,k,e){var r=e(21),i=e(798),s=Array.prototype;o.exports=function(n){var u=n.findIndex;return n===s||r(s,n)&&u===s.findIndex?i:u}},function(o,k,e){e(799);var r=e(30);o.exports=r("Array").findIndex},function(o,k,e){var r=e(1),i=e(84).findIndex,s=e(196),n=!0;"findIndex"in[]&&Array(1).findIndex(function(){n=!1}),r({target:"Array",proto:!0,forced:n},{findIndex:function(u){return i(this,u,arguments.length>1?arguments[1]:void 0)}}),s("findIndex")},function(o,k,e){var r=e(8),i=e(9),s=e(3),n=e(2),u=e(35).fn,p=e(0),d=p.objs2accounts,m=e(801),c=e(203);u.processUser=function(h){var a,y=this,T=y.db,v=h.obj,g=h.error,b=h.content;switch(h.cmd){case"markInBlacklist":g||y.markInBlacklist(v);break;case"syncMarkInBlacklist":y.markInBlacklist(b,!0);break;case"markInMutelist":g||y.markInMutelist(v);break;case"syncMarkInMutelist":y.markInMutelist(b,!0);break;case"getRelations":g||y.onRelations(h);break;case"syncMyInfo":y.onMyInfo(h,!0);break;case"updateMyInfo":g||(v.user.updateTime=b.timetag,y.onUpdateMyInfo(h,v.user));break;case"syncUpdateMyInfo":y.onUpdateMyInfo(h,b.user,!0);break;case"getUsers":var S;g||(a=r(S=b.users).call(S,function(O){return O=i(c).call(c,O,y.mixStorePolicy&&y.mixStorePolicy.s3Policy?y.mixStorePolicy.s3Policy.dlcdns:[],y.mixStorePolicy&&y.mixStorePolicy.s3Policy?y.mixStorePolicy.s3Policy.dlcdn:""),y.mergeUser(O),O}),h.obj=a,T.enable&&T.putUsers(a));break;case"updateDonnop":y.onUpdateDonnop(h);break;case"syncUpdateDonnop":y.onDonnop(h,!1)}},u.onMyInfo=function(h){var a,y=this,T=y.db,v=h.error,g=h.content,b=new s(function(O,I){var R,N;v?(v&&(v.callFunc="user::onMyInfo"),O(v),y.syncData()):(a=i(c).call(c,g.user),T.enable?(R=O,N=I,T.mergeMyInfo(a,!0).then(function(){S(),R()}).then(void 0,function(F){F.message="db.mergeMyInfo error",F.callFunc="user::onMyInfo",N(F)})):(S(),O()))}).catch(function(O){return y.logger.error("user::onMyInfo: ",O),s.reject(O)});function S(){y.timetags.myInfo=a.updateTime,y.syncResult.myInfo=a}b.cmd="myInfo",y.syncPromiseArray.push(b)},u.onUpdateMyInfo=function(h,a,y){var T=this.db,v=i(c).call(c,a),g=p.merge(this.myInfo,v);this.myInfo=g,y?(this.logger.info("user::onUpdateMyInfo:",g&&g.account),this.options.onupdatemyinfo(g)):h.obj=g,T.enable&&(v.account=this.account,T.updateUser(v))},u.onRelations=function(h){var a,y=this,T=y.db,v=h.error,g=y.packetFromSync(h),b=h.content.specialRelations,S=!0,O=[],I=[],R=[],N=[],F=new s(function(x,L){var _,C;v?g&&(x(v),y.syncData()):(n(b).call(b,function(A){var M={account:(A=m.parse(A)).account,createTime:A.createTime,updateTime:A.updateTime};A.isBlacked?O.push(M):I.push(M),A.isMuted?R.push(M):N.push(M)}),y.logger.info("user::onRelations: parse blacklist",d(O),O,"delete",d(I),I),y.logger.info("user::onRelations: parse mutelist",d(R),R,"delete",d(N),N),b.length?(S=!0,a=h.content.timetag):S=!1,T.enable?(_=x,C=L,h.promise=new s(function(A,M){function U(){g?(P(),A(),_()):T.getRelations().then(function(E){O=E[0],R=E[1],P(),A(),_()}).then(void 0,function(E){E.message="db.getRelations error",E.callFunc="user::onRelations",M(E),C(E)})}S?T.mergeRelations(O,I,R,N,a).then(function(){U()}).then(void 0,function(E){E.message="db.mergeRelations error",E.callFunc="user::onRelations",M(E),C(E)}):(y.logger.warn("user::onRelations: no relations need merge"),U())}).then(void 0,function(A){throw A.message="merge relations data error",A.callFunc="user::onRelations",C(A),A})):(P(),x()))}).catch(function(x){return y.logger.error("user::onRelations: ",x),s.reject(x)});function P(){y.timetags.relations=a,O.invalid=I,R.invalid=N,g?(y.syncResult.blacklist=O,y.syncResult.mutelist=R,y.syncResult.invalidBlacklist=I,y.syncResult.invalidMutelist=N):(y.logger.info("user::onRelations: get relations",O,R),h.obj.blacklist=O,h.obj.mutelist=R)}g&&(F.cmd="relations",y.syncPromiseArray.push(F))},u.markInBlacklist=function(h,a){var y=this.db;h.record={account:h.account,updateTime:+new Date},y.enable&&y.markInBlacklist(h),a&&(this.logger.info("user::markInBlacklist:",h),this.options.onsyncmarkinblacklist(h))},u.markInMutelist=function(h,a){var y=this.db;h.record={account:h.account,updateTime:+new Date},y.enable&&y.markInMutelist(h),a&&(this.logger.info("user::markInMutelist:",h),this.options.onsyncmarkinmutelist(h))},u.mergeUser=function(h){this.userSet[h.account]=h}},function(o,k,e){var r=e(0);function i(){}i.parse=function(s){var n=r.copy(s);return n.isBlacked=n.isBlacked==="1",n.isMuted=n.isMuted==="1",n.createTime=+n.createTime,n.updateTime=+n.updateTime,n},o.exports=i},function(o,k,e){var r=e(120),i=e(2),s=e(9),n=e(3),u=e(7),p=e(8),d=["type"],m=e(35).fn,c=e(0),h=c.objs2accounts,a=e(748),y=e(203);m.processFriend=function(T){var v=T.obj,g=T.content,b=T.error;switch(T.cmd){case"friendRequest":this.updateFriendSysMsg(T),b||this.onFriendRequest(v);break;case"syncFriendRequest":this.onFriendRequest(g,!0);break;case"deleteFriend":b||this.onDeleteFriend(v);break;case"syncDeleteFriend":this.onDeleteFriend(g,!0);break;case"updateFriend":b||this.onUpdateFriend(v);break;case"syncUpdateFriend":this.onUpdateFriend(g.friend,!0);break;case"getFriends":this.getFriends(T);break;case"syncFriends":this.onFriends(T);break;case"syncFriendUsers":this.onFriendUsers(T)}},m.getFriends=function(T){var v=T.content.friends,g=[],b=[];i(v).call(v,function(S){(S=s(a).call(a,S)).valid?g.push(S):b.push(S)}),g.invalid=b,T.obj=g},m.onFriends=function(T){var v,g=this,b=g.db,S=T.error,O=T.content.friends,I=!0,R=[],N=[],F=new n(function(x,L){var _,C;S?L(S):(function(){I&&i(O).call(O,function(A){(A=s(a).call(a,A)).valid?R.push(A):N.push(A)}),g.logger.info("friend::onFriends: parse friends",h(R),"delete",h(N)),O.length?(I=!0,v=T.content.timetag):I=!1}(),b.enable?(_=x,C=L,T.promise=new n(function(A,M){function U(){P(),A(),_()}I?b.mergeFriends(R,N,v).then(function(){U()}).then(void 0,function(E){E._msg="merge friends error",M(E),C(E)}):(g.logger.info("friend::onFriends: no merge friends"),U())}).then(void 0,function(A){throw A._msg="merge friends data error",C(A),A})):(P(),x()))}).catch(function(x){return g.logger.error("friend::onFriends: ",x),n.reject(x)});function P(){var x,L;g.timetags.friends=v,R.invalid=N,g.syncResult.friends=u(x=g.syncResult.friends||[]).call(x,R||[]),g.syncResult.invalidFriends=u(L=g.syncResult.invalidFriends||[]).call(L,N||[])}F.cmd="friends",g.syncPromiseArray.push(F)},m.onFriendRequest=function(T,v){var g=n.resolve(),b=this.db,S=T.type,O=r(T,d);if((S=T.type=a.getTypeFromByte(S)||S)==="addFriend"||S==="passFriendApply"){var I=T.friend=a.assembleFriend(O);b.enable&&(g=b.putFriend(I))}return v&&this.onSyncFriendAction(T),g},m.onSyncFriendAction=function(T){this.logger.info("friend::onSyncFriendActionon: ".concat(T.type,", "),T.account),this.options.onsyncfriendaction(T)},m.onDeleteFriend=function(T,v){var g=n.resolve(),b=this.db;return b.enable&&(g=b.deleteFriend(T.account)),v&&(T.type="deleteFriend",this.onSyncFriendAction(T)),g},m.onUpdateFriend=function(T,v){var g=this.db,b=s(a).call(a,T);g.enable&&g.updateFriend(b),v&&this.onSyncFriendAction({type:"updateFriend",friend:b})},m.onFriendUsers=function(T){var v,g,b=this.db,S=T.content,O=p(v=S.users).call(v,function(N){return s(y).call(y,N)});this.logger.info("friend::onFriendUsers: parse users",h(O));var I=S.timetag,R=n.resolve();b.enable&&(R=b.mergeFriendUsers(O,I)),this.timetags.friendUsers=I,R.cmd="friendUsers",this.syncPromiseArray.push(R),this.syncResult.users=u(g=this.syncResult.users||[]).call(g,O||[]),this.syncing||this.onSyncDone()},m.updateFriendSysMsg=function(T){var v,g,b=T.obj,S=T.error;if(T.obj.idServer){if(S)v="error",S=c.filterObj(S,"code message");else{var O=b.type;switch(O=a.getTypeFromByte(O)||O){case"passFriendApply":v="passed";break;case"rejectFriendApply":v="rejected"}}g={idServer:b.idServer,state:v,from:b.account,type:"applyFriend"},S&&(g.error=S),this.updateSysMsg(g)}}},function(o,k,e){var r=e(32),i=e(17),s=e(35).fn,n=e(0);s.onRobots=function(u){var p=u.content;if(n.isFunction(this.options.onrobots)&&r(p.robots)){var d,m=i(d=p.robots).call(d,function(c){return!!c.botid});m.length>0&&this.options.onrobots(m||[])}}},function(o,k,e){var r=e(9),i=e(2),s=e(23),n=e(171),u=e(3),p=e(8),d=e(17),m=e(5),c=e(35).fn,h=e(0),a=h.objs2accounts,y=h.teams2ids,T=e(192),v=e(150);c.processTeam=function(g){var b,S,O,I=g.error;switch(g.obj===void 0&&(g.obj={}),g.cmd){case"createTeam":b=g.obj.team,I||(b=g.content.team),b=r(T).call(T,b),g.obj.team=b,O=v.assembleOwner(b),g.obj.owner=O,I||(this.logger.info("team::processTeam: create team ",b&&b.teamId,O&&O.account),this.onCreateTeam(b,O));break;case"syncCreateTeam":b=r(T).call(T,g.content.team),O=v.assembleOwner(b),this.logger.info("team::processTeam: sync createTeam",b&&b.teamId,O&&O.account),this.options.onsynccreateteam(b,O),this.onCreateTeam(b,O);break;case"sendSuperTeamMsg":case"sendTeamMsg":this.onSendMsg(g);break;case"teamMsg":this.onMsg(g);break;case"teamMsgs":this.onMsgs(g);break;case"addTeamMembers":case"removeTeamMembers":case"leaveTeam":case"dismissTeam":case"addTeamManagers":case"removeTeamManagers":case"transferTeam":break;case"updateInfoInTeam":I||((S=g.obj).account=this.account,S.id=v.genId(S.teamId,S.account),S=r(v).call(v,S),g.obj=S,this.mergeMyTeamMembers(S),this.onUpdateTeamMember(S));break;case"updateNickInTeam":g.obj=r(v).call(v,g.obj);break;case"updateTeam":g.obj=r(T).call(T,g.obj,!0);break;case"applyTeam":g.error||(g.obj=r(T).call(T,g.content.team));break;case"passTeamApply":this.updateTeamSysMsgState(g,"passed");break;case"rejectTeamApply":this.updateTeamSysMsgState(g,"rejected");break;case"acceptTeamInvite":this.updateTeamSysMsgState(g,"passed"),g.error||(g.obj=r(T).call(T,g.content.team));break;case"rejectTeamInvite":this.updateTeamSysMsgState(g,"rejected");break;case"getTeam":g.error||(g.obj=r(T).call(T,g.content.team));break;case"getTeams":this.onTeams(g);break;case"getTeamMembers":this.onTeamMembers(g);break;case"syncTeams":this.onTeams(g);break;case"syncTeamMembers":this.onTeamMembers(g);break;case"getTeamHistoryMsgs":case"searchTeamHistoryMsgs":this.onHistoryMsgs(g);break;case"syncSendTeamMsg":this.onMsg(g);break;case"notifyTeamMsgReads":this.onTeamMsgReceipt(g);break;case"syncUpdateTeamMember":(S=r(v).call(v,g.content.teamMember)).account===this.account&&this.mergeMyTeamMembers(S),this.onUpdateTeamMember(S);break;case"updateMuteStateInTeam":break;case"getMyTeamMembers":g.error||(g.obj=v.reverseMembers(g.content.teamMembers));break;case"getMutedTeamMembers":g.error||(g.obj={teamId:g.obj.teamId,members:v.reverseMembers(g.content.teamMembers)});break;case"syncMyTeamMembers":this.onSyncMyTeamMembers(g);break;case"sendTeamMsgReceipt":this.sendTeamMsgReceipt(g);break;case"getTeamMsgReads":this.getTeamMsgReads(g);break;case"getTeamMsgReadAccounts":this.getTeamMsgReadAccounts(g);break;case"getTeamsById":this.getTeamsById(g)}},c.getTeamMsgReads=function(g){var b=this;if(g.error)this.logger.error("team::sendTeamMsgReceipt: ",g.error);else{var S=h._get(g,"content.teamMsgReceipts")||[];if(this.db.enable){var O=[];i(S).call(S,function(I){I.idClient&&O.push({idClient:I.idClient,unread:+I.unread,read:+I.read})}),O.length>0&&s(function(){return b.db.updateMsgBatch(O)},0)}}},c.getTeamMsgReadAccounts=function(g){if(g.error)this.logger.error("team::getTeamMsgReadAccounts: ",g.error);else{var b=h._get(g,"content.readAccounts")||[],S=h._get(g,"content.unreadAccounts")||[],O=h._get(g,"content.teamMsgReceipt.idClient")||[];this.db.enable&&this.db.putMsgReadDetail({idClient:O,readAccounts:b,unreadAccounts:S})}},c.sendTeamMsgReceipt=function(g){var b=this;if(g.error)this.logger.error("team::sendTeamMsgReceipt: ",g.error);else{var S=h._get(g,"obj.teamMsgReceipts")||[],O=h._get(g,"content.teamMsgReceipts")||[];if(this.db.enable){var I=[];i(S).call(S,function(R){n(O).call(O,function(N){return R.idServer===N.idServer})||I.push({idClient:R.idClient,hasRead:!0})}),I.length>0&&(this.logger.log("sendTeamMsgReceipt::updateMsgBatch"),s(function(){return b.db.updateMsgBatch(I)},0))}}},c.onCreateTeam=function(g,b){var S=this.db;S.enable&&(S.putTeam(g),S.putTeamMembers(b)),this.options.onCreateTeam(g,b)},c.onTeams=function(g){g.content=g.content||{};var b,S=this,O=S.db,I=S.packetFromSync(g),R=g.content.teams||[],N=!0,F=[],P=[];if(g.error)switch(g.error.code){case 803:g.error=null,N=!1}var x=new u(function(_,C){var A,M;g.error?I&&C(g.error):(function(){N&&i(R).call(R,function(U){(U=r(T).call(T,U)).validToCurrentUser?F.push(U):P.push(U)}),R.length?(N=!0,b=g.content.timetag):N=!1}(),O.enable?(A=_,M=C,g.promise=new u(function(U,E){function z(){I?(L(),U(),A()):O.getTeams().then(function($){F=$,L(),U(),A()}).catch(function($){$.message="db.getTeams error",$.callFunc="team::afterMergeData",E($),M($)})}N?O.mergeTeams(F,P,b).then(function(){z()}).catch(function($){var X={callFunc:"team::onTeams:mergeData",message:"db.mergeTeams error",event:$};E(X),M(X)}):(S.logger.warn("team::onTeams:mergeData: no teams need merge"),z())}).then(void 0,function(U){throw U.message="merge teams data error",U.callFunc="team::mergeData",M(U),U})):(L(),_()))}).catch(function(_){return S.logger.error("team::onTeams: ",_),u.reject(_)});function L(){S.timetags.teams=b,F.invalid=P,I?(S.syncResult.teams=F,S.syncResult.invalidTeams=P,S.syncing||S.onSyncDone()):(S.logger.info("team::onTeams: not in syncing, get teams",y(F)),g.obj=F)}I&&(x.cmd="teams",S.syncPromiseArray.push(x))},c.getTeamsById=function(g){var b;if(g.error){if(g.error.code!==816)return;this.logger.error("team::getTeamsById: ",g.error),g.error=null}g.content.teams=p(b=g.content.teams).call(b,function(S){return r(T).call(T,S)}),g.obj=g.content},c.onTeamMembers=function(g){g.content=g.content||{};var b,S,O=this,I=O.packetFromSync(g),R=g.content.members||[],N=!0,F=[],P=[];if(g.obj&&(S=g.obj.teamId),S||(S=g.content.teamId),S=""+S,g.error)switch(g.error.code){case 406:g.error=null,N=!1}var x=new u(function(L,_){g.error?I&&(O.logger.error("team::onTeamMember: team error:",S,g.error),_({callFunc:"team::onTeamMembers",event:g.error,message:"teamId-".concat(S," 获取群成员错误")})):(function(){N&&i(R).call(R,function(C){(C=r(v).call(v,C)).valid?F.push(C):P.push(C)}),R.length?(N=!0,b=g.content.timetag):N=!1}(),F.invalid=P,I?(O.syncTeamMembersResult[S]=F,O.syncTeamMembersResult[S+"-invalid"]=P,O.timetags["team-"+S]=b):(O.logger.info("team::onTeamMembers: not syncing, get members",S,a(F)),g.obj={teamId:S,members:F}),L())});I&&(x.cmd=S,O.syncTeamMembersPromiseArray.push(x))},c.onUpdateTeamMember=function(g){if(g.updateTime||(g.updateTime=+new Date),this.logger.info("team::onUpdateTeamMember: ",g&&g.account),this.options.onupdateteammember(h.simpleClone(g)),this.account===g.account){var b=this.myTeamMembersMap[g.teamId];this.logger.info("team::onMyTeamMembers: ",[b]),this.options.onMyTeamMembers(h.simpleClone([b]))}var S={teamId:g.teamId,memberUpdateTime:g.updateTime};this.onUpdateTeam(S);var O=this.db;O.enable&&O.updateTeamMember(g)},c.onUpdateTeam=function(g){this.logger.info("team::onUpdateTeam:",g&&g.teamId),this.options.onUpdateTeam(h.simpleClone(g));var b=this.db;b.enable&&b.updateTeam(g)},c.onSyncMyTeamMembers=function(g){var b=this,S=b.db,O=v.reverseMembers(g.content.teamMembers);if(S.enable){var I=S.putTeamMembers(O).then(function(){return S.updateMyTeamMembersTimetag(g.content.timetag)}).catch(function(R){return b.logger.error("team::syncMyTeamMember: ",R),u.reject(R)});I.cmd="myTeamMembers",b.syncTeamMembersPromiseArray.push(I),b.syncPromiseArray.push(I)}else b.syncResult.myTeamMembers=O;b.mergeMyTeamMembers(O)},c.mergeMyTeamMembers=function(g){h.isArray(g)||(g=[g]);var b=this.myTeamMembersMap=this.myTeamMembersMap||{};i(g).call(g,function(S){var O=S.teamId;b[O]=h.merge(b[O],S)})},c.notifyForNewTeamMsg=function(g){h.isArray(g)||(g=[g]);var b=this,S=this.myTeamMembersMap||{},O={},I=[];i(g).call(g,function(N){h.exist(S[N])?O[N]=S[N].muteNotiType:I.push(N)});var R=u.resolve({map:O});return I.length&&(R=b.api.getMyTeamMembers({teamIds:I,promise:!0}).then(function(N){b.mergeMyTeamMembers(N),i(N).call(N,function(P){O[P.teamId]=P.muteNotiType});var F=d(g).call(g,function(P){return!O[P]});return u.resolve({map:O,miss:F})}).catch(function(N){return m(O).length>0?u.resolve({map:O,miss:I,error:N}):u.reject(N)})),R},c.updateTeamSysMsgState=function(g,b){var S,O=g.error;O&&(b="error",O=h.filterObj(O,"code message")),S={idServer:g.obj.idServer,state:b,from:g.obj.from,type:g.obj.type},O&&(S.error=O),this.updateSysMsg(S)},c.onTeamMsgReceipt=function(g){var b=g.content,S=g.error;S&&this.logger.error("team::onTeamMsgReceipt:",S),b&&b.teamMsgReceipts&&(this.options.onTeamMsgReceipt(b),this.options.onMsgReceipts(b.teamMsgReceipts))}},function(o,k,e){var r=e(9),i=e(3),s=e(2),n=e(35).fn,u=e(0),p=u.teams2ids,d=e(307),m=e(202);n.processSuperTeam=function(c){var h,a,y,T=c.error;switch(c.obj===void 0&&(c.obj={}),c.cmd){case"sendSuperTeamMsg":this.onSendMsg(c);break;case"superTeamMsg":this.onMsg(c);break;case"sendSuperTeamCustomSysMsg":this.onSendSysMsg(c);break;case"superTeamCustomSysMsg":this.onSysMsg(c);break;case"syncSuperTeams":this.onSuperTeams(c);break;case"syncCreateSuperTeam":h=r(d).call(d,c.content.team),y=m.assembleOwner(h),this.logger.info("team::processTeam: sync createTeam",h&&h.teamId,y&&y.account),this.options.onSyncCreateSuperTeam(h,y),this.onCreateSuperTeam(h,y);break;case"getSuperTeamHistoryMsgs":case"searchSuperTeamHistoryMsgs":this.onHistoryMsgs(c);break;case"syncSendSuperTeamMsg":this.onMsg(c);break;case"addSuperTeamMembers":case"removeSuperTeamMembers":case"leaveSuperTeam":case"addSuperTeamManagers":case"removeSuperTeamManagers":case"transferSuperTeam":break;case"updateInfoInSuperTeam":T||((a=c.obj).account=this.account,a.id=m.genId(a.teamId,a.account),a=r(m).call(m,a),c.obj=a,this.mergeMySuperTeamMembers(a),this.onUpdateSuperTeamMember(a));break;case"updateNickInTeam":c.obj=r(m).call(m,c.obj);break;case"syncUpdateSuperTeamMember":(a=r(m).call(m,c.content.teamMember)).account===this.account&&this.mergeMySuperTeamMembers(a),this.onUpdateSuperTeamMember(a);break;case"updateSuperTeam":c.obj=r(d).call(d,c.obj,!0);break;case"getSuperTeam":c.error||(c.obj=r(d).call(d,c.content.team));break;case"getSuperTeams":this.onSuperTeams(c);break;case"syncSuperTeamMembers":this.onSyncSuperTeamMembers(c);break;case"syncMySuperTeamMembers":this.onSyncMySuperTeamMembers(c);break;case"getSuperTeamMembers":c.error||this.onGetAllSuperTeamMembers(c);break;case"getSuperTeamMembersByJoinTime":case"getSuperTeamMembersByAccounts":case"getMutedSuperTeamMembers":c.error||this.onSuperTeamMembers(c);break;case"onDeleteSuperTeamMsg":this.onDeleteMsg(c);break;case"onSuperTeamMsgDelete":case"syncDeleteSuperTeamMsg":this.onMsgDeleted(c,!0);break;case"onMarkSuperTeamSessionAck":this.onMarkSessionAck(c);break;case"syncMarkSuperTeamSessionAck":this.syncMarkSessionAck(c);break;case"passSuperTeamApply":this.updateSuperTeamSysMsgState(c,"passed");break;case"rejectSuperTeamApply":this.updateTeamSysMsgState(c,"rejected");break;case"acceptSuperTeamInvite":this.updateTeamSysMsgState(c,"passed");break;case"rejectSuperTeamInvite":this.updateSuperTeamSysMsgState(c,"rejected")}},n.onSuperTeams=function(c){c.content=c.content||{};var h,a=this,y=a.db,T=a.packetFromSync(c),v=c.content.teams||[],g=!0,b=[],S=[];if(c.error)switch(c.error.code){case 803:c.error=null,g=!1}var O=new i(function(R,N){var F,P;c.error?T&&N(c.error):(function(){g&&s(v).call(v,function(x){(x=r(d).call(d,x)).validToCurrentUser?b.push(x):S.push(x)}),v.length?(g=!0,h=c.content.timetag):g=!1}(),y.enable?(F=R,P=N,c.promise=new i(function(x,L){function _(){T?(I(),x(),F()):y.getSuperTeams().then(function(C){b=C,I(),x(),F()}).then(void 0,function(C){C.message="db.getSuperTeams error",C.callFunc="superTeam::afterMergeData",L(C),P(C)})}g?y.mergeSuperTeams(b,S,h).then(function(){_()}).then(void 0,function(C){var A={callFunc:"superTeam::onSuperTeams:mergeData",message:"db.mergeSuperTeams error",event:C};L(A),P(A)}):(a.logger.warn("superTeam::onSuperTeams:mergeData: no teams need merge"),_())}).then(void 0,function(x){throw x.message="merge teams data error",x.callFunc="superTeam::mergeData",P(x),x})):(I(),R()))}).catch(function(R){return a.logger.error("superTeam::onSuperTeams: ",R),i.reject(R)});function I(){a.timetags.superTeams=h,b.invalid=S,T?(a.syncResult.superTeams=b,a.syncResult.invalidSuperTeams=S):(a.logger.info("superTeam::onSuperTeams: not in syncing, get teams",p(b)),c.obj=b)}T&&(O.cmd="superteams",a.syncPromiseArray.push(O))},n.onCreateSuperTeam=function(c,h){var a=this.db;a.enable&&(a.putSuperTeam(c),a.putSuperTeamMembers(h))},n.onGetAllSuperTeamMembers=function(c){var h=this,a=this.db,y=c.raw.ser,T=this.superTeamMembersData[y]||{},v=T.teamId||c.obj&&c.obj.teamId;if(a.enable){var g=c.content&&c.content.timetag,b=c.raw.code===200?i.all(T.pArr):i.resolve();c.promise=b.then(function(){return a.getSuperTeamMembers(v).then(function(S){g&&a.updateSuperTeamMemberTimetag(v,g),c.obj={members:S,invalid:[],teamId:v}})}).catch(function(S){return h.logger.error(S)})}else c.obj={members:T.members,invalid:T.invalid,teamId:v};this.superTeamMembersData[y]=void 0},n.onSyncSuperTeamMembers=function(c){var h,a=this.db,y=[],T=[],v=c.content.members||[],g=c.raw.ser;if(c.obj&&(h=c.obj.teamId),h||(h=c.content.teamId),s(v).call(v,function(O){(O=r(m).call(m,O)).valid?T.push(O):y.push(O)}),a.enable){this.superTeamMembersData[g]=this.superTeamMembersData[g]||{teamId:h,pArr:[]};var b=i.resolve();c.content&&c.content.isAll&&(b=a.deleteSuperTeamMembers(h));var S=b.then(function(){return a.mergeSuperTeamMembers(h,T,y)}).then(function(){return i.resolve()});this.superTeamMembersData[g].pArr.push(S)}else this.superTeamMembersData[g]=this.superTeamMembersData[g]||{teamId:h,members:[],invalid:[]},T.length&&(this.superTeamMembersData[g].members=this.api.mergeTeamMembers(this.superTeamMembersData[g].members,T)),y.length&&(this.superTeamMembersData[g].invalid=this.api.mergeTeamMembers(this.superTeamMembersData[g].invalid,y));c.raw=void 0},n.onSyncMySuperTeamMembers=function(c){var h=this,a=h.db,y=m.reverseMembers(c.content.teamMembers);if(a.enable){var T=a.putSuperTeamMembers(y).then(function(){return a.updateMySuperTeamMembersTimetag(c.content.timetag)}).catch(function(v){return h.logger.error("superTeam::syncMySuperTeamMember: ",v),i.reject(v)});h.syncPromiseArray.push(T)}else h.syncResult.mySuperTeamMembers=y;h.mergeMySuperTeamMembers(y)},n.onSuperTeamMembers=function(c,h){var a,y=this.db,T=[],v=[],g=c.content.members||[];s(g).call(g,function(b){(b=r(m).call(m,b)).valid?v.push(b):T.push(b)}),c.obj&&(a=c.obj.teamId),a||(a=c.content.teamId||v[0]&&v[0].teamId),y.enable&&!h&&y.mergeSuperTeamMembers(a,v,T),c.obj={members:v,invalid:T,teamId:a}},n.onUpdateSuperTeamMember=function(c){if(c.updateTime||(c.updateTime=+new Date),this.logger.info("superTeam::onUpdateSuperTeamMember: ",c&&c.account),this.options.onUpdateSuperTeamMember(u.simpleClone(c)),this.account===c.account){var h=this.mySuperTeamMembersMap[c.teamId];this.logger.info("superTeam::onMySuperTeamMembers: ",[h]),this.options.onMySuperTeamMembers(u.simpleClone([h]))}var a={teamId:c.teamId,memberUpdateTime:c.updateTime};this.onUpdateSuperTeam(a);var y=this.db;y.enable&&y.updateSuperTeamMember(c)},n.onUpdateSuperTeam=function(c){this.logger.info("superteam::onUpdateSuperTeam:",c&&c.teamId),this.options.onUpdateSuperTeam(u.simpleClone(c));var h=this.db;h.enable&&h.updateSuperTeam(c)},n.mergeMySuperTeamMembers=function(c){u.isArray(c)||(c=[c]);var h=this.mySuperTeamMembersMap=this.mySuperTeamMembersMap||{};s(c).call(c,function(a){var y=a.teamId;h[y]=u.merge(h[y],a)})},n.updateSuperTeamSysMsgState=function(c,h){var a,y=c.error;y&&(h="error",y=u.filterObj(y,"code message")),a={idServer:c.obj.idServer,state:h,from:c.obj.from,type:c.obj.type},y&&(a.error=y),this.updateSysMsg(a)}},function(o,k,e){var r=e(9),i=e(3),s=e(23),n=e(35).fn,u=e(0),p=e(309);n.processNotify=function(d){switch(d.cmd){case"syncOfflineNetcallMsgs":case"syncOfflineMsgs":this.onOfflineMsgs(d);break;case"batchMarkRead":break;case"syncOfflineSysMsgs":case"syncOfflineSuperTeamSysMsgs":this.onOfflineSysMsgs(d);break;case"syncRoamingMsgs":case"syncSuperTeamRoamingMsgs":this.onRoamingMsgs(d);break;case"syncOfflineFilterMsgs":this.onOfflineMsgs(d,!0);break;case"syncOfflineFilterSysMsgs":this.onOfflineSysMsgs(d,!0);break;case"syncMsgReceipts":this.onOfflineMsgReceipts(d);break;case"syncDonnop":this.onDonnop(d,!0);break;case"syncSessionAck":this.syncSessionAck(d);break;case"syncSuperTeamSessionAck":this.syncSuperTeamSessionAck(d);break;case"syncRobots":this.onRobots(d);break;case"syncBroadcastMsgs":this.onBroadcastMsgs(d);break;case"syncDeleteSuperTeamMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(d);break;case"syncDeleteMsgSelf":this.syncDeleteMsgSelf(d);break;case"syncSessionsWithMoreRoaming":this.syncSessionsWithMoreRoaming(d);break;case"syncStickTopSessions":this.syncStickTopSessions(d);break;case"syncSessionHistoryMsgsDelete":this.syncSessionHistoryMsgsDelete(d)}},n.onDonnop=function(d,m){if(!d.error){var c=this,h=c.db,a=r(p).call(p,d.content.donnop);c.mergeDonnop(a);var y=c.dbDonnop();if(m){var T=d.content.timetag;c.timetags.donnop=T,h.enable&&(y=y.then(function(){return c.db.updateDonnopTimetag(T)}).catch(function(v){return c.logger.error("notify::onDonnop: ",v),i.reject(v)})),y.cmd="donnop",c.syncPromiseArray.push(y)}else c.onPushNotificationMultiportConfigUpdate()}},n.onUpdateDonnop=function(d){if(!d.error){var m=d.obj;m&&(this.mergeDonnop(u.filterObj(m,["shouldPushNotificationWhenPCOnline"])),this.dbDonnop(),this.onPushNotificationMultiportConfigUpdate())}},n.getPushNotificationMultiportConfig=function(){return u.merge({},this.pushNotificationMultiportConfig)},n.mergeDonnop=function(d){this.pushNotificationMultiportConfig=u.merge({},this.pushNotificationMultiportConfig,d)},n.dbDonnop=function(){return this.db.enable?this.db.setDonnop(this.pushNotificationMultiportConfig):i.resolve()},n.onPushNotificationMultiportConfigUpdate=function(){var d=this;s(function(){var m=d.getPushNotificationMultiportConfig();d.logger.info("link::onPushNotificationMultiportConfigUpdate:",m),d.options.onPushNotificationMultiportConfigUpdate(m)})}},function(o,k,e){var r=e(57),i=e(2),s=e(17),n=e(3),u=e(8),p=e(5),d=e(6),m=e(10),c=e(9),h=e(138),a=e(7),y=e(23),T=e(25),v=e(52),g=e(41),b=e(58),S=e(59),O=e(60),I=e(61),R=e(47),N=e(15),F=e(85),P=e(86),x=e(69),L=e(32);function _(D,Q){var G=P!==void 0&&x(D)||D["@@iterator"];if(!G){if(L(D)||(G=function(te,ne){var re;if(te){if(typeof te=="string")return C(te,ne);var se=N(re=Object.prototype.toString.call(te)).call(re,8,-1);if(se==="Object"&&te.constructor&&(se=te.constructor.name),se==="Map"||se==="Set")return F(te);if(se==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(se))return C(te,ne)}}(D))||Q&&D&&typeof D.length=="number"){G&&(D=G);var B=0,q=function(){};return{s:q,n:function(){return B>=D.length?{done:!0}:{done:!1,value:D[B++]}},e:function(te){throw te},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var H,K=!0,Z=!1;return{s:function(){G=G.call(D)},n:function(){var te=G.next();return K=te.done,te},e:function(te){Z=!0,H=te},f:function(){try{K||G.return==null||G.return()}finally{if(Z)throw H}}}}function C(D,Q){(Q==null||Q>D.length)&&(Q=D.length);for(var G=0,B=new Array(Q);G<Q;G++)B[G]=D[G];return B}function A(D,Q){var G=p(D);if(b){var B=b(D);Q&&(B=s(B).call(B,function(q){return S(D,q).enumerable})),G.push.apply(G,B)}return G}var M=e(35).fn,U=e(0),E=U.undef,z=e(44),$=e(150),X=e(202),Y=e(152),W=e(290),ee=e(13),w=e(74),J=e(72);function V(D,Q,G){var B=this,q=B.message.Message,H=G?"offlineFilterMsgs":"offlineMsgs";if(!(Q&&Q.length>0))return n.resolve();var K=q.getMaxTimetag(Q),Z=Q[0].scene,te=Q[0].target;B.markMsgRead(Q),Q=q.deduplication(Q),Q=q.sortMsgs(Q);var ne=B.genSessionByMsgs(Q);B.cacheSyncedSession(ne);var re=B.putMsg(Q,"offlineMsgs").then(function(se){var oe=se;(oe=B.filterIgnore(oe)).length&&(B.logger.info("msg::onOfflineMsgs： toreLastSession",H,D,oe.length),B.syncResult[H]=B.syncResult[H]||[],B.syncResult[H].push({sessionId:D,scene:Z,to:te,msgs:oe,timetag:K}))}).catch(function(se){return B.logger.error("msg::onOfflineMsgs: ",se),n.reject(se)});return re.cmd="offlineMsgs-"+D,re}M.processMsg=function(D){switch(D.cmd){case"sendMsg":this.onSendMsg(D);break;case"msg":this.onMsg(D);break;case"sysMsg":this.onSysMsg(D);break;case"broadcastMsg":this.onBroadcastMsg(D);break;case"sendCustomSysMsg":this.onSendSysMsg(D);break;case"getHistoryMsgs":case"searchHistoryMsgs":this.onHistoryMsgs(D);break;case"msgFtsInServer":case"msgFtsInServerByTiming":this.onmsgFtsInServer(D);break;case"syncSendMsg":this.onMsg(D);break;case"deleteSessions":this.onDeleteSessions(D);break;case"sendMsgReceipt":this.onSendMsgReceipt(D);break;case"msgReceipt":this.onMsgReceipt(D);break;case"onDeleteMsg":this.onDeleteMsg(D);break;case"onMsgDeleted":this.onMsgDeleted(D);break;case"onDeleteMsgOfflineRoaming":this.onDeleteMsgOfflineRoaming(D);break;case"onMarkSessionAck":this.onMarkSessionAck(D);break;case"syncMarkSessionAck":this.syncMarkSessionAck(D);break;case"syncUpdateServerSession":this.onSyncUpdateServerSession(D);break;case"deleteMsgSelf":this.deleteMsgSelf(D);break;case"deleteMsgSelfBatch":this.deleteMsgSelfBatch(D);break;case"onDeleteMsgSelf":this.onDeleteMsgSelf(D);break;case"onDeleteMsgSelfBatch":this.onDeleteMsgSelfBatch(D);break;case"clearServerHistoryMsgs":this.clearServerHistoryMsgs(D);break;case"onClearServerHistoryMsgs":this.onClearServerHistoryMsgs(D)}},M.checkIgnore=function(D){var Q=this;i(D).call(D,function(G){if(!G.ignore){try{Q.options.shouldIgnoreMsg(G)&&(G.ignore=!0)}catch(q){throw Q.logger.error("userOption:shouldIgnoreMsg function error",q),q}var B;try{B=Q.options.shouldIgnoreNotification(G)}catch(q){throw Q.logger.error("userOption:shouldIgnoreNotification function error",q),q}G.type==="notification"&&B&&(G.ignore=!0)}})},M.filterIgnore=function(D){return s(D).call(D,function(Q){return!Q.ignore})},M.genSessionByMsgs=function(D){return this.checkIgnore(D),Y.genSessionByMsgs(this.message.Message,D)},M.onRoamingMsgs=function(D){var Q=this,G=Q.message,B=G.Message,q=B.getMaxTimetag,H=G.reverseMsgs(D.content.msgs),K=q(H);H=B.deduplication(H);var Z=(H=B.sortMsgs(H))[0],te=Z.sessionId,ne=Q.genSessionByMsgs(H);Q.cacheSyncedSession(ne);var re=Q.putMsg(H,"roamingMsgs").then(function(se){var oe=(H=se).length,ae=(H=Q.filterIgnore(H)).length;oe!==ae&&Q.logger.info("msg::onRoamingMsgs msg length before filter: "+oe+" after filter: "+ae),H.length&&(Q.logger.info("msg::onRoamingMsgs: putRoamingMsgs",te,H.length),Q.syncResult.roamingMsgs=Q.syncResult.roamingMsgs||[],Q.syncResult.roamingMsgs.push({sessionId:te,scene:Z.scene,to:Z.target,msgs:H,timetag:K}),Q.syncing||Q.onSyncDone())}).catch(function(se){return Q.logger.error("msg::onRoamingMsgs: ",se),n.reject(se)});re.cmd="roamingMsgs-"+te,Q.syncPromiseArray.push(re)},M.onOfflineMsgs=function(D,Q){var G,B=this,q=this.message,H=null;Q&&(H={filter:!0});var K=q.reverseMsgs(D.content.msgs,{modifyObj:H});K=J.deduplication(K);var Z={};i(K).call(K,function(re){Z[re.sessionId]=Z[re.sessionId]||[],Z[re.sessionId].push(re)});var te=u(G=p(Z)).call(G,function(re){return{sessionId:re,msgs:Z[re]}}),ne=U.asyncPool(50,te,function(re){return V.call(B,re.sessionId,re.msgs,Q)});this.syncPromiseArray.push(ne)},M.completeMsg=function(D){return D.from=this.account,D.fromNick=this.myInfo&&this.myInfo.nick,D.fromClientType="Web",D.fromDeviceId=z.deviceId,D.time||(D.time=+new Date),D},M.amendMsg=function(D){if(D.scene==="team"){var Q=U.get(this.myTeamMembersMap,D.to+".nickInTeam");Q&&(D.fromNick=Q)}else if(D.scene==="superTeam"){var G=U.get(this.mySuperTeamMembersMap,D.to+".nickInTeam");G&&(D.fromNick=G)}return D},M.onMsgs=function(D){var Q=this,G=Q.reporterHook.getSafeClock(),B=Q.message.reverseMsgs(D.content.msgs,{mapper:function(q){var H=function(K){for(var Z=1;Z<arguments.length;Z++){var te,ne,re=arguments[Z]!=null?arguments[Z]:{};Z%2?i(te=A(Object(re),!0)).call(te,function(se){r(K,se,re[se])}):O?I(K,O(re)):i(ne=A(Object(re))).call(ne,function(se){R(K,se,S(re,se))})}return K}({},q);if(H.__receiveTime=D.__receiveTime,H.__handleTime=G,H.__clientExt)try{H.__clientExt=JSON.parse(H.__clientExt)}catch{Q.logger.warn("IMProtocolFn:onMsg __clientExt parse failed ".concat(H.__clientExt))}return Q.handleMsg(H),H}});Q.pushMsgDelay(B)},M.onMsg=function(D,Q){var G;if(D.content.msg.attach){var B=null;try{B=JSON.parse(D.content.msg.attach)}catch{}if(B&&B.url&&U.get(this.mixStorePolicy,"s3Policy.dlcdns")){var q,H=_(this.mixStorePolicy.s3Policy.dlcdns);try{for(H.s();!(q=H.n()).done;){var K,Z=q.value;d(K=B.url).call(K,Z)>=0&&(B.isS3=!0,Z!==this.mixStorePolicy.s3Policy.dlcdn&&(B.url=B.url.replace(Z,this.mixStorePolicy.s3Policy.dlcdn)))}}catch(ne){H.e(ne)}finally{H.f()}}D.content.msg.attach=m(B)}var te=c(G=this.message).call(G,D.content.msg);if(te.__receiveTime=D.__receiveTime,te.__handleTime=this.reporterHook.getSafeClock(),U.get(D,"content.msg.__clientExt"))try{te.__clientExt=JSON.parse(D.content.msg.__clientExt)}catch{this.logger.warn("IMProtocolFn:onMsg __clientExt parse failed ".concat(D.content.msg.__clientExt))}Q&&(te.filter=!0),D.cmd!=="syncSendMsg"||te.from!==te.to?(this.pushMsgDelay([te]),this.syncing?(this.logger.info("msg::onMsg:is in syncing ..."),this.unhandledMsgs.push({type:"onMsg",msg:te})):this.handleMsg(te)):this.logger.warn("onMsg::syncSendMsg to self, so ignore",te.idClient,te.idServer)},M.onBroadcastMsgs=function(D){var Q=D.content.broadcastMsgs;Q=h(Q).call(Q,function(G,B){return G.broadcastId-B.broadcastId}),this.putBroadcastMsgs(Q)},M.onBroadcastMsg=function(D){var Q=D.content.broadcastMsg;Q.time=Q.timestamp,this.syncing?this.unhandledMsgs.push({type:"onBroadcastMsg",msg:Q}):Q&&this.putBroadcastMsg(Q)},M.pushMsgTask=function(D){this.msgPromise=this.msgPromise.then(function(){return D()})},M.pushMsgDelay=function(D){if(D&&D.length>0){var Q=this;if(Q.msgStatEnable&&!ee.isWeixinApp){var G,B=u(D).call(D,function(q){return{appkey:Q.options.appKey,accid:q.to,fromAccid:q.from,msgId:q.idServer,serverTime:q.time,receiveTime:Q.reporterHook.getNTPTime(),sessionId:Q.sdkSession,platform:"web",sdk_ver:ee.info.version,manufactor:w.name+" "+w.version}});Q.msgDelayArr=a(G=Q.msgDelayArr).call(G,B),Q.msgDelayArr.length>5&&Q.doReportMsgDelay()}}},M.doReportMsgDelay=function(){var D,Q=m(this.msgDelayArr);this.msgDelayArr&&this.msgDelayArr.length>0&&(W.sendBeacon("https://statistic.live.126.net/statics/report/im/sdk/msgreceived",Q),this.msgDelayArr=[]),this.msgDelayTimer&&clearTimeout(this.msgDelayTimer),this.socket&&(this.msgDelayTimer=y(T(D=this.doReportMsgDelay).call(D,this),1e4))},M.handleMsg=function(D){var Q,G=this,B=G.db,q=D.time;G.markMsgRead(D),G.logger.info(a(Q="msg::handleMsg:msgPromise start ".concat(D.idServer," ")).call(Q,D.idClient)),G.msgPromise=G.msgPromise.then(function(){var H;return G.logger.info(a(H="msg::handleMsg:msgPromise, putMsg start ".concat(D.idServer," ")).call(H,D.idClient)),G.putMsg(D,"onMsg")}).then(function(){var H;return G.logger.info(a(H="msg::handleMsg:msgPromise, putMsg done and update timetag ".concat(D.idServer," ")).call(H,D.idClient)),B.enable?D.scene==="superTeam"?B.updateSuperTeamRoamingMsgTimetag(q):B.updateRoamingMsgTimetag(q):(G.timetags[D.scene==="superTeam"?"superTeamRoamingMsgs":"roamingMsgs"]=q,n.resolve())}).then(function(){if(D)return G.checkUserUpdate(D)}).then(function(){if(D){var H=D.type;switch(G.logger.info("msg::handleMsg:msgPromise, checkUserUpdate "+D.scene+" "+H+" msg"+(H==="notification"?" "+D.attach.type:"")),H){case"notification":return G.onTeamNotificationMsg(D)}}}).then(function(){var H,K;G.logger.info(a(H=a(K="msg::handleMsg:msgPromise, onmsg ready: ".concat(D.idServer," ")).call(K,D.idClient,", ")).call(H,!!D.ignore)),D&&!D.ignore&&y(function(){var Z,te=D.scene==="p2p";if(ee.isBrowser&&D.flow!=="out"){var ne={msgId:D.idServer,clientId:D.idClient,receiveTime:G.reporterHook.getNTPTime(D.__receiveTime),serverTime:D.time,callbackTime:G.reporterHook.getNTPTime(),preHandleTime:G.reporterHook.getNTPTime(D.__handleTime),fromAccid:D.from,toAccid:G.options.account,type:G.message.sceneMap[D.scene],tid:te?"":D.to,result:200,failReason:"",rt:v(G.reporterHook.getSafeClock()-D.__receiveTime)},re=U.get(D,"__clientExt.statistics.apiCallingTime"),se=U.get(D,"__clientExt.statistics.sendTime");re&&se&&(ne.apiCallingTime=re,ne.sendTime=se,ne.attachUploadDuration=U.get(D,"__clientExt.statistics.attachUploadDuration")||0),G.reporter&&G.reporter.report("msgReceive",ne)}delete D.__receiveTime,delete D.__handleTime,delete D.__clientExt,G.logger.info(a(Z="msg::handleMsg:msgPromise, tigger onmsg: ".concat(D.idServer," ")).call(Z,D.idClient)),G.options.onmsg(U.copy(D))},0)}).catch(function(H){var K;G.logger.error(a(K="msg::handleMsg:msgPromise, catch err ".concat(D.idServer," ")).call(K,D.idClient),H),H.callFunc="msg::handleMsg",G.onCustomError("消息处理错误",H)})},M.putMsg=function(D,Q){if(U.isArray(D)||(D=[D]),s(D[0]))return n.resolve(D);var G,B=this,q=B.db,H=q.enable,K=n.resolve(),Z=B.message.Message.getLastMsg(D),te=Z.flow,ne=B.genSessionByMsgs(D);se(ne);var re=[];function se(oe){Q!=="roamingMsgs"&&Q!=="offlineMsgs"||B.cacheSyncedSession(oe)}return K=(K=(K=K.then(function(){var oe;return H||B.options.autoMarkRead||Q==="roamingMsgs"||!ne||(B.sessionUnreadMsgs=B.sessionUnreadMsgs||{},B.sessionUnreadMsgs[ne.id]=B.sessionUnreadMsgs[ne.id]||[],B.sessionUnreadMsgs[ne.id]=a(oe=B.sessionUnreadMsgs[ne.id]).call(oe,s(D).call(D,function(ae){try{return B.options.shouldCountNotifyUnread(ae)}catch(pe){throw B.logger.error("userOption:shouldCountNotifyUnread function error",pe),pe}}))),Q==="offlineMsgs"||Q==="roamingMsgs"?n.reject(D):H?q.putMsg(D):D}).then(function(oe){var ae=[];return i(D).call(D,function(pe){B.checkMsgUnique(pe)&&ae.push(pe)}),D=ae,re=H?oe:D,n.resolve(D)})).then(function(oe){return oe.length&&H&&ne?new n(function(ae){q.getSessions({sessionId:ne.id}).then(function(pe){if(pe&&pe.lastMsg){var ge=pe.lastMsg;ne.lastMsg&&ne.lastMsg.time<ge.time&&(ne.lastMsg=ge)}re&&re.length?ne?q.putSession(ne).then(function(fe){ae(fe)}):ae(pe):(re=oe,ae(pe))})}):n.resolve(ne)})).then(function(oe){if(ne&&re.length){G=Z.sessionId!==B.currSessionId;var ae=Q==="roamingMsgs",pe=B.options.syncSessionUnread,ge=ne.id,fe=B.getSessionInCache(ge,!0)||{},ie=fe.ack||0;if(Q==="offlineMsgs"||ae&&pe||Q==="onMsg"&&te==="in"&&G){var me;if(H&&oe){var ye=fe.unread||0;(ne=oe).unread=ye,ie=ie||ne.ack||0}else(oe=fe)&&(ne.unread=oe.unread||0);se(ne),ne.unread=ne.unread||0;var de=0;i(re).call(re,function(ce){var ve;try{ve=B.options.shouldCountNotifyUnread(ce)}catch(Le){throw B.logger.error("userOption:shouldCountNotifyUnread function error",Le),Le}var be=(ce.type!=="notification"||ce.type==="notification"&&ve)&&(E(ce.isUnreadable)||ce.isUnreadable);if(be&&pe&&(be=ce.time>ie&&ce.flow!=="out"),be&&(de++,pe&&!H)){var xe=fe.unreadMsgs||[];xe.push(ce),ne.unreadMsgs=xe}}),ne.unread+=de;var ue=U.secureOutput("session",ne);if(ue.unreadMsgs&&(ue.unreadMsgs=u(me=ue.unreadMsgs).call(me,function(ce){return ce&&ce.idServer})),B.logger.info("msg::putMsg:updateSession: ",ue),se(ne),H)return q.updateSession({id:ne.id,unread:ne.unread})}}}),Q==="onMsg"&&(K=K.then(function(){D.length&&ne&&(B.onUpdateSession(ne),B.options.syncSessionUnread&&!G&&B.api.resetSessionUnread(B.currSessionId))})),K.then(function(){return n.resolve(D)}).catch(function(oe){return oe&&oe.length?n.resolve(oe):n.reject(oe)})},M.putBroadcastMsgs=function(D){var Q=this,G=Q.db,B=D.length;if(B>0){if(Q.doMarkBroadcastMsgsRead(D),G.enable){var q=D[B-1].broadcastId;return G.updateBroadcastMsgTimetag(q),G.putBroadcastMsg(D).then(function(){return y(function(){Q.doMarkMsgsRead(),Q.options.onbroadcastmsgs(U.copy(D))},0),n.resolve(D)})}y(function(){Q.options.onbroadcastmsgs(U.copy(D))},0)}return D},M.putBroadcastMsg=function(D){var Q=this,G=Q.db;return Q.doMarkBroadcastMsgsRead([D]),G.enable?(D.broadcastId&&G.updateBroadcastMsgTimetag(D.broadcastId),G.putBroadcastMsg(D).then(function(){return y(function(){Q.options.onbroadcastmsg(U.copy(D))},0),n.resolve(D)})):(y(function(){Q.options.onbroadcastmsg(U.copy(D))},0),D)},M.doMarkBroadcastMsgsRead=function(D){D=u(D).call(D,function(Q){return Q.broadcastId}),this.sendCmd("batchMarkRead",{sid:7,cid:17,ids:D})},M.cacheSyncedSession=function(D){if(D&&this.syncResult){D=g({},D),this.syncResult.sessions=this.syncResult.sessions||{};var Q=D.id,G=this.syncResult.sessions[Q]||{};G&&G.ack>D.ack&&(D.ack=void 0),G&&G.msgReceiptTime>D.msgReceiptTime&&(D.msgReceiptTime=void 0);var B=U.get(G,"lastMsg.time"),q=U.get(D,"lastMsg.time");B&&q&&B>q&&(D.lastMsg=G.lastMsg),this.syncResult.sessions[Q]=g(G,D),this.syncResult.sessions[Q]=g({},this.mergeSession(this.syncResult.sessions[Q]))}},M.checkMsgUnique=U.genCheckUniqueFunc("idClient"),M.revokeMsgUniqueCheck=function(D){this.uniqueSet&&this.uniqueSet.idClient&&(this.uniqueSet.idClient[D]=!1)},M.storeSendMsg=function(D){if(!this.syncing){var Q=this.putMsg(D,"sendMsg");return this.msgPromise=this.msgPromise.then(function(){return Q}),Q}this.unhandledMsgs.push({type:"sendMsg",msg:D})},M.updateSendMsgError=function(D){if(!this.syncing){var Q=this.updateMsg(D);return this.msgPromise=this.msgPromise.then(function(){return Q}),Q}this.unupdatedMsgs.push(D)},M.onSendMsg=function(D,Q){var G,B,q=this,H=D.content&&D.content.msg,K=D.obj&&D.obj.msg||H;if(K)if(this.logger.warn(a(G=a(B="sendMsg::end: ".concat(H&&H.idServer," ")).call(B,K.idClient," ")).call(G,D&&D.raw&&D.raw.ser)),D.obj)te();else{var Z=q.db;Z&&Z.enable&&Z.getMsgByIdClient(K.idClient).then(function(ne){ne&&(K=ne,te(!1))}).catch(function(){return te()})}else this.logger.error("sendMsg::error::get msg failed, msg empty");function te(){var ne,re=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];q.completeMsg(K);var se=D.error&&D.error.code===7101;D.error&&!se||(K.idServer=H.idServer,K.time=+H.time,H.yidunAntiSpamRes&&(K.yidunAntiSpamRes=H.yidunAntiSpamRes),H.callbackExt&&(K.callbackExt=H.callbackExt)),se&&(K.isInBlackList=!0),D.error?K.status="fail":K.status="success",K=re?c(ne=q.message).call(ne,K):K,K=q.amendMsg(K),Q&&(K.filter=!0),D.obj=K,q.syncing?q.unupdatedMsgs.push(K):q.msgPromise=n.all([q.msgPromise,D.obj.promise]).then(function(oe){return oe.length||(K.resend=!0),q.updateMsg(K).then(function(){return q.options.syncSessionUnread&&q.currSessionId===K.sessionId&&q.api.resetSessionUnread(q.currSessionId),q.resolveMsgReceiptTask(K),K})}).catch(function(oe){q.logger.error("onSendMsg::dealMsg error",oe)})}},M.updateLocalMsg=function(D){var Q=this.updateMsg(D);return this.msgPromise=this.msgPromise.then(function(){return Q}),Q},M.updateMsg=function(D){if(s(D)||this.options.shouldIgnoreMsg(D))return n.resolve(D);var Q=this,G=Q.db,B=D.status==="success",q=Y.genSessionByMsg(D),H=!!D.isLocal;return Q.onUpdateSession(q),G.enable?G.updateMsg(D).then(function(K){var Z=G.updateSession(q),te=n.resolve();return B&&K&&!H&&(te=D.scene==="superTeam"?G.updateSuperTeamRoamingMsgTimetag(K.time):G.updateRoamingMsgTimetag(K.time)),n.all([Z,te])}).catch(function(K){Q.logger.error("updateMsg error",K)}):(B&&!H&&(Q.timetags.roamingMsgs=D.time),n.resolve(D))},M.updateRoamingMsgTimetag=function(D){var Q=this.db;return Q.enable?Q.updateRoamingMsgTimetag(D):(this.timetags.roamingMsgs=D,n.resolve(D))},M.checkUserUpdate=function(D){var Q=this,G=D.from;return Q.logger.info("handleMsg::checkUserUpdate: ",G,Q.account),G===Q.account?n.resolve():new n(function(B){var q=Q.userSet[G];if(q){var H=+q.updateTime,K=+D.userUpdateTime;!isNaN(H)&&!isNaN(K)&&U.isNumber(H)&&U.isNumber(K)&&H<K?Z():B()}else Z();function Z(){Q.api.getUser({account:G,sync:!0,done:function(te,ne){te||y(function(){Q.logger.log("user::checkUserUpdate: onupdateuser",ne&&ne.account),Q.options.onupdateuser(ne)},0),B()}})}})},M.processUnsettledMsgs=function(){var D,Q,G=this;i(D=G.unhandledMsgs).call(D,function(B){var q=B.msg;switch(B.type){case"onMsg":G.handleMsg(q);break;case"sendMsg":G.msgPromise=G.msgPromise.then(function(){return G.putMsg(q)});break;case"onBroadcastMsg":G.msgPromise=G.msgPromise.then(function(){return G.putBroadcastMsg(q)})}}),i(Q=G.unupdatedMsgs).call(Q,function(B){G.msgPromise=G.msgPromise.then(function(){return G.updateMsg(B)})}),G.resetUnsettledMsgs()},M.onTeamNotificationMsg=function(D){var Q=D.attach,G=Q.type,B=D.from,q=D.to,H=D.time,K=Q.team,Z=Q.account,te=Q.accounts;switch(G){case"updateTeam":return K.updateTime=H,this.onUpdateTeam(K);case"addTeamMembers":return this.onAddTeamMembers(D,K,te);case"removeTeamMembers":return this.onRemoveTeamMembers(K,q,te);case"acceptTeamInvite":return this.onAddTeamMembers(D,K,[B]);case"passTeamApply":return this.onAddTeamMembers(D,K,[Z]);case"addTeamManagers":return this.updateTeamManagers(D,q,te,!0,H);case"removeTeamManagers":return this.updateTeamManagers(D,q,te,!1,H);case"leaveTeam":return this.onRemoveTeamMembers(K,q,[B]);case"dismissTeam":return this.onDismissTeam(q,H);case"transferTeam":return this.transferTeam(D,K,B,Z);case"updateTeamMute":return this.onUpdateTeamMembersMute(D,K,[Z],Q.mute);case"updateSuperTeam":return K.updateTime=H,this.onUpdateSuperTeam(K);case"acceptSuperTeamInvite":return this.onAddSuperTeamMembers(D,K,[D.from]);case"addSuperTeamMembers":return this.onAddSuperTeamMembers(D,K,te);case"passSuperTeamApply":return this.onAddSuperTeamMembers(D,K,[Z]);case"removeSuperTeamMembers":return this.onRemoveSuperTeamMembers(K,q,te);case"leaveSuperTeam":return this.onRemoveSuperTeamMembers(K,q,[B]);case"dismissSuperTeam":return this.onDismissSuperTeam(q,H);case"transferSuperTeam":return this.transferSuperTeam(D,K,B,Z);case"addSuperTeamManagers":return this.updateSuperTeamManagers(D,q,te,!0,H);case"removeSuperTeamManagers":return this.updateSuperTeamManagers(D,q,te,!1,H);case"updateSuperTeamMembersMute":return this.onUpdateSuperTeamMembersMute(D,K,te,Q.mute)}},M.onAddSuperTeamMembers=function(D,Q,G){var B=this.db,q=X.assembleMembers(Q,G);D.attach.members=q;var H={team:Q,accounts:G,members:q};if(this.logger.info("team::onAddSuperTeamMembers: ".concat(H.team.teamId,", "),H.accounts),this.options.onAddSuperTeamMembers(U.simpleClone(H)),B.enable){var K=B.putSuperTeamMembers(q),Z=B.putSuperTeam(Q);return n.all([K,Z])}},M.onRemoveSuperTeamMembers=function(D,Q,G){var B=this.db,q={team:D,teamId:Q,accounts:G};if(this.logger.info("team::onRemoveSuperTeamMembers: ".concat(Q,", "),q.accounts),this.options.onRemoveSuperTeamMembers&&this.options.onRemoveSuperTeamMembers(U.simpleClone(q)),D&&B.enable){if(d(G).call(G,this.account)===-1){var H=B.removeSuperTeamMembersByAccounts(Q,G),K=n.resolve();return D&&(K=B.putSuperTeam(D)),n.all([H,K])}return B.leaveSuperTeam(Q)}},M.onDismissSuperTeam=function(D,Q){var G=this.db,B={teamId:D};if(this.logger.info("team::onDismissSuperTeam:",D),this.options.onDismissSuperTeam(B),G.enable)return G.dismissSuperTeam(D,Q)},M.onAddTeamMembers=function(D,Q,G){var B=this,q=B.db,H=Q.teamId,K=$.assembleMembers(Q,G);D.attach.members=K;var Z={team:Q,accounts:G,members:K};if(B.logger.info("team::onAddTeamMembers: ",H,G),B.options.onAddTeamMembers(U.simpleClone(Z)),q.enable){var te,ne=q.putTeam(Q);return d(G).call(G,B.account)===-1?te=q.putTeamMembers(K):(B.logger.log("team::onAddTeamMembers: user join team",H),ne=new n(function(re){B.api.getTeamMembers({teamId:H,sync:!0,done:function(){re()}})})),n.all([te,ne])}},M.onRemoveTeamMembers=function(D,Q,G){var B=this.db,q={team:D,teamId:Q,accounts:G};if(this.logger.info("team::onRemoveTeamMembers: ".concat(Q),G),this.options.onRemoveTeamMembers(U.simpleClone(q)),D&&B.enable){if(d(G).call(G,this.account)===-1){var H=B.removeTeamMembersByAccounts(Q,G),K=n.resolve();return D&&(K=B.putTeam(D)),n.all([H,K])}return B.leaveTeam(Q)}},M.updateTeamManagers=function(D,Q,G,B,q){var H=this.db,K=D.attach.members=u(G).call(G,function(se){return{id:$.genId(Q,se),type:B?"manager":"normal",updateTime:q,account:se}}),Z={teamId:""+Q,memberUpdateTime:q};D.attach.team=Z;var te={team:Z,accounts:G,isManager:B,members:K};if(this.logger.info("team::updateTeamManagers:",Q,G,B),this.options.onUpdateTeamManagers(U.simpleClone(te)),H.enable){var ne=H.updateTeam(Z),re=H.updateTeamManagers(Q,G,B,q);return n.all([ne,re])}},M.updateSuperTeamManagers=function(D,Q,G,B,q){var H=this.db,K=D.attach.members=u(G).call(G,function(se){return{id:$.genId(Q,se),teamId:Q,account:se,type:B?"manager":"normal",updateTime:q}}),Z={teamId:""+Q,memberUpdateTime:q};D.attach.team=Z;var te={team:Z,accounts:G,isManager:B,members:K};if(this.logger.info("team::updateSuperTeamManagers:",Q,G,B),this.options.onUpdateSuperTeamManagers(U.simpleClone(te)),H.enable){var ne=H.updateSuperTeam(Z),re=H.updateSuperTeamMembers(K);return n.all([ne,re])}},M.onDismissTeam=function(D,Q){var G=this.db,B={teamId:D};if(this.logger.info("team::onDismissTeam:",D),this.options.onDismissTeam(B),G.enable)return G.dismissTeam(D,Q)},M.transferTeam=function(D,Q,G,B){var q=this.db,H=Q.teamId,K=Q.memberUpdateTime,Z={id:$.genId(H,G),type:"normal",updateTime:K},te={id:$.genId(H,B),type:"owner",updateTime:K};D.attach.members=[Z,te];var ne={team:Q,from:Z,to:te};if(this.logger.info("team::transferTeam: from to",H,G,B),this.options.onTransferTeam(U.simpleClone(ne)),q.enable)return q.transferTeam(Q,G,B)},M.transferSuperTeam=function(D,Q,G,B){var q=this.db,H=Q.teamId,K=Q.memberUpdateTime,Z={teamId:H,type:"normal",account:G,updateTime:K},te={teamId:H,type:"owner",account:B,updateTime:K};D.attach.members=[Z,te];var ne={team:Q,from:Z,to:te};if(this.logger.info("team::transferSuperTeam: from to ",H,G,B),this.options.onTransferSuperTeam(U.simpleClone(ne)),q.enable)return q.transferSuperTeam(Q,Z,te)},M.onUpdateTeamMembersMute=function(D,Q,G,B){var q=this.db,H=u(G).call(G,function(ne){return{id:$.genId(Q.teamId,ne),account:ne,teamId:Q.teamId,mute:B,updateTime:Q.memberUpdateTime}});D.attach.members=H;var K={team:Q,accounts:G,members:H,mute:B};if(this.logger.info("team::onUpdateTeamMembersMute:",Q.teamId,G,B),this.options.onUpdateTeamMembersMute(U.simpleClone(K)),q.enable){var Z=q.updateTeamMembers(H),te=q.putTeam(Q);return n.all([Z,te])}},M.onUpdateSuperTeamMembersMute=function(D,Q,G,B){var q=this.db,H=u(G).call(G,function(ne){return{id:X.genId(Q.teamId,ne),account:ne,teamId:Q.teamId,mute:B,updateTime:Q.memberUpdateTime}});D.attach.members=H;var K={team:Q,accounts:G,members:H,mute:B};if(this.logger.info("team::onUpdateSuperTeamMembersMute:",Q.teamId,G,B),this.options.onUpdateSuperTeamMembersMute(U.simpleClone(K)),q.enable){var Z=q.updateSuperTeamMembers(H),te=q.putSuperTeam(Q);return n.all([Z,te])}},M.onHistoryMsgs=function(D){D.error||(D.obj.msgs=this.message.reverseMsgs(D.content.msgs))},M.onmsgFtsInServer=function(D){if(!D.error){var Q=this.message.reverseMsgs(D.content.msgs);D.obj.msgs=Q,D.content.msgs=Q}},M.isFilterMsgs=function(D){return!!s(D[0])},M.splitMsgs=function(D,Q,G,B){i(D).call(D,function(q){if(s(q))B.push(q);else switch(q.scene){case"p2p":Q.push(q);break;case"team":G.push(q)}})},M.markMsgRead=function(D,Q){if(U.isArray(D)||(D=[D]),this.db.enable||this.options.autoMarkRead||Q){var G=u(D).call(D,function(B){return{flag:"msg",idServer:B.idServer,scene:B.scene,filter:s(B),type:B.type,attachType:B.attach&&B.attach.type}});this.msgAckBufferManager.add(G)}},M.markSysMsgRead=function(D,Q){if(U.isArray(D)||(D=[D]),this.db.enable||this.options.autoMarkRead||Q){var G=u(D).call(D,function(B){return{flag:"systemMsg",idServer:B.idServer,scene:B.scene,filter:s(B),type:B.type}});this.msgAckBufferManager.add(G)}},M.handleMsgsAck=function(D){var Q,G=this,B={p2pSysMsgs:{sid:7,cid:3,msgs:[]},p2pMsgs:{sid:7,cid:2,msgs:[]},superTeamSysMsgs:{sid:21,cid:19,msgs:[]},teamMsgs:{sid:8,cid:3,msgs:[]},filterSysMsgs:{sid:101,cid:3,msgs:[]},filterMsgs:{sid:101,cid:2,msgs:[]},netcallMsgs:{sid:9,cid:11,msgs:[]}};i(D).call(D,function(q){/^(netcallBill|netcallMiss|netcallReject)$/.test(q.attachType)?B.netcallMsgs.msgs.push(q):s(q)?q.flag==="systemMsg"?B.filterSysMsgs.msgs.push(q):B.filterMsgs.msgs.push(q):q.flag!=="systemMsg"?q.scene==="p2p"?B.p2pMsgs.msgs.push(q):q.scene==="team"&&B.teamMsgs.msgs.push(q):q.scene==="superTeam"?B.superTeamSysMsgs.msgs.push(q):B.p2pSysMsgs.msgs.push(q)}),i(Q=p(B)).call(Q,function(q){return G.doMarkMsgsRead(B[q].sid,B[q].cid,B[q].msgs)})},M.doMarkMsgsRead=function(D,Q,G){G&&G.length&&(this.logger.log("markMsgRead::batchMarkRead",D,Q,G),this.sendCmd("batchMarkRead",{sid:D,cid:Q,ids:u(G).call(G,function(B){return B.idServer})}))}},function(o,k,e){var r=e(57),i=e(9),s=e(2),n=e(5),u=e(17),p=e(3),d=e(41),m=e(58),c=e(59),h=e(60),a=e(61),y=e(47);function T(R,N){var F=n(R);if(m){var P=m(R);N&&(P=u(P).call(P,function(x){return c(R,x).enumerable})),F.push.apply(F,P)}return F}function v(R){for(var N=1;N<arguments.length;N++){var F,P,x=arguments[N]!=null?arguments[N]:{};N%2?s(F=T(Object(x),!0)).call(F,function(L){r(R,L,x[L])}):h?a(R,h(x)):s(P=T(Object(x))).call(P,function(L){y(R,L,c(x,L))})}return R}var g=e(35).fn,b=e(749),S=e(751);function O(R,N,F){var P=this,x=this.timetags&&this.timetags.sync;this.db.enable&&x&&N&&this.db.getMsgByIdClient(R).then(function(L){if(L&&!(L.commentTimetag&&L.commentTimetag<=x&&L.time<=x)){if(L.commentTimetag=N.time,L.comments=L.comments||[],F){var _;L.comments=u(_=L.comments).call(_,function(U){return U.body!==N.body||U.from!==N.from})}else{for(var C,A=0;A<L.comments.length;A++)if(L.comments[A].from===N.from&&L.comments[A].body===N.body){L.comments[A]=N,C=!0;break}C||L.comments.push(N)}var M={idClient:L.idClient,comments:L.comments,commentTimetag:L.commentTimetag};P.db.updateMsg(M)}})}function I(R){R.scene=this.message.sceneReverseMap[+R.scene]||R.scene,R.time=+R.time}g.processMsgExtend=function(R){switch(R.cmd){case"getThreadMsgs":this.onGetThreadMsgs(R);break;case"getMsgsByIdServer":this.onGetMsgsByIdServer(R);break;case"addQuickComment":this.changeQuickComment(R);break;case"deleteQuickComment":this.changeQuickComment(R,!0);break;case"onQuickComment":case"syncAddQuickComment":this.onQuickComment(R);break;case"onDeleteQuickComment":case"syncDeleteQuickComment":this.onQuickComment(R,!0);break;case"getQuickComments":this.getQuickComments(R);break;case"addCollect":case"updateCollect":this.addCollect(R);break;case"deleteCollects":this.deleteCollects(R);break;case"getCollects":this.getCollects(R);break;case"addStickTopSession":case"syncAddStickTopSession":this.onChangeStickTopSession(R,"add");break;case"updateStickTopSession":case"syncUpdateStickTopSession":this.onChangeStickTopSession(R,"update");break;case"deleteStickTopSession":case"syncDeleteStickTopSession":this.onChangeStickTopSession(R,"delete");break;case"addMsgPin":case"onAddMsgPin":case"syncAddMsgPin":this.pinMsgChange(R,"add");break;case"updateMsgPin":case"onUpdateMsgPin":case"syncUpdateMsgPin":this.pinMsgChange(R,"update");break;case"deleteMsgPin":case"onDeleteMsgPin":case"syncDeleteMsgPin":this.pinMsgChange(R,"delete");break;case"getMsgPins":this.getMsgPins(R)}},g.onGetThreadMsgs=function(R){if(!R.error){var N;R.obj.msgs=this.message.reverseMsgs(R.content.msgs),R.obj.threadMsg=i(N=this.message).call(N,R.content.threadMsg);var F=R.content.threadMsgsMeta||{};R.obj.total=F.total,R.obj.timetag=F.lastMsgTime}},g.onGetMsgsByIdServer=function(R){R.error||(R.obj.msgs=this.message.reverseMsgs(R.content.msgs))},g.changeQuickComment=function(R,N){R.error||(R.obj.comment.time=R.content.timetag,R.obj.comment=i(b).call(b,R.obj.comment),I.call(this,R.obj.msg),O.call(this,R.obj.msg.idClient,R.obj.comment,N))},g.onQuickComment=function(R,N){if(R.content){var F=R.content,P=F.comment,x=F.msg;P&&x&&(I.call(this,x),P=i(b).call(b,P),N?this.options.onDeleteQuickComment(R.content.msg,P):this.options.onQuickComment(R.content.msg,P),O.call(this,x.idClient,P,N))}},g.getQuickComments=function(R){var N,F=this;if(!R.error){var P=R.obj.idMap,x=R.obj.indexMap,L=R.content&&R.content.commentRes||[];s(L).call(L,function(_){var C=[],A=F.parser.unserializeMap.comment;if(+_.modify==1)try{C=JSON.parse(_.detail)}catch(U){F.logger.warn("getQuickComments parse detail error",U)}if(s(C).call(C,function(U,E){var z,$={};s(z=n(U)).call(z,function(X){$[A[X]]=U[X]}),$=i(b).call(b,$),C[E]=$}),_.timestamp=+_.timestamp,P[_.idClient]){var M={idClient:_.idClient,commentTimetag:_.timestamp};P[_.idClient].commentTimetag=_.timestamp,+_.modify==1&&(P[_.idClient].comments=C,M.comments=C),F.db.enable&&F.db.updateMsg(M)}else P[_.idClient]={idServer:_.idServer,idClient:_.idClient,comments:C,commentTimetag:_.timestamp,scene:F.message.sceneReverseMap[_.scene]||_.scene}}),R.obj=[],s(N=n(x)).call(N,function(_){R.obj[x[_]]=P[_]})}},g.addCollect=function(R){R.error||(R.obj.collect=i(S).call(S,R.content.collect))},g.deleteCollects=function(R){R.error||(R.obj.deleteNum=R.content.deleteNum)},g.getCollects=function(R){if(!R.error){var N=[],F=R.content.collectList||[];s(F).call(F,function(P){N.push(i(S).call(S,P))}),R.obj.collectList=N,R.obj.total=R.content.total}},g.onChangeStickTopSession=function(R,N){var F=this;if(!R.error){var P=R.content.stickTopSession||R.obj.stickTopSession||{},x=R.content.timetag||+P.updateTime,L=P.id.split("|");L[0]==="super_team"&&(L[0]="superTeam"),P={id:L.join("-"),scene:L[0],to:L[1],topCustom:P.topCustom||""},N==="delete"?P.isTop=!1:N==="add"&&(P.isTop=!0),P=this.onUpdateSession(P),R.obj&&(R.obj.stickTopSession=P),this.db.enable&&(this.db.updateSession(P).then(function(_){_||F.db.putSession(P)}),this.db.updateTimetag("stickTopSessions",x))}},g.pinMsgChange=function(R,N){var F=this;if(!R.error){R.content=R.content||{};var P=this,x=this.db,L=R.obj&&R.obj.msg,_=R.content.msg||L||{},C=R.content.pinTag||R.obj.pinTag,A=R.content.timetag||+C.updateTime,M=p.resolve();I.call(this,_),x.enable&&(M=x.getMsgByIdClient(_.idClient)),C.createTime&&(C.createTime=+C.createTime),C.updateTime&&(C.updateTime=+C.updateTime),M.then(function(U){return _=U||_,U?_=U:_.sessionId=_.scene+"-"+F.message.Message.getMsgTarget(_,F.account),L?(R.obj.msg=_,R.obj.pinTag=C):F.options.onPinMsgChange({msg:_,pinTag:C},N),function(){x.enable&&x[N==="delete"?"deleteMsgPin":"putMsgPin"](v(v({},_),{},{pinFrom:C.pinFrom,pinCustom:C.pinCustom})).then(function(){var E="pin-"+_.sessionId,z=P.timetags.sync;return x.getTimetag(E).then(function($){return $>z?x.updateTimetag(E,A):p.resolve()})}).catch(function(E){P.logger.error("msgExtend::pinMsgChange:error",E)})}(),p.resolve}).then(function(){}),R.promise=M}},g.getMsgPins=function(R){var N=this;if(!R.error){var F=this.db,P=R.content||{};if(P.pins=P.pins||[],P.modify){var x,L=[];F.enable&&(F.updateTimetag("pin-"+R.obj.id,P.timetag),s(x=P.pins).call(x,function(_){_.sessionId=R.obj.id,L.push(F.getMsgByIdClient(_.idClient))})),R.promise=p.all(L).then(function(_){var C;s(C=P.pins).call(C,function(A,M){_[M]?d(A,_[M]):(A.sessionId=R.obj.id,I.call(N,A))}),R.obj.pins=P.pins,F.enable&&F.deleteMsgPins(R.obj.id).then(function(){return F.putMsgPins(P.pins)}).catch(function(A){N.logger.error("msgExtend::getMsgPins:change db error",A)})})}else F.enable?(F.updateTimetag("pin-"+R.obj.id,P.timetag),R.promise=F.getMsgPins(R.obj.id).then(function(_){R.obj.pins=_||[]})):R.obj.pins=[]}}},function(o,k,e){var r=e(810);o.exports=r},function(o,k,e){e(811);var r=e(12);o.exports=r.Number.isInteger},function(o,k,e){e(1)({target:"Number",stat:!0},{isInteger:e(812)})},function(o,k,e){var r=e(28),i=Math.floor;o.exports=Number.isInteger||function(s){return!r(s)&&isFinite(s)&&i(s)===s}},function(o,k,e){var r=e(120),i=e(3),s=e(2),n=e(7),u=["time","from"],p=e(35).fn,d=e(0);p.onOfflineMsgReceipts=function(m){var c,h=this,a=h.db,y=m.content.msgReceipts,T=[],v=i.resolve();this.logger.info("onOfflineMsgReceipts",y),s(y).call(y,function(g){c={id:"p2p-"+g.from,msgReceiptTime:+g.time},h.cacheSyncedSession(c)}),h.syncResult.msgReceipts=T,a.enable&&(v=a.updateMsgReceiptsTimetag(m.content.timetag)),v.cmd=T,h.syncPromiseArray.push(v)},p.shouldUpdateSessionFromMsgReceipt=function(m,c){return!m||!m.msgReceiptServerTime||c.time>m.msgReceiptServerTime},p.genSessionFromMsgReceipt=function(m,c){var h=c.time,a={id:c.sessionId,msgReceiptTime:h,msgReceiptServerTime:h};return m&&m.id===c.sessionId&&(a=d.merge({},m,a)),m&&m.updateTime||(a.updateTime=h),a},p.onMsgReceipt=function(m){var c=this,h=c.db,a=m.content.msgReceipt;a.time=+a.time;var y=a.idClient,T=i.resolve();h.enable&&y&&(T=h.getMsgByIdClient(y)),this.logger.info("onMsgReceipt::",a),T.then(function(v){if(v){if(!v.idServer)return void(c.msgReceiptTasks[y]=a);v.time}else a.time;a.msgReceiptTime=a.time,a.sessionId="p2p-".concat(a.from),c.updateSessionMsgReceiptTime(a),a.time,a.from;var g=r(a,u);c.options.onMsgReceipts([g])})},p.resolveMsgReceiptTask=function(m){var c=this.msgReceiptTasks[m.idClient];c&&(c.msgReceiptTime=m.time,this.updateSessionMsgReceiptTime(c))},p.updateSessionMsgReceiptTime=function(m){var c=this.db,h={id:"p2p-"+m.from,msgReceiptTime:m.msgReceiptTime,msgReceiptServerTime:m.time};(this.getSessionInCache(h.id)||{}).msgReceiptTime>=h.msgReceiptTime?this.logger.warn("receive old msgReceiptTime",m):(c.enable&&c.putSession(h),this.onUpdateSession(h))},p.onSendMsgReceipt=function(m){var c;if(!m.error)if(m.obj&&m.obj.msgReceipt){var h=m.obj.msgReceipt,a=+h.time,y=+m.content.msgReceipt.time,T=this.getSessionInCache("p2p-"+h.to);T?(this.logger.info(n(c="sendMsgReceipt on:: param time ".concat(a,", res time ")).call(c,y)),T.msgReceiptSendTime=Math.min(a,y)):this.logger.info("sendMsgReceipt on:: session is undefined or logically deleted, failed to send read receipt")}else this.logger.info("sendMsgReceipt on:: origin msg is missing, it maybe timeout")},p.shouldSendMsgReceipt=function(m){if(m&&m.scene==="p2p"&&m.status==="success"){var c=this.getSessionInCache(m.sessionId);if(c){var h=c.msgReceiptSendTime;return!h||h<m.time}}return!1},p.isMsgRemoteRead=function(m){if(m&&m.scene==="p2p"&&m.flow==="out"&&m.status==="success"){var c=this.getSessionInCache(m.sessionId);if(c&&c.msgReceiptTime)return m.time<=c.msgReceiptTime}return!1}},function(o,k,e){var r=e(102),i=e(103),s=e(56),n=e(9),u=e(2),p=e(7),d=e(8),m=e(3),c=e(87),h=e(197),a=e(5),y=e(17),T=e(52),v=e(15),g=e(25),b=e(201),S=e(85),O=e(86),I=e(69),R=e(32);function N(E,z){var $=O!==void 0&&I(E)||E["@@iterator"];if(!$){if(R(E)||($=function(J,V){var D;if(J){if(typeof J=="string")return F(J,V);var Q=v(D=Object.prototype.toString.call(J)).call(D,8,-1);if(Q==="Object"&&J.constructor&&(Q=J.constructor.name),Q==="Map"||Q==="Set")return S(J);if(Q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Q))return F(J,V)}}(E))||z&&E&&typeof E.length=="number"){$&&(E=$);var X=0,Y=function(){};return{s:Y,n:function(){return X>=E.length?{done:!0}:{done:!1,value:E[X++]}},e:function(J){throw J},f:Y}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var W,ee=!0,w=!1;return{s:function(){$=$.call(E)},n:function(){var J=$.next();return ee=J.done,J},e:function(J){w=!0,W=J},f:function(){try{ee||$.return==null||$.return()}finally{if(w)throw W}}}}function F(E,z){(z==null||z>E.length)&&(z=E.length);for(var $=0,X=new Array(z);$<z;$++)X[$]=E[$];return X}var P=e(35).fn,x=e(151),L=e(152),_=e(0),C=e(105).EMSyncType;function A(E,z){return M.apply(this,arguments)}function M(){return(M=i(r.mark(function E(z,$){var X,Y,W,ee,w,J,V,D,Q,G,B,q,H,K=this;return r.wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(W=(Y=this).db,ee=[],u(z).call(z,function(te){K.revokeMsgUniqueCheck(te.idClient),ee.push(te.idClient)}),Y.options.rollbackDelMsgUnread){Z.next=14;break}return Z.next=7,W.deleteMsg(ee);case 7:if(Z.t0=Z.sent,Z.t0){Z.next=10;break}Z.t0=[];case 10:return w=Z.t0,w=Object.prototype.toString.call(w)==="[object Array]"?w:[w],Y.logger.info("msg::_deleteMsgSelfBatchInDb, rollback false, affect: ".concat(w.length," rows")),Z.abrupt("return");case 14:return J=!1,V=Y.options.cbUpdateSession||g(X=Y.updateSessionInDbWithNotify).call(X,Y),D=Y.getSessionInCache($)||{id:$},Q=D.lastMsg||{},b(ee).call(ee,Q.idClient)&&(J=!0),Y.logger.info("msg::_deleteMsgSelfBatchInDb session change before:",$,J,D.unread),Z.next=22,W.deleteMsg(ee);case 22:if(Z.t1=Z.sent,Z.t1){Z.next=25;break}Z.t1=[];case 25:if(G=Z.t1,G=Object.prototype.toString.call(G)==="[object Array]"?G:[G],Y.logger.info("msg::_deleteMsgSelfBatchInDb affect:",G.length," rows"),!J){Z.next=34;break}return Z.next=31,W.getMsgs({sessionId:$,limit:1});case 31:B=Z.sent,Q=B&&B[0]?B[0]:null,D.lastMsg=Q;case 34:if(q=!1,D&&D.unread&&(H=D&&D.ack||0,u(G).call(G,function(te){var ne=!0;if(te.type==="notification")try{ne=Y.options.shouldCountNotifyUnread(te)}catch(re){throw Y.logger.error("userOption:shouldCountNotifyUnread function error",re),re}ne&&H<te.time&&te.flow==="in"&&(D.unread=D.unread>0?D.unread-1:0,q=!0)})),!J&&!q){Z.next=39;break}return Y.logger.info("msg::_deleteMsgSelfBatchInDb session change after:",$,D.unread),Z.abrupt("return",V(D));case 39:case"end":return Z.stop()}},E,this)}))).apply(this,arguments)}function U(E,z){z=z||new Date().getTime();var $=this.db,X=this.getSessionInCache(E),Y=this.options.rollbackClearMsgsUnread!==!1,W=[];return $.enable&&W.push($.deleteMsgsBySessionId({sessionId:E,end:z})),Y&&X&&(X=this.mergeSession({id:X.id,unread:0,lastMsg:null,unreadMsgs:[]}),X=this.onUpdateSession(X)),$.enable&&Y&&X&&W.push($.updateSession(X)),m.all(W)}P.onDeleteMsg=function(E){var z=this.db;if(delete E.obj.sysMsg,!E.error){var $=E.obj.msg;E.promise=this.deleteLocalMsg($).then(function(){if(z.enable){var X=$.scene==="superTeam"?"deleteSuperTeamMsg":"deleteMsg";z.getTimetag(X).then(function(Y){Y=Y||0,s()+1>=Y&&z.updateTimetag(X,s()+1)})}})}},P.onMsgDeleted=function(E,z){var $=this;if(!$.canHandleDeletedMsgInSyncing)return $.logger.info("msg::onMsgDeleted:is in syncing ..."),void $.unhandledSysMsgsForDeletedMsgs.push({packet:E,isSuperTeam:z});if(!E.error){var X=$.db,Y=n(x).call(x,E.content.sysMsg);Y=$.processDeleteMsgSysMsg(Y),z||$.markSysMsgRead(Y),$.deleteLocalMsg(Y.msg).then(function(){if(X.enable){var W=z?"deleteSuperTeamMsg":"deleteMsg";X.updateTimetag(W,Y.time+1)}$.handleSysMsg(Y)})}},P.processDeleteMsgSysMsg=function(E){var z;return E.msg={},u(z=["scene","from","to"]).call(z,function($){E.msg[$]=E[$]}),E.msg.idClient=E.deletedIdClient,E.msg.idServer=E.deletedIdServer,E.msg.time=E.deletedMsgTime,E.msg.fromNick=E.deletedMsgFromNick,E.opeAccount=E.opeAccount||E.from,E.msg.opeAccount=E.opeAccount,this.message.Message.setExtra(E.msg,this.account),E},P.onDeleteMsgOfflineRoaming=function(E){if(!E.error){var z,$=this,X=+E.content.type==1?"offline":"roaming",Y=x.reverseSysMsgs(E.content.sysMsgs,{mapper:function(J){return $.processDeleteMsgSysMsg(J)}}),W=Y&&Y[0]&&Y[0].scene==="superTeam";$.logger.info(p(z="msg::onDeleteMsgOfflineRoaming: on delete ".concat(X," ")).call(z,W?"superTeam":""," idServer deletedIdClient deletedIdClient="),d(Y).call(Y,function(J){var V,D;return p(V=p(D="".concat(J.idServer,"-")).call(D,J.deletedIdServer,"-")).call(V,J.deletedIdClient)})),X==="offline"&&$.markSysMsgRead(Y);var ee=E.content.timetag;W?($.timetags.deleteSuperTeamMsg=ee,$.syncResult.deleteSuperTeamMsgTimetag=ee):($.timetags.deleteMsg=ee,$.syncResult.deleteMsgTimetag=ee);var w=$.putSysMsg(Y,"offlineSysMsgs").catch(function(J){return $.logger.error("msgDelete::onDeleteMsgOfflineRoaming: ",J),m.reject(J)});w.cmd="deleteMsgSysMsgs "+X,$.syncPromiseArray.push(w),$.syncResult.deleteMsgSysMsgs=$.syncResult.deleteMsgSysMsgs||[],$.syncResult.deleteMsgSysMsgs.push({type:X,sysMsgs:Y})}},P.deleteMsgOfflineRoaming=function(E,z){if(!E)return m.resolve();var $=this;$.logger.info("msg::deleteMsgOfflineRoaming: ",d(E).call(E,function(W){var ee;return W.type+" "+d(ee=W.sysMsgs).call(ee,function(w){var J,V;return p(J=p(V="".concat(w.idServer,"-")).call(V,w.deletedIdServer,"-")).call(J,w.deletedIdClient)})}),_.secureOutput("session",z));var X=$.db,Y=[];return u(E).call(E,function(W){var ee;u(ee=W.sysMsgs).call(ee,function(w){var J=$.deleteLocalMsg(w.msg,{cbUpdateSession:function(V){V=$.mergeSession(V),V=c(L).call(L,V);var D=_.findObjIndexInArray(z,{value:V.id});if(D!==-1&&(z[D]=_.merge({},z[D],V)),X.enable)return X.updateSession(V)}});Y.push(J)})}),m.all(Y).then(function(){X.enable&&($.syncResult.deleteMsgTimetag&&X.updateTimetag("deleteMsg",$.syncResult.deleteMsgTimetag),$.syncResult.deleteSuperTeamMsgTimetag&&X.updateTimetag("deleteSuperTeamMsg",$.syncResult.deleteSuperTeamMsgTimetag))})},P.deleteMsgSelf=function(E){if(!E.error){var z=this.db,$=E.obj&&E.obj.deleteMsgSelfTag;if($){var X=E.content&&E.content.timetag;$.scene=$.scene+""=="1"?"p2p":"team";var Y=[this.deleteLocalMsg($)];X<=this.timetags.deleteMsgSelf||(this.timetags.deleteMsgSelf=X,z.enable&&Y.push(z.updateDeleteMsgSelf(X))),E.promise=m.all(Y)}}},P.deleteMsgSelfBatch=function(){var E=i(r.mark(function z($){var X,Y,W,ee,w,J,V,D;return r.wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(!$.error){Q.next=2;break}return Q.abrupt("return");case 2:if(Y=this,W=this.db,(ee=$.obj&&$.obj.deleteMsgSelfTags)&&ee.length>0){Q.next=7;break}return Q.abrupt("return");case 7:if(w=h(ee).call(ee,function(G,B){var q=B.sessionId;if(G[q]=G[q]||[],G[q].push(B),!W.enable){var H=Y.getSessionInCache(q);H&&H.lastMsg&&B&&H.lastMsg.idClient===B.idClient&&(H.lastMsg=null,Y.onUpdateSession(H))}return G},{}),W.enable){Q.next=11;break}return u(J=a(w)).call(J,function(G){var B=w[G],q=Y.getSessionInCache(G);if(Y.options.rollbackDelMsgUnread&&q){var H=q.ack||0,K=y(B).call(B,function(Z){var te=!0;if(Z.type==="notification")try{te=Y.options.shouldCountNotifyUnread(Z)}catch(ne){throw Y.logger.error("userOption:shouldCountNotifyUnread function error",ne),ne}return Y.message.Message.setFlow(Z,Y.account),te&&H<Z.time&&Z.flow==="in"});K.length>0&&q.unread&&(q.unread=q.unread-K.length>=0?q.unread-K.length:0,Y.onUpdateSession(q))}}),Q.abrupt("return",m.resolve());case 11:V=d(X=a(w)).call(X,function(G){var B=w[G];return A.call(Y,B,G)}),(D=$.content&&$.content.timetag)<=Y.timetags.deleteMsgSelf||(Y.timetags.deleteMsgSelf=D,V.push(W.updateDeleteMsgSelf(D))),$.promise=m.all(V);case 15:case"end":return Q.stop()}},z,this)}));return function(z){return E.apply(this,arguments)}}(),P.onDeleteMsgSelf=function(E){var z=this,$=this.db,X=E.content.deleteMsgSelfTag;X.scene=X.scene+""=="1"?"p2p":"team",z.options.onDeleteMsgSelf([X]),z.deleteLocalMsg(X).then(function(){var Y=X.deletedTime;return Y<=z.timetags.deleteMsgSelf||!$.enable?m.resolve():(z.timetags.deleteMsgSelf=Y,$.updateDeleteMsgSelf(Y))}).catch(function(Y){z.logger.error("onDeleteMsgSelf error",Y)})},P.onDeleteMsgSelfBatch=function(E){var z=this;if(!E.error){var $={1:"p2p",2:"team"},X=_.get(E,"content.deleteMsgSelfTags")||[];u(X).call(X,function(W){var ee;W.scene=$[W.scene],W.sessionId=p(ee="".concat(W.scene,"-")).call(ee,z.message.Message.getMsgTarget(W,z.account)),W.deletedTime=T(W.deletedTime),W.time=T(W.time)});var Y=_.get(E,"content.deleteMsgSelfTags[0].deletedTime");Y=T(Y)||0,this.options.onDeleteMsgSelf(X),this.deleteMsgSelfBatch({obj:{deleteMsgSelfTags:X},content:{timetag:Y}})}},P.clearServerHistoryMsgs=function(E){if(!E.error){var z=this.db,$=E.obj&&E.obj.clearMsgsParamsWithSync;if($){var X=($.type&&$.type.toString()==="2"?"team":"p2p")=="p2p"?"p2p-".concat($.otherAccid):"team-".concat($.toTid),Y=E.content&&T(E.content.timetag);Y&&Y>this.timetags.sessionHistoryMsgsDelete&&(this.timetags.sessionHistoryMsgsDelete=Y,z.enable&&z.updateTimetag("sessionHistoryMsgsDelete",this.timetags.sessionHistoryMsgsDelete)),U.call(this,X,Y)}}},P.onClearServerHistoryMsgs=function(E){if(!E.error){var z=this.db,$=E.content&&E.content.sessionHistoryMsgsDeleteTag;if($){var X=($.type&&$.type.toString()==="2"?"team":"p2p")=="p2p"?"p2p-".concat($.otherAccid):"team-".concat($.toTid),Y=$.ext,W=T($.time);this.options.onClearServerHistoryMsgs&&this.options.onClearServerHistoryMsgs([{sessionId:X,time:W,ext:Y}]),W<=this.timetags.sessionHistoryMsgsDelete||(this.timetags.sessionHistoryMsgsDelete=W,z.enable&&z.updateTimetag("sessionHistoryMsgsDelete",this.timetags.sessionHistoryMsgsDelete)),U.call(this,X,W)}}},P.syncSessionHistoryMsgsDelete=function(E){if(!E.error){var z=this.db,$=E.content&&E.content.sessionHistoryMsgsDeleteTags;if($&&$.length>0){var X=d($).call($,function(W){return{sessionId:(W.type&&W.type.toString()==="2"?"team":"p2p")=="p2p"?"p2p-".concat(W.otherAccid):"team-".concat(W.toTid),time:T(W.time)}});this.reporterHook.emit("reporter/syncItemComplete",C.kSyncType4_24),this.options.onClearServerHistoryMsgs&&this.options.onClearServerHistoryMsgs(X),this.syncResult.clearServerHistoryMsgs=X;var Y=0;u(X).call(X,function(W){W.time>Y&&(Y=W.time)}),z.enable&&z.updateTimetag("sessionHistoryMsgsDelete",Y)}}},P.syncDeleteMsgSelf=function(E){var z=this,$=this.db,X=E.content.deletedMsgs;if(X&&X.length!==0){var Y=[];u(X).call(X,function(W){W.scene=W.scene==="1"?"p2p":"team",W.deletedTime=+W.deletedTime,W.time=+W.time,Y.push(z.deleteLocalMsg(W))}),z.options.onDeleteMsgSelf(X),m.all(Y).then(function(){var W=v(X).call(X,-1)[0].deletedTime;if(!(z.timetags.deleteMsgSelf>=W))return z.timetags.deleteMsgSelf=W,$.enable?$.updateDeleteMsgSelf(W):void 0}).catch(function(W){z.logger.error("syncDeleteMsgSelf error",W)})}},P.deleteLocalMsg=function(){var E=i(r.mark(function z($,X){var Y,W,ee,w,J,V,D,Q,G,B,q,H;return r.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if($){K.next=2;break}return K.abrupt("return");case 2:if(ee=(W=this).db,w=(X=X||{}).cbUpdateSession||g(Y=W.updateSessionInDbWithNotify).call(Y,W),this.revokeMsgUniqueCheck($&&$.idClient),J=$.sessionId||$.scene+"-"+this.message.Message.getMsgTarget($,this.account),V=!1,D=W.getSessionInCache(J),Q=!0,$.type!=="notification"){K.next=20;break}K.prev=12,Q=W.options.shouldCountNotifyUnread($),K.next=20;break;case 16:throw K.prev=16,K.t0=K.catch(12),W.logger.error("userOption:shouldCountNotifyUnread function error",K.t0),K.t0;case 20:if(W.options.rollbackDelMsgUnread&&D&&(G=D.ack||0,Q&&D&&G<$.time&&$.from!==W.account&&D.unread&&(W.logger.info("msgDelete::deleteLocalMsg:cache.getSessions: unread",D.id,D.unread),D.unread=D.unread-1,V=!0)),D&&D.lastMsg&&D.lastMsg.idClient==$.idClient&&(W.logger.info("msgDelete::deleteLocalMsg:cache.getSessions: lastMsg",D.id,D.unread),D.lastMsg=null,V=!0),!ee.enable){K.next=49;break}return B=null,K.next=26,ee.getMsgByIdClient($.idClient);case 26:return K.sent||W.logger.info("msgDelete::deleteLocalMsg::db.deleteMsg no find in DB",$),W.logger.info("msgDelete::deleteLocalMsg::db.deleteMsg ",$.idClient),K.next=31,ee.deleteMsg($.idClient);case 31:if(!D||D.lastMsg!==null){K.next=36;break}return K.next=34,ee.getMsgs({sessionId:J,limit:1});case 34:(q=K.sent)&&q[0]&&(B=q[0]);case 36:if(D||!W.options.rollbackDelMsgUnread){K.next=46;break}return W.logger.info("msgDelete::deleteLocalMsg::Can not find session in cache,will find in DB",J),K.next=40,ee.getSession(J);case 40:if(H=K.sent){K.next=43;break}return K.abrupt("return");case 43:G=(D=H).ack||0,Q&&D&&G<$.time&&$.flow==="in"&&D.unread&&(W.logger.info("msgDelete::deleteLocalMsg:db.getSessions: unread",H.id,H.unread),D.unread=D.unread-1,V=!0);case 46:if(D&&D.lastMsg===null&&B&&(W.logger.info("msgDelete::deleteLocalMsg:db.getSessions: lastMsg",J,B),D.lastMsg=B||null,V=!0),!V){K.next=49;break}return K.abrupt("return",w(D));case 49:if(ee.enable||!V){K.next=52;break}return W.onUpdateSession(D),K.abrupt("return");case 52:case"end":return K.stop()}},z,this,[[12,16]])}));return function(z,$){return E.apply(this,arguments)}}(),P.deleteLocalMsgs=function(E){var z=this,$=z.db;return new m(function(X,Y){if(function(W){var ee=z.getSessionInCache(E.sessionId);if(ee&&E.updateSession){var w=ee.lastMsg;w&&(!E.start&&!E.end||w.time>E.start&&w.time<E.end)&&(ee.lastMsg=null,z.logger.log("deleteLocalMsgs::delete cacheSession lastMsg done, options is",E),$.enable||(z.onUpdateSession(ee),W()))}}(X),$.enable)return $.deleteMsgsBySessionId(E).then(function(){E.updateSession&&z.checkAndUpdateLocalSessionByMsg(E.sessionId),X()},function(W){return Y(W)})})},P.deleteLocalMsgsByTime=function(){var E=i(r.mark(function z($){var X,Y,W,ee,w,J,V,D,Q,G,B,q,H,K;return r.wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Y=(X=this).db,Z.next=4,Y.getDeletedMsgsCountByTime($);case 4:return W=Z.sent,ee=0,w=[],Z.next=9,Y.deleteMsgsByTime($);case 9:return $.deletedone&&$.deletedone({deletedMsgCount:W}),Z.next=12,Y.getAllSessions();case 12:J=Z.sent,V=N(J),Z.prev=14,V.s();case 16:if((D=V.n()).done){Z.next=47;break}return Q=D.value,G=Q.id,B=!1,Z.next=22,Y.getSession(G);case 22:if(q=Z.sent){Z.next=25;break}return Z.abrupt("continue",45);case 25:return Z.next=27,Y.getMsgCountAfterAck({shouldCountNotifyUnread:X.options.shouldCountNotifyUnread,sessionId:G,ack:q.ack||0});case 27:if(H=Z.sent,q.unread!==H&&(q.unread=H,B=!0),!(q.lastMsg&&q.lastMsg.time>$.start&&q.lastMsg.time<$.end)){Z.next=39;break}if($.start!==0){Z.next=34;break}q.lastMsg=null,Z.next=38;break;case 34:return Z.next=36,Y.getMsgs({sessionId:G,limit:1});case 36:K=Z.sent,q.lastMsg=K&&K[0]?K[0]:null;case 38:B=!0;case 39:if(!B){Z.next=45;break}return Z.next=42,Y.updateSession(q);case 42:X.sessionSet[G]&&w.push(q),ee++;case 45:Z.next=16;break;case 47:Z.next=52;break;case 49:Z.prev=49,Z.t0=Z.catch(14),V.e(Z.t0);case 52:return Z.prev=52,V.f(),Z.finish(52);case 55:return X.onUpdateSessions(w),Z.abrupt("return",m.resolve({deletedMsgCount:W,sessionUpdateCount:ee}));case 57:case"end":return Z.stop()}},z,this,[[14,49,52,55]])}));return function(z){return E.apply(this,arguments)}}()},function(o,k,e){var r=e(68),i=e(8),s=e(9),n=e(7),u=e(3),p=e(23),d=e(17),m=e(2),c=e(35).fn,h=e(0),a=e(151);c.splitSysMsgs=function(y,T){for(var v,g=y.length-1;g>=0;g--)v=y[g],a.isCustom(v)&&(r(y).call(y,g,1),T.push(v))},c.onOfflineSysMsgs=function(y,T){var v,g=this,b=i(v=y.content.sysMsgs).call(v,function(F){return F=s(a).call(a,F),T&&(F.filter=!0),F});b=s(b).call(b),g.markSysMsgRead(b);var S=[];g.splitSysMsgs(b,S);var O,I=T?"offlineFilterSysMsgs":"offlineSysMsgs",R=T?"offlineFilterCustomSysMsgs":"offlineCustomSysMsgs";if(b.length){var N=g.putSysMsg(b,"offlineSysMsgs").then(function(F){var P;(b=F).length&&(g.logger.info("sysmsg::onOfflineSysMsgs: ",I,b.length,b&&i(b).call(b,function(x){return x.idServer})),g.syncResult[I]=g.syncResult[I]||[],g.syncResult[I]=n(P=g.syncResult[I]).call(P,b))}).catch(function(F){return g.logger.error("sysMsg::onOfflineSysMsgs: ",F),u.reject(F)});N.cmd="sysMsgs",g.syncPromiseArray.push(N)}S.length&&(g.logger.info("sysmsg::onOfflineSysMsgs: ",R,i(S).call(S,function(F){return F.idServer})),g.syncResult[R]=g.syncResult[R]||[],g.syncResult[R]=n(O=g.syncResult[R]).call(O,S))},c.onSendSysMsg=function(y,T){var v=y.obj||{};v?(this.completeSysMsg(v),y.error?v.status="fail":v.status="success",v=s(a).call(a,v),T&&(y.obj.filter=!0),y.obj=v):this.logger.warn("onSendSysMsg::no obj")},c.completeSysMsg=function(y){return y.from=this.account,y},c.onSysMsg=function(y,T){var v=s(a).call(a,y.content.sysMsg);T&&(v.filter=!0),this.markSysMsgRead(v),a.isCustom(v)?(this.logger.info("sysmsg::onSysMsg: on customSysMsg"),this.options.oncustomsysmsg(v)):this.syncing?(this.logger.info("sysmsg::onSysMsg:is in syncing ..."),this.unhandledSysMsgs.push(v)):this.handleSysMsg(v)},c.handleSysMsg=function(y){var T=this,v=y.type,g=y.from,b=y.serverex;T.sysMsgPromise=T.sysMsgPromise.then(function(){return T.putSysMsg(y,"onSysMsg")}).then(function(S){y=S[0]}).then(function(){if(y){var S,O=u.resolve();switch(v){case"addFriend":S={type:"addFriend",account:g},b&&(S.serverex=b),O=T.onFriendRequest(S);break;case"passFriendApply":S={type:"passFriendApply",account:g},O=T.onFriendRequest(S);break;case"deleteFriend":O=T.onDeleteFriend({account:g})}return S&&S.friend&&(y.friend=S.friend),O}}).then(function(){y&&(T.logger.info("sysmsg::handleSysMsg: ",v,h.pickAsString(y,["idServer","deletedIdClient","deletedIdServer"])),p(function(){T.options.onsysmsg(y)},0))})},c.putSysMsg=function(y,T){if(h.isArray(y)||(y=[y]),d(y[0]))return u.resolve(y);var v=this,g=v.db,b=g.enable,S=u.resolve(),O=[];return(S=(S=S.then(function(){return b?g.putSysMsg(y):y}).then(function(I){var R=[];m(y).call(y,function(N){v.checkSysMsgUnique(N)&&R.push(N)}),y=R,O=b?I:y})).then(function(){return v.getSysMsgUnread().then(function(I){return O.length||((O=y).backward=!0),v.updateSysMsgUnread(O,I,1).then(function(R){T==="offlineSysMsgs"&&(v.syncResult.sysMsgUnread=R),T==="onSysMsg"&&v.onUpdateSysMsgUnread(R)})})})).then(function(){return y})},c.checkSysMsgUnique=h.genCheckUniqueFunc("idServer"),c.getSysMsgUnread=function(){var y=this,T=y.db;return new u(function(v){T.enable?T.getSysMsgUnread().then(function(g){v(g)},function(){v(y.sysMsgUnread)}):v(y.sysMsgUnread)})},c.updateSysMsgUnread=function(y,T,v){if(h.isArray(y)||(y=[y]),!y.length)return u.resolve(T);T=T||{};var g,b=this.db;return m(y).call(y,function(S){(v>0&&!S.read||v<0&&S.read)&&(g=S.type,T[g]=(T[g]||0)+v)}),T=a.completeUnread(T),this.sysMsgUnread=T,b.enable&&!y.backward?b.updateSysMsgUnread(T):u.resolve(T)},c.reduceSysMsgUnread=function(y){var T=this;return T.getSysMsgUnread().then(function(v){return T.updateSysMsgUnread(y,v,-1)}).then(function(v){T.onUpdateSysMsgUnread(v)})},c.onUpdateSysMsgUnread=function(y){var T=this;p(function(){T.logger.info("sysmsg::onUpdateSysMsgUnread:",y),T.options.onupdatesysmsgunread(y)},0)},c.updateSysMsg=function(y){var T=this,v=T.db;(v.enable?v.updateSysMsg(y):u.resolve(y)).then(function(g){T.onUpdateSysMsg(g)})},c.onUpdateSysMsg=function(y){var T=this;p(function(){h.isArray(y)||(y=[y]),m(y).call(y,function(v){T.logger.info("sysmsg::onUpdateSysMsg:",v.idServer),T.options.onupdatesysmsg(v)})},0)},c.processUnsettledSysMsgs=function(){var y,T,v=this;m(y=v.unhandledSysMsgs).call(y,function(g){v.handleSysMsg(g)}),m(T=v.unhandledSysMsgsForDeletedMsgs).call(T,function(g){v.onMsgDeleted(g.packet,g.isSuperTeam)}),v.resetUnsettledSysMsgs()}},function(o,k,e){var r=e(752),i=e(57),s=e(2),n=e(6),u=e(15),p=e(9),d=e(3),m=e(8),c=e(87),h=e(17),a=e(41),y=e(5),T=e(7),v=e(58),g=e(59),b=e(60),S=e(61),O=e(47);function I(_,C){var A=y(_);if(v){var M=v(_);C&&(M=h(M).call(M,function(U){return g(_,U).enumerable})),A.push.apply(A,M)}return A}function R(_){for(var C=1;C<arguments.length;C++){var A,M,U=arguments[C]!=null?arguments[C]:{};C%2?s(A=I(Object(U),!0)).call(A,function(E){i(_,E,U[E])}):b?S(_,b(U)):s(M=I(Object(U))).call(M,function(E){O(_,E,g(U,E))})}return _}var N=e(35).fn,F=e(0),P=e(152),x=e(40),L=e(151);N.processSession=function(_){if(!_.error)switch(_.cmd){case"getServerSessions":this.onGetServerSessions(_);break;case"getServerSession":this.onGetServerSession(_);break;case"updateServerSession":this.onUpdateServerSession(_)}},N.onGetServerSessions=function(_){var C=this,A=_.content&&_.content.sessionReqTag,M=_.content&&_.content.sessionList,U=[];s(M).call(M,function(E){var z,$;if(E.id=E.id.split("|").join("-"),n(z=E.id).call(z,"super_team")===0&&(E.id="superTeam"+u($=E.id).call($,10)),E.updateTime=+E.updateTime,E.lastMsg){var X=E.lastMsgType==="1"?"sysMsg":"msg";U.push(C.parser.unserialize(JSON.parse(E.lastMsg),X).then(function(Y){var W;E.lastMsg=X==="msg"?p(W=C.message).call(W,Y):p(L).call(L,Y)}))}}),_.promise=d.all(U).then(function(){_.obj={sessionList:M,hasMore:A.hasMore==="1"},A.minTimestamp&&(_.obj.minTimestamp=+A.minTimestamp)})},N.onGetServerSession=function(_){var C,A=this,M=_.content&&_.content.session;if(M){var U;if(M.id=M.id.split("|").join("-"),n(C=M.id).call(C,"super_team")===0&&(M.id="superTeam"+u(U=M.id).call(U,10)),M.updateTime=+M.updateTime,M.lastMsg){var E=_.content.session&&_.content.session.lastMsgType==="1"?"sysMsg":"msg";_.promise=A.parser.unserialize(JSON.parse(M.lastMsg),E).then(function(z){var $;M.lastMsg=E==="msg"?p($=A.message).call($,z):p(L).call(L,z),_.obj=M})}else _.obj=M}},N.onUpdateServerSession=function(_){_.obj={}},N.onSyncUpdateServerSession=function(_){var C,A=this,M=this,U=_.content&&_.content.session;if(U){var E;U.id=U.id.split("|").join("-"),n(C=U.id).call(C,"super_team")===0&&(U.id="superTeam"+u(E=U.id).call(E,10)),U.updateTime=+U.updateTime,U.lastMsg?M.parser.unserialize(JSON.parse(U.lastMsg),"msg").then(function(z){var $;U.lastMsg=p($=M.message).call($,z),A.options.onSyncUpdateServerSession(F.simpleClone(U))}):this.options.onSyncUpdateServerSession(F.simpleClone(U))}},N.mergeSession=function(_){_=F.copyWithNull(_);var C=this.sessionSet,A=_.id,M=C[A]||{},U=!1;return P.isComplete(_)?delete M.isDeleted:M.isDeleted&&(U=!0),C[A]=F.merge(M,_),_=U?_:C[A],F.undef(_.unread)&&(_.unread=0),_},N.mergeSessions=function(_){var C=this;return m(_=_||[]).call(_,function(A){return C.mergeSession(A)})},N.onDeleteSessions=function(_){var C;_.obj=m(C=_.obj.sessions).call(C,function(A){return P.parse(A)})},N.onUpdateSession=function(_){if(_){if(_=this.mergeSession(_),_=c(P).call(P,_),P.isComplete(_))return this.logger.info("session::onUpdateSession: ".concat(_.id),_.id,F.secureOutput("session",_)),this.options.onupdatesessions?this.options.onupdatesessions([_]):this.options.onupdatesession(_),_;this.logger.warn("session::onUpdateSession::session is not complete",F.secureOutput("session",_))}},N.onUpdateSessions=function(_){var C=this;if(_){_=C.mergeSessions(_),_=m(_).call(_,function(U){return c(P).call(P,U)});var A=h(_).call(_,function(U){return P.isComplete(U)}),M=h(_).call(_,function(U){return!P.isComplete(U)});if(M&&M.length>0&&C.logger.warn("session::onUpdateSessions::sessions is not complete",m(M).call(M,function(U){return U.id}),F.secureOutput("session",M)),A.length!==0)return C.logger.info("session::onUpdateSessions:",F.secureOutput("session",A)),C.options.onupdatesessions?C.options.onupdatesessions(A):s(A).call(A,function(U){C.options.onupdatesession(U)}),A;C.logger.warn("session::onUpdateSessions::completeSessions is empty")}},N.setCurrSession=function(_){_=""+_,this.currSessionId=_,this.logger.info("session::setCurrSession:",_)},N.resetSessionUnread=function(_){var C=_.id;this.db.enable&&this.db.updateSession({id:C,unread:0}),!this.options.autoMarkRead&&this.sessionUnreadMsgs&&this.sessionUnreadMsgs[C]&&(this.markMsgRead(this.sessionUnreadMsgs[C],!0),this.sessionUnreadMsgs[C]=[]),this.getSessionInCache(C)?this.onUpdateSession({id:C,unread:0}):this.onUpdateSession(R(R({},_),{},{unread:0}))},N.resetSessionsUnread=function(_){var C=this,A=this.db;A.enable&&m(_).call(_,function(U){A.updateSession({id:U.id,unread:0})});var M=!this.options.autoMarkRead&&this.sessionUnreadMsgs;_=m(_).call(_,function(U){return M&&C.sessionUnreadMsgs[U.id]&&(C.markMsgRead(C.sessionUnreadMsgs[U.id],!0),C.sessionUnreadMsgs[U.id]=[]),C.getSessionInCache(U.id)?{id:U.id,unread:0}:R(R({},U),{},{unread:0})}),this.onUpdateSessions(_)},N.insertLocalSession=function(_){var C=this,A=C.db,M=_.scene+"-"+_.to,U=C.getSessionInCache(M);return U&&P.isComplete(U)?d.reject(x.sessionExist({callFunc:"session::insertLocalSession",session:U})):(A.enable?A.getMsgs({sessionId:M,limit:1}):d.resolve()).then(function(E){if(F.isArray(E)&&E.length===1){var z=E[0];(U=P.genSessionByMsg(z)).updateTime=z.time}else U={id:M,scene:_.scene,to:_.to,updateTime:+_.updateTime||+new Date,lastMsg:null};return C.onUpdateSession(U),A.enable?A.putSession(U):d.resolve(U)})},N.checkAndUpdateLocalSessionByMsg=function(_){var C,A=this.db,M=this,U=this.options.syncSessionUnread&&_!==this.currSessionId,E=A.getMsgs({sessionId:_,limit:1}),z=A.getSession(_).then(function($){if($)return C=a({},$),$.ack=$.ack||0,U?A.getMsgs({sessionId:_,start:$.ack}):d.resolve();M.logger.error("can't find session that sessionId = ".concat(_))});return d.all([E,z]).then(function($){var X,Y,W=r($,2),ee=W[0],w=W[1],J={id:_};if(!C)return M.logger.error("checkAndUpdateLocalSessionByMsg:can not find session",_),d.resolve(200);if(X=C&&!C.lastMsg?null:C.lastMsg.idClient,ee&&ee[0]?Y=(ee=ee[0]).idClient:(Y=null,ee=null),X!==Y&&(J.lastMsg=ee),w!==void 0){var V=0;s(w=w||[]).call(w,function(D){var Q;try{Q=M.options.shouldCountNotifyUnread(D)}catch(G){throw M.logger.error("userOption:shouldCountNotifyUnread function error",G),G}D.isUnreadable&&D.flow==="in"&&(D.type!=="notification"||Q)&&V++}),V!==C.unread&&(J.unread=V)}return y(J).length>1?(M.logger.info("session::checkAndUpdateLocalSessionByMsg::needUpdate newSession:",F.secureOutput("session",J)),A.updateSession(J).then(function(){return M.onUpdateSession(J)})):d.resolve(200)})},N.syncSessionsWithMoreRoaming=function(_){var C=this,A=_&&_.content&&_.content.sessions;if(A&&A.length){var M={0:"p2p",1:"team",5:"superTeam"};if(s(A).call(A,function(E){var z,$=E.to===C.options.account?E.from:E.to;E.scene=M[E.scene],E.id=T(z="".concat(E.scene,"-")).call(z,$),E.time=+E.time}),this.db.enable){var U=this.db.putSessionsWithMoreRoaming(A);U.cmd="syncSessionsWithMoreRoaming",this.syncPromiseArray.push(U)}this.syncing&&this.syncResult?this.syncResult.sessionsWithMoreRoaming=A:this.logger.warn("syncSessionsWithMoreRoaming::not in syncing or no syncResult")}},N.syncStickTopSessions=function(_){var C=this,A=this.db,M=[],U=[],E=d.resolve(),z=_.content.sessions||[];this.syncing&&this.syncResult?(s(z).call(z,function($){var X=$.id.split("|");X[0]==="super_team"&&(X[0]="superTeam"),$.id=X.join("-"),$.scene=X[0],$.to=X[1],$.isTop=!0,M.push(X.join("-")),delete $.createTime,delete $.updateTime,A.enable&&U.push(A.putSession($))}),A.enable&&(E=A.updateTimetag("stickTopSessions",_.content.timetag)),E.then(function(){return A.enable?A.getStickTopSessions():[]}).then(function($){if(_.content.modify){var X=[];s($).call($,function(Y){n(M).call(M,Y.id)>-1||(X.push(Y.id),Y.isTop=!1,Y.topCustom="",U.push(A.putSession(Y)))})}else C.syncResult.stickTopSessions=$;return d.all(U)}),this.syncResult.stickTopSessions=z,E.cmd="syncStickTopSessions",this.syncPromiseArray.push(E)):this.logger.warn("syncSessionsWithMoreRoaming::not in syncing or no syncResult")},N.getSessionInCache=function(_,C){var A=this.sessionSet[_];return!A||A.isDeleted&&!C?void 0:A},N.deleteSessionInCache=function(_,C){var A=this;F.isArray(_)||(_=[_]),C?s(_).call(_,function(M){A.sessionSet[M]&&(A.sessionSet[M].isDeleted=!0)}):s(_).call(_,function(M){return delete A.sessionSet[M]}),this.logger.info("sessions::deleteSessionInCache::delete session done",_,C)},N.updateSessionInCache=function(_){return this.logger.info("session::updateSessionInCache: ".concat(_.id),_.id,_),this.getSessionInCache(_.id)?_=this.mergeSession(_):(this.logger.info("session::updateSessionInCache: can not find session in cache ".concat(_.id)),null)},N.updateSessionInDbWithNotify=function(_,C){var A=this;return new d(function(M,U){var E=A.db;if(A.getSessionInCache(_.id)){var z=d.resolve(),$=F.filterObj(_,"id lastMsg localCustom unread");E.enable&&(z=E.updateSession($)),z.then(function(X){return A.onUpdateSession(X,C)}).then(M,function(X){U({callFunc:"session::updateLocalSession",event:X})})}else U(x.sessionNotExist({sessionId:_.id,callFunc:"session::updateLocalSession"}))})}},function(o,k,e){var r=e(743);o.exports=function(i){if(r(i))return i},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(153),i=e(69);o.exports=function(s,n){var u=s==null?null:r!==void 0&&i(s)||s["@@iterator"];if(u!=null){var p,d,m,c,h=[],a=!0,y=!1;try{if(m=(u=u.call(s)).next,n===0){if(Object(u)!==u)return;a=!1}else for(;!(a=(p=m.call(u)).done)&&(h.push(p.value),h.length!==n);a=!0);}catch(T){y=!0,d=T}finally{try{if(!a&&u.return!=null&&(c=u.return(),Object(c)!==c))return}finally{if(y)throw d}}return h}},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k){o.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(2),i=e(5),s=e(7),n=e(41),u=e(35).fn,p=e(0);u.syncSessionAck=function(d){var m,c=this;if(this.logger.info("syncSessionAck::",d.content),c.syncing&&c.syncResult){c.saveAck.p2pTeam=d.content.timetag;var h={};r(m=[[d.content.p2p,"p2p"],[d.content.team.m_map,"team"]]).call(m,function(a){var y,T=a[0],v=a[1];r(y=i(T)).call(y,function(g){var b,S;h[s(b="".concat(v,"-")).call(b,g)]=T[g];var O={id:s(S="".concat(v,"-")).call(S,g),ack:T[g]};c.cacheSyncedSession(O)})}),c.syncResult.ackMap?c.syncResult.ackMap=n(c.syncResult.ackMap,h):c.syncResult.ackMap=h}else c.logger.warn("syncSessionAck: not in syncing or no syncResult",c.syncing,!!c.syncResult)},u.syncSuperTeamSessionAck=function(d){var m,c=this;if(c.syncResult){c.saveAck.superTeam=d.content.timetag;var h={},a=d.content.superTeam.m_map;r(m=i(a)).call(m,function(y){h["superTeam-".concat(y)]=a[y];var T={id:"superTeam-".concat(y),ack:a[y]};c.cacheSyncedSession(T)}),c.syncResult.ackMap?c.syncResult.ackMap=n(c.syncResult.ackMap,h):c.syncResult.ackMap=h}},u.onMarkSessionAck=function(d){d.error||this.storeSessionAck(d.obj)},u.syncMarkSessionAck=function(d){this.storeSessionAck(d.content,!0)},u.storeSessionAck=function(d,m){var c;if(this.options.syncSessionUnread&&d){var h;switch(d.scene){case 0:h="p2p";break;case 1:h="team";break;case void 0:default:h="superTeam"}var a=s(c="".concat(h,"-")).call(c,d.to),y=d.timetag;if(y<=((this.getSessionInCache(a)||{}).ack||0))this.logger.warn("session::storeSessionAck: ack <= ackInMemory",y);else{var T={id:a,ack:y};this.mergeSession(T),this.logger.info("session::storeSessionAck:",p.secureOutput("session",T)),this.markUnreadBySessionAck({sessionId:a,ack:T.ack},m)}}},u.markUnreadBySessionAck=function(d,m){var c=d.sessionId,h=d.ack,a=this,y=a.db;if(y.enable)a.pushMsgTask(function(){return y.getMsgCountAfterAck({shouldCountNotifyUnread:a.options.shouldCountNotifyUnread,sessionId:c,ack:h}).then(function(I){var R={id:c,unread:I,ack:h};return a.logger.info("session::markUnreadBySessionAck: db.getMsgCountAfterAck done",R),a.syncing?a.cacheSyncedSession(R):m&&a.onUpdateSession(R),y.updateSession(R)}).catch(function(I){a.logger.error("markUnreadBySessionAck::error",I)})});else{var T=a.getSessionInCache(c);if(T){var v=T.unreadMsgs;if(v&&v.length){for(var g=0,b=[],S=v.length-1;S>=0;S--){var O=v[S];if(!(O.time>h))break;g++,b.push(O)}T.unreadMsgs=b,T.unread=g,a.logger.info("session::markUnreadBySessionAck: unread ".concat(g)),a.syncing?a.cacheSyncedSession(T):m&&a.onUpdateSession(T)}}}}},function(o,k,e){var r=e(35).fn;r.processChatroom=function(i){switch(i.cmd){case"getChatroomAddress":this.onChatroomAddress(i)}},r.onChatroomAddress=function(i){i.error||(i.obj.address=i.content.address)}},function(o,k,e){var r=e(35).fn;r.processQchat=function(i){switch(i.cmd){case"getQChatAddress":this.onQChatAddress(i)}},r.onQChatAddress=function(i){i.error||(i.obj.address=i.content.address)}},function(o,k,e){e(35).fn.processFilter=function(r){switch(r.cmd){case"sendFilterMsg":this.onSendMsg(r,!0);break;case"filterMsg":this.onMsg(r,!0);break;case"filterSysMsg":this.onSysMsg(r,!0);break;case"sendFilterCustomSysMsg":this.onSendSysMsg(r,!0)}}},function(o,k,e){var r=e(8),i=e(44),s=e(35).fn,n=e(0),u=i.clientTypeMap;function p(d){d=d||{};var m=n.copy(d);return m.clientType&&(m.clientType=u[m.clientType]||""),m.serverCustom&&(m.custom=JSON.parse(m.serverCustom),typeof m.custom[0]=="string"&&(m.custom=m.custom[0]),delete m.serverCustom),m}s.processEventService=function(d){var m=d.content,c=d.error,h=this.options||{};switch(c&&(c.callFunc="events::processsEventService",this.onCustomError("事件服务解包失败","EVENT_SERVICE_ERROR",c)),d.cmd){case"pushEvent":if(n.isFunction(h.onpushevents)){var a={msgEvents:[p(m.msgEvent)]};h.onpushevents(a)}break;case"pushEvents":if(n.isFunction(h.onpushevents)){var y=m.msgEvents;y={msgEvents:r(y).call(y,function(T){return p(T)})},h.onpushevents(y)}}}},function(o,k,e){var r=e(35).fn,i=e(0);r.processProxyService=function(s){var n=s.error;switch(n&&(n.callFunc="events::processProxyService",this.onCustomError("proxyService","EVENT_PROXY_SERVICE_ERROR",n)),s.cmd){case"onProxyMsg":if(i.isFunction(this.options.onProxyMsg)){var u=s.content.proxyMsg||{};u.time&&(u.time=+u.time),this.options.onProxyMsg(u)}break;case"httpProxy":s.obj=s.content&&s.content.proxyTag}}},function(o,k,e){var r=e(9),i=e(8),s=e(0),n=function(g){this.account=g.account},u=n.prototype,p=u.Message=e(72),d=u.TextMessage=e(827),m=u.FileMessage=e(204),c=u.GeoMessage=e(831),h=u.NotificationMessage=e(832),a=u.CustomMessage=e(833),y=u.TipMessage=e(834),T=u.RobotMessage=e(835),v=u.G2Message=e(836);u.validScenes=p.validScenes,u.validTypes=p.validTypes,u.sceneMap=p.sceneMap,u.sceneReverseMap=p.sceneReverseMap,u.reverse=function(g){var b;switch(p.getType(g)){case"text":b=r(d).call(d,g);break;case"image":case"audio":case"video":case"file":b=r(m).call(m,g);break;case"geo":b=r(c).call(c,g);break;case"notification":b=r(h).call(h,g);break;case"custom":b=r(a).call(a,g);break;case"tip":b=r(y).call(y,g);break;case"g2":b=r(v).call(v,g);break;case"robot":b=r(T).call(T,g);break;default:b=r(p).call(p,g)}return p.setExtra(b,this.account),b},u.reverseMsgs=function(g,b){var S,O,I=this;return i(g).call(g,function(R){return R=r(I).call(I,R),b&&((S=b.modifyObj)&&(R=s.merge(R,S)),O=b.mapper,s.isFunction(O)&&(R=O(R))),R})},o.exports=n},function(o,k,e){var r=e(18),i=e(9),s=e(72),n=e(0);function u(p){n.verifyOptions(p,"text","msg::TextMessage"),p.type="text",s.call(this,p)}u.prototype=r(s.prototype),u.reverse=function(p){return i(s).call(s,p)},o.exports=u},function(o,k,e){var r=e(18),i=e(204);function s(){}s.prototype=r(i.prototype),s.verifyFile=function(n,u){return!0},o.exports=s},function(o,k,e){var r=e(18),i=e(204);function s(){}s.prototype=r(i.prototype),s.verifyFile=function(){},o.exports=s},function(o,k,e){var r=e(18),i=e(204);function s(){}s.prototype=r(i.prototype),s.verifyFile=function(){},o.exports=s},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(72),u=e(0);function p(d){d.type="geo",u.verifyOptions(d,"geo","msg::GeoMessage"),u.verifyOptions(d.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),u.verifyParamType("geo.lng",d.geo.lng,"number","msg::GeoMessage"),u.verifyParamType("geo.lat",d.geo.lat,"number","msg::GeoMessage"),u.verifyParamType("geo.title",d.geo.title,"string","msg::GeoMessage"),n.call(this,d),this.attach=r(d.geo)}p.prototype=i(n.prototype),p.reverse=function(d){var m=s(n).call(n,d);return d.attach=d.attach?""+d.attach:"",m.geo=d.attach?JSON.parse(d.attach):{},m},o.exports=p},function(o,k,e){var r=e(18),i=e(9),s=e(8),n=e(171),u=e(0).notundef,p=e(72),d=e(147).IM,m=e(192),c=e(203),h={0:"addTeamMembers",1:"removeTeamMembers",2:"leaveTeam",3:"updateTeam",4:"dismissTeam",5:"passTeamApply",6:"transferTeam",7:"addTeamManagers",8:"removeTeamManagers",9:"acceptTeamInvite",10:"updateTeamMute",101:"netcallMiss",102:"netcallBill",103:"netcallReject",401:"addSuperTeamMembers",402:"removeSuperTeamMembers",403:"leaveSuperTeam",404:"updateSuperTeam",405:"dismissSuperTeam",406:"transferSuperTeam",407:"addSuperTeamManagers",408:"removeSuperTeamManagers",409:"updateSuperTeamMembersMute",410:"passSuperTeamApply",411:"acceptSuperTeamInvite"};function a(){}a.prototype=r(p.prototype),a.reverse=function(y){var T=i(p).call(p,y);if(y.attach=y.attach?""+y.attach:"",y.attach){var v=JSON.parse(y.attach);if(T.attach={type:h[v.id]||v.id},u(v.data)){var g,b,S=v.data;u(S.tinfo)&&(T.attach.team=i(m).call(m,d.syncUnserialize(S.tinfo,"team"),!0)),u(S.ids)&&(T.attach.accounts=S.ids),u(S.id)&&(T.attach.account=S.id),u(S.uinfos)&&(T.attach.users=s(g=S.uinfos).call(g,function(O){return i(c).call(c,d.syncUnserialize(O,"user"))})),u(S.mute)&&(T.attach.mute=+S.mute==1),u(S.attach)&&(T.attach.custom=S.attach),u(S.channel)&&(T.attach.channelId=S.channel),u(S.calltype)&&(T.attach.netcallType=S.calltype),u(S.duration)&&(T.attach.duration=S.duration),u(S.time)&&(T.attach.time=S.time),u(S.from)&&(T.attach.from=S.from),u(S.ext)&&(T.attach.ext=S.ext),T.attach.accounts&&T.attach.accounts.length<=2&&T.from===T.to&&n(b=T.attach.accounts).call(b,function(O){if(O!==T.to)return T.to=O,!0})}}else T.attach={};return T},o.exports=a},function(o,k,e){var r=e(18),i=e(9),s=e(72),n=e(0);function u(p){n.verifyOptions(p,"content","msg::CustomMessage"),p.type="custom",s.call(this,p),this.attach=p.content}u.prototype=r(s.prototype),u.reverse=function(p){var d=i(s).call(s,p);return d.content=p.attach,d},o.exports=u},function(o,k,e){var r=e(18),i=e(9),s=e(72),n=e(0);function u(p){n.verifyOptions(p,"tip","msg::TipMessage"),p.type="tip",s.call(this,p),this.body=p.tip}u.prototype=r(s.prototype),u.reverse=function(p){var d=i(s).call(s,p);return d.text="",d.tip=p.body,p.attach&&(d.attach=p.attach),d},o.exports=u},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(8),u=e(72),p=e(0),d={welcome:"00",text:"01",link:"03"},m={"01":"text","02":"image","03":"answer",11:"template"};function c(h){p.verifyOptions(h,"content","msg::RobotMessage"),p.undef(h.robotAccid)&&(h.robotAccid=h.to);var a=h.content;switch(a.type){case"welcome":p.undef(h.body)&&(this.body="欢迎消息");break;case"text":p.verifyOptions(a,"content","msg::RobotMessage"),p.undef(h.body)&&(this.body=a.content);break;case"link":p.verifyOptions(a,"target","msg::RobotMessage")}a.type&&(a.type=d[a.type]),a={param:a,robotAccid:h.robotAccid},this.attach=r(a),h.type="robot",u.call(this,h)}c.prototype=i(u.prototype),c.reverse=function(h){var a=s(u).call(u,h);if(a.type==="robot"){var y=JSON.parse(h.attach);if(y.param&&(y.param.type=m[y.param.type]||"unknown"),y.robotMsg){var T=(y=p.merge(y,y.robotMsg)).message;y.flag==="bot"?y.message=n(T).call(T,function(v){return v.type=m[v.type]||"unknown",v}):y.flag,delete y.robotMsg}a.content=y}return a},o.exports=c},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(72),u=e(0);function p(d){u.verifyOptions(d,"attach","msg::G2Message"),d.type="g2",n.call(this,d),this.attach=r(d.attach)}p.prototype=i(n.prototype),p.reverse=function(d){var m=s(n).call(n,d);return d.attach&&(m.attach=JSON.parse(d.attach)),m},o.exports=p},function(o,k,e){var r=e(57),i=e(102),s=e(26),n=e(103),u=e(8),p=e(17),d=e(6),m=e(3),c=e(2),h=e(41),a=e(5),y=e(58),T=e(59),v=e(60),g=e(61),b=e(47);function S(P,x){var L=a(P);if(y){var _=y(P);x&&(_=p(_).call(_,function(C){return T(P,C).enumerable})),L.push.apply(L,_)}return L}function O(P){for(var x=1;x<arguments.length;x++){var L,_,C=arguments[x]!=null?arguments[x]:{};x%2?c(L=S(Object(C),!0)).call(L,function(A){r(P,A,C[A])}):v?g(P,v(C)):c(_=S(Object(C))).call(_,function(A){b(P,A,T(C,A))})}return P}var I=e(39).fn,R=e(0),N=R.isArray,F=e(150);I.mergeObjArray=function(P,x,L){return P||(P=[]),x?(N(x)||(x=[x]),x.length?(L=L||{},R.mergeObjArray(P,x,L)):P):P},I.cutObjArray=function(P,x,L){return P&&x?(N(x)||(x=[x]),x.length?(L=L||{},R.cutObjArray(P,x,L)):P):P},I.mergeLoginPorts=function(P,x){return this.mergeObjArray(P,x,{keyPath:"deviceId"})},I.cutLoginPorts=function(P,x){return this.cutObjArray(P,x,{keyPath:"deviceId",sortPath:"type"})},I.mergeRelations=function(P,x){return this.mergeObjArray(P,x,{keyPath:"account"})},I.cutRelations=function(P,x){return this.cutObjArray(P,x,{keyPath:"account"})},I.findRelation=function(P,x){return R.findObjInArray(P,{keyPath:"account",value:x})},I.mergeFriends=function(P,x){return this.mergeObjArray(P,x,{keyPath:"account"})},I.cutFriends=function(P,x){return this.cutObjArray(P,x,{keyPath:"account"})},I.cutFriendsByAccounts=function(P,x){N(x)||(x=[x]);var L=u(x).call(x,function(_){return{account:_}});return this.cutFriends(P,L)},I.findFriend=function(P,x){return R.findObjInArray(P,{keyPath:"account",value:x})},I.mergeUsers=function(P,x){return this.mergeObjArray(P,x,{keyPath:"account"})},I.findUser=function(P,x){return R.findObjInArray(P,{keyPath:"account",value:x})},I.mergeTeams=function(P,x){return this.mergeObjArray(P,x,{keyPath:"teamId"})},I.cutTeams=function(P,x){return this.cutObjArray(P,x,{keyPath:"teamId"})},I.findTeam=function(P,x){return R.findObjInArray(P,{keyPath:"teamId",value:x})},I.assembleTeamOwner=F.assembleOwner,I.assembleTeamMembers=F.assembleMembers,I.genTeamMemberId=F.genId,I.mergeTeamMembers=function(P,x){return this.mergeObjArray(P,x)},I.cutTeamMembers=function(P,x){return this.cutObjArray(P,x)},I.cutTeamMembersByAccounts=function(P,x,L){N(L)||(L=[L]);var _=F.assembleMembers({teamId:x},L);return this.cutTeamMembers(P,_)},I.findTeamMember=function(P,x){return R.findObjInArray(P,{keyPath:"id",value:x})},I.mergeSessions=function(P,x){return this.mergeObjArray(P,x,{sortPath:"updateTime",desc:!0})},I.cutSessions=function(P,x){return this.cutObjArray(P,x)},I.cutSessionsByIds=function(P,x){N(x)||(x=[x]);var L=u(x).call(x,function(_){return{id:_}});return this.cutSessions(P,L)},I.findSession=function(P,x){return R.findObjInArray(P,{keyPath:"id",value:x})},I.mergeMsgs=function(P,x){return this.mergeObjArray(P,x,{keyPath:"idClient",sortPath:"time"})},I.cutMsgs=function(P,x){return this.cutObjArray(P,x,{keyPath:"idClient"})},I.cutMsgsByIdClients=function(P,x){N(x)||(x=[x]);var L=u(x).call(x,function(_){return{idClient:_}});return this.cutMsgs(P,L)},I.findMsg=function(P,x){return R.findObjInArray(P,{keyPath:"idClient",value:x})},I.mergeSysMsgs=function(P,x){return this.mergeObjArray(P,x,{keyPath:"idServer",desc:!0})},I.cutSysMsgs=function(P,x){return this.cutObjArray(P,x,{keyPath:"idServer"})},I.cutSysMsgsByIdServers=function(P,x){N(x)||(x=[x]);var L=u(x).call(x,function(_){return{idServer:_}});return this.cutSysMsgs(P,L)},I.findSysMsg=function(P,x){return R.findObjInArray(P,{keyPath:"idServer",value:x})},I.searchLocal=function(P){if(R.verifyOptions(P,"keyword","searchLocal"),this.db.enable){var x,L=this,_=this.db,C=P.keyword+"",A=["account","nick","alias"],M=["id","scene","lastMsg.type","lastMsg.text","localCustom","target.account","target.nick","target.alias","target.name"],U="",E=P.keyPath;switch(E?(U=(E=(E+"").split(".")).shift(),E=E.join(".")):U="all",U){case"user":E&&(A=p(A).call(A,function(V){return V===E||d(V).call(V,E+".")===0})),X(A).then(function(V){P.done(null,{sessions:[],users:V})});break;case"session":E&&(M=p(M).call(M,function(V){return V===E||d(V).call(V,E+".")===0})),z(M,!E||d(E).call(E,"target")>-1).then(function(V){P.done(null,{sessions:V,users:[]})});break;case"all":W().then(function(){m.all([z(M,!0),X(A)]).then(function(V){P.done(null,{sessions:V[0],users:V[1]})})});break;default:P.done(null,{sessions:[],users:[],msg:'keyPath must start with "user" or "session"'})}}else P.done(null,{sessions:[],users:[],msg:"no db"});function z(V,D){return $.apply(this,arguments)}function $(){return($=n(i.mark(function V(D,Q){var G;return i.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return G=Q?[_.getSessions(),W(),_.getTeams(),_.getSuperTeams()]:[_.getSessions()],B.abrupt("return",m.all(G).then(function(q){var H,K=q[0]||[],Z={p2p:q[1]||[],team:q[2]||[],superTeam:q[3]||[]},te={};return Q&&(c(H=a(Z)).call(H,function(ne){var re;c(re=Z[ne]).call(re,function(se){var oe=se.teamId||se.account;te[ne+"-"+oe]=se})}),c(K).call(K,function(ne){ne.target=te[ne.id]})),w(D,K)}));case 2:case"end":return B.stop()}},V)}))).apply(this,arguments)}function X(V){return Y.apply(this,arguments)}function Y(){return(Y=n(i.mark(function V(D){var Q;return i.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,W();case 2:return Q=G.sent,G.abrupt("return",w(D,Q));case 4:case"end":return G.stop()}},V)}))).apply(this,arguments)}function W(){return ee.apply(this,arguments)}function ee(){return(ee=n(i.mark(function V(){var D,Q;return i.wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!x){G.next=2;break}return G.abrupt("return",x);case 2:return G.next=4,L.db.getFriends();case 4:if(G.t0=G.sent,G.t0){G.next=7;break}G.t0=[];case 7:return D=G.t0,Q=L.protocol.userSet||{},x=u(D).call(D,function(B){return O(O({},B),Q[B.account])}),G.abrupt("return",x);case 11:case"end":return G.stop()}},V)}))).apply(this,arguments)}function w(V,D){var Q=[];return c(D).call(D,function(G){for(var B=0;B<V.length;B++){var q=J(G,V[B].split("."));if(q&&d(q).call(q,C)>-1){Q.push(h({},G));break}}}),Q}function J(V,D){if(s(V)==="object"&&V)return D.length===1?V[D[0]]:J(V[D.shift()],D)}}},function(o,k,e){var r=e(15),i=e(39).fn,s=e(0),n=e(24).reportAPI;i.kick=function(u){var p;(u=u||{}).done=n({instance:this,className:"NIMFn",funcName:"kick",done:u.done}),s.verifyOptions(u,"deviceIds","link::kick"),this.processCallback(u),this.sendCmd("kick",{deviceIds:r(p=u.deviceIds).call(p,0)},u.callback)},i.disconnect=function(u){(u=u||{}).done=n({instance:this,className:"NIMFn",funcName:"disconnect",done:u.done}),u=u||{},this.protocol.disconnect(u.done)}},function(o,k,e){var r=e(39).fn,i=e(0),s=e(24).reportAPI;r.markInBlacklist=function(n){(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"markInBlacklist",done:n.done}),i.verifyOptions(n,"account isAdd","relation::markInBlacklist"),i.verifyParamType("isAdd",n.isAdd,"boolean","relation::markInBlacklist"),this.processCallback(n),this.sendCmd("markInBlacklist",{account:n.account,isAdd:n.isAdd},n.callback)},r.addToBlacklist=function(n){return(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"addToBlacklist",done:n.done}),n.isAdd=!0,this.markInBlacklist(n)},r.removeFromBlacklist=function(n){return(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"removeFromBlacklist",done:n.done}),n.isAdd=!1,this.markInBlacklist(n)},r.markInMutelist=function(n){(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"markInMutelist",done:n.done}),i.verifyOptions(n,"account","relation::markInMutelist"),i.verifyParamType("isAdd",n.isAdd,"boolean","relation::markInMutelist"),this.processCallback(n),this.sendCmd("markInMutelist",{account:n.account,isAdd:n.isAdd},n.callback)},r.addToMutelist=function(n){return(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"addToMutelist",done:n.done}),n.isAdd=!0,this.markInMutelist(n)},r.removeFromMutelist=function(n){return(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"removeFromMutelist",done:n.done}),n.isAdd=!1,this.markInMutelist(n)},r.getRelations=function(n){(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"getRelations",done:n.done});var u=this,p=u.db,d=0;function m(){u.sendCmd("getRelations",{timetag:d,NOTSTORE:"timetag"},n.callback)}n=i.verifyOptions(n),u.processCallback(n),p.enable?p.getRelationsTimetag().then(function(c){d=c,m()},m):m()}},function(o,k,e){var r=e(7),i=e(2),s=e(6),n=e(39).fn,u=e(0),p=u.objs2accounts,d=e(203),m=e(24).reportAPI;n.updateMyInfo=function(c){(c=c||{}).done=m({instance:this,className:"NIMFn",funcName:"updateMyInfo",done:c.done}),u.verifyOptions(c),this.processCallback(c),c.user=new d(c),delete c.user.account,this.sendCmd("updateMyInfo",{user:c.user,antispamTag:{antiSpamBusinessId:c.antiSpamBusinessId},single:!0},c.callback)},n.getMyInfo=function(c){return(c=c||{}).done=m({instance:this,className:"NIMFn",funcName:"getMyInfo",done:c.done}),(c=c||{}).account=this.account,this.getUser(c)},n.getUser=function(c){(c=c||{}).done=m({instance:this,className:"NIMFn",funcName:"getUser",done:c.done});var h,a=this,y=a.db;function T(){a.sendCmd("getUsers",{accounts:[h],single:!0},c.callback)}u.verifyOptions(c,"account","user::getUser"),a.processCallback(c),c.cbaop=function(v,g){if(!v)return g=g[0]||null,a.logger.info("api::getUser: cbaop ".concat(h)),g},h=c.account,c.sync?T():y.enable?y.getUser(h).then(function(v){v?c.done(null,v):T()},T):T()},n.getUsers=function(c){(c=c||{}).done=m({instance:this,className:"NIMFn",funcName:"getUsers",done:c.done});var h,a=this,y=a.db,T=[];function v(){a.sendCmd("getUsers",{accounts:h,single:!0},c.callback)}u.verifyOptions(c,"accounts","user::getUsers"),u.verifyParamType("accounts",c.accounts,"array","user::getUsers"),a.processCallback(c),c.cbaop=function(g,b){if(!g)return b=r(b).call(b,T),a.logger.info("api::getUsers: cbaop ".concat(h)),b},h=u.deduplicate(c.accounts),u.verifyArrayMax("accounts",c.accounts,150,"user::getUsers"),c.sync?v():y.enable?y.getUsers(h).then(function(g){if(g&&g.length===h.length)c.done(null,g);else{T=g;var b=p(g),S=[];i(h).call(h,function(O){s(b).call(b,O)===-1&&S.push(O)}),h=S,v()}},v):v()}},function(o,k,e){var r=e(138),i=e(39).fn,s=e(0),n=s.notundef,u=e(748),p=e(24).reportAPI;i.friendRequest=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"friendRequest",done:d.done}),s.verifyOptions(d,"type account","friend::friendRequest"),s.verifyParamValid("type",d.type,u.validTypes(),"friend::friendRequest"),this.processPs(d),this.processCallback(d);var m={account:d.account,type:u.getByteFromType(d.type),ps:d.ps};n(d.idServer)&&(m.idServer=d.idServer),this.sendCmd("friendRequest",m,d.callback)},i.addFriend=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"addFriend",done:d.done}),d.type="addFriend",this.friendRequest(d)},i.applyFriend=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"applyFriend",done:d.done}),d.type="applyFriend",this.friendRequest(d)},i.passFriendApply=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"passFriendApply",done:d.done}),s.verifyOptions(d,"idServer","friend::passFriendApply"),d.type="passFriendApply",this.friendRequest(d)},i.rejectFriendApply=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"rejectFriendApply",done:d.done}),s.verifyOptions(d,"idServer","friend::rejectFriendApply"),d.type="rejectFriendApply",this.friendRequest(d)},i.deleteFriend=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"deleteFriend",done:d.done}),s.verifyOptions(d,"account","friend::deleteFriend");var m=d.delAlias===!0;this.processCallback(d),this.sendCmd("deleteFriend",{account:d.account,delFriendParams:{delAlias:m?1:0}},d.callback)},i.updateFriend=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"updateFriend",done:d.done}),this.processCallback(d);var m=new u(d);this.sendCmd("updateFriend",{friend:m,single:!0},d.callback)},i.getFriends=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"getFriends",done:d.done});var m=this.db;s.validate({timetag:{type:"number",required:!1}},d,"friend::getFriends"),this.processCallback(d),m.enable?m.getFriends({updateTime:d.updateTime||0}).then(function(c){(c=r(c).call(c,function(h,a){return h.updateTime-a.updateTime})).invalid=[],d.done(null,c)}):this.sendCmd("getFriends",{timetag:d.updateTime||0,NOTSTORE:"timetag"},d.callback)},i.isMyFriend=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"isMyFriend",done:d.done});var m=this.db;s.validate({account:{type:"string",allowEmpty:!1,require:!0}},d),this.processCallback(d),m.enable||d.done(null,!1),m.getFriend(d.account).then(function(c){c&&c.valid===!0?d.done(null,!0):d.done(null,!1)})},i.isUserInBlackList=function(d){(d=d||{}).done=p({instance:this,className:"NIMFn",funcName:"isUserInBlackList",done:d.done});var m=this.db;s.validate({account:{type:"string",allowEmpty:!1,require:!0}},d),this.processCallback(d),m.enable||d.done(null,!1),m.getUserFromBlackList(d.account).then(function(c){c&&c.account?d.done(null,!0):d.done(null,!1)})}},function(o,k,e){var r=e(39).fn,i=e(24).reportAPI;r.getRobots=function(s){(s=s||{}).done=i({instance:this,className:"NIMFn",funcName:"getRobots",done:s.done}),this.logger.warn("this api will be abandon"),(s=s||{}).type="getRobots",this.processCallback(s),this.sendCmd("sync",{sync:{robots:0}},s.callback)}},function(o,k,e){var r=e(15),i=e(8),s=e(17),n=e(3),u=e(39).fn,p=e(0),d=p.undef,m=e(192),c=e(150),h=e(24).reportAPI;u.createTeam=function(a){var y;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"createTeam",done:a.done}),p.verifyOptions(a,"type name","team::createTeam"),d(a.accounts)?a.accounts=[]:p.verifyParamType("accounts",a.accounts,"array","team::createTeam"),a.action="create",this.processPs(a),this.processCallback(a),a.team=new m(a);var T={team:a.team,accounts:r(y=a.accounts).call(y,0),ps:a.ps,antispamTag:{antiSpamBusinessId:a.antiSpamBusinessId}};this.sendCmd("createTeam",T,a.callback)},u.updateTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"updateTeam",done:a.done}),p.verifyOptions(a,"teamId","team::updateTeam"),a.action="update",this.processCallback(a),a.team=new m(a),this.sendCmd("updateTeam",{team:a.team,antispamTag:{antiSpamBusinessId:a.antiSpamBusinessId},single:!0},a.callback)},u.addTeamMembers=function(a){var y;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"addTeamMembers",done:a.done}),p.verifyOptions(a,"teamId accounts","team::addTeamMembers"),p.verifyParamType("accounts",a.accounts,"array","team::addTeamMembers"),this.processPs(a),p.notexist(a.custom)&&(a.custom=""),this.processCallback(a);var T={teamId:a.teamId,accounts:r(y=a.accounts).call(y,0),ps:a.ps,attach:a.custom};this.sendCmd("addTeamMembers",T,a.callback)},u.removeTeamMembers=function(a){var y;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"removeTeamMembers",done:a.done}),p.verifyOptions(a,"teamId accounts","team::removeTeamMembers"),p.verifyParamType("accounts",a.accounts,"array","team::removeTeamMembers"),this.processCallback(a);var T={teamId:a.teamId,accounts:r(y=a.accounts).call(y,0)};this.sendCmd("removeTeamMembers",T,a.callback)},u.acceptTeamInvite=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"acceptTeamInvite",done:a.done}),p.verifyOptions(a,"idServer teamId from","team::acceptTeamInvite"),this.processCallback(a);var y={idServer:a.idServer,teamId:a.teamId,from:a.from,type:"teamInvite"};this.sendCmd("acceptTeamInvite",y,a.callback)},u.rejectTeamInvite=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"rejectTeamInvite",done:a.done}),p.verifyOptions(a,"idServer teamId from","team::rejectTeamInvite"),this.processPs(a),this.processCallback(a);var y={idServer:a.idServer,teamId:a.teamId,from:a.from,ps:a.ps,type:"teamInvite"};this.sendCmd("rejectTeamInvite",y,a.callback)},u.applyTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"applyTeam",done:a.done}),p.verifyOptions(a,"teamId","team::applyTeam"),this.processPs(a),this.processCallback(a);var y={teamId:a.teamId,ps:a.ps};this.sendCmd("applyTeam",y,a.callback)},u.passTeamApply=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"passTeamApply",done:a.done}),p.verifyOptions(a,"idServer teamId from","team::passTeamApply"),this.processCallback(a);var y={idServer:a.idServer,teamId:a.teamId,from:a.from,type:"applyTeam"};this.sendCmd("passTeamApply",y,a.callback)},u.rejectTeamApply=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"rejectTeamApply",done:a.done}),p.verifyOptions(a,"idServer teamId from","team::rejectTeamApply"),this.processPs(a),this.processCallback(a);var y={idServer:a.idServer,teamId:a.teamId,from:a.from,ps:a.ps,type:"applyTeam"};this.sendCmd("rejectTeamApply",y,a.callback)},u.addTeamManagers=function(a){var y;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"addTeamManagers",done:a.done}),p.verifyOptions(a,"teamId accounts","team::addTeamManagers"),p.verifyParamType("accounts",a.accounts,"array","team::addTeamManagers"),this.processCallback(a);var T={teamId:a.teamId,accounts:r(y=a.accounts).call(y,0)};this.sendCmd("addTeamManagers",T,a.callback)},u.removeTeamManagers=function(a){var y;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"removeTeamManagers",done:a.done}),p.verifyOptions(a,"teamId accounts","team::removeTeamManagers"),p.verifyParamType("accounts",a.accounts,"array","team::removeTeamManagers"),this.processCallback(a);var T={teamId:a.teamId,accounts:r(y=a.accounts).call(y,0)};this.sendCmd("removeTeamManagers",T,a.callback)},u.updateInfoInTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"updateInfoInTeam",done:a.done}),p.verifyOptions(a,"teamId","team::updateInfoInTeam"),this.processCallback(a),this.sendCmd("updateInfoInTeam",{teamMember:new c(a),single:!0},a.callback)},u.updateNickInTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"updateNickInTeam",done:a.done}),p.verifyOptions(a,"teamId account","team::updateNickInTeam"),this.processCallback(a),this.sendCmd("updateNickInTeam",{teamMember:new c(a),single:!0},a.callback)},u.updateMuteStateInTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"updateMuteStateInTeam",done:a.done}),p.verifyOptions(a,"teamId account mute","team::updateMuteStateInTeam"),this.processCallback(a),a.mute=a.mute?1:0,this.sendCmd("updateMuteStateInTeam",a)},u.getMutedTeamMembers=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getMutedTeamMembers",done:a.done}),p.verifyOptions(a,"teamId","team::getMutedTeamMembers"),this.processCallback(a),this.sendCmd("getMutedTeamMembers",a)},u.leaveTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"leaveTeam",done:a.done}),p.verifyOptions(a,"teamId","team::leaveTeam"),this.processCallback(a);var y={teamId:a.teamId};this.sendCmd("leaveTeam",y,a.callback)},u.transferTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"transferTeam",done:a.done}),p.verifyOptions(a,"teamId account leave","team::transferTeam"),p.verifyParamType("leave",a.leave,"boolean","team::transferTeam"),this.processCallback(a);var y={teamId:a.teamId,account:a.account,leave:a.leave};this.sendCmd("transferTeam",y,a.callback)},u.dismissTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"dismissTeam",done:a.done}),p.verifyOptions(a,"teamId","team::dismissTeam"),this.processCallback(a);var y={teamId:a.teamId};this.sendCmd("dismissTeam",y,a.callback)},u.getTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeam",done:a.done});var y,T=this,v=T.db;function g(){T.sendCmd("getTeam",{teamId:a.teamId},a.callback)}p.verifyOptions(a,"teamId","team::getTeam"),T.processCallback(a),a.cbaop=function(b){b||T.logger.info("api::getTeam: cbaop ".concat(y))},y=a.teamId,v.enable&&!a.sync?v.getTeam(y).then(function(b){b&&b.validToCurrentUser?(T.logger.log("api::getTeam: db.getTeam ".concat(y)),a.done(null,b)):g()},g):g()},u.getTeams=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeams",done:a.done});var y=this,T=y.db,v=0;function g(){y.sendCmd("getTeams",{timetag:v,NOTSTORE:"timetag"},a.callback)}p.verifyOptions(a),y.processCallback(a),T.enable?T.getTeamsTimetag().then(function(b){v=b,g()},g):g()},u.getTeamsById=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeamsById",done:a.done}),p.verifyOptions(a,"teamIds","teams::getTeamsById"),this.processCallback(a),this.sendCmd("getTeamsById",{teamIds:a.teamIds},a.callback)},u.getTeamMembers=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeamMembers",done:a.done});var y=this;p.verifyOptions(a,"teamId","team::getTeamMembers"),y.processCallback(a),y.sendCmd("getTeamMembers",{teamId:a.teamId,timetag:0,NOTSTORE:"timetag"},a.callback)},u.getTeamMemberByTeamIdAndAccount=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeamMemberByTeamIdAndAccount",done:a.done});var y=this;p.verifyParamType("teamId",a.teamId,"numeric or numeric string","team::getTeamMemberByTeamIdAndAccount"),p.verifyOptions(a,"account","team::getTeamMemberByTeamIdAndAccount"),y.processCallback(a),y.sendCmd("getTeamMembers",{teamId:a.teamId,timetag:0,NOTSTORE:"timetag"},function(T,v,g){var b={};if(v&&v.members&&v.members.length){for(var S=0;S<v.members.length;S++)if(v.members[S].account===a.account){b[a.account]=v.members[S];break}}a.callback(T,b,g)})},u.getTeamMemberInvitorAccid=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeamMemberInvitorAccid",done:a.done}),p.verifyParamType("teamId",a.teamId,"numeric or numeric string","team::getTeamMemberInvitorAccid"),d(a.accounts)||(p.verifyParamType("accounts",a.accounts,"array","team::getTeamMemberInvitorAccid"),a.accounts.length>200&&p.onParamError("accounts 参数数组长度不能超过200","team::getTeamMemberInvitorAccid"));var y,T={teamId:a.teamId};a.accounts.length&&(T.accounts=r(y=a.accounts).call(y,0)),this.processCallback(a),this.sendCmd("getTeamMemberInvitorAccid",T,function(v,g,b){a.callback(v,b&&b.accountsMap||{})})},u.notifyForNewTeamMsg=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"notifyForNewTeamMsg",done:a.done}),p.verifyOptions(a,"teamIds","team::notifyForNewTeamMsg"),this.protocol.notifyForNewTeamMsg(a.teamIds).then(function(y){a.done(y.error||null,i(y),y.miss)},function(y){a.done(y)})},u.getMyTeamMembers=function(a){h({instance:this,className:"NIMFn",funcName:"getMyTeamMembers",hasCallback:!1}),p.verifyOptions(a,"teamIds","team::getMyTeamMembers");var y=this.processCallbackPromise(a);return this.sendCmd("getMyTeamMembers",a),y},u.getLocalTeams=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getLocalTeams",done:a.done});var y,T=this.db,v=[];function g(){a.teams=v,a.done(y,a)}p.verifyOptions(a,"teamIds","team::getLocalTeams"),p.verifyParamType("teamIds",a.teamIds,"array","team::getLocalTeams"),this.processCallback(a),T.enable?T.getTeamsByTeamIds(a.teamIds).then(function(b){v=s(b).call(b,function(S){return!!S}),g()},function(b){y=b,g()}):g()},u.getLocalTeamMembers=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getLocalTeamMembers",done:a.done});var y,T=this.db,v=[];function g(){a.members=v,a.done(y,a)}p.verifyOptions(a,"teamId accounts","team::getLocalTeamMembers"),p.verifyParamType("accounts",a.accounts,"array","team::getLocalTeamMembers"),this.processCallback(a),T.enable?T.getInvalidTeamMembers(a.teamId,a.accounts).then(function(b){v=s(b).call(b,function(S){return!!S}),g()},function(b){y=b,g()}):g()},u.deleteLocalTeam=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"deleteLocalTeam",done:a.done});var y,T=this.db;function v(){a.done(y,a)}p.verifyOptions(a,"teamId","team::deleteLocalTeam"),this.processCallback(a),T.enable?T.deleteTeam(a.teamId).then(function(){v()},function(g){y=g,v()}):v()},u.muteTeamAll=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"muteTeamAll",done:a.done}),p.verifyOptions(a,"teamId mute","team::muteTeamAll"),a.mute=a.mute?1:0,this.processCallback(a),this.sendCmd("muteTeamAll",a)},u.sendTeamMsgReceipt=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"sendTeamMsgReceipt",done:a.done}),p.verifyOptions(a,"teamMsgReceipts","team::sendTeamMsgReceipt"),a.teamMsgReceipts.length>50?this.logger.error("team::sendTeamMsgReceipt：teamMsgReceipts length over 50"):(this.processCallback(a),this.sendCmd("sendTeamMsgReceipt",a))},u.getTeamMsgReads=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeamMsgReads",done:a.done}),p.verifyOptions(a,"teamMsgReceipts","team::getTeamMsgReads"),this.processCallback(a),this.sendCmd("getTeamMsgReads",a)},u.getTeamMsgReadAccounts=function(a){var y=this;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getTeamMsgReadAccounts",done:a.done});var T,v=this;p.verifyOptions(a,"teamMsgReceipt","team::getTeamMsgReadAccounts"),a.callback=function(g,b,S){g&&T?(b=b||{teamMsgReceipt:a.teamMsgReceipt},a.done(g,b,{teamMsgReceipt:a.teamMsgReceipt,unreadAccounts:T.unreadAccounts,readAccounts:T.readAccounts})):a.done(g,b,S)},this.db.enable&&a.teamMsgReceipt.idClient?this.db.getMsgReadDetail(a.teamMsgReceipt.idClient).then(function(g){if(T=g,!g)return n.reject("no record");if(g.unreadAccounts&&g.unreadAccounts.length>0)return n.reject("unreadAccounts.length > 0");var b={teamMsgReceipt:a.teamMsgReceipt,unreadAccounts:g.unreadAccounts,readAccounts:g.readAccounts};v.logger.info("getTeamMsgReadAccounts from db"),a.done(null,{teamMsgReceipt:a.teamMsgReceipt},b)}).catch(function(g){y.logger.warn("db.getMsgReadDetail invalid",g),v.sendCmd("getTeamMsgReadAccounts",a)}):v.sendCmd("getTeamMsgReadAccounts",a)}},function(o,k,e){var r=e(752),i=e(3),s=e(9),n=e(25),u=e(15),p=e(8),d=e(2),m=e(7),c=e(39).fn,h=e(0),a=h.undef,y=e(307),T=e(202),v=e(24).reportAPI;function g(b){var S=this.db;if(!S.enable)return i.resolve({valid:!1});var O=S.getSuperTeam(b),I=S.getSuperTeamMembersTimetag(b);return i.all([O,I]).then(function(R){var N=r(R,2),F=N[0],P=N[1],x=F&&F.memberUpdateTime,L={timetag:P=P||0};return x&&P>=x&&(L.valid=!0),i.resolve(L)}).catch(function(){return i.resolve({timetag:0})})}c.addSuperTeamMembers=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"addSuperTeamMembers",done:b.done}),h.verifyOptions(b,"teamId accounts","superTeam::addSuperTeamMembers"),h.verifyParamType("accounts",b.accounts,"array","superTeam::addSuperTeamMembers");var S=h.deduplicate(b.accounts);this.processPs(b),this.processCallback(b);var O={teamId:b.teamId,accounts:S,ps:b.ps};this.sendCmd("addSuperTeamMembers",O,b.callback)},c.removeSuperTeamMembers=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"removeSuperTeamMembers",done:b.done}),h.verifyOptions(b,"teamId accounts","team::removeSuperTeamMembers"),h.verifyParamType("accounts",b.accounts,"array","team::removeSuperTeamMembers");var S=h.deduplicate(b.accounts);this.processCallback(b);var O={teamId:b.teamId,accounts:S};this.sendCmd("removeSuperTeamMembers",O,b.callback)},c.leaveSuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"leaveSuperTeam",done:b.done}),h.verifyOptions(b,"teamId","superTeam::leaveSuperTeam"),this.processCallback(b);var S={teamId:b.teamId};this.sendCmd("leaveSuperTeam",S,b.callback)},c.getSuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"getSuperTeam",done:b.done});var S,O=this,I=O.db;function R(){O.sendCmd("getSuperTeam",{teamId:b.teamId},b.callback)}h.verifyOptions(b,"teamId","team::getSuperTeam"),O.processCallback(b),b.cbaop=function(N){N||O.logger.info("api::getSuperTeam: cbaop ".concat(S))},S=b.teamId,I.enable&&!b.sync?I.getSuperTeam(S).then(function(N){N&&N.validToCurrentUser?(O.logger.log("api::getSuperTeam: db.getSuperTeam ".concat(S)),b.done(null,N)):R()}).catch(function(){R()}):R()},c.getSuperTeams=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"getSuperTeams",done:b.done});var S=this,O=S.db,I=0;function R(){S.sendCmd("getSuperTeams",{timetag:I,NOTSTORE:"timetag"},b.callback)}h.verifyOptions(b),S.processCallback(b),O.enable?O.getSuperTeamsTimetag().then(function(N){I=N,R()},R):R()},c.updateSuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"updateSuperTeam",done:b.done}),h.verifyOptions(b,"teamId","superTeam::updateSuperTeam"),b.action="update",this.processCallback(b),b.team=new y(b),this.sendCmd("updateSuperTeam",{team:b.team,antispamTag:{antiSpamBusinessId:b.antiSpamBusinessId},single:!0},b.callback)},c.updateInfoInSuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"updateInfoInSuperTeam",done:b.done}),h.verifyOptions(b,"teamId","superTeam::updateInfoInSuperTeam"),this.processCallback(b),this.sendCmd("updateInfoInSuperTeam",{superTeamMember:new T(b),single:!0},b.callback)},c.getSuperTeamMembersByJoinTime=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"getSuperTeamMembersByJoinTime",done:b.done});var S=this,O=b,I=O.joinTime,R=s(O),N=O.limit,F=O.teamId;R=!!R,a(I)&&(I=0),a(N)&&(N=100),h.verifyOptions(b,"teamId","superTeam::getSuperTeamMembersByJoinTime"),h.verifyParamType("joinTime",I,"number","api::superTeam::getSuperTeamMembersByJoinTime"),h.verifyParamType("limit",N,"number","api::superTeam::getSuperTeamMembersByJoinTime"),S.processCallback(b),S.sendCmd("getSuperTeamMembersByJoinTime",{teamId:F,limit:N,joinTime:I,reverse:R,timetag:0,NOTSTORE:"timetag"},b.callback)},c.getAllSuperTeamMembers=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"getAllSuperTeamMembers",done:b.done});var S=this,O=this.db;function I(R){R=R||0,S.sendCmd("getSuperTeamMembers",{teamId:b.teamId,timetag:R,NOTSTORE:"timetag"},b.callback)}h.verifyOptions(b,"teamId","superTeam::getAllSuperTeamMembers"),S.processCallback(b),n(g).call(g,this)(b.teamId).then(function(R){var N=R.valid,F=R.timetag;N?(S.logger.info("getAllSuperTeamMembers from local db"),O.getSuperTeamMembers(b.teamId).then(function(P){var x={teamId:b.teamId,members:P};b.done(null,x)},function(){return I()})):I(F)})},c.applySuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"applySuperTeam",done:b.done}),h.verifyOptions(b,"teamId","team::applySuperTeam"),h.verifyOptions(b,"teamId","team::applySuperTeam"),this.processPs(b),this.processCallback(b);var S={teamId:b.teamId,ps:b.ps};this.sendCmd("applySuperTeam",S,b.callback)},c.passSuperTeamApply=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"passSuperTeamApply",done:b.done}),h.verifyOptions(b,"idServer teamId from","team::passSuperTeamApply"),this.processCallback(b);var S={idServer:b.idServer,teamId:b.teamId,from:b.from};this.sendCmd("passSuperTeamApply",S,b.callback)},c.rejectSuperTeamApply=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"rejectSuperTeamApply",done:b.done}),h.verifyOptions(b,"idServer teamId from","team::rejectSuperTeamApply"),this.processPs(b),this.processCallback(b);var S={idServer:b.idServer,teamId:b.teamId,from:b.from,ps:b.ps};this.sendCmd("rejectSuperTeamApply",S,b.callback)},c.acceptSuperTeamInvite=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"acceptSuperTeamInvite",done:b.done}),h.verifyOptions(b,"idServer teamId from","team::acceptSuperTeamInvite"),this.processCallback(b);var S={idServer:b.idServer,teamId:b.teamId,from:b.from};this.sendCmd("acceptSuperTeamInvite",S,b.callback)},c.rejectSuperTeamInvite=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"rejectSuperTeamInvite",done:b.done}),h.verifyOptions(b,"idServer teamId from","team::rejectSuperTeamInvite"),this.processPs(b),this.processCallback(b);var S={idServer:b.idServer,teamId:b.teamId,from:b.from,ps:b.ps};this.sendCmd("rejectSuperTeamInvite",S,b.callback)},c.addSuperTeamManagers=function(b){var S;(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"addSuperTeamManagers",done:b.done}),h.verifyOptions(b,"teamId accounts","team::addSuperTeamManagers"),h.verifyParamType("accounts",b.accounts,"array","team::addSuperTeamManagers"),this.processCallback(b);var O={teamId:b.teamId,accounts:u(S=b.accounts).call(S,0)};this.sendCmd("addSuperTeamManagers",O,b.callback)},c.removeSuperTeamManagers=function(b){var S;(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"removeSuperTeamManagers",done:b.done}),h.verifyOptions(b,"teamId accounts","team::removeSuperTeamManagers"),h.verifyParamType("accounts",b.accounts,"array","team::removeSuperTeamManagers"),this.processCallback(b);var O={teamId:b.teamId,accounts:u(S=b.accounts).call(S,0)};this.sendCmd("removeSuperTeamManagers",O,b.callback)},c.updateSuperTeamMembersMute=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"updateSuperTeamMembersMute",done:b.done}),h.verifyOptions(b,"teamId accounts mute","team::updateSuperTeamMembersMute"),h.verifyParamType("accounts",b.accounts,"array","team::updateSuperTeamMembersMute"),h.verifyArrayMax("accounts",b.accounts,10),this.processCallback(b),b.mute=b.mute?1:0,this.sendCmd("updateSuperTeamMembersMute",b)},c.updateSuperTeamMute=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"updateSuperTeamMute",done:b.done}),h.verifyOptions(b,"teamId mute","team::updateSuperTeamMute"),b.mute=b.mute?1:0,this.processCallback(b),this.sendCmd("updateSuperTeamMute",b)},c.updateNickInSuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"updateNickInSuperTeam",done:b.done}),h.verifyOptions(b,"teamId account","team::updateNickInSuperTeam"),this.processCallback(b),this.sendCmd("updateNickInSuperTeam",{superTeamMember:new T(b),single:!0},b.callback)},c.transferSuperTeam=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"transferSuperTeam",done:b.done}),h.verifyOptions(b,"teamId account leave","team::transferSuperTeam"),h.verifyParamType("leave",b.leave,"boolean","team::transferSuperTeam"),this.processCallback(b);var S={teamId:b.teamId,account:b.account,leave:b.leave};this.sendCmd("transferSuperTeam",S,b.callback)},c.getSuperTeamMembersByAccounts=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"getSuperTeamMembersByAccounts",done:b.done});var S=this,O=this.db,I=b,R=I.teamId,N=I.accounts;if(h.verifyOptions(b,"teamId accounts","superTeam::getSuperTeamMembersByAccounts"),h.verifyParamType("accounts",N,"array","superTeam::getSuperTeamMembersByAccounts"),h.verifyArrayMax("accounts",N,20),N.length<=0)return h.onParamError("参数accounts不能为空数组","superTeam::getSuperTeamMembersByAccounts");function F(){var P=p(N).call(N,function(x){return R+"|"+x});S.processCallback(b),S.sendCmd("getSuperTeamMembersByAccounts",{memberIds:P},function(x,L){b.done(null,{accounts:N,members:L.members,invaldAccounts:L.invalid})})}g.call(this,R).then(function(P){var x,L,_;return P.valid?(x=[],L=[],_=[],d(N).call(N,function(C){var A,M=O.getSuperTeamMemberById(m(A="".concat(R,"-")).call(A,C)).then(function(U){L.push(U)}).catch(function(){_.push(C)});x.push(M)}),void i.all(x).then(function(){b.done(null,{accounts:N,members:L,invaldAccounts:_})})):F()}).catch(function(){return F()})},c.getMutedSuperTeamMembers=function(b){(b=b||{}).done=v({instance:this,className:"NIMFn",funcName:"getMutedSuperTeamMembers",done:b.done});var S=this,O=b,I=O.joinTime,R=s(O),N=O.limit,F=O.teamId;R=!!R,a(I)&&(I=0),a(N)&&(N=100),h.verifyOptions(b,"teamId","superTeam::getSuperTeamMembersByJoinTime"),h.verifyParamType("joinTime",I,"number","api::superTeam::getSuperTeamMembersByJoinTime"),h.verifyParamType("limit",N,"number","api::superTeam::getSuperTeamMembersByJoinTime"),this.processCallback(b),S.sendCmd("getMutedSuperTeamMembers",{teamId:F,limit:N,joinTime:I,reverse:R},b.callback)}},function(o,k,e){var r=e(102),i=e(8),s=e(3),n=e(2),u=e(7),p=e(9),d=e(747),m=e(41),c=e(15),h=e(87),a=e(32),y=e(17),T=e(6),v=e(85),g=e(86),b=e(69),S=e(103);function O(M,U){var E=g!==void 0&&b(M)||M["@@iterator"];if(!E){if(a(M)||(E=function(ee,w){var J;if(ee){if(typeof ee=="string")return I(ee,w);var V=c(J=Object.prototype.toString.call(ee)).call(J,8,-1);if(V==="Object"&&ee.constructor&&(V=ee.constructor.name),V==="Map"||V==="Set")return v(ee);if(V==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(V))return I(ee,w)}}(M))||U&&M&&typeof M.length=="number"){E&&(M=E);var z=0,$=function(){};return{s:$,n:function(){return z>=M.length?{done:!0}:{done:!1,value:M[z++]}},e:function(ee){throw ee},f:$}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var X,Y=!0,W=!1;return{s:function(){E=E.call(M)},n:function(){var ee=E.next();return Y=ee.done,ee},e:function(ee){W=!0,X=ee},f:function(){try{Y||E.return==null||E.return()}finally{if(W)throw X}}}}function I(M,U){(U==null||U>M.length)&&(U=M.length);for(var E=0,z=new Array(U);E<U;E++)z[E]=M[E];return z}var R=e(39).fn,N=e(0),F=N.undef,P=N.notundef,x=e(296),L=e(152),_=e(24).reportAPI,C=e(846);function A(M,U){var E=this,z=[],$=[],X=this.db,Y=this;return X.enable?(n(M).call(M,function(ee){var w=E.protocol.getSessionInCache(ee);w?W(w,ee):$.push(X.getSession(ee).then(function(J){return W(J,ee)}))}),s.all($).then(function(){return z})):(n(M).call(M,function(ee){return W(E.protocol.getSessionInCache(ee),ee)}),s.resolve(z));function W(ee,w){var J,V,D,Q;ee?ee.lastMsg?ee.scene&&ee.to?ee.ack>=ee.lastMsg.time?Y.logger.warn(u(J="".concat(U," not need ack ")).call(J,ee.id)):z.push(ee):Y.logger.warn(u(V="".concat(U," session.scene|to undefined ")).call(V,ee.id)):Y.logger.warn(u(D="".concat(U," session.lastMsg undefined ")).call(D,ee.id)):Y.logger.warn(u(Q="".concat(U," session undefined ")).call(Q,w))}}R.setCurrSession=function(M){_({instance:this,className:"NIMFn",funcName:"setCurrSession",hasCallback:!1}),this.resetSessionUnread(M),this.protocol.setCurrSession(M)},R.resetAllSessionUnread=function(){_({instance:this,className:"NIMFn",funcName:"resetAllSessionUnread",hasCallback:!1});for(var M in this.protocol.sessionSet)this.protocol.sessionSet[M].unread>0&&this.resetSessionUnread(M)},R.resetSessionsUnread=function(){var M=S(r.mark(function U(E){var z,$,X,Y,W,ee,w,J,V=arguments;return r.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return z=V.length>1&&V[1]!==void 0?V[1]:function(){},z=_({instance:this,className:"NIMFn",funcName:"resetSessionsUnread",done:z}),($=this).logger.info("resetSessionsUnread::",E),D.next=6,A.call(this,E,"api::resetSessionsUnread");case 6:if(X=D.sent,$.protocol.resetSessionsUnread(X),$.options.syncSessionUnread&&X.length!==0){D.next=11;break}return z(),D.abrupt("return");case 11:Y=i(X).call(X,function(Q){return{scene:Q.scene==="p2p"?0:1,to:Q.to,timetag:Q.lastMsg.time}}),W=C(Y,50),ee=O(W),D.prev=14,J=r.mark(function Q(){var G;return r.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return G=w.value,B.next=3,new s(function(q,H){$.sendCmd("markSessionAckBatch",{sessionAckTags:G},function(K){K?(z(K),H(K)):q()})});case 3:case"end":return B.stop()}},Q)}),ee.s();case 17:if((w=ee.n()).done){D.next=21;break}return D.delegateYield(J(),"t0",19);case 19:D.next=17;break;case 21:D.next=26;break;case 23:D.prev=23,D.t1=D.catch(14),ee.e(D.t1);case 26:return D.prev=26,ee.f(),D.finish(26);case 29:z(null);case 30:case"end":return D.stop()}},U,this,[[14,23,26,29]])}));return function(U){return M.apply(this,arguments)}}(),R.resetSuperTeamSessionsUnread=function(){var M=S(r.mark(function U(E){var z,$,X,Y,W,ee,w,J,V=arguments;return r.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return z=V.length>1&&V[1]!==void 0?V[1]:function(){},z=_({instance:this,className:"NIMFn",funcName:"resetSuperTeamSessionsUnread",done:z}),($=this).logger.info("resetSuperTeamSessionsUnread::",E),D.next=6,A.call(this,E,"api::resetSuperTeamSessionsUnread");case 6:if(X=D.sent,$.protocol.resetSessionsUnread(X),$.options.syncSessionUnread&&X.length!==0){D.next=11;break}return z(),D.abrupt("return");case 11:Y=i(X).call(X,function(Q){return{to:Q.to,timetag:Q.lastMsg.time}}),W=C(Y,50),ee=O(W),D.prev=14,J=r.mark(function Q(){var G;return r.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return G=w.value,B.next=3,new s(function(q,H){$.sendCmd("markSuperTeamSessionsAck",{sessionAckTags:G},function(K){K?(z(K),H(K)):q()})});case 3:case"end":return B.stop()}},Q)}),ee.s();case 17:if((w=ee.n()).done){D.next=21;break}return D.delegateYield(J(),"t0",19);case 19:D.next=17;break;case 21:D.next=26;break;case 23:D.prev=23,D.t1=D.catch(14),ee.e(D.t1);case 26:return D.prev=26,ee.f(),D.finish(26);case 29:z(null);case 30:case"end":return D.stop()}},U,this,[[14,23,26,29]])}));return function(U){return M.apply(this,arguments)}}(),R.resetSessionUnread=function(M){var U=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){};U=_({instance:this,className:"NIMFn",funcName:"resetSessionUnread",done:U});var E=this,z=E.options.resetUnreadMode!==!1,$=function(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;ee?U(ee,M):U(null)};E.logger.info("resetSessionUnread::use reset mode",z);var X=E.protocol.getSessionInCache(M),Y=!X&&this.db.enable?E.db.getSession(M):s.resolve(X);function W(ee){if(!ee.lastMsg&&!ee.updateTime)return E.logger.warn("api::resetSessionUnread: session.lastMsg undefined ".concat(M)),$();if(!ee.scene||!ee.to)return E.logger.warn("api::resetSessionUnread: session.scene|to undefined ".concat(M)),$();var w;if(w=ee.lastMsg?ee.lastMsg.time:ee.updateTime,ee&&ee.ack&&ee.ack>=w)return E.logger.warn("api::resetSessionUnread: session ack not needs ".concat(M)),$();var J={done:function(D){D?(E.logger.error({message:D||"mark ack failed",callFunc:"resetSessionUnread"}),$(D||"mark ack failed")):(z||E.protocol.resetSessionUnread(ee),$())}};if(E.processCallback(J),ee.scene==="superTeam")E.sendCmd("markSuperTeamSessionAck",{to:ee.to,timetag:w},J.callback);else{var V={scene:ee.scene==="p2p"?0:1,to:ee.to,timetag:w};E.sendCmd("markSessionAck",V,J.callback)}}Y.then(function(ee){return ee?E.options.syncSessionUnread?(z&&E.protocol.resetSessionUnread(ee),void W(ee)):(E.protocol.resetSessionUnread(ee),$()):(E.logger.warn("api::resetSessionUnread: session undefined ".concat(M)),$())})},R.resetCurrSession=function(){_({instance:this,className:"NIMFn",funcName:"resetCurrSession",hasCallback:!1}),this.protocol.setCurrSession("")},R.insertLocalSession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"insertLocalSession",done:M.done});var U,E;function z(){M.session=E,M.done(U,M)}N.verifyOptions(M,"scene to","scene::insertLocalSession"),N.verifyParamValid("scene",M.scene,this.message.validScenes,"scene::insertLocalSession"),this.protocol.insertLocalSession(M).then(function($){E=$,z()},function($){U=$,z()})},R.getLocalSessions=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"getLocalSessions",done:M.done});var U=[];N.verifyOptions(M),F(M.limit)&&(M.limit=100),N.verifyParamType("limit",M.limit,"number","scene::getLocalSessions"),P(p(M))?N.verifyParamType("reverse",p(M),"boolean","scene::getLocalSessions"):M.reverse=!1,this.processCallback(M);var E=d(this.protocol.sessionSet),z=0,$=M.lastSessionId;if(p(M)){var X,Y=O(E);try{for(Y.s();!(X=Y.n()).done;){var W=X.value,ee=W.id;if($)ee===$&&($=void 0);else if(W.lastMsg!==void 0&&!W.isDeleted){if(++z>M.limit)break;U.push(m({},W))}}}catch(Q){Y.e(Q)}finally{Y.f()}}else{var w,J,V=O(E);try{for(V.s();!(J=V.n()).done;){var D=J.value;if($===D.id)break;D.lastMsg===void 0||D.isDeleted||U.push(D)}}catch(Q){V.e(Q)}finally{V.f()}U=p(w=c(U).call(U,-M.limit)).call(w)}this.logger.debug("getLocalSessions::sessions is",U),U=i(U).call(U,function(Q){return h(L).call(L,Q)}),M.sessions=U,delete M.callback,M.done(void 0,M)},R.getLocalSession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"getLocalSession",done:M.done});var U=this,E=U.db,z=null;if(N.verifyOptions(M,"sessionId","scene::getLocalSession"),N.verifyParamType("sessionId",M.sessionId,"string","scene::getLocalSession"),z=U.protocol.getSessionInCache(M.sessionId),U.logger.debug("getLocalSession::cache session is",z),!z&&E.enable)return U.processCallback(M),void E.getSession(M.sessionId).then(function($){$&&(z=$,U.logger.debug("getLocalSession::db session is",z)),M.done(null,z)}).catch(function($){M.done($)});M.done(null,h(L).call(L,z))},R.getLocalSessionsByMsgType=function(M){var U;(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"getLocalSessionsByMsgType",done:M.done});var E=this.db,z=M.exclude,$=[],X=c(U=x.validTypes).call(U,0);if(P(z)){if(typeof z=="string")z=[z];else if(!a(z))return void N.onParamInvalidType("exclude",["string","string array"],"","exclude::getLocalSessionsByMsgType");z=y(z).call(z,function(Y){return T(X).call(X,Y)>-1}),X=y(X).call(X,function(Y){return T(z).call(z,Y)===-1})}this.processCallback(M),E.enable?E.getSessions().then(function(Y){z&&z.length!==0?X&&X.length!==0?(n(Y).call(Y,function(W,ee){var w,J,V;W.lastMsg&&T(z).call(z,W.lastMsg.type)>-1&&(w=ee,J=W.id,V=E.getMsgs({sessionId:J,limit:1,types:X}).then(function(D){return D&&D[0]?Y[w].lastMsg=D[0]:Y[w].lastMsg=null,s.resolve()}),$.push(V))}),s.all($).then(function(){M.done(null,{exclude:z,sessions:Y})})):M.done(null,{exclude:z,sessions:i(Y).call(Y,function(W){W.lastMsg=null})}):M.done(null,{exclude:z,sessions:Y})}):M.done(null,{exclude:z,sessions:[]})},R.updateLocalSession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"updateLocalSession",done:M.done});var U,E=this,z=E.db;N.verifyOptions(M,"id","scene::updateLocalSession"),E.processCallback(M);var $=N.filterObj(M,"id localCustom");function X(){M.needNotify!==!1&&E.protocol.onUpdateSession($),M.session=$,M.done(U,M)}$=E.protocol.updateSessionInCache(M),z.enable&&$?z.updateSession($).then(function(Y){$=Y,X()},function(Y){U=Y,X()}):X()},R.deleteLocalSession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"deleteLocalSession",done:M.done});var U,E=this,z=E.db;N.verifyOptions(M,"id","session::deleteLocalSession"),E.processCallback(M);var $=E.protocol.getSessionInCache(M.id);if(E.protocol.deleteSessionInCache(M.id,M.isLogic),z.enable?(M.isLogic?z.deleteSessionLogic(M.id):z.deleteSession(M.id,$)).then(function(){E.logger.info("sessions::deleteSessionInDb::delete session done",M.id),Y()},function(W){U=W,Y()}):Y(),M.isDeleteRoaming){var X=typeof M.id=="string"?[M.id]:M.id;X=i(X).call(X,function(W){return W.replace("-","|")}),this.sendCmd("deleteSessions",{sessions:X},function(){})}function Y(){M.done(U,M)}},R.deleteSession=function(M,U){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"deleteSession",done:M.done}),U||this.logger.warn('this api will be abandon,please use "deleteLocalSession"'),N.verifyOptions(M,"scene to","session::deleteSession"),this.processCallback(M),M.sessions=[{scene:M.scene,to:M.to}],this.deleteSessions(M)},R.deleteRoamingMsgBySession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"deleteRoamingMsgBySession",done:M.done}),this.deleteSession(M,!0)},R.deleteSessions=function(M){var U,E;(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"deleteSessions",done:M.done}),N.verifyOptions(M,"sessions","session::deleteSessions"),N.verifyParamType("sessions",M.sessions,"array","session::deleteSessions"),n(U=M.sessions).call(U,function(z,$){N.verifyOptions(z,"scene to",!0,"sessions["+$+"].","session::deleteSessions")}),this.processCallback(M),this.sendCmd("deleteSessions",{sessions:i(E=M.sessions).call(E,function(z){return z.scene+"|"+z.to})},M.callback)},R.getServerSessions=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"getServerSessions",done:M.done}),P(M.minTimestamp)&&N.verifyParamType("minTimestamp",M.minTimestamp,"number","session::deleteSessions"),P(M.maxTimestamp)&&N.verifyParamType("maxTimestamp",M.maxTimestamp,"number","session::deleteSessions"),P(M.needLastMsg)&&(M.needLastMsg=M.needLastMsg===!1?0:1),P(M.limit)&&(N.verifyParamType("limit",M.limit,"number","session::deleteSessions"),N.verifyParamMax("limit",M.limit,100,"scene::getLocalSessions")),this.processCallback(M),this.sendCmd("getServerSessions",{sessionReqTag:M},M.callback)},R.getServerSession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"getServerSession",done:M.done}),N.verifyOptions(M,"scene to","scene::getServerSession"),N.verifyParamValid("scene",M.scene,this.message.validScenes,"scene::getServerSession"),N.verifyParamType("to",M.to,"string","to::getServerSession");var U=M.scene+"|"+M.to;M.scene==="superTeam"&&(U="super_team|"+M.to),this.processCallback(M),this.sendCmd("getServerSession",{session:{id:U}},M.callback)},R.updateServerSession=function(M){(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"updateServerSession",done:M.done}),N.verifyOptions(M,"scene to","scene::updateServerSession"),N.verifyParamValid("scene",M.scene,this.message.validScenes,"scene::updateServerSession"),N.verifyParamType("to",M.to,"string","to::updateServerSession"),P(M.extra)&&N.verifyParamType("extra",M.extra,"string","extra::updateServerSession");var U=M.scene+"|"+M.to;M.scene==="superTeam"&&(U="super_team|"+M.to),this.processCallback(M),this.sendCmd("updateServerSession",{session:{id:U,ext:M.extra||""}},M.callback)},R.deleteServerSessions=function(M){var U,E=this;(M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"deleteServerSessions",done:M.done}),N.verifyOptions(M,"sessions","scene::deleteServerSessions"),N.verifyParamType("sessions",M.sessions,"array","sessions::deleteServerSessions");var z=[];n(U=M.sessions).call(U,function($){N.verifyParamValid("scene",$.scene,E.message.validScenes,"scene::deleteServerSessions"),N.verifyParamType("to",$.to,"string","to::deleteServerSessions");var X=$.scene+"|"+$.to;$.scene==="superTeam"&&(X="super_team|"+$.to),z.push({id:X})}),this.processCallback(M),this.sendCmd("deleteServerSessions",{sessions:z},M.callback)},R.updateSessionsWithMoreRoaming=function(M){var U;if((M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"updateSessionsWithMoreRoaming",done:M.done}),N.verifyOptions(M,"msg","session::updateSessionsWithMoreRoaming"),N.verifyCallback(M,"done","session::updateSessionsWithMoreRoaming"),!this.db.enable)return M.done(null,"db is disable");var E={time:M.msg.time,idServer:M.msg.idServer,to:M.msg.to,from:M.msg.from};N.verifyParamType("msg.time",M.msg.time,"number","time::updateSessionsWithMoreRoaming"),N.verifyParamType("msg.idServer",M.msg.idServer,"string","idServer::updateSessionsWithMoreRoaming"),N.verifyParamType("msg.from",M.msg.from,"string","from::updateSessionsWithMoreRoaming"),N.verifyParamType("msg.to",M.msg.to,"string","to::updateSessionsWithMoreRoaming"),N.verifyParamValid("scene",M.msg.scene,this.message.validScenes,"scene::updateSessionsWithMoreRoaming");var z=E.to===this.account?E.from:E.to;E.id=u(U="".concat(M.msg.scene,"-")).call(U,z),this.db.updateSessionsWithMoreRoaming(E).then(function($){M.done(null,$)}).catch(function($){M.done($)})},R.deleteSessionsWithMoreRoaming=function(M){if((M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"deleteSessionsWithMoreRoaming",done:M.done}),N.verifyOptions(M,"id","session::deleteSessionsWithMoreRoaming"),N.verifyCallback(M,"done","session::deleteSessionsWithMoreRoaming"),!this.db.enable)return M.done(null,"db is disable");this.db.deleteSessionsWithMoreRoaming(M.id).then(function(U){M.done(null,U)}).catch(function(U){M.done(U)})},R.getSessionsWithMoreRoaming=function(M){if((M=M||{}).done=_({instance:this,className:"NIMFn",funcName:"getSessionsWithMoreRoaming",done:M.done}),N.verifyCallback(M,"done","session::getSessionsWithMoreRoaming"),!this.db.enable)return M.done(null,"db is disable");this.db.getSessionsWithMoreRoaming(M.id).then(function(U){M.done(null,U)}).catch(function(U){M.done(U)})}},function(o,k,e){var r=e(847),i=e(848),s=e(849),n=Math.ceil,u=Math.max;o.exports=function(p,d,m){d=(m?i(p,d,m):d===void 0)?1:u(s(d),0);var c=p==null?0:p.length;if(!c||d<1)return[];for(var h=0,a=0,y=Array(n(c/d));h<c;)y[a++]=r(p,h,h+=d);return y}},function(o,k){o.exports=function(e,r,i){var s=-1,n=e.length;r<0&&(r=-r>n?0:n+r),(i=i>n?n:i)<0&&(i+=n),n=r>i?0:i-r>>>0,r>>>=0;for(var u=Array(n);++s<n;)u[s]=e[s+r];return u}},function(o,k,e){var r=e(199),i=e(200),s=e(301),n=e(88);o.exports=function(u,p,d){if(!n(d))return!1;var m=typeof p;return!!(m=="number"?i(d)&&s(p,d.length):m=="string"&&p in d)&&r(d[p],u)}},function(o,k,e){var r=e(850);o.exports=function(i){var s=r(i),n=s%1;return s==s?n?s-n:s:0}},function(o,k,e){var r=e(851);o.exports=function(i){return i?(i=r(i))===1/0||i===-1/0?17976931348623157e292*(i<0?-1:1):i==i?i:0:i===0?i:0}},function(o,k,e){var r=e(852),i=e(88),s=e(854),n=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,p=/^0o[0-7]+$/i,d=parseInt;o.exports=function(m){if(typeof m=="number")return m;if(s(m))return NaN;if(i(m)){var c=typeof m.valueOf=="function"?m.valueOf():m;m=i(c)?c+"":c}if(typeof m!="string")return m===0?m:+m;m=r(m);var h=u.test(m);return h||p.test(m)?d(m.slice(2),h?2:8):n.test(m)?NaN:+m}},function(o,k,e){var r=e(853),i=/^\s+/;o.exports=function(s){return s&&s.slice(0,r(s)+1).replace(i,"")}},function(o,k){var e=/\s/;o.exports=function(r){for(var i=r.length;i--&&e.test(r.charAt(i)););return i}},function(o,k,e){var r=e(119),i=e(104);o.exports=function(s){return typeof s=="symbol"||i(s)&&r(s)=="[object Symbol]"}},function(o,k,e){var r=e(120),i=e(856),s=e(857),n=e(102),u=e(103),p=e(57),d=e(17),m=e(15),c=e(2),h=e(32),a=e(171),y=e(8),T=e(7),v=e(9),g=e(10),b=e(862),S=e(5),O=e(58),I=e(59),R=e(60),N=e(61),F=e(47),P=["callback","done"];function x(w,J){var V=S(w);if(O){var D=O(w);J&&(D=d(D).call(D,function(Q){return I(w,Q).enumerable})),V.push.apply(V,D)}return V}function L(w){for(var J=1;J<arguments.length;J++){var V,D,Q=arguments[J]!=null?arguments[J]:{};J%2?c(V=x(Object(Q),!0)).call(V,function(G){p(w,G,Q[G])}):R?N(w,R(Q)):c(D=x(Object(Q))).call(D,function(G){F(w,G,I(Q,G))})}return w}var _=e(39).fn,C=e(0),A=C.undef,M=C.notundef,U=e(44),E=e(152),z=e(151),$=e(40),X=e(72),Y=e(24).reportAPI,W=e(13);_.sendG2Msg=function(w){return(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"sendG2Msg",done:w.done}),this.processCallback(w),w.msg=new this.message.G2Message(w),this.sendMsg(w)},_.beforeSendMsg=function(w){var J,V=this.protocol,D=w.msg;switch(D.to===this.account&&(D.fromDeviceId=U.deviceId),D.userUpdateTime=V.myInfo&&V.myInfo.updateTime,D.getScene()){case"p2p":J="sendMsg";break;case"team":J="sendTeamMsg";break;case"superTeam":J="sendSuperTeamMsg"}d(w)&&(J="sendFilterMsg",D.filter=!0),w.cmd=J},_.afterSendMsg=function(w){var J=w.rtnMsg;if(!J||!J.ignore){var V=this.protocol.getSessionInCache(J.sessionId);w.isLocal&&V&&V.lastMsg&&J.time<V.lastMsg.time||this.protocol.onUpdateSession(E.genSessionByMsg(J))}},_.beforeForwardMsg=function(w){C.verifyOptions(w,"msg scene to","msg::beforeForwardMsg"),w.msg.scene=w.scene,w.msg.to=w.to},_.markMsgRead=function(w){var J=this.protocol;!w||this.db.enable||J.options.autoMarkRead?this.logger.warn("api::markMsgRead: 不需要标记消息为已收到 (没有消息, 或者启用了数据库, 或者启用了自动标记已收到)"):J.markMsgRead(w,!0)},_.sendMsgReceipt=function(w){if((w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"sendMsgReceipt",done:w.done}),C.verifyOptions(w),this.processCallback(w),w.msg){C.verifyOptions(w,"msg","msg::sendMsgReceipt");var J=w.msg;C.verifyOptions(J,"target idClient time",!0,"msg.","msg::sendMsgReceipt"),this.protocol.shouldSendMsgReceipt(J)?this.sendCmd("sendMsgReceipt",{msgReceipt:{to:J.target,idClient:J.idClient,time:J.time}},w.callback):w.done()}else w.done()},_.isMsgRemoteRead=function(w){return Y({instance:this,className:"NIMFn",funcName:"isMsgRemoteRead",hasCallback:!1}),this.protocol.isMsgRemoteRead(w)},_.recallMsg=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"recallMsg",done:w.done}),this.deleteMsg(w,!0)},_.deleteMsg=function(w,J){var V;(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteMsg",done:w.done}),J||this.logger.warn("this api will be abandon,please use “recallMsg”"),C.verifyOptions(w,"msg","msg::deleteMsg");var D=w.msg;if(D.scene!=="team"&&D.from!==this.account||D.status!=="success"||D.isLocal)return w.done($.newParamError("只能删除自己发的, 并且发送成功的消息，且不能是本地消息",{callFunc:"msg::deleteMsg"}),w);C.verifyOptions(D,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsg"),C.verifyParamValid("msg.scene",D.scene,this.message.validScenes,"msg::deleteMsg"),this.processPs(w),this.processCallback(w);var Q={deletedIdClient:D.idClient,deletedIdServer:D.idServer,time:D.time,from:D.from,to:D.to,opeAccount:D.from},G=D.scene==="superTeam"?"deleteSuperTeamMsg":"deleteMsg";Q.type="deleteMsg"+D.scene[0].toUpperCase()+m(V=D.scene).call(V,1);var B=["ps","apnsText","pushPayload","env","opeAccount","attach"];c(B).call(B,function(q){w[q]&&(Q[q]=w[q])}),Q=new z(Q),this.sendCmd(G,{sysMsg:Q,msg:D},w.callback)},_.deleteMsgSelf=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteMsgSelf",done:w.done}),C.verifyOptions(w,"msg","msg::deleteMsgSelf");var J=w.msg;if(J.scene==="superTeam")return w.done($.newParamError("单向删除暂不支持超大群场景",{callFunc:"msg::deleteMsgSelf"}),w);C.verifyOptions(J,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsgSelf"),C.verifyParamValid("msg.scene",J.scene,this.message.validScenes,"msg::deleteMsgSelf"),this.processCallback(w);var V={scene:J.scene==="p2p"?1:2,from:J.from,to:J.to,time:J.time,idClient:J.idClient,idServer:J.idServer,custom:w.custom,type:J.type};this.sendCmd("deleteMsgSelf",{deleteMsgSelfTag:V},w.callback)},_.deleteMsgSelfBatch=function(w){var J,V,D,Q=this;if((w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteMsgSelfBatch",done:w.done}),C.verifyOptions(w,"msgs","msg::deleteMsgSelfBatch"),(!h(w.msgs)||w.msgs.length===0||w.msgs.length>100)&&C.onParamError("msgs应该是数组且数据长度应大于0小于等于100","msg::deleteMsgSelfBatch"),a(J=w.msgs).call(J,function(B){return B.scene==="superTeam"}))return w.done($.newParamError("消息列表中存在超大群消息，单向删除暂不支持超大群场景",{callFunc:"msg::deleteMsgSelfBatch"}),w);c(V=w.msgs).call(V,function(B){C.verifyOptions(B,["scene","to","from","time","idClient","idServer"],!0,"msg.","msg::deleteMsgSelfBatch"),C.verifyParamValid("msg.scene",B.scene,Q.message.validScenes,"msg::deleteMsgSelfBatch")}),this.processCallback(w);var G=y(D=w.msgs).call(D,function(B){var q;return{scene:B.scene==="p2p"?1:2,from:B.from,to:B.to,time:B.time,idClient:B.idClient,idServer:B.idServer,sessionId:B.sessionId||T(q="".concat(B.scene,"-")).call(q,B.to),custom:w.custom,type:B.type}});this.sendCmd("deleteMsgSelfBatch",{deleteMsgSelfTags:G},w.callback)};var ee={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};_.getHistoryMsgs=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"getHistoryMsgs",done:w.done}),this.protocol.syncing&&this.logger.warn("Please call getHistoryMsgs after onsyncdone callback"),C.verifyOptions(w,"scene to","msg::getHistoryMsgs"),C.verifyParamValid("scene",w.scene,this.message.validScenes,"msg::getHistoryMsgs"),w.beginTime===void 0&&(w.beginTime=0);var J,V=this.protocol.getSessionInCache(w.scene+"-"+w.to),D=V&&V.lastEmptyTime;if(D>w.beginTime&&(w.beginTime=D),C.verifyParamType("beginTime",w.beginTime,"number","msg::getHistoryMsgs"),w.endTime===void 0&&(w.endTime=0),C.verifyParamType("endTime",w.endTime,"number","msg::getHistoryMsgs"),w.lastMsgId=w.lastMsgId&&+w.lastMsgId?w.lastMsgId:"0",w.limit===void 0&&(w.limit=100),C.verifyParamType("limit",w.limit,"number","msg::getHistoryMsgs"),C.verifyParamMax("limit",w.limit,100,"msg::getHistoryMsgs"),M(v(w))?C.verifyParamType("reverse",v(w),"boolean","msg::getHistoryMsgs"):w.reverse=!1,M(w.asc)?C.verifyParamType("asc",w.asc,"boolean","msg::getHistoryMsgs"):w.asc=!1,A(w.msgTypes))w.msgTypes=[];else if(h(w.msgTypes)){var Q,G;w.msgTypes=y(Q=w.msgTypes).call(Q,function(q){return ee[q]}),w.msgTypes=d(G=w.msgTypes).call(G,function(q){return typeof q=="number"})}else typeof ee[w.msgTypes]=="number"?w.msgTypes=[ee[w.msgTypes]]:w.msgTypes=[];switch(this.processCallback(w),w.cbaop=function(q,H){if(!q){var K;w.asc&&(H.msgs=v(K=H.msgs).call(K)),H.msgs=X.deduplication(H.msgs)}},w.scene){case"p2p":J="getHistoryMsgs";break;case"team":J="getTeamHistoryMsgs";break;case"superTeam":J="getSuperTeamHistoryMsgs"}var B={scene:w.scene,to:w.to,beginTime:w.beginTime,endTime:w.endTime,lastMsgId:w.lastMsgId,limit:w.limit,reverse:v(w),msgTypes:w.msgTypes};this.sendCmd(J,B,w.callback)},_.searchHistoryMsgs=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"searchHistoryMsgs",done:w.done}),C.verifyOptions(w,"scene to keyword","msg::searchHistoryMsgs"),C.verifyParamValid("scene",w.scene,this.message.validScenes,"msg::searchHistoryMsgs"),w.beginTime===void 0&&(w.beginTime=0);var J,V=this.protocol.getSessionInCache(w.scene+"-"+w.to),D=V&&V.lastEmptyTime;switch(D>w.beginTime&&(w.beginTime=D),C.verifyParamType("beginTime",w.beginTime,"number","msg::searchHistoryMsgs"),w.endTime===void 0&&(w.endTime=0),C.verifyParamType("endTime",w.endTime,"number","msg::searchHistoryMsgs"),w.limit===void 0&&(w.limit=100),C.verifyParamType("limit",w.limit,"number","msg::searchHistoryMsgs"),C.verifyParamMax("limit",w.limit,100,"msg::searchHistoryMsgs"),M(v(w))?C.verifyParamType("reverse",v(w),"boolean","msg::searchHistoryMsgs"):w.reverse=!1,M(w.asc)?C.verifyParamType("asc",w.asc,"boolean","msg::searchHistoryMsgs"):w.asc=!1,this.processCallback(w),w.asc&&(w.cbaop=function(G,B){var q;G||(B.msgs=v(q=B.msgs).call(q))}),w.scene){case"p2p":J="searchHistoryMsgs";break;case"team":J="searchTeamHistoryMsgs"}var Q=C.filterObj(w,"scene to beginTime endTime keyword limit reverse");this.sendCmd(J,Q,w.callback)},_.getLocalMsgs=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"getLocalMsgs",done:w.done});var J=this,V=J.db,D=[];C.verifyOptions(w);var Q=!1;M(w.start)&&(Q=!0,C.verifyParamType("start",w.start,"number","msg::getLocalMsgs"));var G=!1;if(M(w.end)&&(G=!0,C.verifyParamType("end",w.end,"number","msg::getLocalMsgs")),Q&&G&&w.end<=w.start&&C.onParamError("参数 end 必须晚于 start"),M(w.subTypes)&&C.verifyParamType("subTypes",w.subTypes,"array","msg::getLocalMsgs"),A(w.limit)&&(w.limit=100),C.verifyParamType("limit",w.limit,"number","msg::getLocalMsgs"),C.verifyParamMin("limit",w.limit,1,"msg::getLocalMsgs"),J.processCallback(w),V.enable){var B=new Date().getTime();V.getMsgs(w).then(function(H){var K;D=H,J.logger.info(T(K="api::getLocalMsgs: query db cost ".concat(new Date().getTime()-B," ms and the conditions is ")).call(K,g(w))),q()},function(H){(H=H||{}).message=H.message||"msg::getLocalMsgs:db error",q()})}else q();function q(){var H=C.simpleClone(w);H.msgs=D,delete H.callback,delete H.done,w.done(null,H)}},_.getLocalMsgsInUnread=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"getLocalMsgsInUnread",done:w.done});var J=this;C.validate({sessionId:{type:"string",allowEmpty:!1}},w),this.getLocalSession({sessionId:w.sessionId,done:function(V,D){V?w.done&&w.done(V):D?(D.ack=D.ack||0,J.getLocalMsgs(L({sessionId:w.sessionId,start:D.ack,limit:b,filterFunc:function(Q){return Q.flow==="in"&&Q.isUnreadable===!0},done:function(){}},w))):w.done&&w.done(new Error("session ".concat(w.sessionId," not exist")))}})},_.getLocalMsgByIdClient=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"getLocalMsgByIdClient",done:w.done});var J=this.db,V=null,D=null;function Q(){w.msg=D,w.done(V,w)}C.verifyOptions(w,"idClient","msg::getLocalMsgByIdClient"),this.processCallback(w),J.enable?J.getMsgByIdClient(w.idClient).then(function(G){G&&(D=G),Q()},function(G){V=G,Q()}):(this.logger.warn("because db is false,error is null"),Q())},_.getLocalMsgsByIdClients=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"getLocalMsgsByIdClients",done:w.done});var J,V=this.db,D=[];function Q(){w.msgs=D,w.done(J,w)}C.verifyOptions(w,"idClients","msg::getLocalMsgByIdClients"),C.verifyParamType("idClients",w.idClients,"array","msg::getLocalMsgByIdClients"),this.processCallback(w),V.enable?V.getMsgsByIdClients(w.idClients).then(function(G){D=d(G).call(G,function(B){return!!B}),Q()},function(G){J=G,Q()}):Q()},_.updateLocalMsg=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"updateLocalMsg",done:w.done});var J,V=this.db,D=null;if(C.verifyOptions(w,"idClient","msg::updateLocalMsg"),this.processCallback(w),V.enable){var Q=C.filterObj(w,"idClient localCustom");V.updateMsg(Q).then(function(B){D=B,G()},function(B){J=B,G()})}else G();function G(){w.msg=D,w.done(J,w)}},_.deleteLocalMsg=function(){var w=u(n.mark(function J(V){var D,Q,G,B;return n.wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return B=function(){V.done(Q,V)},(V=V||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteLocalMsg",done:V.done}),D=this,C.verifyOptions(V,"msg","msg::deleteLocalMsg"),G=V.msg,C.verifyOptions(G,"idClient sessionId",!0,"msg.","msg::deleteLocalMsg"),D.processCallback(V),q.prev=8,q.next=11,D.protocol.deleteLocalMsg(G);case 11:B(),q.next=18;break;case 14:q.prev=14,q.t0=q.catch(8),Q=q.t0,B();case 18:case"end":return q.stop()}},J,this,[[8,14]])}));return function(J){return w.apply(this,arguments)}}(),_.deleteLocalMsgsBySession=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteLocalMsgsBySession",done:w.done});var J,V=this,D=V.db;C.verifyOptions(w,"scene to","msg::deleteLocalMsgsBySession"),C.verifyParamValid("scene",w.scene,V.message.validScenes,"msg::deleteLocalMsgsBySession"),w.sessionId=w.scene+"-"+w.to,w.delLastMsg=w.delLastMsg===!0,w.isTag=w.isTag===!0;var Q=new Date().getTime();function G(){w.done(J,w)}V.processCallback(w);var B={id:w.sessionId};w.delLastMsg&&(B.lastMsg=null),w.isTag&&(B.lastEmptyTime=Q),D.enable?D.deleteMsgsBySessionId(w).then(function(){w.delLastMsg||w.isTag?D.updateSession(B).then(function(q){V.protocol.onUpdateSession(q),w.session=q,G()}):G()}).catch(function(q){J=q,G()}):(this.logger.warn("because db is false,error is null"),G(),(w.delLastMsg||w.isTag)&&V.protocol.onUpdateSession(B))},_.deleteLocalMsgsByTime=function(w){var J=this.db;W.isBrowser&&J.enable&&(M((w=w||{}).start)?C.verifyParamType("start",w.start,"number","msg::deleteLocalMsgsByTime"):w.start=0,M(w.end)?C.verifyParamType("end",w.end,"number","msg::deleteLocalMsgsByTime"):w.end=1/0,M(w.end)&&M(w.start)&&w.end<=w.start&&C.onParamError("参数 end 必须大于 start"),this.processCallback(w),this.protocol.deleteLocalMsgsByTime(w).then(function(V){w.done(null,V)},function(V){w.done(V,null)}))},_.deleteLocalMsgs=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteLocalMsgs",done:w.done});var J;function V(){w.done(J,w)}w.updateSession=w.updateSession!==!1,C.verifyOptions(w,"sessionId","msg::deleteLocalMsgsBySession"),M(w.start)&&C.verifyParamType("start",w.start,"number","msg::deleteLocalMsgs"),M(w.end)&&C.verifyParamType("end",w.end,"number","msg::deleteLocalMsgs"),M(w.end)&&M(w.start)&&w.end<=w.start&&C.onParamError("参数 end 必须大于 start"),this.processCallback(w),this.protocol.deleteLocalMsgs(w).then(function(){V()},function(D){J=D,V()})},_.deleteAllLocalMsgs=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"deleteAllLocalMsgs",done:w.done});var J,V=this.db;function D(){w.done(J,w)}this.processCallback(w),this.protocol.sessionSet={},V.enable?V.deleteAllMsgs().then(function(){D()},function(Q){J=Q,D()}):(this.logger.warn("because db is false,error is null"),D())},_.saveMsgsToLocal=function(w){var J;(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"saveMsgsToLocal",done:w.done}),this.db.enable||(this.logger.warn("because db is false,error is null"),w.done(null,[])),C.verifyOptions(w,"msgs done","msg::saveMsgsToLocal"),C.verifyParamType("msgs",w.msgs,"Array","msg::saveMsgsToLocal");var V=y(J=w.msgs).call(J,function(D){var Q=L({},D);return Q.hasOwnProperty("needUpdateSession")||(Q.needUpdateSession=!0),Q});this.db.putMsg(V).then(function(D,Q){Q?w.done(Q):w.done(null,D)})},_.clearServerHistoryMsgs=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"clearServerHistoryMsgs",done:w.done}),C.verifyOptions(w,"account","msg::clearServerHistoryMsgs");var J=w.delRoam!==!1;this.processCallback(w),this.sendCmd("clearServerHistoryMsgs",{clearMsgsParams:{account:w.account,delRoam:J?1:0}},w.callback)},_.clearServerHistoryMsgsWithSync=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"clearServerHistoryMsgsWithSync",done:w.done}),C.verifyOptions(w,"scene to","msg::clearServerHistoryMsgsWithSync");var J=w.isDeleteRoam===void 0||w.isDeleteRoam===!0,V={type:w.scene==="team"?2:1,isDeleteRoam:J?1:0,isSyncSelf:w.isSyncSelf===!0?1:0};V[V.type===2?"toTid":"otherAccid"]=w.to,w.ext!==void 0&&(V.ext=w.ext),this.processCallback(w),this.sendCmd("clearServerHistoryMsgsWithSync",{clearMsgsParamsWithSync:V},w.callback)},_.msgFtsInServer=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"msgFtsInServer",done:w.done}),this.processCallback(w);var J=w,V=s({},(i(J),J));C.validate({keyword:{type:"string"},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},sessionLimit:{type:"number",min:0,required:!1},msgLimit:{type:"number",min:0,required:!1},order:{type:"enum",values:["ASC","DESC"],required:!1},p2pList:{type:"array",required:!1},teamList:{type:"array",required:!1},senderList:{type:"array",required:!1},msgTypeList:{type:"array",required:!1},msgSubTypeList:{type:"array",required:!1}},V,"msg::msgFtsInServer"),M(V.toTime)&&M(V.fromTime)&&V.toTime<V.fromTime&&C.onParamError("Options error: toTime should be greater than fromTime");var D,Q={ASC:1,DESC:2};V.order&&Q[V.order]&&(V.order=Q[V.order]),V.msgTypeList&&(V.msgTypeList=y(D=V.msgTypeList).call(D,function(B){return ee[B]}));var G=["p2pList","teamList","senderList","msgTypeList","msgSubTypeList"];c(G).call(G,function(B){h(V[B])&&(V[B]=V[B].join(","))}),this.sendCmd("msgFtsInServer",{msgFullSearchRequestTag:V},w.callback)},_.msgFtsInServerByTiming=function(w){(w=w||{}).done=Y({instance:this,className:"NIMFn",funcName:"msgFtsInServerByTiming",done:w.done}),this.processCallback(w);var J=w,V=(J.callback,J.done,r(J,P));C.validate({keyword:{type:"string"},fromTime:{type:"number",required:!1},toTime:{type:"number",required:!1},msgLimit:{type:"number",min:0,required:!1},order:{type:"enum",values:["ASC","DESC"],required:!1},p2pList:{type:"array",required:!1},teamList:{type:"array",required:!1},senderList:{type:"array",required:!1},msgTypeList:{type:"array",required:!1},msgSubTypeList:{type:"array",required:!1}},V,"msg::msgFtsInServerByTimeSort"),M(V.toTime)&&M(V.fromTime)&&V.toTime<V.fromTime&&C.onParamError("Options error: toTime should be greater than fromTime");var D,Q={ASC:1,DESC:2};V.msgLimit===void 0&&(V.msgLimit=20),V.order&&Q[V.order]&&(V.order=Q[V.order]),V.msgTypeList&&(V.msgTypeList=y(D=V.msgTypeList).call(D,function(B){return ee[B]}));var G=["p2pList","teamList","senderList","msgTypeList","msgSubTypeList"];c(G).call(G,function(B){h(V[B])&&(V[B]=V[B].join(","))}),this.sendCmd("msgFtsInServerByTiming",{msgTimingFullSearchRequestTag:V},w.callback)}},function(o,k){o.exports=function(e){if(e==null)throw new TypeError("Cannot destructure "+e)},o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){var r=e(858),i=e(149);function s(){var n;return o.exports=s=r?i(n=r).call(n):function(u){for(var p=1;p<arguments.length;p++){var d=arguments[p];for(var m in d)Object.prototype.hasOwnProperty.call(d,m)&&(u[m]=d[m])}return u},o.exports.__esModule=!0,o.exports.default=o.exports,s.apply(this,arguments)}o.exports=s,o.exports.__esModule=!0,o.exports.default=o.exports},function(o,k,e){o.exports=e(859)},function(o,k,e){o.exports=e(860)},function(o,k,e){var r=e(861);o.exports=r},function(o,k,e){var r=e(304);o.exports=r},function(o,k,e){o.exports=e(863)},function(o,k,e){var r=e(864);o.exports=r},function(o,k,e){e(865),o.exports=9007199254740991},function(o,k,e){e(1)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})},function(o,k,e){var r=e(9),i=e(32),s=e(15),n=e(2),u=e(10),p=e(5),d=e(17),m=e(39).fn,c=e(0),h=e(749),a=e(751),y=(e(72),c.notundef),T=e(24).reportAPI;function v(g,b,S,O){S=S||"",c.verifyParamType(S+"from",g.from,"string",b),c.verifyParamType(S+"to",g.to,"string",b),c.verifyParamType(S+"idServer",g.idServer,"string",b),c.verifyParamType(S+"time",g.time,"number",b),c.verifyParamValid(S+"scene",g.scene,this.message.validScenes,b),O||c.verifyParamType(S+"idClient",g.idClient,"string",b)}m.getThreadMsgs=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"getThreadMsgs",done:g.done}),c.verifyCallback(g,"done","msg::getThreadMsgs"),c.verifyOptions(g,"scene threadMsgFromAccount threadMsgToAccount threadMsgIdServer threadMsgTime","msg::getThreadMsgs"),c.verifyParamType("threadMsgFromAccount",g.threadMsgFromAccount,"string","msg::getThreadMsgs"),c.verifyParamType("threadMsgToAccount",g.threadMsgToAccount,"string","msg::getThreadMsgs"),c.verifyParamType("threadMsgIdServer",g.threadMsgIdServer,"string","msg::getThreadMsgs"),c.verifyParamType("threadMsgTime",g.threadMsgTime,"number","msg::getThreadMsgs"),c.verifyParamValid("scene",g.scene,this.message.validScenes,"msg::getThreadMsgs"),this.processCallback(g);var b={scene:this.message.sceneMap[g.scene],from:g.threadMsgFromAccount,to:g.threadMsgToAccount,time:g.threadMsgTime,idServer:g.threadMsgIdServer},S={limit:g.limit<100?g.limit:100,beginTime:typeof g.beginTime=="number"?g.beginTime:0,reverse:r(g)===!0?1:0};typeof g.endTime=="number"&&(S.endTime=g.endTime,S.endTime<=S.beginTime&&c.onParamError("endTime应该大于beginTime","msg::getThreadMsgs")),g.lastMsgId&&(S.lastMsgId=g.lastMsgId),this.sendCmd("getThreadMsgs",{msg:b,threadMsgReq:S,NOTSTORE:"msg threadMsgReq"},g.callback)},m.getMsgsByIdServer=function(g){var b,S,O=this;(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"getMsgsByIdServer",done:g.done});var I=this,R="msg::getMsgsByIdServer";c.verifyCallback(g,"done",R),(!i(g.reqMsgs)||g.reqMsgs.length===0||g.reqMsgs.length>100)&&c.onParamError("reqMsgs应该是数组且数据长度应大于0小于等于100",R),g.reqMsgs=s(b=g.reqMsgs).call(b,0),n(S=g.reqMsgs).call(S,function(N,F){v.call(I,N,R,"reqMsgs[".concat(F,"]."),!0),N.scene=O.message.sceneMap[N.scene]}),this.processCallback(g),this.sendCmd("getMsgsByIdServer",{reqMsgs:g.reqMsgs},g.callback)},m.addQuickComment=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"addQuickComment",done:g.done}),c.verifyOptions(g,"msg body","msg::addQuickComment"),v.call(this,g.msg,"msg::addQuickComment");var b=new h(g,"msg::addQuickComment");b.from=this.account;var S={scene:this.message.sceneMap[g.msg.scene],from:g.msg.from,to:g.msg.to,time:g.msg.time,idServer:g.msg.idServer,idClient:g.msg.idClient};this.processCallback(g),this.sendCmd("addQuickComment",{msg:S,comment:b},g.callback)},m.deleteQuickComment=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"deleteQuickComment",done:g.done}),c.verifyOptions(g,"msg body","msg::deleteQuickComment"),v.call(this,g.msg,"msg::deleteQuickComment");var b=new h(g,"msg::addQuickComment");b.from=this.account;var S={scene:this.message.sceneMap[g.msg.scene],from:g.msg.from,to:g.msg.to,time:g.msg.time,idServer:g.msg.idServer,idClient:g.msg.idClient};this.processCallback(g),this.sendCmd("deleteQuickComment",{msg:S,comment:b},g.callback)},m.getQuickComments=function(g){var b=this;(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"getQuickComments",done:g.done});var S="msg::getQuickComments",O=this,I={},R={};c.verifyOptions(g,"msgs","msg::getQuickComments"),(!i(g.msgs)||g.msgs.length===0||g.msgs.length>20)&&c.onParamError("msgs应该是数组且数据长度应大于0小于等于20",S);var N=[];try{N=JSON.parse(u(g.msgs))}catch{c.onParamError("msgs 不是合法的对象",S)}n(N).call(N,function(F,P){v.call(O,F,S,"msgs[".concat(P,"]."),!0),F.scene=b.message.sceneMap[F.scene],I[F.idClient]=null,R[F.idClient]=P}),this.processCallback(g),this.getLocalMsgsByIdClients({idClients:p(I),done:function(F,P){var x,L=O.protocol.timetags.sync;!F&&P.msgs&&P.msgs.length&&L&&(n(x=P.msgs).call(x,function(_){I[_.idClient]=_}),N=d(N).call(N,function(_){var C=I[_.idClient];return!C||(C.commentTimetag&&(_.timestamp=C.commentTimetag),!(C.commentTimetag>L))})),O.sendCmd("getQuickComments",{commentReq:N,idMap:I,indexMap:R},g.callback)}})},m.addCollect=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"addCollect",done:g.done}),c.verifyOptions(g,"type data","msg::addCollect");var b=new a(g,"msg::addCollect");this.processCallback(g),this.sendCmd("addCollect",{collect:b},g.callback)},m.deleteCollects=function(g){var b;(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"deleteCollects",done:g.done}),c.verifyOptions(g,"collectList","msg::deleteCollects"),(!i(g.collectList)||g.collectList.length===0||g.collectList.length>100)&&c.onParamError("collectList应该是数组且数据长度应大于0小于等于100","msg::deleteCollects"),n(b=g.collectList).call(b,function(S,O){c.verifyParamType("collectList[".concat(O,"].id"),S.id,"string","msg::deleteCollects"),c.verifyParamType("collectList[".concat(O,"].createTime"),S.createTime,"number","msg::deleteCollects")}),this.processCallback(g),this.sendCmd("deleteCollects",{collectList:g.collectList},g.callback)},m.updateCollect=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"updateCollect",done:g.done}),c.verifyOptions(g,"collect","msg::updateCollect"),c.verifyParamType("collect.id",g.collect.id,"string","msg::updateCollect"),c.verifyParamType("collect.createTime",g.collect.createTime,"number","msg::updateCollect"),this.processCallback(g),this.sendCmd("updateCollect",{collect:g.collect},g.callback)},m.getCollects=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"getCollects",done:g.done}),c.verifyCallback(g,"done","msg::getCollects");var b={},S=["type","beginTime","endTime","limit"];n(S).call(S,function(O){y(g[O])&&(c.verifyParamType(O,g[O],"number","msg::getCollects"),b[O]=g[O])}),g.limit>100&&c.onParamError("limit不能大于100","msg::getCollects"),g.beginTime>g.endTime&&c.onParamError("beginTime不能大于endTime","msg::getCollects"),y(g.lastId)&&(c.verifyParamType("lastId",g.lastId,"string","msg::getCollects"),b.lastMsgId=g.lastId),y(r(g))&&(b.reverse=r(g)===!0?1:0),this.processCallback(g),this.sendCmd("getCollects",{collectQuery:b,NOTSTORE:"collectQuery"},g.callback)},m.addStickTopSession=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"addStickTopSession",done:g.done}),c.verifyOptions(g,"id","msg::addStickTopSession");var b=c.getIdArray(g.id);c.verifyParamValid("id的前半部分",b[0],this.message.validScenes,"msg::addStickTopSession"),c.verifyParamType("id的后半部分",b[1],"string","msg::addStickTopSession"),b[0]==="superTeam"&&(b[0]="super_team");var S={id:b=b.join("|")};g.topCustom&&(c.verifyParamType("topCustom",g.topCustom,"string","msg::addStickTopSession"),S.topCustom=g.topCustom),this.processCallback(g),this.sendCmd("addStickTopSession",{stickTopSession:S},g.callback)},m.deleteStickTopSession=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"deleteStickTopSession",done:g.done}),c.verifyOptions(g,"id","msg::deleteStickTopSession");var b=c.getIdArray(g.id);c.verifyParamValid("id的前半部分",b[0],this.message.validScenes,"msg::deleteStickTopSession"),c.verifyParamType("id的后半部分",b[1],"string","msg::deleteStickTopSession"),b[0]==="superTeam"&&(b[0]="super_team"),b=b.join("|"),this.processCallback(g),this.sendCmd("deleteStickTopSession",{stickTopSession:{id:b}},g.callback)},m.updateStickTopSession=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"updateStickTopSession",done:g.done}),c.verifyOptions(g,"id","msg::updateStickTopSession");var b=c.getIdArray(g.id);c.verifyParamValid("id的前半部分",b[0],this.message.validScenes,"msg::updateStickTopSession"),c.verifyParamType("id的后半部分",b[1],"string","msg::updateStickTopSession"),b[0]==="superTeam"&&(b[0]="super_team");var S={id:b=b.join("|")};g.topCustom&&(c.verifyParamType("topCustom",g.topCustom,"string","msg::updateStickTopSession"),S.topCustom=g.topCustom),this.processCallback(g),this.sendCmd("updateStickTopSession",{stickTopSession:S},g.callback)},m.getStickTopSessions=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"getStickTopSessions",done:g.done}),c.verifyOptions(g,"done","msg::getStickTopSessions"),this.processCallback(g);var b,S=this.protocol.sessionSet,O=[];for(var I in S)(b=this.protocol.getSessionInCache(I,g.findDelete))&&b.isTop&&O.push(S[I]);g.callback(null,O)},m.addMsgPin=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"addMsgPin",done:g.done}),c.verifyOptions(g,"msg","msg::addMsgPin"),v.call(this,g.msg,"msg::addMsgPin");var b={pinFrom:this.account};y(g.pinCustom)&&(c.verifyParamType("pinCustom",g.pinCustom,"string","msg::addMsgPin"),b.pinCustom=g.pinCustom);var S={scene:this.message.sceneMap[g.msg.scene],from:g.msg.from,to:g.msg.to,time:g.msg.time,idServer:g.msg.idServer,idClient:g.msg.idClient};this.processCallback(g),this.sendCmd("addMsgPin",{msg:S,pinTag:b},g.callback)},m.updateMsgPin=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"updateMsgPin",done:g.done}),c.verifyOptions(g,"msg","msg::updateMsgPin"),v.call(this,g.msg,"msg::updateMsgPin");var b={pinFrom:this.account};y(g.pinCustom)&&(c.verifyParamType("pinCustom",g.pinCustom,"string","msg::updateMsgPin"),b.pinCustom=g.pinCustom);var S={scene:this.message.sceneMap[g.msg.scene],from:g.msg.from,to:g.msg.to,time:g.msg.time,idServer:g.msg.idServer,idClient:g.msg.idClient};this.processCallback(g),this.sendCmd("updateMsgPin",{msg:S,pinTag:b},g.callback)},m.deleteMsgPin=function(g){(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"deleteMsgPin",done:g.done}),c.verifyOptions(g,"msg","msg::deleteMsgPin"),v.call(this,g.msg,"msg::deleteMsgPin");var b={pinFrom:this.account},S={scene:this.message.sceneMap[g.msg.scene],from:g.msg.from,to:g.msg.to,time:g.msg.time,idServer:g.msg.idServer,idClient:g.msg.idClient};this.processCallback(g),this.sendCmd("deleteMsgPin",{msg:S,pinTag:b},g.callback)},m.getMsgPins=function(g){var b=this;(g=g||{}).done=T({instance:this,className:"NIMFn",funcName:"getMsgPins",done:g.done}),c.verifyOptions(g,"id","msg::getMsgPins");var S=this.db,O=c.getIdArray(g.id);c.verifyParamValid("id的前半部分",O[0],this.message.validScenes,"msg::getMsgPins"),c.verifyParamType("id的后半部分",O[1],"string","msg::getMsgPins"),O[0]==="superTeam"&&(O[0]="super_team");var I={sessionId:O=O.join("|"),timetag:0};if(this.processCallback(g),S.enable){var R=this.protocol.timetags.sync;S.getTimetag("pin-"+g.id).then(function(F){F>R?S.getMsgPins(g.id).then(function(P){return g.callback(null,{pins:P||[]})}).catch(function(P){return g.callback(P)}):(I.timetag=F,N.call(b))})}else N.call(this);function N(){this.sendCmd("getMsgPins",{msgPinReq:I,id:g.id,NOTSTORE:"msgPinReq"},g.callback)}}},function(o,k,e){var r=e(3),i=e(17),s=e(2),n=e(9),u=e(39).fn,p=e(0),d=p.undef,m=p.notundef,c=e(151),h=e(24).reportAPI;u.markSysMsgRead=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"markSysMsgRead",done:a.done});var y,T=this.db,v=r.resolve(),g=this.protocol;p.verifyOptions(a,"sysMsgs","sysmsg::markSysMsgRead");var b=a.sysMsgs;function S(){a.done(y,a)}p.isArray(b)||(b=[b]),T.enable?v=T.markSysMsgRead(b).then(function(O){b=O,g.onUpdateSysMsg(O)}):(b=i(b).call(b,function(O){return!O.read})).length&&(g.options.autoMarkRead||g.markSysMsgRead(b,!0),s(b).call(b,function(O){O.read=!0}),g.onUpdateSysMsg(b)),v.then(function(){return g.reduceSysMsgUnread(b)}).then(S,function(O){y=O,S()})},u.sendCustomSysMsg=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"sendCustomSysMsg",done:a.done}),p.verifyOptions(a,"scene to content","sysmsg::sendCustomSysMsg"),p.verifyParamValid("scene",a.scene,this.message.validScenes,"sysmsg::sendCustomSysMsg"),this.processCallback(a);var y="sendCustomSysMsg";return a.scene==="p2p"?a.type="customP2p":a.scene==="superTeam"?(a.type="customSuperTeam",y="sendSuperTeamCustomSysMsg"):a.type="customTeam",a.sysMsg=new c(a),i(a)&&(y="sendFilterCustomSysMsg"),this.sendCmd(y,{sysMsg:a.sysMsg,single:!0},a.callback),this.formatReturnSysMsg(a.sysMsg)},u.formatReturnSysMsg=function(a){return a=p.copy(a),this.protocol.completeSysMsg(a),a.status="sending",a=n(c).call(c,a)},u.getLocalSysMsgs=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"getLocalSysMsgs",done:a.done});var y,T=this.db,v=[];function g(){a.sysMsgs=v,a.done(y,a)}p.verifyOptions(a),a.category&&p.verifyParamValid("category",a.category,c.validCategories,"sysmsg::getLocalSysMsgs"),a.type&&p.verifyParamValid("type",a.type,c.validTypes,"sysmsg::getLocalSysMsgs"),d(a.limit)&&(a.limit=100),p.verifyParamType("limit",a.limit,"number","sysmsg::getLocalSysMsgs"),p.verifyParamMax("limit",a.limit,100,"sysmsg::getLocalSysMsgs"),m(n(a))?p.verifyParamType("reverse",n(a),"boolean","sysmsg::getLocalSysMsgs"):a.reverse=!1,this.processCallback(a),T.enable?T.getSysMsgs(a).then(function(b){v=b,g()},function(b){y=b,g()}):g()},u.updateLocalSysMsg=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"updateLocalSysMsg",done:a.done});var y,T=this.db,v=null;if(p.verifyOptions(a,"idServer","sysmsg::updateLocalSysMsg"),this.processCallback(a),T.enable){var g=p.filterObj(a,"idServer state localCustom");T.updateSysMsg(g).then(function(S){v=S,b()},function(S){y=S,b()})}else b();function b(){a.sysMsg=v,a.done(y,a)}},u.deleteLocalSysMsg=function(a){(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"deleteLocalSysMsg",done:a.done});var y,T=this.db;function v(){a.done(y,a)}p.verifyOptions(a,"idServer","sysmsg::deleteLocalSysMsg"),this.processCallback(a),T.enable?T.deleteSysMsg(a.idServer).then(function(){v()},function(g){y=g,v()}):v()},u.deleteAllLocalSysMsgs=function(a){var y;(a=a||{}).done=h({instance:this,className:"NIMFn",funcName:"deleteAllLocalSysMsgs",done:a.done});var T=this,v=T.db;function g(){T.protocol.onUpdateSysMsgUnread({}),a.done(y,a)}T.processCallback(a),v.enable?v.deleteAllSysMsgs().then(function(){g()},function(b){y=b,g()}):g()}},function(o,k,e){var r=e(39).fn,i=e(0),s=e(13),n=e(24).reportAPI;r.getChatroomAddress=function(u){(u=u||{}).done=n({instance:this,className:"NIMFn",funcName:"getChatroomAddress",done:u.done}),i.verifyOptions(u,"chatroomId","chatroom::getChatroomAddress"),u.isWeixinApp=s.isWeixinApp,u.type=s.ipVersion,this.processCallback(u),this.sendCmd("getChatroomAddress",u)}},function(o,k){},function(o,k){},function(o,k,e){var r=e(39).fn,i=e(0),s=e(24).reportAPI;r.audioToText=function(n){(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"audioToText",done:n.done}),i.verifyOptions(n,"url","audio::audioToText"),n.audioToText=i.filterObj(n,"url"),this.processCallback(n),this.sendCmd("audioToText",n)}},function(o,k,e){var r=e(39).fn;r.clearDB=function(i){var s=this.db;this.processCallback(i);var n=i.done;s.enable?s.clear().then(n,n):n()},r.removeDB=function(i){var s=this.db;this.processCallback(i);var n=i.done;s.enable?s.destroy().then(n,n):n()},r.closeDB=function(i){var s=this.db;this.processCallback(i);var n=i.done;s.enable?s.close().then(n,n):n()}},function(o,k,e){var r=e(39).fn,i=e(309),s=e(0),n=s.undef,u=e(24).reportAPI;r.getPushNotificationMultiportConfig=function(){return u({instance:this,className:"NIMFn",funcName:"getPushNotificationMultiportConfig",hasCallback:!1}),this.protocol.getPushNotificationMultiportConfig()},r.updatePushNotificationMultiportConfig=function(p){(p=p||{}).done=u({instance:this,className:"NIMFn",funcName:"updatePushNotificationMultiportConfig",done:p.done}),s.verifyOptions(p),n(p.shouldPushNotificationWhenPCOnline)&&(p.shouldPushNotificationWhenPCOnline=!0),p.donnop=new i(p),this.processCallback(p),this.sendCmd("updateDonnop",p)}},function(o,k,e){var r=e(2),i=e(3),s=e(7),n=e(26),u=e(39).fn,p=e(0),d=e(875),m=e(876),c=e(24).reportAPI;function h(a){return n(a)==="object"&&(a.msgEventSubscribes?a=a.msgEventSubscribes:a.msgEventSubscribe?a=a.msgEventSubscribe:a.accounts?a=a.accounts:a.msgEvent&&(a=a.msgEvent).time&&(a.time=+a.time),a.sync===1?a.sync=!0:a.sync===0&&(a.sync=!1)),a}u.batchSendEventsCmds=function(a,y,T){var v=this,g=p.dropArrayDuplicates(y.accounts);g=p.reshape2d(g,100);var b=[];r(g).call(g,function(S){b.push(new i(function(O,I){var R=p.simpleClone(y);R.accounts=S,v.sendCmdWithResp(a,R,function(N,F){N?I(N):O(h(F))})}))}),i.all(b).then(function(S){var O=null;if(S.length>0)if(S[0].msgEventSubscribe){var I=S[0].msgEventSubscribe;I=h(I);var R=[];r(S).call(S,function(N){R=s(R).call(R,N.accounts)}),O={accounts:R,msgEventSubscribe:I}}else O=[],r(S).call(S,function(N){O=s(O).call(O,N)});T(null,O)},function(S){T(S,null)})},u.publishEvent=function(a){(a=a||{}).done=c({instance:this,className:"NIMFn",funcName:"publishEvent",done:a.done});var y=new d(a);y=y.assembleEvent(),this.processCallback(a),this.sendCmdWithResp("publishEvent",{msgEvent:y},function(T,v){T||(v=h(v)),a.callback(T,v)})},u.subscribeEvent=function(a){(a=a||{}).done=c({instance:this,className:"NIMFn",funcName:"subscribeEvent",done:a.done}),p.verifyOptions(a,"accounts","event::subscribeEvent");var y=new m(a);p.verifyParamType("accounts",a.accounts,"array","event::subscribeEvent"),this.processCallback(a),y=y.assembleEvent(),this.batchSendEventsCmds("subscribeEvent",{msgEventSubscribe:y,accounts:a.accounts},function(T,v){!T&&v&&(v={failedAccounts:v}),a.callback(T,v)})},u.unSubscribeEventsByAccounts=function(a){(a=a||{}).done=c({instance:this,className:"NIMFn",funcName:"unSubscribeEventsByAccounts",done:a.done}),p.verifyOptions(a,"accounts","event::unSubscribeEventsByAccounts"),p.verifyParamType("accounts",a.accounts,"array","event::unSubscribeEventsByAccounts");var y=new m(a);y=y.assembleEvent(),this.processCallback(a),this.batchSendEventsCmds("unSubscribeEventsByAccounts",{msgEventSubscribe:y,accounts:a.accounts},function(T,v){!T&&v&&(v={failedAccounts:v}),a.callback(T,v)})},u.unSubscribeEventsByType=function(a){(a=a||{}).done=c({instance:this,className:"NIMFn",funcName:"unSubscribeEventsByType",done:a.done});var y=new m(a);y=y.assembleEvent(),this.processCallback(a),this.sendCmdWithResp("unSubscribeEventsByType",{msgEventSubscribe:y},function(T,v){a.callback(T,v)})},u.querySubscribeEventsByAccounts=function(a){(a=a||{}).done=c({instance:this,className:"NIMFn",funcName:"querySubscribeEventsByAccounts",done:a.done}),p.verifyOptions(a,"accounts","event::querySubscribeEventsByAccounts"),p.verifyParamType("accounts",a.accounts,"array","event::querySubscribeEventsByAccounts");var y=new m(a);y=y.assembleEvent(),this.processCallback(a),this.batchSendEventsCmds("querySubscribeEventsByAccounts",{msgEventSubscribe:y,accounts:a.accounts},function(T,v){!T&&v&&(v={msgEventSubscribes:v}),a.callback(T,v)})},u.querySubscribeEventsByType=function(a){(a=a||{}).done=c({instance:this,className:"NIMFn",funcName:"querySubscribeEventsByType",done:a.done});var y=new m(a);y=y.assembleEvent(),this.processCallback(a),this.sendCmdWithResp("querySubscribeEventsByType",{msgEventSubscribe:y},function(T,v){T||(v={msgEventSubscribes:h(v)}),a.callback(T,v)})}},function(o,k,e){var r=e(6),i=e(0),s=i.notundef,n=e(40);function u(p){if(i.verifyOptions(p,"type value","event::MsgEvent"),i.verifyParamType("type",p.type,"number","event::MsgEvent"),i.verifyParamType("value",p.value,"number","event::MsgEvent"),this.type=p.type,this.value=p.value,this.idClient=i.guid(),s(p.custom)&&(this.custom=""+p.custom),this.validTime=p.validTime||604800,i.verifyParamType("validTime",this.validTime,"number","event::MsgEvent"),i.verifyParamMin("validTime",this.validTime,60,"event::MsgEvent"),i.verifyParamMax("validTime",this.validTime,604800,"event::MsgEvent"),s(p.broadcastType)){var d;if(i.verifyParamType("broadcastType",p.broadcastType,"number","event::MsgEvent"),r(d=[1,2]).call(d,p.broadcastType)<0)throw new n('参数错误"broadcastType":只能为1或2');this.broadcastType=p.broadcastType}else this.broadcastType=2;s(p.sync)?(i.verifyParamType("sync",p.sync,"boolean","event::MsgEvent"),this.sync=p.sync):this.sync=!1}u.prototype.assembleEvent=function(){return{type:this.type,value:this.value,idClient:this.idClient,custom:this.custom||"",validTime:this.validTime,broadcastType:this.broadcastType,sync:this.sync===!0?1:0}},o.exports=u},function(o,k,e){var r=e(0),i=r.notundef;function s(n){r.verifyOptions(n,"type","event::MsgEventSubscribe"),r.verifyParamType("type",n.type,"number","event::MsgEventSubscribe"),r.findObjIndexInArray([1,2,3],n.type)<0&&r.verifyParamMin("type",n.type,1e5,"event::MsgEventSubscribe"),this.type=n.type,i(n.subscribeTime)?(r.verifyParamType("subscribeTime",n.subscribeTime,"number","event::MsgEventSubscribe"),r.verifyParamMin("subscribeTime",n.subscribeTime,60,"event::MsgEventSubscribe"),r.verifyParamMax("subscribeTime",n.subscribeTime,2592e3,"event::MsgEventSubscribe"),this.subscribeTime=n.subscribeTime):this.subscribeTime=2592e3,i(n.sync)?(r.verifyParamType("sync",n.sync,"boolean","event::MsgEventSubscribe"),this.sync=n.sync):this.sync=!0}s.prototype.assembleEvent=function(){return{type:this.type,subscribeTime:this.subscribeTime,sync:this.sync===!0?1:0}},o.exports=s},function(o,k,e){var r=e(41),i=e(39).fn,s=e(0),n=e(24).reportAPI;i.httpRequestProxy=function(u){(u=u||{}).done=n({instance:this,className:"NIMFn",funcName:"httpRequestProxy",done:u.done}),s.verifyOptions(u,"path","misc::httpRequestProxy");var p=r({},u);delete p.done,this.processCallback(u),this.sendCmd("httpProxy",{proxyTag:p},u.callback)}},function(o,k,e){var r=e(39).fn,i=e(13),s=e(24).reportAPI;r.getQChatAddress=function(n){(n=n||{}).done=s({instance:this,className:"NIMFn",funcName:"getQChatAddress",done:n.done}),this.processCallback(n),this.sendCmd("getQChatAddress",{getQChatAddressTag:{ipType:i.ipVersion}},n.done)}},function(o,k,e){e(298);var r=e(194);e(310)(r),o.exports=r},function(o,k,e){var r=e(313),i=e(15),s=e(3),n=e(56),u=e(7),p=e(23),d=e(195).fn,m=e(13),c=e(155).V2NIMConnectStatus;d.connect=function(){if(this.checkNetworkAvailable()===!1&&this.autoconnect)return this.logger.info("connect::skip this reconnection attempt because network is offline"),void this.reconnect();m.isBrowser&&this.reporter.restore(),r(d).connect.call(this)},d.refreshSocketUrl=function(){var h;return this.socketUrlsBackup=this.socketUrlsBackup||[],this.socketUrls=i(h=this.socketUrlsBackup).call(h,0),this.logger.info("link::refreshSocketUrl"),this.statusProtector.emit("auth/loginLifeCycleAddressing"),s.resolve(this.socketUrls)},d.onHandshakeFailed=function(h,a){var y;this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options&&this.options.chatroomId,serverIps:this.options&&this.options.chatroomAddresses&&this.options.chatroomAddresses.join(","),currentServerIp:a,rt:n()-h,result:408,failReason:"ws_handshake_failed",time:n()}),this.logger.warn(u(y="link::onHandshakeFailed: shandshake failed, startTime: ".concat(h,", targetUrl: ")).call(y,a))},d.onConnectFailed=function(h,a,y){var T,v,g=typeof h=="string"?"connect_failed:".concat(h):"connect_failed";this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options&&this.options.chatroomId,serverIps:this.options&&this.options.chatroomAddresses&&this.options.chatroomAddresses.join(","),currentServerIp:y,rt:n()-a,result:408,failReason:"ws_".concat(g),time:n()}),this.logger.warn(u(T=u(v="link::onConnectFailed: connect failed due to ".concat(h,", startTime: ")).call(v,a,", targetUrl: ")).call(T,y))},d.onSocketError=function(h,a,y){var T,v,g=typeof h=="string"?"socket.io error:".concat(h):"socket.io error";this.reporter.report("chatroomLogin",{accid:this.account,roomId:this.options&&this.options.chatroomId,serverIps:this.options&&this.options.chatroomAddresses&&this.options.chatroomAddresses.join(","),currentServerIp:y,rt:n()-a,result:408,failReason:"ws_".concat(g),time:n()}),this.logger.warn(u(T=u(v="link::onSocketError: due to ".concat(h,", startTime: ")).call(v,a,", targetUrl: ")).call(T,y))},d.notifyDisconnect=function(h){r(d).notifyDisconnect.call(this,h)},d.disconnect=function(){var h=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(){};if(this.isConnected())return this.sendCmd("logout"),void p(function(){r(d).disconnect.call(h,a)},0);this.connecting?this.logger.warn("ChatroomProtocolFn api disconnect:: connecting but exiting"):this.statusProtector.getConnectStatus()!==c.V2NIM_CONNECT_STATUS_DISCONNECTED?this.logger.warn("ChatroomProtocolFn api disconnect:: has tried to disconnect actively"):this.logger.warn("ChatroomProtocolFn api disconnect:: other logic entered");var y=r(d);y.disconnect.call(this,a)}},function(o,k,e){var r=e(102),i=e(57),s=e(103),n=e(10),u=e(56),p=e(3),d=e(25),m=e(5),c=e(58),h=e(17),a=e(59),y=e(2),T=e(60),v=e(61),g=e(47);function b(F,P){var x=m(F);if(c){var L=c(F);P&&(L=h(L).call(L,function(_){return a(F,_).enumerable})),x.push.apply(x,L)}return x}function S(F){for(var P=1;P<arguments.length;P++){var x,L,_=arguments[P]!=null?arguments[P]:{};P%2?y(x=b(Object(_),!0)).call(x,function(C){i(F,C,_[C])}):T?v(F,T(_)):y(L=b(Object(_))).call(L,function(C){g(F,C,a(_,C))})}return F}var O=e(195).fn,I=e(44),R=e(0);function N(F){var P=this;if(F.code===398)return this.logger.warn("pendingLoginFailed:398 try to reconnect socket link，backoff set min 5s"),P.forceDisconnect(),P.backoff.setMin(5e3),void(P.retryCount===0?P.refreshSocketUrl():p.resolve()).then(function(){var x;P.reconnect({allFailedCB:d(x=function(L){this.logger.error("pendingLoginFailed: ",L.code,L),this.onAuthError(L,"link::onLoginReconnectFailed")}).call(x,P,F)})});this.logger.error("pendingLoginFailed: ",F.code,F),P.onAuthError(F,"link::onLogin")}O.assembleLogin=function(){var F=this.options;this.sdkSession=this.genSessionKey();var P={appKey:F.appKey,account:F.account,deviceId:I.deviceId,chatroomId:F.chatroomId,session:this.sdkSession,appLogin:this.autoconnect?1:0},x=!0;if(F.loc_x===void 0||F.loc_y===void 0||F.loc_z===void 0?x=!1:(typeof F.loc_x!="number"&&(F.loc_x=0),typeof F.loc_y!="number"&&(F.loc_y=0),typeof F.loc_z!="number"&&(F.loc_z=0)),F.authType=F.loginAuthType,P=R.merge(P,R.filterObj(F,x?"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous notifyTargetTags loginAuthType loginExt loc_x loc_y loc_z distance antiSpamBusinessId":"chatroomNick chatroomAvatar chatroomCustom chatroomEnterCustom isAnonymous notifyTargetTags loginAuthType loginExt distance antiSpamBusinessId")),F.tags&&F.tags.length>0)try{P.tags=n(F.tags)}catch(L){this.logger.error("assembleLogin::format tags error",F.tags,L)}return{type:1,login:P,imLogin:this.assembleIMLogin()}},O.login=s(r.mark(function F(){var P,x,L,_=this;return r.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return P=this,C.next=3,P.assembleLogin();case 3:if(x=C.sent,!(L=this.socket&&this.socket.socket&&this.socket.socket.sessionid)){C.next=13;break}if(this.socketIds||(this.socketIds={}),!this.socketIds[L]){C.next=10;break}return this.logger.warn("onConnect::repeat login",L),C.abrupt("return");case 10:this.socketIds[L]=!0,C.next=14;break;case 13:this.logger.warn("onConnect:: no socketId ",this.socket&&this.socket.socket);case 14:this.logger.warn("link::doLogin: "+L+" appLogin is "+x.login.appLogin),P.createLoginTime=u(),P.sendCmd("login",S({},x),function(A,M){if(A)P.reporter.report("chatroomLogin",{accid:P.account,roomId:P.options&&P.options.chatroomId,serverIps:P.options&&P.options.chatroomAddresses&&P.options.chatroomAddresses.join(","),currentServerIp:P.url,rt:u()-P.createLoginTime,result:A?A.code:408,failReason:A?A.message:"",time:u()}),N.call(P,A),P.statusProtector.emit("auth/loginLifeCycleLoginFail",A);else if(P.reporter.report("chatroomLogin",{accid:P.account,roomId:P.options&&P.options.chatroomId,serverIps:P.options&&P.options.chatroomAddresses&&P.options.chatroomAddresses.join(","),currentServerIp:P.url,rt:u()-P.createLoginTime,result:200,failReason:"",time:u()}),P.resetReconnectStatus(),_.heartbeatFail=0,_.hasLogin=!0,_.autoconnect=!0,P.startHeartbeat(),P.initOnlineListener(),P.statusProtector.emit("auth/loginLifeCycleLoginSucc"),P.keepNosSafeUrl)P.afterLogin(M);else{var U=[];P.parser.checkObjSafeUrl(M,U,[]),p.all(U).then(function(){P.afterLogin(M)}).catch(function(){P.afterLogin(M)})}});case 17:case"end":return C.stop()}},F,this)})),O.afterLogin=function(F){var P=F.chatroom;this.sendCmd("getNosCdnHost",{}),this.chatroom=P,this.notifyLogin(F)},O.kickedReasons=["","chatroomClosed","managerKick","samePlatformKick","silentlyKick","blacked"],O.kickedMessages=["","聊天室关闭了","被房主或者管理员踢出","不允许同一个帐号在多个地方同时登录","悄悄被踢","被拉黑了"]},function(o,k,e){var r=e(9),i=e(23),s=e(68),n=e(2),u=e(52),p=e(41),d=e(15),m=e(32),c=e(123),h=e(5),a=e(195).fn,y=e(0),T=e(13),v=e(883),g=e(761),b=e(888),S=e(889),O=e(890);a.completeMsg=function(I){I.chatroomId=this.chatroom&&this.chatroom.id,I.from=this.options.account,I.fromClientType="Web",I.time||(I.time=+new Date)},a.amendMsg=function(I){return I},a.onMsg=function(I){var R,N=r(R=this.message).call(R,I.content.msg);if(this.checkMsgUnique(N)){if(N.__handleTime=this.reporterHook.getSafeClock(),N.__receiveTime=I.__receiveTime,y.get(I,"content.msg.__clientExt"))try{N.__clientExt=JSON.parse(I.content.msg.__clientExt)}catch{this.logger.warn("ChatroomProtocolFn:onMsg __clientExt parse failed ".concat(I.content.msg.__clientExt))}this.msgBuffer.push(N),this.msgFlushTimer||this.startMsgFlushTimer(),I&&I.content&&I.content.msg&&I.content.msg.needHighPriorityMsgAck==="1"&&this.sendCmd("sendChatroomMsgAck",{chatRoomMsgAckTag:{idClient:N.idClient,chatroomId:N.chatroomId}})}else this.logger.warn("onMsg::msg::repeat",N.idClient)},a.startMsgFlushTimer=function(){var I=this,R=I.options;I.msgFlushTimer=i(function(){var N,F=s(N=I.msgBuffer).call(N,0,R.msgBufferSize);if(T.isBrowser){var P=I.reporterHook.getSafeClock();n(F).call(F,function(x){if(x.flow!=="out"){var L={msgId:x.idServer,clientId:x.idClient,receiveTime:I.reporterHook.getNTPTime(x.__receiveTime),serverTime:x.time,callbackTime:I.reporterHook.getNTPTime(P),preHandleTime:I.reporterHook.getNTPTime(x.__handleTime),fromAccid:x.from,toAccid:I.options.account,type:4,tid:"",roomId:x.chatroomId,result:200,failReason:"",rt:u(P-x.__receiveTime)},_=y.get(x,"__clientExt.statistics.apiCallingTime"),C=y.get(x,"__clientExt.statistics.sendTime");_&&C&&(L.apiCallingTime=_,L.sendTime=C,L.attachUploadDuration=y.get(x,"__clientExt.statistics.attachUploadDuration")||0),I.reporter&&I.reporter.report("msgReceive",L)}delete x.__handleTime,delete x.__receiveTime,delete x.__clientExt})}I.options.onmsgs(F),I.msgBuffer.length?I.startMsgFlushTimer():delete I.msgFlushTimer},R.msgBufferInterval)},a.checkMsgUnique=y.genCheckUniqueFunc("idClient"),a.onSendMsg=function(I){var R,N=I.obj.msg;I.error?N.status="fail":(N=I.content.msg).status="success",p(N,I.obj.msg),N=r(R=this.message).call(R,N),this.checkMsgUnique(N),I.obj=N},a.onHistoryMsgs=function(I){I.error||(I.obj||(I.obj={}),I.obj.msgs=this.message.reverseMsgs(I.content.msgs))},a.onCdnMsgInfo=function(I){if(I){I.cdnUrls&&(I.cdnUrls=I.cdnUrls.split("|")),I.interval&&(I.interval=1e3*u(I.interval)),I.timeout&&(I.timeout=+I.timeout),I.enable&&(I.enable=+I.enable),I.timestamp&&(I.timestamp=+I.timestamp,this.correctCdnTime(I.timestamp));var R=!this.cdnInfo.enable&&I.enable;p(this.cdnInfo,I),R&&this.queryCdnMsgs()}},a.correctCdnTime=function(I){I&&typeof I=="number"&&(this.cdnInfo||(this.cdnInfo={}),this.cdnInfo.timestamp=I,this.cdnInfo.localTime=+new Date,this.cdnInfo.lastNow=null,this.logger.info("correctCdnTime: timestamp, localTime",I,this.cdnInfo.localTime,new Date(I),new Date(this.cdnInfo.localTime)))},a.queryCdnMsgs=function(I){var R,N=this;if(this.cdnInfo&&this.cdnInfo.enable&&this.isConnected()){this.queryCdnTimer=i(function(){return N.queryCdnMsgs()},this.cdnInfo.interval);var F=+new Date;if(F=F-this.cdnInfo.localTime+this.cdnInfo.timestamp,F-=F%this.cdnInfo.interval,this.cdnInfo.lastNow!==F&&this.cdnInfo.cdnUrls&&this.cdnInfo.cdnUrls.length){this.cdnInfo.cdnUrls.push(this.cdnInfo.cdnUrls.shift());var P=this,x=this.cdnInfo.decryptKey,L=this.cdnInfo.timeout||Math.ceil(this.cdnInfo.interval/2),_=d(R=this.cdnInfo.cdnUrls).call(R,0);I=I||0,function C(){if(I>=3)return void P.finalFail++;if(_.length){var A=_.shift().replace("#time",F),M=A.split("/")[2],U=+new Date;P.adaptersRequest(A,{timeout:L,onload:function(E){if(P.cdnInfo.lastNow>F)P.logger.warn("queryCdnMsgs::doQuery cdnInfo.lastNow > now, will throw data ",P.cdnInfo.lastNow,F,E);else{P.cdnInfo.lastNow=F,P.afterQueryCdn(M,+new Date-U,!0);try{E=JSON.parse(E)}catch(Y){P.logger.warn("queryCdnMsgs::doQuery::onload parse res error: ",Y)}if(E&&E.data){E.ptm&&(P.cdnInfo.timeout=E.ptm),E.pis&&(P.cdnInfo.interval=1e3*E.pis);var z,$,X=E.e===!0?(z=E.data,$=x,v.decrypt(z,g.parse($),{mode:b,padding:S}).toString(O)):E.data;P.onCdnMsgsSmoothly(X,F,1e3*E.c)}}},onerror:function(E){if(I++,P.afterQueryCdn(M,+new Date-U,!1),E.status===404){var z;try{var $=JSON.parse(E.result);$.code===404&&$.timestamp&&(z=$.timestamp)}catch(X){P.logger.warn("queryCdnMsgs::doQuery::parse 404 result error",X,E)}!z&&E.date&&(z=+new Date(E.date)),z&&(P.correctCdnTime(z),clearTimeout(P.queryCdnTimer),P.queryCdnMsgs(I))}else C()}},{exception_service:8})}}()}}},a.onCdnMsgsSmoothly=function(I,R,N){try{I=JSON.parse(I)}catch(_){this.logger.warn("onCdnMsgsSmoothly::JSON.parse error",_)}if(this.logger.info("receive cdn msgs "+I.length+" and request time is "+new Date(R)),m(I)&&I.length){var F=this,P=this.options.msgBufferInterval,x=Math.ceil(I.length*P/N);L(),clearInterval(F.cdnSmoothTimer),F.cdnSmoothTimer=c(function(){return L()},P)}function L(){if(F.isConnected()){var _=s(I).call(I,0,x);n(_).call(_,function(C){var A=F.parser.syncUnserialize(C,"msg");F.onMsg({content:{msg:A}})}),I.length||clearInterval(F.cdnSmoothTimer)}}},a.resetCdnData=function(){this.cdnData={},this.finalFail=0,this.cdnDataTime=+new Date},a.initCdnData=function(){this.resetCdnData(),y.isFunction(this.options.onCdnRequestData)?(this.options.cdnRequestDataInterval=this.options.cdnRequestDataInterval||3e4,this.afterQueryCdn=function(I,R,N){var F,P=this;this.cdnData[I]||(this.cdnData[I]={success:0,fail:0,sr:0,fr:0,smr:0,fmr:0}),N?(this.cdnData[I].success++,this.cdnData[I].sr+=R,R>this.cdnData[I].smr&&(this.cdnData[I].smr=R)):(this.cdnData[I].fail++,this.cdnData[I].fr+=R,R>this.cdnData[I].fmr&&(this.cdnData[I].fmr=R)),+new Date-this.cdnDataTime<this.options.cdnRequestDataInterval||(n(F=h(this.cdnData)).call(F,function(x){P.cdnData[x].sr=P.cdnData[x].sr/P.cdnData[x].success||0,P.cdnData[x].fr=P.cdnData[x].fr/P.cdnData[x].fail||0}),this.options.onCdnRequestData(p({},this.cdnData),this.finalFail),this.resetCdnData())}):this.afterQueryCdn=function(){}}},function(o,k,e){var r;o.exports=(r=e(89),e(761),e(885),e(762),e(312),function(){var i=r,s=i.lib.BlockCipher,n=i.algo,u=[],p=[],d=[],m=[],c=[],h=[],a=[],y=[],T=[],v=[];(function(){for(var S=[],O=0;O<256;O++)S[O]=O<128?O<<1:O<<1^283;var I=0,R=0;for(O=0;O<256;O++){var N=R^R<<1^R<<2^R<<3^R<<4;N=N>>>8^255&N^99,u[I]=N,p[N]=I;var F=S[I],P=S[F],x=S[P],L=257*S[N]^16843008*N;d[I]=L<<24|L>>>8,m[I]=L<<16|L>>>16,c[I]=L<<8|L>>>24,h[I]=L,L=16843009*x^65537*P^257*F^16843008*I,a[N]=L<<24|L>>>8,y[N]=L<<16|L>>>16,T[N]=L<<8|L>>>24,v[N]=L,I?(I=F^S[S[S[x^F]]],R^=S[S[R]]):I=R=1}})();var g=[0,1,2,4,8,16,32,64,128,27,54],b=n.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var S=this._keyPriorReset=this._key,O=S.words,I=S.sigBytes/4,R=4*((this._nRounds=I+6)+1),N=this._keySchedule=[],F=0;F<R;F++)F<I?N[F]=O[F]:(L=N[F-1],F%I?I>6&&F%I==4&&(L=u[L>>>24]<<24|u[L>>>16&255]<<16|u[L>>>8&255]<<8|u[255&L]):(L=u[(L=L<<8|L>>>24)>>>24]<<24|u[L>>>16&255]<<16|u[L>>>8&255]<<8|u[255&L],L^=g[F/I|0]<<24),N[F]=N[F-I]^L);for(var P=this._invKeySchedule=[],x=0;x<R;x++){if(F=R-x,x%4)var L=N[F];else L=N[F-4];P[x]=x<4||F<=4?L:a[u[L>>>24]]^y[u[L>>>16&255]]^T[u[L>>>8&255]]^v[u[255&L]]}}},encryptBlock:function(S,O){this._doCryptBlock(S,O,this._keySchedule,d,m,c,h,u)},decryptBlock:function(S,O){var I=S[O+1];S[O+1]=S[O+3],S[O+3]=I,this._doCryptBlock(S,O,this._invKeySchedule,a,y,T,v,p),I=S[O+1],S[O+1]=S[O+3],S[O+3]=I},_doCryptBlock:function(S,O,I,R,N,F,P,x){for(var L=this._nRounds,_=S[O]^I[0],C=S[O+1]^I[1],A=S[O+2]^I[2],M=S[O+3]^I[3],U=4,E=1;E<L;E++){var z=R[_>>>24]^N[C>>>16&255]^F[A>>>8&255]^P[255&M]^I[U++],$=R[C>>>24]^N[A>>>16&255]^F[M>>>8&255]^P[255&_]^I[U++],X=R[A>>>24]^N[M>>>16&255]^F[_>>>8&255]^P[255&C]^I[U++],Y=R[M>>>24]^N[_>>>16&255]^F[C>>>8&255]^P[255&A]^I[U++];_=z,C=$,A=X,M=Y}z=(x[_>>>24]<<24|x[C>>>16&255]<<16|x[A>>>8&255]<<8|x[255&M])^I[U++],$=(x[C>>>24]<<24|x[A>>>16&255]<<16|x[M>>>8&255]<<8|x[255&_])^I[U++],X=(x[A>>>24]<<24|x[M>>>16&255]<<16|x[_>>>8&255]<<8|x[255&C])^I[U++],Y=(x[M>>>24]<<24|x[_>>>16&255]<<16|x[C>>>8&255]<<8|x[255&A])^I[U++],S[O]=z,S[O+1]=$,S[O+2]=X,S[O+3]=Y},keySize:8});i.AES=s._createHelper(b)}(),r.AES)},function(o,k){},function(o,k,e){var r;o.exports=(r=e(89),function(i){var s=r,n=s.lib,u=n.WordArray,p=n.Hasher,d=s.algo,m=[];(function(){for(var v=0;v<64;v++)m[v]=4294967296*i.abs(i.sin(v+1))|0})();var c=d.MD5=p.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(v,g){for(var b=0;b<16;b++){var S=g+b,O=v[S];v[S]=16711935&(O<<8|O>>>24)|4278255360&(O<<24|O>>>8)}var I=this._hash.words,R=v[g+0],N=v[g+1],F=v[g+2],P=v[g+3],x=v[g+4],L=v[g+5],_=v[g+6],C=v[g+7],A=v[g+8],M=v[g+9],U=v[g+10],E=v[g+11],z=v[g+12],$=v[g+13],X=v[g+14],Y=v[g+15],W=I[0],ee=I[1],w=I[2],J=I[3];W=h(W,ee,w,J,R,7,m[0]),J=h(J,W,ee,w,N,12,m[1]),w=h(w,J,W,ee,F,17,m[2]),ee=h(ee,w,J,W,P,22,m[3]),W=h(W,ee,w,J,x,7,m[4]),J=h(J,W,ee,w,L,12,m[5]),w=h(w,J,W,ee,_,17,m[6]),ee=h(ee,w,J,W,C,22,m[7]),W=h(W,ee,w,J,A,7,m[8]),J=h(J,W,ee,w,M,12,m[9]),w=h(w,J,W,ee,U,17,m[10]),ee=h(ee,w,J,W,E,22,m[11]),W=h(W,ee,w,J,z,7,m[12]),J=h(J,W,ee,w,$,12,m[13]),w=h(w,J,W,ee,X,17,m[14]),W=a(W,ee=h(ee,w,J,W,Y,22,m[15]),w,J,N,5,m[16]),J=a(J,W,ee,w,_,9,m[17]),w=a(w,J,W,ee,E,14,m[18]),ee=a(ee,w,J,W,R,20,m[19]),W=a(W,ee,w,J,L,5,m[20]),J=a(J,W,ee,w,U,9,m[21]),w=a(w,J,W,ee,Y,14,m[22]),ee=a(ee,w,J,W,x,20,m[23]),W=a(W,ee,w,J,M,5,m[24]),J=a(J,W,ee,w,X,9,m[25]),w=a(w,J,W,ee,P,14,m[26]),ee=a(ee,w,J,W,A,20,m[27]),W=a(W,ee,w,J,$,5,m[28]),J=a(J,W,ee,w,F,9,m[29]),w=a(w,J,W,ee,C,14,m[30]),W=y(W,ee=a(ee,w,J,W,z,20,m[31]),w,J,L,4,m[32]),J=y(J,W,ee,w,A,11,m[33]),w=y(w,J,W,ee,E,16,m[34]),ee=y(ee,w,J,W,X,23,m[35]),W=y(W,ee,w,J,N,4,m[36]),J=y(J,W,ee,w,x,11,m[37]),w=y(w,J,W,ee,C,16,m[38]),ee=y(ee,w,J,W,U,23,m[39]),W=y(W,ee,w,J,$,4,m[40]),J=y(J,W,ee,w,R,11,m[41]),w=y(w,J,W,ee,P,16,m[42]),ee=y(ee,w,J,W,_,23,m[43]),W=y(W,ee,w,J,M,4,m[44]),J=y(J,W,ee,w,z,11,m[45]),w=y(w,J,W,ee,Y,16,m[46]),W=T(W,ee=y(ee,w,J,W,F,23,m[47]),w,J,R,6,m[48]),J=T(J,W,ee,w,C,10,m[49]),w=T(w,J,W,ee,X,15,m[50]),ee=T(ee,w,J,W,L,21,m[51]),W=T(W,ee,w,J,z,6,m[52]),J=T(J,W,ee,w,P,10,m[53]),w=T(w,J,W,ee,U,15,m[54]),ee=T(ee,w,J,W,N,21,m[55]),W=T(W,ee,w,J,A,6,m[56]),J=T(J,W,ee,w,Y,10,m[57]),w=T(w,J,W,ee,_,15,m[58]),ee=T(ee,w,J,W,$,21,m[59]),W=T(W,ee,w,J,x,6,m[60]),J=T(J,W,ee,w,E,10,m[61]),w=T(w,J,W,ee,F,15,m[62]),ee=T(ee,w,J,W,M,21,m[63]),I[0]=I[0]+W|0,I[1]=I[1]+ee|0,I[2]=I[2]+w|0,I[3]=I[3]+J|0},_doFinalize:function(){var v=this._data,g=v.words,b=8*this._nDataBytes,S=8*v.sigBytes;g[S>>>5]|=128<<24-S%32;var O=i.floor(b/4294967296),I=b;g[15+(S+64>>>9<<4)]=16711935&(O<<8|O>>>24)|4278255360&(O<<24|O>>>8),g[14+(S+64>>>9<<4)]=16711935&(I<<8|I>>>24)|4278255360&(I<<24|I>>>8),v.sigBytes=4*(g.length+1),this._process();for(var R=this._hash,N=R.words,F=0;F<4;F++){var P=N[F];N[F]=16711935&(P<<8|P>>>24)|4278255360&(P<<24|P>>>8)}return R},clone:function(){var v=p.clone.call(this);return v._hash=this._hash.clone(),v}});function h(v,g,b,S,O,I,R){var N=v+(g&b|~g&S)+O+R;return(N<<I|N>>>32-I)+g}function a(v,g,b,S,O,I,R){var N=v+(g&S|b&~S)+O+R;return(N<<I|N>>>32-I)+g}function y(v,g,b,S,O,I,R){var N=v+(g^b^S)+O+R;return(N<<I|N>>>32-I)+g}function T(v,g,b,S,O,I,R){var N=v+(b^(g|~S))+O+R;return(N<<I|N>>>32-I)+g}s.MD5=p._createHelper(c),s.HmacMD5=p._createHmacHelper(c)}(Math),r.MD5)},function(o,k,e){var r,i,s,n,u,p,d,m;o.exports=(m=e(89),i=(r=m).lib,s=i.WordArray,n=i.Hasher,u=r.algo,p=[],d=u.SHA1=n.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,h){for(var a=this._hash.words,y=a[0],T=a[1],v=a[2],g=a[3],b=a[4],S=0;S<80;S++){if(S<16)p[S]=0|c[h+S];else{var O=p[S-3]^p[S-8]^p[S-14]^p[S-16];p[S]=O<<1|O>>>31}var I=(y<<5|y>>>27)+b+p[S];I+=S<20?1518500249+(T&v|~T&g):S<40?1859775393+(T^v^g):S<60?(T&v|T&g|v&g)-1894007588:(T^v^g)-899497514,b=g,g=v,v=T<<30|T>>>2,T=y,y=I}a[0]=a[0]+y|0,a[1]=a[1]+T|0,a[2]=a[2]+v|0,a[3]=a[3]+g|0,a[4]=a[4]+b|0},_doFinalize:function(){var c=this._data,h=c.words,a=8*this._nDataBytes,y=8*c.sigBytes;return h[y>>>5]|=128<<24-y%32,h[14+(y+64>>>9<<4)]=Math.floor(a/4294967296),h[15+(y+64>>>9<<4)]=a,c.sigBytes=4*h.length,this._process(),this._hash},clone:function(){var c=n.clone.call(this);return c._hash=this._hash.clone(),c}}),r.SHA1=n._createHelper(d),r.HmacSHA1=n._createHmacHelper(d),m.SHA1)},function(o,k,e){var r,i,s,n;o.exports=(r=e(89),s=(i=r).lib.Base,n=i.enc.Utf8,void(i.algo.HMAC=s.extend({init:function(u,p){u=this._hasher=new u.init,typeof p=="string"&&(p=n.parse(p));var d=u.blockSize,m=4*d;p.sigBytes>m&&(p=u.finalize(p)),p.clamp();for(var c=this._oKey=p.clone(),h=this._iKey=p.clone(),a=c.words,y=h.words,T=0;T<d;T++)a[T]^=1549556828,y[T]^=909522486;c.sigBytes=h.sigBytes=m,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var p=this._hasher,d=p.finalize(u);return p.reset(),p.finalize(this._oKey.clone().concat(d))}})))},function(o,k,e){var r,i;o.exports=(i=e(89),e(312),i.mode.ECB=((r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(s,n){this._cipher.encryptBlock(s,n)}}),r.Decryptor=r.extend({processBlock:function(s,n){this._cipher.decryptBlock(s,n)}}),r),i.mode.ECB)},function(o,k,e){var r;o.exports=(r=e(89),e(312),r.pad.Pkcs7)},function(o,k,e){var r;o.exports=(r=e(89),r.enc.Utf8)},function(o,k,e){var r=e(9),i=e(195).fn,s=e(311);i.onChatroomMembersInfo=i.onChatroomMembers=function(n){n.error||(n.obj.members=s.reverseMembers(n.content.members))},i.onGetChatroomMemberCountByTag=function(n){n.error||(n.obj=n.content)},i.onMarkChatroomMember=function(n){n.error||(n.obj.member=r(s).call(s,n.content.chatroomMember))},i.onSyncRobot=function(n){!n.error&&this.options.onrobots?this.options.onrobots(null,n.content):this.ontions.onrobots(n.error,{})}},function(o,k,e){var r=e(9),i=e(8),s=e(0),n=function(v){this.account=v.account},u=n.prototype,p=u.Message=e(117),d=u.TextMessage=e(893),m=u.FileMessage=e(205),c=u.GeoMessage=e(897),h=u.NotificationMessage=e(898),a=u.CustomMessage=e(899),y=u.TipMessage=e(900),T=u.RobotMessage=e(901);u.validTypes=p.validTypes,u.reverse=function(v){var g;switch(p.getType(v)){case"text":g=r(d).call(d,v);break;case"image":case"audio":case"video":case"file":g=r(m).call(m,v);break;case"geo":g=r(c).call(c,v);break;case"notification":g=r(h).call(h,v);break;case"custom":g=r(a).call(a,v);break;case"tip":g=r(y).call(y,v);break;case"robot":g=r(T).call(T,v);break;default:g=r(p).call(p,v)}return p.setExtra(g,this.account),g},u.reverseMsgs=function(v,g){var b,S,O=this;return i(v).call(v,function(I){return I=r(O).call(O,I),g&&((b=g.modifyObj)&&(I=s.merge(I,b)),S=g.mapper,s.isFunction(S)&&(I=S(I))),I})},o.exports=n},function(o,k,e){var r=e(18),i=e(9),s=e(117),n=e(0);function u(p){n.verifyOptions(p,"text","msg::TextMessage"),p.type="text",s.call(this,p),this.attach=p.text,this.body=""}u.prototype=r(s.prototype),u.reverse=function(p){var d=i(s).call(s,p);return d.text=p.attach,d},o.exports=u},function(o,k,e){var r=e(18),i=e(0),s=e(205);function n(){}n.prototype=r(s.prototype),n.verifyFile=function(u,p){i.verifyOptions(u,"w h",!0,"file.",p)},o.exports=n},function(o,k,e){var r=e(18),i=e(205),s=e(0);function n(){}n.prototype=r(i.prototype),n.verifyFile=function(u,p){s.verifyOptions(u,"dur",!0,"file.",p)},o.exports=n},function(o,k,e){var r=e(18),i=e(205),s=e(0);function n(){}n.prototype=r(i.prototype),n.verifyFile=function(u,p){s.verifyOptions(u,"dur w h",!0,"file.",p)},o.exports=n},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(117),u=e(0);function p(d){d.type="geo",u.verifyOptions(d,"geo","msg::GeoMessage"),u.verifyOptions(d.geo,"lng lat title",!0,"geo.","msg::GeoMessage"),u.verifyParamType("geo.lng",d.geo.lng,"number","msg::GeoMessage"),u.verifyParamType("geo.lat",d.geo.lat,"number","msg::GeoMessage"),u.verifyParamType("geo.title",d.geo.title,"string","msg::GeoMessage"),n.call(this,d),this.attach=r(d.geo)}p.prototype=i(n.prototype),p.reverse=function(d){var m=s(n).call(n,d);return d.attach=d.attach?""+d.attach:"",m.geo=d.attach?JSON.parse(d.attach):{},m},o.exports=p},function(o,k,e){var r=e(18),i=e(9),s=e(52),n=e(0).notundef,u=e(117),p={301:"memberEnter",302:"memberExit",303:"blackMember",304:"unblackMember",305:"gagMember",306:"ungagMember",307:"addManager",308:"removeManager",309:"addCommon",310:"removeCommon",311:"closeChatroom",312:"updateChatroom",313:"kickMember",314:"addTempMute",315:"removeTempMute",316:"updateMemberInfo",317:"updateQueue",318:"muteRoom",319:"unmuteRoom",320:"batchUpdateQueue",321:"addTempMuteTag",322:"removeTempMuteTag",324:"batchQueueOffer",323:"deleteChatroomMsg",325:"updateChatroomTags"};function d(){}d.prototype=r(u.prototype),d.reverse=function(m){var c=i(u).call(u,m);if(m.attach=m.attach?""+m.attach:"",m.attach){var h=JSON.parse(m.attach);if(c.attach={type:p[h.id]},n(h.data)){var a=h.data;if(n(a.operator)&&(c.attach.from=a.operator),n(a.opeNick)&&(c.attach.fromNick=a.opeNick),n(a.target)&&(c.attach.to=a.target),n(a.tarNick)&&(c.attach.toNick=a.tarNick),n(a.muteDuration)&&(c.attach.duration=s(a.muteDuration,10)),n(a.tags)&&(c.attach.tags=a.tags),c.attach.type==="memberEnter"&&(n(a.muted)?c.attach.gaged=+a.muted==1:c.attach.gaged=!1,n(a.tempMuted)?c.attach.tempMuted=+a.tempMuted==1:c.attach.tempMuted=!1,n(a.muteTtl)?c.attach.tempMuteDuration=+a.muteTtl:c.attach.tempMuteDuration=0),c.attach.type==="deleteChatroomMsg"&&(c.attach.msgId=a.msgId,c.attach.msgTime=a.msgTime),n(a.ext)&&(c.attach.custom=a.ext),n(a.queueChange)){var y=JSON.parse(a.queueChange);switch(y._e){case"OFFER":c.attach.queueChange={type:"OFFER",elementKey:y.key,elementValue:y.content};break;case"POLL":c.attach.queueChange={type:"POLL",elementKey:y.key,elementValue:y.content};break;case"DROP":c.attach.queueChange={type:"DROP"};break;case"PARTCLEAR":case"BATCH_UPDATE":c.attach.queueChange={type:y._e,elementKv:y.kvObject};break;case"BATCH_OFFER":c.attach.queueChange={type:y._e,elements:y.elements}}}}}else c.attach={};return c},o.exports=d},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(117),u=e(0);function p(d){u.verifyOptions(d,"content","msg::CustomMessage"),d.type="custom",n.call(this,d),typeof d.content!="string"&&(d.content=r(d.content)),this.attach=d.content}p.prototype=i(n.prototype),p.reverse=function(d){var m=s(n).call(n,d);return m.content=d.attach,m},o.exports=p},function(o,k,e){var r=e(18),i=e(9),s=e(117),n=e(0);function u(p){n.verifyOptions(p,"tip","msg::TipMessage"),p.type="tip",s.call(this,p),this.attach=p.tip}u.prototype=r(s.prototype),u.reverse=function(p){var d=i(s).call(s,p);return d.tip=p.attach,d},o.exports=u},function(o,k,e){var r=e(10),i=e(18),s=e(9),n=e(8),u=e(117),p=e(0),d={welcome:"00",text:"01",link:"03"},m={"01":"text","02":"image","03":"answer",11:"template"};function c(h){p.verifyOptions(h,"content","msg::RobotMessage");var a=h.content;switch(a.type){case"welcome":p.undef(h.body)&&(this.body="欢迎消息");break;case"text":p.verifyOptions(a,"content","msg::RobotMessage"),p.undef(h.body)&&(this.body=a.content);break;case"link":p.verifyOptions(a,"target","msg::RobotMessage")}a.type&&(a.type=d[a.type]),a={param:a,robotAccid:h.robotAccid},this.attach=r(a),h.type="robot",u.call(this,h)}c.prototype=i(u.prototype),c.reverse=function(h){var a=s(u).call(u,h);if(a.type==="robot"){var y=JSON.parse(h.attach);if(y.param&&(y.param.type=m[y.param.type]||"unknown"),y.robotMsg){var T=(y=p.merge(y,y.robotMsg)).message;y.flag==="bot"?y.message=n(T).call(T,function(v){return v.type=m[v.type]||"unknown",v}):y.flag,delete y.robotMsg}a.content=y}return a},o.exports=c},function(o,k,e){var r=e(9),i=e(32),s=e(8),n=e(17),u=e(10),p=e(0),d=p.undef,m=e(194).fn,c=e(24).reportAPI;m.beforeSendMsg=function(a){a.cmd="sendMsg"};var h={text:0,image:1,audio:2,video:3,geo:4,notification:5,file:6,tip:10,robot:11,custom:100};m.getHistoryMsgs=function(a){if((a=a||{}).done=c({instance:this,className:"ChatroomFn",funcName:"getHistoryMsgs",done:a.done}),p.verifyOptions(a),d(a.timetag)?a.timetag=0:p.verifyParamType("timetag",a.timetag,"number","msg::getHistoryMsgs"),d(a.limit)?a.limit=100:p.verifyParamType("limit",a.limit,"number","msg::getHistoryMsgs"),d(r(a))?a.reverse=!1:p.verifyParamType("reverse",r(a),"boolean","msg::getHistoryMsgs"),d(a.msgTypes))a.msgTypes=[];else if(i(a.msgTypes)){var y,T;a.msgTypes=s(y=a.msgTypes).call(y,function(v){return h[v]}),a.msgTypes=n(T=a.msgTypes).call(T,function(v){return typeof v=="number"})}else typeof h[a.msgTypes]=="number"?a.msgTypes=[h[a.msgTypes]]:a.msgTypes=[];this.processCallback(a),this.sendCmd("getHistoryMsgs",a,function(v,g,b){i(b)&&(b=s(b).call(b,function(S){return h[S.type]&&(S.type=h[S.type]),S})),a.callback(v,g,b)})},m.getHistoryMsgsByTags=function(a){if((a=a||{}).done=c({instance:this,className:"ChatroomFn",funcName:"getHistoryMsgsByTags",done:a.done}),p.verifyOptions(a,"tags","api::msg::getHistoryMsgsByTags"),p.verifyParamType("tags",a.tags,"array","api::msg::getHistoryMsgsByTags"),d(a.fromTime)?a.fromTime=0:p.verifyParamType("fromTime",a.fromTime,"number","api::msg::getHistoryMsgsByTags"),d(a.toTime)?a.toTime=0:p.verifyParamType("toTime",a.toTime,"number","api::msg::getHistoryMsgsByTags"),d(a.limit)?a.limit=100:p.verifyParamType("limit",a.limit,"number","msg::getHistoryMsgs"),d(r(a))?a.reverse=0:p.verifyParamType("reverse",r(a),"number","msg::getHistoryMsgs"),d(a.types))a.types=[];else if(i(a.types)){var y,T;a.types=s(y=a.types).call(y,function(v){return h[v]}),a.types=n(T=a.types).call(T,function(v){return typeof v=="number"})}else typeof h[a.types]=="number"?a.types=[h[a.types]]:a.types=[];this.processCallback(a),a.types=u(a.types),a.tags=u(a.tags),this.sendCmd("getHistoryMsgsByTags",{chatRoomTagHistoryMsgRequestTag:a},a.callback)}},function(o,k,e){var r=e(194).fn,i=e(24).reportAPI;r.disconnect=function(s){(s=s||{}).done=i({instance:this,className:"ChatroomFn",funcName:"disconnect",done:s.done}),this.protocol.disconnect(s.done)}},function(o,k,e){var r=e(0),i=r.undef,s=r.verifyOptions,n=r.verifyParamType,u=e(311),p=e(194).fn,d=e(24).reportAPI;p.updateMyChatroomMemberInfo=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"updateMyChatroomMemberInfo",done:m.done}),s(m,"member needNotify","member::updateMyChatroomMemberInfo"),n("needNotify",m.needNotify,"boolean","member::updateMyChatroomMemberInfo"),m.needSave=m.needSave||!1,n("needSave",m.needSave,"boolean","member::updateMyChatroomMemberInfo"),this.processCustom(m),this.processCallback(m),m.chatroomMember=new u(m.member),m.antispamTag={antiSpamBusinessId:m.antiSpamBusinessId},this.sendCmd("updateMyChatroomMemberInfo",m)},p.getChatroomMembers=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"getChatroomMembers",done:m.done}),s(m,"guest","member::getChatroomMembers"),n("guest",m.guest,"boolean","member::getChatroomMembers"),i(m.time)?m.time=0:n("time",m.time,"number","member::getChatroomMembers"),i(m.limit)?m.limit=100:n("limit",m.limit,"number","member::getChatroomMembers"),this.processCallback(m),m.guest?m.type=m.desc===!1?3:1:m.type=m.onlyOnline?2:0,this.sendCmd("getChatroomMembers",m)},p.getChatroomMembersByTag=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"getChatroomMembersByTag",done:m.done}),s(m,"tag","getChatroomMembersByTag::rag"),i(m.time)?m.time=0:n("time",m.time,"number","getChatroomMembersByTag::time"),i(m.limit)?m.limit=100:n("limit",m.limit,"number","getChatroomMembersByTag::limit"),this.processCallback(m),this.sendCmd("getChatroomMembersByTag",{tagMemberReq:r.filterObj(m,"tag limit time"),callback:m.callback})},p.getChatroomMemberCountByTag=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"getChatroomMemberCountByTag",done:m.done}),s(m,"tag","getChatroomMemberCountByTag::rag"),this.processCallback(m),this.sendCmd("getChatroomMemberCountByTag",m)},p.getChatroomMembersInfo=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"getChatroomMembersInfo",done:m.done}),s(m,"accounts","member::getChatroomMembersInfo"),n("accounts",m.accounts,"array","member::getChatroomMembersInfo"),this.processCallback(m),this.sendCmd("getChatroomMembersInfo",m)},p.markChatroomIdentity=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"markChatroomIdentity",done:m.done}),s(m,"identity","member::markChatroomIdentity"),m.type={manager:1,common:2,black:-1,mute:-2}[m.identity],delete m.identity,isNaN(m.type)?s(m,"identity",'member::markChatroomIdentity. The valid value of the identity is "manager" or "common" or "black" or "mute".'):this.markChatroomMember(m)},p.markChatroomManager=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"markChatroomManager",done:m.done}),m.type=1,this.markChatroomMember(m)},p.markChatroomCommonMember=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"markChatroomCommonMember",done:m.done}),m.type=2,this.markChatroomMember(m)},p.markChatroomBlacklist=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"markChatroomBlacklist",done:m.done}),m.type=-1,this.markChatroomMember(m)},p.markChatroomGaglist=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"markChatroomGaglist",done:m.done}),m.type=-2,this.markChatroomMember(m)},p.markChatroomMember=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"markChatroomMember",done:m.done}),s(m,"account type isAdd","member::markChatroomMember"),n("isAdd",m.isAdd,"boolean","member::markChatroomMember"),i(m.level)?m.level=0:n("level",m.level,"number","member::markChatroomMember"),this.processCustom(m),this.processCallback(m),this.sendCmd("markChatroomMember",m)},p.kickChatroomMember=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"kickChatroomMember",done:m.done}),s(m,"account","member::kickChatroomMember"),this.processCustom(m),this.processCallback(m),this.sendCmd("kickChatroomMember",m)},p.updateChatroomMemberTempMute=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"updateChatroomMemberTempMute",done:m.done}),s(m,"account duration needNotify","member::updateChatroomMemberTempMute"),n("duration",m.duration,"number","member::updateChatroomMemberTempMute"),n("needNotify",m.needNotify,"boolean","member::updateChatroomMemberTempMute"),this.processCustom(m),this.processCallback(m),this.sendCmd("updateChatroomMemberTempMute",m)},p.updateTagMembersTempMute=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"updateTagMembersTempMute",done:m.done}),s(m,"tag duration needNotify","member::updateTagMembersTempMute"),n("duration",m.duration,"number","member::updateTagMembersTempMute"),n("needNotify",m.needNotify,"boolean","member::updateTagMembersTempMute"),this.processCustom(m),this.processCallback(m);var c=r.filterObj(m,"tag duration custom notifyTargetTags");c.needNotify=m.needNotify?1:0,this.sendCmd("updateTagMembersTempMute",{tagMuteReq:c,callback:m.callback})},p.updateCoordinate=r.throttle(function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"updateCoordinate",done:m.done});var c=!0;m.x===void 0||m.y===void 0||m.z===void 0?c=!1:(typeof m.x!="number"&&(m.x=0),typeof m.y!="number"&&(m.y=0),typeof m.z!="number"&&(m.z=0)),this.processCallback(m);var h=r.filterObj(m,c?"x y z distance":"distance");this.sendCmd("updateCoordinate",{coordinateReq:h,callback:m.callback})},300,{},function(m){m&&m.done&&m.done({code:416,chatroomId:this.options.chatroomId})}),p.getRobotList=function(m){(m=m||{}).done=d({instance:this,className:"ChatroomFn",funcName:"getRobotList",done:m.done}),this.logger.warn("this api will be abandon"),i(m.timetag)&&(m.timetag=0),this.processCallback(m),this.sendCmd("syncRobot",m)}},function(o,k,e){var r=e(194).fn,i=e(0),s=e(24).reportAPI;r.queueOffer=function(n){(n=n||{}).done=s({instance:this,className:"ChatroomFn",funcName:"queueOffer",done:n.done}),i.verifyOptions(n,"elementKey elementValue","msg::queueOffer");var u={elementKey:n.elementKey,elementValue:n.elementValue,transient:!!n.transient};n.elementAccount&&(u.elementAccount=n.elementAccount),this.processCallback(n),this.sendCmd("queueOffer",u,n.callback)},r.queuePoll=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(n=n||{}).done=s({instance:this,className:"ChatroomFn",funcName:"queuePoll",done:n.done}),n.elementKey=n.elementKey||"",this.processCallback(n),this.sendCmd("queuePoll",n,n.callback)},r.queueList=function(n){(n=n||{}).done=s({instance:this,className:"ChatroomFn",funcName:"queueList",done:n.done}),this.processCallback(n),this.sendCmd("queueList",n,n.callback)},r.peak=function(n){(n=n||{}).done=s({instance:this,className:"ChatroomFn",funcName:"peak",done:n.done}),this.processCallback(n),this.sendCmd("peak",n,n.callback)},r.queueDrop=function(n){(n=n||{}).done=s({instance:this,className:"ChatroomFn",funcName:"queueDrop",done:n.done}),this.processCallback(n),this.sendCmd("queueDrop",n,n.callback)},r.queueChange=function(n){(n=n||{}).done=s({instance:this,className:"ChatroomFn",funcName:"queueChange",done:n.done}),i.verifyOptions(n,"elementMap","msg::queueOffer"),n.needNotify?(n.needNotify=!0,i.verifyOptions(n,"notifyExt","msg::queueOffer")):n.needNotify=!1,this.processCallback(n),this.sendCmd("queueChange",n,n.callback)}},,,function(o,k,e){o.exports=e(909)},function(o,k,e){e(298);var r={NIM:e(763),Chatroom:e(879)};e(310)(r),o.exports=r}])})})(NIM_Web_SDK);var dayjs_minExports={},dayjs_min={get exports(){return dayjs_minExports},set exports(o){dayjs_minExports=o}};(function(o,k){(function(e,r){o.exports=r()})(commonjsGlobal,function(){var e=1e3,r=6e4,i=36e5,s="millisecond",n="second",u="minute",p="hour",d="day",m="week",c="month",h="quarter",a="year",y="date",T="Invalid Date",v=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,b={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],U=A%100;return"["+A+(M[(U-20)%10]||M[U]||M[0])+"]"}},S=function(A,M,U){var E=String(A);return!E||E.length>=M?A:""+Array(M+1-E.length).join(U)+A},O={s:S,z:function(A){var M=-A.utcOffset(),U=Math.abs(M),E=Math.floor(U/60),z=U%60;return(M<=0?"+":"-")+S(E,2,"0")+":"+S(z,2,"0")},m:function A(M,U){if(M.date()<U.date())return-A(U,M);var E=12*(U.year()-M.year())+(U.month()-M.month()),z=M.clone().add(E,c),$=U-z<0,X=M.clone().add(E+($?-1:1),c);return+(-(E+(U-z)/($?z-X:X-z))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:c,y:a,w:m,d,D:y,h:p,m:u,s:n,ms:s,Q:h}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},I="en",R={};R[I]=b;var N="$isDayjsObject",F=function(A){return A instanceof _||!(!A||!A[N])},P=function A(M,U,E){var z;if(!M)return I;if(typeof M=="string"){var $=M.toLowerCase();R[$]&&(z=$),U&&(R[$]=U,z=$);var X=M.split("-");if(!z&&X.length>1)return A(X[0])}else{var Y=M.name;R[Y]=M,z=Y}return!E&&z&&(I=z),z||!E&&I},x=function(A,M){if(F(A))return A.clone();var U=typeof M=="object"?M:{};return U.date=A,U.args=arguments,new _(U)},L=O;L.l=P,L.i=F,L.w=function(A,M){return x(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var _=function(){function A(U){this.$L=P(U.locale,null,!0),this.parse(U),this.$x=this.$x||U.x||{},this[N]=!0}var M=A.prototype;return M.parse=function(U){this.$d=function(E){var z=E.date,$=E.utc;if(z===null)return new Date(NaN);if(L.u(z))return new Date;if(z instanceof Date)return new Date(z);if(typeof z=="string"&&!/Z$/i.test(z)){var X=z.match(v);if(X){var Y=X[2]-1||0,W=(X[7]||"0").substring(0,3);return $?new Date(Date.UTC(X[1],Y,X[3]||1,X[4]||0,X[5]||0,X[6]||0,W)):new Date(X[1],Y,X[3]||1,X[4]||0,X[5]||0,X[6]||0,W)}}return new Date(z)}(U),this.init()},M.init=function(){var U=this.$d;this.$y=U.getFullYear(),this.$M=U.getMonth(),this.$D=U.getDate(),this.$W=U.getDay(),this.$H=U.getHours(),this.$m=U.getMinutes(),this.$s=U.getSeconds(),this.$ms=U.getMilliseconds()},M.$utils=function(){return L},M.isValid=function(){return this.$d.toString()!==T},M.isSame=function(U,E){var z=x(U);return this.startOf(E)<=z&&z<=this.endOf(E)},M.isAfter=function(U,E){return x(U)<this.startOf(E)},M.isBefore=function(U,E){return this.endOf(E)<x(U)},M.$g=function(U,E,z){return L.u(U)?this[E]:this.set(z,U)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(U,E){var z=this,$=!!L.u(E)||E,X=L.p(U),Y=function(G,B){var q=L.w(z.$u?Date.UTC(z.$y,B,G):new Date(z.$y,B,G),z);return $?q:q.endOf(d)},W=function(G,B){return L.w(z.toDate()[G].apply(z.toDate("s"),($?[0,0,0,0]:[23,59,59,999]).slice(B)),z)},ee=this.$W,w=this.$M,J=this.$D,V="set"+(this.$u?"UTC":"");switch(X){case a:return $?Y(1,0):Y(31,11);case c:return $?Y(1,w):Y(0,w+1);case m:var D=this.$locale().weekStart||0,Q=(ee<D?ee+7:ee)-D;return Y($?J-Q:J+(6-Q),w);case d:case y:return W(V+"Hours",0);case p:return W(V+"Minutes",1);case u:return W(V+"Seconds",2);case n:return W(V+"Milliseconds",3);default:return this.clone()}},M.endOf=function(U){return this.startOf(U,!1)},M.$set=function(U,E){var z,$=L.p(U),X="set"+(this.$u?"UTC":""),Y=(z={},z[d]=X+"Date",z[y]=X+"Date",z[c]=X+"Month",z[a]=X+"FullYear",z[p]=X+"Hours",z[u]=X+"Minutes",z[n]=X+"Seconds",z[s]=X+"Milliseconds",z)[$],W=$===d?this.$D+(E-this.$W):E;if($===c||$===a){var ee=this.clone().set(y,1);ee.$d[Y](W),ee.init(),this.$d=ee.set(y,Math.min(this.$D,ee.daysInMonth())).$d}else Y&&this.$d[Y](W);return this.init(),this},M.set=function(U,E){return this.clone().$set(U,E)},M.get=function(U){return this[L.p(U)]()},M.add=function(U,E){var z,$=this;U=Number(U);var X=L.p(E),Y=function(w){var J=x($);return L.w(J.date(J.date()+Math.round(w*U)),$)};if(X===c)return this.set(c,this.$M+U);if(X===a)return this.set(a,this.$y+U);if(X===d)return Y(1);if(X===m)return Y(7);var W=(z={},z[u]=r,z[p]=i,z[n]=e,z)[X]||1,ee=this.$d.getTime()+U*W;return L.w(ee,this)},M.subtract=function(U,E){return this.add(-1*U,E)},M.format=function(U){var E=this,z=this.$locale();if(!this.isValid())return z.invalidDate||T;var $=U||"YYYY-MM-DDTHH:mm:ssZ",X=L.z(this),Y=this.$H,W=this.$m,ee=this.$M,w=z.weekdays,J=z.months,V=z.meridiem,D=function(B,q,H,K){return B&&(B[q]||B(E,$))||H[q].slice(0,K)},Q=function(B){return L.s(Y%12||12,B,"0")},G=V||function(B,q,H){var K=B<12?"AM":"PM";return H?K.toLowerCase():K};return $.replace(g,function(B,q){return q||function(H){switch(H){case"YY":return String(E.$y).slice(-2);case"YYYY":return L.s(E.$y,4,"0");case"M":return ee+1;case"MM":return L.s(ee+1,2,"0");case"MMM":return D(z.monthsShort,ee,J,3);case"MMMM":return D(J,ee);case"D":return E.$D;case"DD":return L.s(E.$D,2,"0");case"d":return String(E.$W);case"dd":return D(z.weekdaysMin,E.$W,w,2);case"ddd":return D(z.weekdaysShort,E.$W,w,3);case"dddd":return w[E.$W];case"H":return String(Y);case"HH":return L.s(Y,2,"0");case"h":return Q(1);case"hh":return Q(2);case"a":return G(Y,W,!0);case"A":return G(Y,W,!1);case"m":return String(W);case"mm":return L.s(W,2,"0");case"s":return String(E.$s);case"ss":return L.s(E.$s,2,"0");case"SSS":return L.s(E.$ms,3,"0");case"Z":return X}return null}(B)||X.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(U,E,z){var $,X=this,Y=L.p(E),W=x(U),ee=(W.utcOffset()-this.utcOffset())*r,w=this-W,J=function(){return L.m(X,W)};switch(Y){case a:$=J()/12;break;case c:$=J();break;case h:$=J()/3;break;case m:$=(w-ee)/6048e5;break;case d:$=(w-ee)/864e5;break;case p:$=w/i;break;case u:$=w/r;break;case n:$=w/e;break;default:$=w}return z?$:L.a($)},M.daysInMonth=function(){return this.endOf(c).$D},M.$locale=function(){return R[this.$L]},M.locale=function(U,E){if(!U)return this.$L;var z=this.clone(),$=P(U,E,!0);return $&&(z.$L=$),z},M.clone=function(){return L.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),C=_.prototype;return x.prototype=C,[["$ms",s],["$s",n],["$m",u],["$H",p],["$W",d],["$M",c],["$y",a],["$D",y]].forEach(function(A){C[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),x.extend=function(A,M){return A.$i||(A(M,_,x),A.$i=!0),x},x.locale=P,x.isDayjs=F,x.unix=function(A){return x(1e3*A)},x.en=R[I],x.Ls=R,x.p={},x})})(dayjs_min);const dayjs=dayjs_minExports,lottery_vue_vue_type_style_index_0_scoped_66d26d58_lang="",_withScopeId$1=o=>(pushScopeId("data-v-66d26d58"),o=o(),popScopeId(),o),_hoisted_1$2={class:"lottery"},_hoisted_2$2={class:"block-box"},_hoisted_3$1={class:"blocks flex"},_hoisted_4$1=_withScopeId$1(()=>createBaseVNode("span",null,"START",-1)),_hoisted_5$1=[_hoisted_4$1],_hoisted_6$1=["src"],_sfc_main$2={__name:"lottery",setup(o){const k=ref("");ref([]);const e=ref(!1),r=ref(""),i=ref([]),s=computed(()=>[i.value[0],i.value[1],i.value[2],i.value[4],i.value[7],i.value[6],i.value[5],i.value[3]]),n=computed(()=>{const p=[...i.value];return p.length?(p.splice(4,0,"start"),p):[]});ref(!1),ref(!1),useMyFetch("/api/choujiang/list",{immediate:!0,afterFetch:p=>{i.value=p.data.data.lottery_data,k.value=p.data.data.period}}).post(()=>({period:k.value}));function u(){e.value||(e.value=!0,useMyFetch("/api/choujiang/getRewards",{immediate:!0,afterFetch:async p=>{if(checkFetchError(p)){e.value=!1;return}const d=p.data.data.info;let m=s.value.findIndex(a=>a.name==d)+5*8,c=0;const{pause:h}=useIntervalFn(async()=>{m--==-1?(h(),await sleep(1e3),e.value=!1):r.value=s.value[c++%8].name},50)}}).post(()=>({period:k.value})))}return(p,d)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(n),m=>(openBlock(),createElementBlock(Fragment,null,[m=="start"?(openBlock(),createElementBlock("div",{key:0,class:"start-btn flex flex-center",onClick:u},_hoisted_5$1)):(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(["block flex flex-center",{"active-block":r.value==m.name}])},[createBaseVNode("img",{src:m.icon},null,8,_hoisted_6$1),createBaseVNode("span",null,toDisplayString(m.name),1)],2))],64))),256))])])]))}},Lottery=_export_sfc(_sfc_main$2,[["__scopeId","data-v-66d26d58"]]),chat_vue_vue_type_style_index_0_scoped_00de0578_lang="",_withScopeId=o=>(pushScopeId("data-v-00de0578"),o=o(),popScopeId(),o),_hoisted_1$1={class:"chat"},_hoisted_2$1={key:0,class:"controls"},_hoisted_3={key:0,class:"message-item"},_hoisted_4={class:"time"},_hoisted_5={class:"message-content"},_hoisted_6=["onClick"],_hoisted_7={key:2},_hoisted_8={key:1,class:"input-box flex"},_hoisted_9={class:"input"},_hoisted_10=["onKeydown"],_hoisted_11={class:"hongbao-create"},_hoisted_12=_withScopeId(()=>createBaseVNode("div",{class:"title"},"Send Bonus",-1)),_hoisted_13={class:"buttons"},_hoisted_14={class:"hongbao-box"},_hoisted_15=_withScopeId(()=>createBaseVNode("div",{class:"title"},"Congratulations",-1)),_hoisted_16={class:"money"},_sfc_main$1={__name:"chat",setup(o){lib.parse(location.search.slice(1));const k=ref(!1),e=ref({amount:0,num:0,max:0}),r=ref(0),i=ref(!1);function s(){if(e.value.amount==0){showToast("Amount is error!");return}if(e.value.num==0){showToast("Number is error!");return}k.value=!1,useMyFetch("/api/redPacket/create",{immediate:!0,afterFetch:x=>{I(`__hongbao__${x.data.data.period}`)}}).post(()=>({amount:e.value.amount,num:e.value.num,max:e.value.max}))}function n(x){const L=x.replace("__hongbao__","");useMyFetch("/api/redPacket/rob",{immediate:!0,afterFetch:_=>{checkFetchError(_)||(r.value=_.data.data.money,i.value=!0)}}).post(()=>({period:L}))}const u=ref(!1);function p(){I("__choujiang__")}const d=ref(""),m=ref(!1),c=ref([]),h=ref(null),a=ref([]),y=ref([]),T=JSON.parse(useStorage("user").value),v=computed(()=>(T==null?void 0:T.is_admin)===1),g=ref(!0);let b;function S(x){c.value=[...c.value,...x],O()}async function O(){await nextTick(),h.value.scrollTop=1e8}function I(x){b.sendText({text:x,done:(L,_)=>{S([_])}})}function R(){if(!d.value.trim())return;const x=N();I(x),d.value=""}function N(){let x=d.value;return a.value.forEach(L=>{x=x.replaceAll(L,"******************************".slice(0,L.length))}),x}function F(x){showConfirmDialog({confirmButtonText:"Yes",cancelButtonText:"no",message:"Confirm revoke?"}).then(()=>{P(x)}).catch(()=>{})}function P(x){y.value.push(x.idClient),useMyFetch("/api/yunxin/charRoom/recall_msg",{immediate:!0}).post(()=>({roomid:x.chatroomId,msgTimetag:x.time,msgId:x.idClient,fromAcc:x.from,operatorAcc:x.from}))}return(x,L)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$1,[unref(v)?(openBlock(),createElementBlock("div",_hoisted_2$1,[createBaseVNode("img",{class:"hongbao",src:"https://static.lotterybox.com/game/live/hongbao/2.png",onClick:L[0]||(L[0]=()=>k.value=!0)}),createBaseVNode("img",{class:"choujiang",src:"https://static.lotterybox.com/game/live/hongbao/4.png",onClick:L[1]||(L[1]=()=>p())})])):createCommentVNode("",!0),createBaseVNode("div",{class:"message-list",ref_key:"messageListDom",ref:h},[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.value,_=>(openBlock(),createElementBlock(Fragment,null,[!y.value.includes(_.idClient)&&_.text?(openBlock(),createElementBlock("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,toDisplayString(unref(dayjs)(_.time).format("MM-DD HH:mm:ss")),1),createBaseVNode("div",_hoisted_5,[createBaseVNode("span",null,toDisplayString(_.fromNick)+":",1),_.text.indexOf("__hongbao__")==0?(openBlock(),createElementBlock("img",{key:0,class:"hongbao",src:"https://static.lotterybox.com/game/live/hongbao/2.png",onClick:()=>n(_.text)},null,8,_hoisted_6)):_.text.indexOf("__choujiang__")==0?(openBlock(),createElementBlock("img",{key:1,class:"choujiang",src:"https://static.lotterybox.com/game/live/hongbao/4.png",onClick:L[2]||(L[2]=()=>u.value=!0)})):(openBlock(),createElementBlock("span",_hoisted_7,toDisplayString(_.text),1))]),unref(v)?(openBlock(),createBlock(unref(Icon),{key:0,class:"revoke",name:"revoke",onClick:C=>F(_)},null,8,["onClick"])):createCommentVNode("",!0)])):createCommentVNode("",!0)],64))),256))],512),g.value?(openBlock(),createElementBlock("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[withDirectives(createBaseVNode("input",{placeholder:"send message","onUpdate:modelValue":L[3]||(L[3]=_=>d.value=_),onKeydown:withKeys(R,["enter"])},null,40,_hoisted_10),[[vModelText,d.value]])]),createVNode(unref(Button),{type:"success",onClick:R,disabled:!m.value},{default:withCtx(()=>[createTextVNode("Send")]),_:1},8,["disabled"])])):createCommentVNode("",!0)]),createVNode(unref(Popup),{show:k.value,"onUpdate:show":L[8]||(L[8]=_=>k.value=_),style:{width:"300px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_11,[_hoisted_12,createVNode(unref(Field),{modelValue:e.value.amount,"onUpdate:modelValue":L[4]||(L[4]=_=>e.value.amount=_),placeholder:"Enter Amount",label:"Amount"},null,8,["modelValue"]),createVNode(unref(Field),{modelValue:e.value.num,"onUpdate:modelValue":L[5]||(L[5]=_=>e.value.num=_),placeholder:"Enter Number",label:"Count"},null,8,["modelValue"]),createVNode(unref(Field),{modelValue:e.value.max,"onUpdate:modelValue":L[6]||(L[6]=_=>e.value.max=_),placeholder:"Enter Max Amount",label:"Max Amt"},null,8,["modelValue"]),createBaseVNode("div",_hoisted_13,[createVNode(unref(Button),{type:"primary",onClick:s},{default:withCtx(()=>[createTextVNode("Send")]),_:1}),createVNode(unref(Button),{onClick:L[7]||(L[7]=()=>k.value=!1)},{default:withCtx(()=>[createTextVNode("Cancel")]),_:1})])])]),_:1},8,["show"]),createVNode(unref(Popup),{show:i.value,"onUpdate:show":L[9]||(L[9]=_=>i.value=_),closeable:"","close-on-click-overlay":!1},{default:withCtx(()=>[createBaseVNode("div",_hoisted_14,[_hoisted_15,createBaseVNode("div",_hoisted_16,"₹ "+toDisplayString(r.value),1)])]),_:1},8,["show"]),createVNode(unref(Popup),{show:u.value,"onUpdate:show":L[10]||(L[10]=_=>u.value=_),closeable:"","close-on-click-overlay":!1,style:{background:"transparent"}},{default:withCtx(()=>[createVNode(Lottery)]),_:1},8,["show"])],64))}},Chat=_export_sfc(_sfc_main$1,[["__scopeId","data-v-00de0578"]]),user_vue_vue_type_style_index_0_scoped_33d05a17_lang="",_hoisted_1={class:"users"},_hoisted_2={class:"user flex"},_sfc_main={__name:"user",setup(o){return(k,e)=>{var r;return openBlock(),createElementBlock("div",_hoisted_1,[(openBlock(!0),createElementBlock(Fragment,null,renderList((r=k.users)==null?void 0:r.data,i=>(openBlock(),createElementBlock("div",_hoisted_2,[createBaseVNode("div",null,toDisplayString(i.username),1)]))),256))])}}},User=_export_sfc(_sfc_main,[["__scopeId","data-v-33d05a17"]]);export{Chat as C,NoticeBar as N,User as U,useId as u};
