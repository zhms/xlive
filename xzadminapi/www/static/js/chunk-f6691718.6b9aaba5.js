(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f6691718"],{"52ac":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-form",{attrs:{inline:!0,model:t.filters}},[a("el-form-item",[a("el-button",{staticClass:"mr10",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){return t.handleAdd(0)}}},[t._v("添加")])],1)],1),a("el-table",{staticClass:"table",staticStyle:{"margin-top":"-13px"},attrs:{data:t.table_data,border:"","max-height":"670px","cell-style":{padding:"0px"},"highlight-current-row":!0}},[a("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"100"}}),a("el-table-column",{attrs:{align:"center",prop:"role_name",label:"角色名",width:"200"}}),a("el-table-column",{attrs:{align:"center",prop:"parent",label:"上级角色",width:"200"}}),a("el-table-column",{attrs:{align:"center",prop:"memo",label:"备注",width:"300"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(a){return t.handleEdit(e.row,0)}}},[t._v("编辑")]),a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return t.handleDelete(e.row,0)}}},[t._v("删除")])]}}])})],1),a("div",{staticClass:"pagination"},[a("el-pagination",{staticStyle:{"margin-right":"10px"},attrs:{background:"",layout:"sizes,total, prev, pager, next, jumper","current-page":t.page,"page-sizes":t.page_sizes,total:t.total,"page-size":t.page_size},on:{"size-change":t.page_sizeChange,"current-change":t.pageChange}})],1),a("edit-view",{attrs:{show:t.dialog0.show,title:t.dialog0.title,itemdata:t.dialog0.itemdata},on:{"update:show":function(e){return t.$set(t.dialog0,"show",e)},getTableData:t.getTableData}})],1)},n=[],l=(a("7e79"),a("a417")),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dialogBox"},[a("el-dialog",{attrs:{title:t.title,visible:t.visable,width:"500px",center:""},on:{"update:visible":function(e){t.visable=e},open:t.handleOpen}},[a("el-form",{attrs:{"label-width":"90px",inline:!0,model:t.itemdata}},[a("el-form-item",{staticStyle:{"margin-left":"30px"},attrs:{label:"角色名:"}},[a("el-input",{attrs:{disabled:"编辑角色"==t.title},model:{value:t.itemdata.role_name,callback:function(e){t.$set(t.itemdata,"role_name",e)},expression:"itemdata.role_name"}})],1),a("el-form-item",{staticStyle:{"margin-left":"30px"},attrs:{label:"备注:"}},[a("el-input",{model:{value:t.itemdata.memo,callback:function(e){t.$set(t.itemdata,"memo",e)},expression:"itemdata.memo"}})],1),a("el-form-item",{staticStyle:{"margin-left":"30px"},attrs:{label:"上级角色:"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",clearable:""},on:{change:t.showAuthTree},model:{value:t.itemdata.parent,callback:function(e){t.$set(t.itemdata,"parent",e)},expression:"itemdata.parent"}},t._l(t.roles,(function(t){return a("el-option",{key:t.role_name,attrs:{label:t.role_name,value:t.role_name}})})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:t.tree_show,expression:"tree_show"}],staticStyle:{"margin-left":"30px"},attrs:{label:"权限:"}},[a("el-tree",{ref:"authtree",staticStyle:{"margin-left":"85px","margin-top":"-30px",width:"250px"},attrs:{"default-checked-keys":t.tree_selected,"node-key":"path",props:t.tree_data,"show-checkbox":""}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.handleCommit}},[t._v("确定")])],1)],1)],1)},r=[],s=a("53ca"),c=(a("99af"),a("a434"),a("e9c4"),a("b64b"),a("bccc")),d={extends:c["a"],data:function(){return{roles:[],tree_show:!1,tree_data:{},tree_selected:[],parentroledata:null,superroledata:null,roledata:null}},methods:{commitData:function(t){var e=this;if(!this.itemdata.role_name)return this.$message.error("请填写角色名");if(!this.itemdata.parent)return this.$message.error("请选择上级角色");var a=function t(e){for(var a in e)"object"==Object(s["a"])(e[a])?t(e[a]):e[a]=0},i=JSON.parse(JSON.stringify(this.superroledata));a(i);for(var n=this.$refs.authtree.getCheckedNodes(),l=0;l<n.length;l++)if(n[l].leaf){for(var o=n[l].path.split("."),r=i,c=0;c<o.length-1;c++)r=r[o[c]];r[o[o.length-1]]=1}if("编辑角色"==this.title){var d={role_name:this.itemdata.role_name,role_data:JSON.stringify(i),memo:this.itemdata.memo,parent:this.itemdata.parent,state:this.itemdata.state};this.$post("/v1/admin_update_role",d,{google:!0}).then((function(){e.$message.success("编辑成功"),t(!0)}))}if("添加角色"==this.title){var h={parent:this.itemdata.parent,role_name:this.itemdata.role_name,role_data:JSON.stringify(i),memo:this.itemdata.memo,state:1};this.$post("/v1/admin_create_role",h,{google:!0}).then((function(){e.$message.success("添加成功"),t(!0)}))}},onOpen:function(){this.tree_show=!1,this.superroledata=null,this.roles=[],"编辑角色"==this.title?(this.getRoles(),this.showAuthTree()):this.getRoles()},getRoles:function(){var t=this;setTimeout((function(){var e={};t.$post("/v1/admin_get_role",e).then((function(e){t.roles=e.data}))}),200)},showAuthTree:function(){var t=this;if(this.itemdata.parent){var e={role_name:this.itemdata.parent};"god"==e.role_name&&(e.role_name="超级管理员"),this.$post("/v1/admin_get_role",e).then((function(e){t.parentroledata=JSON.parse(e.data[0].role_data);var a={role_name:"超级管理员"};t.$post("/v1/admin_get_role",a).then((function(e){t.superroledata=JSON.parse(e.data[0].role_data);var a={role_name:t.itemdata.role_name||"-"};t.$post("/v1/admin_get_role",a).then((function(e){console.log(e),0==e.data.length&&(e.data=[{role_data:'{"系统首页":{"查":1}}'}]),t.roledata=JSON.parse(e.data[0].role_data);var a=t.getTreeData();t.$refs.authtree.root.setData(a.menu),t.tree_selected=a.selected,t.tree_show=!0}))}))}))}else this.tree_show=!1},getTreeData:function(){var t=this,e=function t(e){for(var a in e)"object"==Object(s["a"])(e[a])?t(e[a]):e[a]=0};e(this.superroledata);var a=function e(a,i){for(var n in i)if("object"==Object(s["a"])(i[n])){var l=a+".".concat(n);e(l,i[n])}else if(1==i[n]){for(var o=a.split("."),r=t.superroledata,c=0;c<o.length;c++)r=r[o[c]];r[n]=1}};for(var i in this.parentroledata){var n="".concat(i);a(n,this.parentroledata[i])}var l=[],o=function e(a,i){for(var n in i)if("object"==Object(s["a"])(i[n])){var l={path:a.path+"."+n,label:n,children:[]};a.children.push(l),e(l,i[n])}else{for(var o=a.path+"."+n,r=o.split("."),c=t.parentroledata,d=0;d<r.length;d++)c=c[r[d]];if(1==c){var h={path:o,label:n,leaf:!0};a.children.push(h)}}};for(var r in this.superroledata){var c={path:r,label:r,children:[]};"系统首页"!=r&&(l.push(c),o(c,this.superroledata[r]))}var d=[],h=function t(e,a){for(var i in a)if("object"==Object(s["a"])(a[i])){var n=e+".".concat(i);t(n,a[i])}else 1==a[i]&&d.push("".concat(e,".").concat(i))};for(var m in this.roledata){var u="".concat(m);h(u,this.roledata[m])}for(var p=0;p<l.length;p++)if(l[p].children)for(var f=0;f<l[p].children.length;f++)if(l[p].children[f].children)for(var g=0;g<l[p].children[f].children.length;g++)l[p].children[f].children[g].children&&0==l[p].children[f].children[g].children.length&&(l[p].children[f].children.splice(g,1),g--);for(var v=0;v<l.length;v++)if(l[v].children)for(var b=0;b<l[v].children.length;b++)l[v].children[b].children&&0==l[v].children[b].children.length&&(l[v].children.splice(b,1),b--);for(var _=0;_<l.length;_++)l[_].children&&0==l[_].children.length&&(l.splice(_,1),_--);return{menu:l,selected:d}}}},h=d,m=a("2877"),u=Object(m["a"])(h,o,r,!1,null,null,null),p=u.exports,f={extends:l["a"],components:{EditView:p},created:function(){this.getTableData()},methods:{getTableData:function(){var t=this,e=this.getQueryData();this.$post("/v1/admin_get_role",e).then((function(e){t.table_data=e.data,t.total=e.total}))},AddItem:function(t,e){if(0==t)return e("添加角色",{})},ModifyItem:function(t,e,a){if(0==t&&"god"==a.parent)return this.$message.error("该角色不可编辑");0==t&&e("编辑角色")},DeleteItem:function(t){var e=this;if("god"==t.parent)return this.$message.error("该角色不可删除");this.$post("/v1/admin_delete_role",t,{google:!0}).then((function(){e.$message.success("删除成功"),e.getTableData()}))}}},g=f,v=Object(m["a"])(g,i,n,!1,null,null,null);e["default"]=v.exports},"7e79":function(t,e,a){},a417:function(t,e,a){"use strict";var i=a("5530"),n=(a("e9c4"),a("b64b"),a("d3b7"),a("159b"),a("5c96")),l=(a("0c6d"),a("2f62")),o=(a("73f5"),a("c1df")),r=a.n(o),s=a("f62d"),c=a("b76c");e["a"]={extends:c["a"],data:function(){return{filters:{},page:1,page_size:15,page_sizes:[15,50,100,200,500,1e3,1500],total:0,table_data:[],itemdata:null,Export:0,columnpicker:!1,column:{},dialog0:{show:!1,title:"",itemdata:{}},dialog1:{show:!1,title:"",itemdata:{}},dialog2:{show:!1,title:"",itemdata:{}},dialog3:{show:!1,title:"",itemdata:{}},dialog4:{show:!1,title:"",itemdata:{}},dialog5:{show:!1,title:"",itemdata:{}},dialog6:{show:!1,title:"",itemdata:{}},dialog7:{show:!1,title:"",itemdata:{}},dialog8:{show:!1,title:"",itemdata:{}},dialog9:{show:!1,title:"",itemdata:{}},symbols:[{id:"trx",name:"TRX"},{id:"usdt",name:"USDT"}]}},computed:Object(i["a"])({},Object(l["b"])(["sellers","channels","games","rooms","states"])),created:function(){if(this.columns){var t="column_".concat(this.$vnode.key),e=localStorage.getItem(t);if(e)this.column=JSON.parse(e);else{for(var a=0;a<this.columns.length;a++)this.column[this.columns[a]]=!0;localStorage.setItem(t,JSON.stringify(this.column))}}},methods:{pageChange:function(t){this.page=t,this.getTableData()},page_sizeChange:function(t){this.page=1,this.page_size=t,this.getTableData()},handleQuery:function(t){var e=this;1===t?(this.Export=1,this.getTableData((function(t){e.Export=0,window.open("/sapi"+t.filename)}))):(this.Export=0,this.page=1,this.getTableData())},handleAdd:function(t){var e=this;this.AddItem(t,(function(a,i){i=i||{},e["dialog".concat(t)].itemdata=i,e["dialog".concat(t)].title=a,e["dialog".concat(t)].show=!0}))},handleEdit:function(t,e){var a=this;this["dialog".concat(e)].itemdata=JSON.parse(JSON.stringify(t)),this.ModifyItem(e,(function(t){a["dialog".concat(e)].title=t,a["dialog".concat(e)].show=!0}),this["dialog".concat(e)].itemdata)},handleDelete:function(t,e){this.DeleteItem(t,e)},getQueryData:function(){var t={};t.page=this.page,t.page_size=this.page_size;var e=JSON.parse(JSON.stringify(this.filters));for(var a in e.channel_id=e.channel_id||0,e)null!=e[a]&&("DateRange"==a&&Object(s["a"])(e[a])?(t["start_time"]=r()(e[a][0]).format("YYYY-MM-DD HH:mm:ss"),t["end_time"]=r()(r()(e[a][1]).valueOf()+864e5).format("YYYY-MM-DD HH:mm:ss")):"DateTimeRange"==a&&Object(s["a"])(e[a])?(t["start_time"]=r()(e[a][0]).format("YYYY-MM-DD HH:mm:ss"),t["end_time"]=r()(r()(e[a][1]).valueOf()+1e3).format("YYYY-MM-DD HH:mm:ss")):(t[a]=e[a],"symbol"==a.toLowerCase()&&(t[a]=e[a].toLowerCase())));return 1==this.Export&&(t.Export=this.Export),t},copy:function(t){var e=document.createElement("textarea");e.value="".concat(t),document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),Object(n["Message"])({type:"success",message:"复制成功",center:!0})},getSummaries:function(t){var e=this,a=t.columns,i=[];return a.forEach((function(t,a){if(0!=a)e.getTotal&&(i[a]=e.getTotal(t.property));else{if(e.getTotal){var n=e.getTotal(0);if(n)return void(i[a]=n)}i[a]="总计"}})),i},selectColumn:function(){this.columnpicker=!0},setColumn:function(t){for(var e in t)this.column[e]=t[e];var a="column_".concat(this.$vnode.key);localStorage.setItem(a,JSON.stringify(this.column))}}}},b76c:function(t,e,a){"use strict";e["a"]={data:function(){return{MapYesNo:{1:"是",2:"否"},ListYesNo:[{id:1,name:"是"},{id:2,name:"否"}]}}}},bccc:function(t,e,a){"use strict";var i=a("5530"),n=(a("b0c0"),a("2f62")),l=a("b76c");e["a"]={extends:l["a"],data:function(){return{table_data:[]}},props:{show:{type:Boolean,default:!1},title:{type:String,default:null},itemdata:{type:Object,default:function(){return{Password:""}}},filters:{type:Object,default:function(){return{}}}},computed:Object(i["a"])(Object(i["a"])({},Object(n["b"])(["sellers","channels","games","rooms","states"])),{},{visable:{get:function(){return this.show},set:function(t){this.$emit("update:show",t)}}}),methods:{handleCommit:function(){var t=this;this.commitData((function(e){t.visable=!e,t.$emit("getTableData")}))},handleOpen:function(){this.onOpen&&this.onOpen()},getMap:function(t){for(var e={},a=0;a<t.length;a++)e[t[a].id]=t[a].name;return e}}}}}]);